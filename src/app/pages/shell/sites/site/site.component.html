<ng-template #renderHome>

    <div class="detailBar-collapsible">
        <span>
            <h4> {{siteDetails.get('id')?.value || 'New'}} - /
                {{siteDetails.get('name')?.value}}
            </h4>
        </span>
        <a [routerLink]="['contract','new']" [state]="{tracingId: 2}">
            <button nz-button nzType="primary" [nzSize]="'small'">
                <span nz-icon nzType="plus"> </span> Contractor

            </button>
        </a>
        <!-- <span>
            <button nz-button nzType="primary" (click)="generatePDF()"> <span nz-icon nzType="download"></span></button>
            <button style="margin-left: 12px;" nz-button nzType="primary" printSectionId="print-section" ngxPrint
                printTitle="MyTitle">

                <span nz-icon nzType="printer" nzTheme="outline"></span>
            </button>
        </span> -->
    </div>
</ng-template>
<nz-collapse nzAccordion>
    <nz-collapse-panel #p nzExpandedIcon='caret-right' [nzHeader]="renderHome"
        [nzActive]="isActive || (siteDetails.get('state')?.value !== siteStates.Approved && siteDetails.get('state')?.value !== siteStates.Completed )"
        [nzDisabled]="(siteDetails.get('state')?.value !== siteStates.Approved && siteDetails.get('state')?.value !== siteStates.Completed )">

        <div class="task-request" id="print-section">
            <nz-card style="width:100%">
                <form nz-form [formGroup]="siteDetails" (ngSubmit)="submitForm()">
                    <div #content>
                        <nz-row nzGutter="2" style="margin-bottom: 12px;">
                            <nz-col [nzMd]="12" [nzSm]="24" [nzXs]="12">
                                <nz-form-item>
                                    <nz-form-label [nzMd]="8" [nzSm]="24" [nzXs]="12" nzRequired nzFor="name">
                                        Name</nz-form-label>
                                    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid date!">
                                        <input class="inputField" nz-input formControlName="name">
                                    </nz-form-control>
                                </nz-form-item>
                            </nz-col>
                            <nz-col [nzMd]="12" [nzSm]="24" [nzXs]="12">

                                <nz-form-item>
                                    <nz-form-label [nzMd]="8" [nzSm]="24" [nzXs]="12" nzRequired
                                        nzFor="budget">budget</nz-form-label>
                                    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid date!">
                                        <input class="inputField" z-input formControlName="budget">
                                    </nz-form-control>
                                </nz-form-item>
                            </nz-col>

                        </nz-row>

                        <nz-row nzGutter="2" style="margin-bottom: 12px;">
                            <nz-col [nzMd]="12" [nzSm]="24" [nzXs]="12">
                                <nz-form-item>
                                    <nz-form-label [nzMd]="8" [nzSm]="24" [nzXs]="12" nzRequired
                                        nzFor="owner">owner</nz-form-label>
                                    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid date!">
                                        <input class="inputField" nz-input formControlName="owner">
                                    </nz-form-control>
                                </nz-form-item>
                            </nz-col>
                            <nz-col [nzMd]="12" [nzSm]="24" [nzXs]="12">
                                <nz-form-item>
                                    <nz-form-label [nzMd]="8" [nzSm]="24" [nzXs]="12" nzRequired
                                        nzFor="contact_no">Contact
                                        No</nz-form-label>
                                    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid date!">
                                        <input class="inputField" nz-input formControlName="contact_no">
                                    </nz-form-control>
                                </nz-form-item>
                            </nz-col>
                        </nz-row>
                        <nz-row nzGutter="2" style="margin-bottom: 12px;">
                            <nz-col [nzMd]="12" [nzSm]="24" [nzXs]="12">
                                <nz-form-item>
                                    <nz-form-label [nzMd]="8" [nzSm]="24" [nzXs]="12" nzRequired nzFor="address">
                                        Address</nz-form-label>
                                    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid date!">
                                        <textarea [rows]="2" class="inputField" nz-input
                                            formControlName="address"></textarea>
                                    </nz-form-control>
                                </nz-form-item>
                            </nz-col>
                        </nz-row>
                        <nz-row nzGutter="2" style="margin-bottom: 12px;">


                            <nz-col [nzMd]="12" [nzSm]="24" [nzXs]="12">
                                <nz-form-item>
                                    <nz-form-label [nzMd]="8" [nzSm]="24" [nzXs]="12" nzRequired
                                        nzFor="site_start_date">Start Date</nz-form-label>
                                    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid date!">
                                        <nz-date-picker nzFormat="MM-dd-yyyy" class="inputField"
                                            formControlName="site_start_date"></nz-date-picker>
                                    </nz-form-control>
                                </nz-form-item>
                            </nz-col>
                            <nz-col [nzMd]="12" [nzSm]="24" [nzXs]="12">


                                <nz-form-item>
                                    <nz-form-label [nzMd]="8" [nzSm]="24" [nzXs]="12" nzRequired
                                        nzFor="site_end_date">End Date</nz-form-label>
                                    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid date!">
                                        <nz-date-picker nzFormat="MM-dd-yyyy" class="inputField"
                                            formControlName="site_end_date"></nz-date-picker>
                                    </nz-form-control>
                                </nz-form-item>
                            </nz-col>

                        </nz-row>
                        <nz-row nzGutter="2" style="margin-bottom: 12px;">


                            <nz-col [nzMd]="12" [nzSm]="24" [nzXs]="12">

                                <!-- <nz-form-item *ngIf="taskDetails.get('isSiteBased')?.value">
                                    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="assignee">Projects</nz-form-label>
                                    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid date!">
                                        <nz-select nzMode="multiple" class="inputField" formControlName="site_ids"
                                            placeholder="Select sites">
                                            <nz-option *ngFor="let siteItem of sites" [nzValue]="siteItem.id"
                                                [nzLabel]="siteItem.label"></nz-option>
                                        </nz-select>
                                    </nz-form-control>
                                </nz-form-item> -->

                                <nz-form-item>
                                    <nz-form-label [nzMd]="8" [nzSm]="24"[nzXs]="12" nzRequired nzFor="site_supervisors">Supervisors</nz-form-label>
                                    <nz-form-control  [nzSm]="14" [nzXs]="24" nzErrorTip="The input is not valid!">
                                      <nz-select nzMode="multiple" id="reports_to" formControlName="site_supervisors" placeholder="Select user">
                                        <ng-container *ngFor="let user of listOfData">
                                            <ng-container *filterUser="{ user: user, permissionName: permissions.AddUpdateTask, isAdmin: false, isContractor: false }">
                                              <nz-option [nzValue]="user?.id" [nzLabel]="user?.name"></nz-option>
                                            </ng-container>
                                          </ng-container>
                                      </nz-select>
                                    </nz-form-control>
                                  </nz-form-item>
                            </nz-col>
                        </nz-row>
                        <nz-row nzGutter="2" style="margin-bottom: 12px;">
                            <nz-col [nzMd]="24" [nzSm]="24" [nzXs]="24">
                                <nz-form-item>
                                    <nz-form-label [nzMd]="4" [nzSm]="24" [nzXs]="24" nzRequired nzFor="details">
                                        Contract Details
                                    </nz-form-label>
                                    <nz-form-control [nzSm]="20" [nzXs]="24" nzErrorTip="The input is not valid date!">
                                        <textarea [rows]="6" class="inputField" nz-input formControlName="details">
                        </textarea>
                                    </nz-form-control>
                                </nz-form-item>
                            </nz-col>
                        </nz-row>
                    </div>
                    <span class="flex space-between">
                        <span>
                            <button *ngIf="(siteDetails.controls.state.value==siteStates.PendingApproval)" nz-button
                                nzType="primary" (click)="cancelPaymentDetails()" nzDanger
                                style="margin-bottom: 12px;float: right;">Cancel</button>
                        </span>
                        <span>
                            <button *ngIf="siteDetails.controls.state.value==siteStates.Draft" nz-button
                                nzType="primary" [disabled]="siteDetails.invalid" (click)="submitRequest()"
                                style="margin-bottom: 12px;float: right;">Submit</button>

                            <button *ngIf="siteDetails.controls.state.value==siteStates.PendingApproval" nz-button
                                nzType="primary" (click)="approveDetails()"
                                style="margin-bottom: 12px;float: right;">Approve
                                Site</button>
                        </span>
                    </span>
                </form>
            </nz-card>

        </div>

        <ng-template #expandedIcon let-active>
            {{ active }}
            <span nz-icon nzType="caret-right" class="ant-collapse-arrow" [nzRotate]="p.nzActive ? 90 : -90"></span>
        </ng-template>
    </nz-collapse-panel>
</nz-collapse>

<div style="margin-top: 12px;"
    *ngIf="siteDetails.get('state')?.value===siteStates.Approved||siteDetails.get('state')?.value===siteStates.Completed">

    <nz-row nzGutter="4" style="margin-bottom: 12px;">
        <nz-col [nzMd]="16" [nzSm]="24" [nzXs]="24">

            <nz-card style="width:100%">
                <app-expenses [site_id]="site_id"></app-expenses>
            </nz-card>
        </nz-col>
        <nz-col [nzMd]="8" [nzSm]="24" [nzXs]="24">
            <nz-card style="width:100%">
                <app-owner-payments [site_id]="site_id"></app-owner-payments>
            </nz-card>
            <nz-card style="width:100%; margin-top: 4px;">
                <app-contractor-payments [site_id]="site_id"></app-contractor-payments>
            </nz-card>
            <nz-card style="margin-top: 4px; width:100%">
                <highcharts-chart [Highcharts]="Highcharts" *ngIf="showChart" [options]="chartOptions"
                    [constructorType]="chartConstructor" style="width: 100%;display: block;">
                </highcharts-chart>
            </nz-card>
        </nz-col>

    </nz-row>

    <button *ngIf="siteDetails.controls.state.value==siteStates.Approved" nz-button nzType="primary"
        (click)="completeSiteWork()" style="margin-bottom: 12px;float: right;">Complete Work</button>
</div>