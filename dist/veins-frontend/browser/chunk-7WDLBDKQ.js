import{a as Be,b as ne,d as Xe}from"./chunk-OG6MHJEU.js";import{a as le}from"./chunk-ATLZZJBL.js";import{a as y,b as he,c as ae}from"./chunk-7HYNQYBZ.js";import{$ as pe,A as z,Ab as X,B as C,Ba as G,Bc as Ve,Cc as Ie,Db as Ne,E as I,Ec as ke,Fb as $,Gc as Me,Ha as D,Hc as Ae,Ia as O,Ib as L,Jb as Z,Jc as Ge,Kc as je,La as ze,Lb as Ee,Lc as qe,Mb as De,Mc as We,Na as Ce,Nb as K,O as m,P as x,Sc as He,U as u,V as l,Wb as Oe,Xb as Pe,a as w,aa as ce,ac as J,b as re,ba as de,bc as Te,ca as s,cc as Ue,da as r,db as se,e as b,ea as f,ec as Fe,fb as j,fc as Re,gc as Q,ha as g,hb as q,hc as Y,ia as h,ja as p,jb as ve,jc as ee,kb as ge,lb as W,lc as te,mb as P,mc as ie,na as E,nb as T,oa as c,ob as U,pa as F,pb as xe,qa as R,qb as be,sa as k,ta as M,tb as Se,ua as A,ub as ye,v as me,va as _e,vb as we,w as N,x as V,xb as H,ya as ue,yb as v,za as fe,zb as B}from"./chunk-I3YC35GG.js";function lt(t,n){if(t&1&&f(0,"nz-option",20),t&2){let i=n.$implicit;l("nzValue",i==null?null:i.id)("nzLabel",i==null?null:i.name)}}function mt(t,n){if(t&1&&(s(0,"nz-select",19),u(1,lt,1,2,"nz-option",10),r()),t&2){let i=p(2);m(),l("ngForOf",i.users)}}function pt(t,n){if(t&1&&f(0,"nz-option",20),t&2){let i=n.$implicit;l("nzValue",i==null?null:i.value)("nzLabel",i==null?null:i.key)}}function ct(t,n){if(t&1&&f(0,"nz-option",20),t&2){let i=n.$implicit;l("nzValue",i.id)("nzLabel",i.name)}}function dt(t,n){if(t&1&&(s(0,"nz-select",21),u(1,ct,1,2,"nz-option",10),r()),t&2){let i=p(2);m(),l("ngForOf",i.subOrganizations)}}function _t(t,n){if(t&1&&(s(0,"nz-form",3)(1,"div",4)(2,"div",5)(3,"nz-form-item")(4,"nz-form-label"),c(5,"Name"),r(),s(6,"nz-form-control"),f(7,"input",6),r()()()(),s(8,"div",4)(9,"div",7)(10,"nz-form-item")(11,"nz-form-label"),c(12,"Reports To"),r(),s(13,"nz-form-control"),u(14,mt,2,1,"nz-select",8),r()()()(),s(15,"div",4)(16,"div",5)(17,"nz-form-item")(18,"nz-form-label"),c(19,"Role Name"),r(),s(20,"nz-form-control")(21,"nz-select",9),u(22,pt,1,2,"nz-option",10),r()()()()(),s(23,"div",4)(24,"div",7)(25,"nz-form-item")(26,"nz-form-label"),c(27,"Organization "),r(),s(28,"nz-form-control"),u(29,dt,2,1,"nz-select",11),r()()()(),s(30,"div",4)(31,"div",7)(32,"nz-form-item")(33,"nz-form-label"),c(34,"Email "),r(),s(35,"nz-form-control"),f(36,"input",12),r()()()(),s(37,"div",4)(38,"div",7)(39,"nz-form-item")(40,"nz-form-label"),c(41,"Contact No "),r(),s(42,"nz-form-control"),f(43,"input",13),r()()()(),s(44,"div",4)(45,"div",7)(46,"nz-form-item")(47,"nz-form-label"),c(48,"Address "),r(),s(49,"nz-form-control"),f(50,"textarea",14),r()()()(),s(51,"div",4)(52,"div",15)(53,"nz-form-item")(54,"nz-form-label"),c(55,"Is Employee "),r(),s(56,"nz-form-control"),f(57,"label",16),r()()(),s(58,"div",15)(59,"nz-form-item")(60,"nz-form-label"),c(61,"Is Contractor"),r(),s(62,"nz-form-control"),f(63,"label",17),r()()(),s(64,"div",15)(65,"nz-form-item")(66,"nz-form-label"),c(67,"Is Admin "),r(),s(68,"nz-form-control"),f(69,"label",18),r()()()()()),t&2){let i=p();l("formGroup",i.userForm),m(),l("nzGutter",8),m(7),l("nzGutter",8),m(6),l("ngIf",i.users.length),m(),l("nzGutter",8),m(7),l("ngForOf",i.userRoles),m(),l("nzGutter",8),m(6),l("ngIf",i.subOrganizations.length),m(),l("nzGutter",8),m(7),l("nzGutter",8),m(7),l("nzGutter",8),m(7),l("nzGutter",8)}}function ut(t,n){if(t&1){let i=g();s(0,"div",22)(1,"button",23),h("click",function(){z(i);let o=p();return C(o.close())}),c(2,"Cancel"),r(),s(3,"button",24),h("click",function(){z(i);let o=p();return C(o.addUser())}),c(4,"Submit"),r()()}if(t&2){let i=p();m(3),l("disabled",!i.userForm.valid)}}var ft=()=>({overflow:"auto"}),Je=(()=>{let n=class n{constructor(e,o,a){this.userService=e,this.fb=o,this.notification=a,this.visible=!1,this.users=[],this.userRoles=[],this.subOrganizations=[],this.isEdit=!1,this.closeDrawer=new me,this.userForm=this.fb.group({name:["",[v.required]],reports_to:[0,[v.required]],role:[null,[v.required]],sub_organization_id:[null,[v.required]],organization_id:[parseInt(localStorage.getItem("organization_id")||"0")],password:["p@ssw0rD"],email:["",[v.required]],contact_no:["",[v.required]],address:[""],is_admin:[!1],is_contractor:[!1],is_employee:[!1]})}ngOnInit(){this.isEdit&&(this.userForm=this.fb.group({name:[this.selectedUser.name,[v.required]],reports_to:[this.selectedUser.reports_to,[v.required]],role:[this.selectedUser.role_id,[v.required]],sub_organization_id:[this.selectedUser.sub_organization_id,[v.required]],organization_id:[parseInt(localStorage.getItem("organization_id")||"0")],email:[this.selectedUser.email,[v.required]],contact_no:[this.selectedUser.contact_no,[v.required]],address:[this.selectedUser.address],is_admin:[this.selectedUser.is_admin],is_contractor:[this.selectedUser.is_contractor],is_employee:[this.selectedUser.is_employee]}))}close(){this.closeDrawer.emit(!1)}addUser(){return b(this,null,function*(){this.isEdit?(console.log(this.userForm),yield this.userService.updateUser(this.userForm.value,this.selectedUser.id),this.notification.create("success","User details update successfully",""),this.closeDrawer.emit(!0)):(console.log(this.userForm),yield this.userService.createUser(this.userForm.value),this.notification.create("success","User created successfully",""),this.closeDrawer.emit(!0))})}objectKeys(e){return Object.keys(e).map(o=>({key:o,value:e[o]}))}};n.\u0275fac=function(o){return new(o||n)(x(j),x(Z),x(Ve))},n.\u0275cmp=N({type:n,selectors:[["app-create-user-drawer"]],inputs:{visible:"visible",users:"users",userRoles:"userRoles",subOrganizations:"subOrganizations",isEdit:"isEdit",selectedUser:"selectedUser"},outputs:{closeDrawer:"closeDrawer"},decls:4,vars:7,consts:[[3,"nzBodyStyle","nzMaskClosable","nzWidth","nzVisible","nzTitle","nzFooter","nzOnClose"],[3,"formGroup",4,"nzDrawerContent"],["footerTpl",""],[3,"formGroup"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","24"],["formControlName","name","nz-input","","placeholder","please enter user name"],["nz-col","","nz-col","","nzSpan","24"],["id","reports_to","formControlName","reports_to","placeholder","Select user",4,"ngIf"],["id","role","formControlName","role","placeholder","Select role"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["id","sub_organization_id","formControlName","sub_organization_id","placeholder","Select Organization",4,"ngIf"],["formControlName","email","nz-input","","placeholder","Add email"],["formControlName","contact_no","nz-input","","placeholder","Add contact no"],["nz-input","","rows","2","formControlName","address","nz-input","","placeholder","Add address"],["nz-col","","nz-col","","nzSpan","8"],["nz-checkbox","","formControlName","is_employee","placeholder","Add is employee"],["nz-checkbox","","formControlName","is_contractor","placeholder","Add is contractor"],["nz-checkbox","","formControlName","is_admin","placeholder","Add is admin"],["id","reports_to","formControlName","reports_to","placeholder","Select user"],[3,"nzValue","nzLabel"],["id","sub_organization_id","formControlName","sub_organization_id","placeholder","Select Organization"],[2,"float","right"],["nz-button","",2,"margin-right","8px",3,"click"],["nz-button","","nzType","primary",3,"disabled","click"]],template:function(o,a){if(o&1&&(s(0,"nz-drawer",0),h("nzOnClose",function(){return a.close()}),u(1,_t,70,12,"nz-form",1)(2,ut,5,1,"ng-template",null,2,G),r()),o&2){let d=E(3);l("nzBodyStyle",_e(6,ft))("nzMaskClosable",!1)("nzWidth",720)("nzVisible",a.visible)("nzTitle",a.isEdit?"Edit User":"Create User")("nzFooter",d)}},dependencies:[D,O,U,P,T,J,Re,Fe,Y,Q,ee,ie,te,K,Oe,Pe,H,B,X,$,L]});let t=n;return t})();function xt(t,n){if(t&1){let i=g();s(0,"button",6),h("click",function(){z(i);let o=p();return C(o.open())}),c(1,"Add"),r()}}function bt(t,n){if(t&1){let i=g();s(0,"app-create-user-drawer",7),h("closeDrawer",function(o){z(i);let a=p();return C(a.close(o))}),r()}if(t&2){let i=p();l("subOrganizations",i.subOrganizations)("visible",i.visible)("userRoles",i.userRoles)("users",i.listOfData)("isEdit",i.isEdit)("selectedUser",i.selectedUser)}}function St(t,n){if(t&1&&(s(0,"th",8),c(1),r()),t&2){let i=n.$implicit;l("nzSortFn",i.compare)("nzSortPriority",i.priority),m(),R(" ",i.title," ")}}function yt(t,n){if(t&1){let i=g();s(0,"a",10),h("click",function(){z(i);let o=p().index,a=p();return C(a.startEdit(o))}),c(1,"Edit"),r()}}function wt(t,n){if(t&1){let i=g();s(0,"a",10),h("click",function(){z(i);let o=p().index,a=p();return C(a.openChangePasswordModal(o))}),c(1,"Change "),f(2,"span",11),r()}}function Nt(t,n){if(t&1&&(s(0,"tr")(1,"td"),c(2),r(),s(3,"td"),c(4),r(),s(5,"td"),c(6),r(),s(7,"td"),c(8),r(),s(9,"td"),u(10,yt,2,0,"a",9),r(),s(11,"td"),u(12,wt,3,0,"a",9),r()()),t&2){let i=n.$implicit,e=p();m(2),F(i.name),m(2),F(i.reportTo),m(2),F(i.roleName),m(2),F(i.sub_organization),m(2),l("appHasPermission",e.appPermissions.UpdateUsers),m(2),l("appHasPermission",e.appPermissions.UpdateUsers)}}var Qe=(()=>{let n=class n{constructor(e,o,a){this.userService=e,this.appService=o,this.modal=a,this.listOfColumn=[{title:"Name",compare:(d,_)=>d.name.localeCompare(_.name),priority:!1},{title:"Reports To",compare:(d,_)=>d.reports_to-_.reports_to,priority:2},{title:"Role Name",compare:(d,_)=>d.role_id-_.role_id,priority:3},{title:"Sub Organization",compare:(d,_)=>d.sub_organization_id-_.sub_organization_id,priority:3},{title:"Action",compare:(d,_)=>d.role_id-_.role_id,priority:3},{title:"",compare:(d,_)=>d.role_id-_.role_id,priority:3}],this.listOfData=[],this.visible=!1,this.isEdit=!1,this.appPermissions=y}ngOnInit(){this.populateUserData()}open(e=!1){this.visible=!0,this.isEdit=e}close(e=!1){this.visible=!1,this.isEdit=!1,e&&this.populateUserData()}populateUserData(){return b(this,null,function*(){this.listOfData=yield this.userService.getOrganizationUsers(),this.userRoles=yield this.appService.getRoles(),this.subOrganizations=yield this.appService.getSubOrganizations(),this.userRoles=this.userRoles.map(e=>({key:e.role_name,value:e.id})),this.subOrganizations=this.subOrganizations.map(e=>re(w({},e),{key:e.name,value:e.id})),this.mapUserData()})}mapUserData(){console.log("userRoles",this.userRoles),this.listOfData=this.listOfData.map(e=>{let o="",a=this.userRoles.find(S=>e.role?.id===S.value),d=this.listOfData.find(S=>S.id==e.reports_to);e.reports_to=d?.id,e.role_id=a?.value;let _=this.subOrganizations.find(S=>S.id===parseInt(e.sub_organization_id.toString()));return e.sub_organization_id=_?.id,re(w({},e),{sub_organization:_?.name,roleName:a?.key,reportTo:this.listOfData.find(S=>S.id==e.reports_to)?.name})})}startEdit(e){this.open(!0),this.selectedUser=this.listOfData[e]}openChangePasswordModal(e){this.modal.create({nzTitle:"Change Password ("+this.listOfData[e].name+")",nzContent:Be,nzFooter:null,nzData:{user:this.listOfData[e]}}).afterClose.subscribe(a=>{a&&console.log("Password changed",a)})}};n.\u0275fac=function(o){return new(o||n)(x(j),x(q),x(Se))},n.\u0275cmp=N({type:n,selectors:[["app-users"]],decls:10,vars:6,consts:[["nz-button","","nzType","primary",3,"click",4,"appHasPermission"],[3,"subOrganizations","visible","userRoles","users","isEdit","selectedUser","closeDrawer",4,"ngIf"],["nzShowPagination","false",3,"nzData","nzPageSize"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["nz-button","","nzType","primary",3,"click"],[3,"subOrganizations","visible","userRoles","users","isEdit","selectedUser","closeDrawer"],[3,"nzSortFn","nzSortPriority"],[3,"click",4,"appHasPermission"],[3,"click"],["nz-icon","","nzType","unlock","nzTheme","outline"]],template:function(o,a){if(o&1&&(u(0,xt,2,0,"button",0)(1,bt,1,6,"app-create-user-drawer",1),s(2,"nz-table",2,3)(5,"thead")(6,"tr"),u(7,St,2,3,"th",4),r()(),s(8,"tbody"),u(9,Nt,13,6,"tr",5),r()()),o&2){let d=E(4);l("appHasPermission",a.appPermissions.UpdateUsers),m(),l("ngIf",a.visible),m(),l("nzData",a.listOfData)("nzPageSize",1e3),m(5),l("ngForOf",a.listOfColumn),m(2),l("ngForOf",d.data)}},dependencies:[D,O,U,P,T,W,je,Me,ke,Ae,We,Ge,qe,ne,Je]});let t=n;return t})();function Et(t,n){if(t&1){let i=g();s(0,"div")(1,"button",3),h("click",function(){z(i);let o=p();return C(o.showModal())}),c(2,"Add Role"),r()()}}function Dt(t,n){if(t&1&&(s(0,"nz-form",4)(1,"nz-form-item")(2,"nz-form-label",5),c(3,"Role Name"),r(),s(4,"nz-form-control",6),f(5,"input",7),r()()()),t&2){let i=p();l("formGroup",i.addRoleForm)}}function Ot(t,n){if(t&1){let i=g();s(0,"div")(1,"nz-form-item")(2,"nz-form-label",14),c(3,"Role Name"),r(),s(4,"nz-form-control",15)(5,"input",16),A("ngModelChange",function(o){z(i);let a=p().$implicit,d=p();return M(d.editCache[a.id].data.role_name,o)||(d.editCache[a.id].data.role_name=o),C(o)}),r()()()()}if(t&2){let i=p().$implicit,e=p();m(5),k("ngModel",e.editCache[i.id].data.role_name)}}function Pt(t,n){if(t&1){let i=g();s(0,"nz-col",17)(1,"label",18),A("ngModelChange",function(o){let d=z(i).$implicit,_=p().$implicit;return M(_.role_permissions[d.value],o)||(_.role_permissions[d.value]=o),C(o)}),r(),c(2),r()}if(t&2){let i=n.$implicit,e=p().$implicit,o=p();l("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",4),m(),l("disabled",!(o.editCache[e.id]!=null&&o.editCache[e.id].edit)),k("ngModel",e.role_permissions[i.value]),m(),R(" ",o.permissionNames[i.value]," ")}}function Tt(t,n){if(t&1){let i=g();s(0,"div")(1,"a",19),h("click",function(){z(i);let o=p(2).$implicit,a=p();return C(a.startEdit(o.id))}),c(2,"Edit"),r()()}}function Ut(t,n){if(t&1){let i=g();s(0,"div")(1,"a",20),h("click",function(){z(i);let o=p(2).$implicit,a=p();return C(a.saveEdit(o.id))}),c(2,"Save"),r(),c(3," \xA0 "),s(4,"a",21),h("nzOnConfirm",function(){z(i);let o=p(2).$implicit,a=p();return C(a.cancelEdit(o.id))}),c(5,"Cancel"),r()()}}function Ft(t,n){if(t&1&&(s(0,"span"),u(1,Tt,3,0,"div",10)(2,Ut,6,0,"div",10),r()),t&2){let i=p().$implicit,e=p();m(),l("ngIf",!(e.editCache[i.id]!=null&&e.editCache[i.id].edit)),m(),l("ngIf",e.editCache[i.id]==null?null:e.editCache[i.id].edit)}}function Rt(t,n){if(t&1&&(c(0),f(1,"span",22)),t&2){let i=n.$implicit;p();let e=E(1);R(" ",i," "),m(),l("nzRotate",e.nzActive?90:-90)}}function Vt(t,n){if(t&1&&(s(0,"nz-collapse-panel",8,9),u(2,Ot,6,1,"div",10),s(3,"nz-row",11),u(4,Pt,3,8,"nz-col",12),ue(5,"keyvalue"),r(),u(6,Ft,3,2,"span",0)(7,Rt,2,2,"ng-template",null,13,G),r()),t&2){let i=n.$implicit,e=p();l("nzHeader",i.role_name),m(2),l("ngIf",e.editCache[i.id]==null?null:e.editCache[i.id].edit),m(2),l("ngForOf",fe(5,4,e.appPermissions)),m(2),l("appHasPermission",e.appPermissions.UpdatePermissions)}}var Ye=(()=>{let n=class n{constructor(e,o){this.fb=e,this.appService=o,this.isModalVisible=!1,this.defuaultpermissions=ae,this.permissionNames=he,this.appPermissions=y,this.rolePermissions={},this.editCache={},this.addRoleForm=this.fb.group({role_name:["",[v.required]],organization_id:[localStorage.getItem("organization_id")],role_permissions:[ae]})}ngOnInit(){this.getAndSetRolesPermission()}getAndSetRolesPermission(){return b(this,null,function*(){this.roles=yield this.appService.getRolesAndPermissions(),this.updateEditCache()})}handleCancel(){this.isModalVisible=!1}showModal(){this.isModalVisible=!0}handleOk(){return b(this,null,function*(){this.isModalVisible=!1,yield this.appService.createRole(this.addRoleForm.value),this.isModalVisible=!1,this.getAndSetRolesPermission()})}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let o=this.roles.findIndex(a=>a.id.toString()===e);this.editCache[e]={data:w({},this.roles[o]),edit:!1}}saveEdit(e){return b(this,null,function*(){let o=this.roles.findIndex(a=>a.id.toString()===e);yield this.appService.updateRole({id:e,role_permissions:this.editCache[e].data.role_permissions,role_name:this.editCache[e].data.role_name}),this.editCache[e].edit=!1,Object.assign(this.roles[o],this.editCache[e].data)})}updateEditCache(){this.roles.forEach(e=>{this.editCache[e.id]={edit:!1,data:w({},e)}})}};n.\u0275fac=function(o){return new(o||n)(x(Z),x(q))},n.\u0275cmp=N({type:n,selectors:[["app-role-permissions"]],decls:7,vars:2,consts:[[4,"appHasPermission"],["nzTitle","Add Role",3,"nzVisible","nzVisibleChange","nzOnCancel","nzOnOk"],[3,"formGroup",4,"nzModalContent"],["nz-button","","nzType","primary",3,"click"],[3,"formGroup"],["nzRequired",""],["nzHasFeedback","","nzErrorTip","Please input role name"],["nz-input","","formControlName","role_name"],[3,"nzHeader"],["p",""],[4,"ngIf"],["nzGutter","8"],[3,"nzSm","nzXs","nzMd","nzXl","nzXXl",4,"ngFor","ngForOf"],["expandedIcon",""],["nzFor","terms"],["nzErrorTip",""],["type","text","nz-input","",3,"ngModel","ngModelChange"],[3,"nzSm","nzXs","nzMd","nzXl","nzXXl"],["nz-checkbox","",3,"disabled","ngModel","ngModelChange"],[3,"click"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],["nz-icon","","nzType","caret-right",1,"ant-collapse-arrow",3,"nzRotate"]],template:function(o,a){o&1&&(u(0,Et,3,0,"div",0),s(1,"nz-modal",1),A("nzVisibleChange",function(_){return M(a.isModalVisible,_)||(a.isModalVisible=_),_}),h("nzOnCancel",function(){return a.handleCancel()})("nzOnOk",function(){return a.handleOk()}),u(2,Dt,6,1,"nz-form",2),r(),s(3,"div")(4,"nz-collapse"),ce(5,Vt,9,6,"nz-collapse-panel",8,pe),r()()),o&2&&(l("appHasPermission",a.appPermissions.UpdatePermissions),m(),k("nzVisible",a.isModalVisible),m(4),de(a.roles))},dependencies:[D,O,U,P,T,J,Ue,Te,W,Y,Q,ee,ie,te,K,we,ye,Ie,H,B,X,$,L,Ne,ne,ze]});let t=n;return t})();var It=[{path:"",component:Qe,data:{name:"Users",permission:y.ManageUsers},canActivate:[le]},{path:"roles",component:Ye,data:{name:"Roles",permission:y.ViewPermissions},canActivate:[le]}],et=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=V({type:n}),n.\u0275inj=I({imports:[se.forChild(It),se]});let t=n;return t})();var tt=ve,kt=Object.keys(tt).map(t=>tt[t]),Si=(()=>{let n=class n{};n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=V({type:n}),n.\u0275inj=I({providers:[{provide:be,useValue:xe},{provide:ge,useValue:kt}],imports:[Ce,et,He,De,Ee,Xe]});let t=n;return t})();export{Si as TeamModule};
