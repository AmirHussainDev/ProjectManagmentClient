import{a as he,b as xe,c as se}from"./chunk-PYMJPE53.js";import{$ as C,Ab as U,Ba as V,Bb as k,Ca as F,Dc as Be,Ea as Ce,Fb as Oe,Ga as ge,Gb as Ne,Hb as K,Ib as J,J as p,K as v,Nb as De,Ob as Ee,P as _,Pb as Te,Q as m,Rb as Ve,Sb as Fe,Tb as Q,Ub as Y,Vb as ee,W as me,X as pe,Xa as ae,Xb as te,Y as ce,Yb as ie,Z as s,Za as G,_ as a,_a as $,aa as de,ab as ve,ba as _e,bb as ye,ca as g,cb as we,da as z,db as R,ea as l,eb as D,fb as M,gb as j,ia as N,ja as d,jb as X,ka as W,kc as Re,la as A,lb as q,lc as Me,na as y,nc as ne,oa as w,ob as H,pa as b,pb as Z,pc as Ie,q as le,qa as ue,r as E,rb as be,rc as Pe,s as L,sb as Se,sc as Ue,ta as fe,tb as I,ua as ze,uc as ke,v as u,vc as We,w as f,wa as T,wc as Ae,xc as Le,z as B,zb as P}from"./chunk-EHIC6YVN.js";import"./chunk-NFQMHT45.js";import{a as S,b as re,g as x}from"./chunk-MON7YFGF.js";function ot(i,o){if(i&1&&C(0,"nz-option",13),i&2){let t=o.$implicit;m("nzValue",t==null?null:t.id)("nzLabel",t==null?null:t.name)}}function rt(i,o){if(i&1&&(s(0,"nz-select",12),_(1,ot,1,2,"nz-option",10),a()),i&2){let t=l(2);p(),m("ngForOf",t.users)}}function at(i,o){if(i&1&&C(0,"nz-option",13),i&2){let t=o.$implicit;m("nzValue",t==null?null:t.value)("nzLabel",t==null?null:t.key)}}function st(i,o){if(i&1&&C(0,"nz-option",13),i&2){let t=o.$implicit;m("nzValue",t.id)("nzLabel",t.name)}}function lt(i,o){if(i&1&&(s(0,"nz-select",14),_(1,st,1,2,"nz-option",10),a()),i&2){let t=l(2);p(),m("ngForOf",t.subOrganizations)}}function mt(i,o){if(i&1&&(s(0,"nz-form",3)(1,"div",4)(2,"div",5)(3,"nz-form-item")(4,"nz-form-label"),d(5,"Name"),a(),s(6,"nz-form-control"),C(7,"input",6),a()()()(),s(8,"div",4)(9,"div",7)(10,"nz-form-item")(11,"nz-form-label"),d(12,"Reports To"),a(),s(13,"nz-form-control"),_(14,rt,2,1,"nz-select",8),a()()()(),s(15,"div",4)(16,"div",5)(17,"nz-form-item")(18,"nz-form-label"),d(19,"Role Name"),a(),s(20,"nz-form-control")(21,"nz-select",9),_(22,at,1,2,"nz-option",10),a()()()()(),s(23,"div",4)(24,"div",7)(25,"nz-form-item")(26,"nz-form-label"),d(27,"Organization "),a(),s(28,"nz-form-control"),_(29,lt,2,1,"nz-select",11),a()()()()()),i&2){let t=l();m("formGroup",t.userForm),p(),m("nzGutter",8),p(7),m("nzGutter",8),p(6),m("ngIf",t.users.length),p(),m("nzGutter",8),p(7),m("ngForOf",t.userRoles),p(),m("nzGutter",8),p(6),m("ngIf",t.subOrganizations.length)}}function pt(i,o){if(i&1){let t=g();s(0,"div",15)(1,"button",16),z("click",function(){u(t);let n=l();return f(n.close())}),d(2,"Cancel"),a(),s(3,"button",17),z("click",function(){u(t);let n=l();return f(n.addUser())}),d(4,"Submit"),a()()}if(i&2){let t=l();p(3),m("disabled",!t.userForm.valid)}}var ct=()=>({overflow:"auto"}),Ze=(()=>{let o=class o{constructor(e,n){this.userService=e,this.fb=n,this.visible=!1,this.users=[],this.userRoles=[],this.subOrganizations=[],this.closeDrawer=new le,this.userForm=this.fb.group({name:["",[D.required]],reports_to:[0,[D.required]],role:[null,[D.required]],sub_organization_id:[null,[D.required]],organization_id:[parseInt(localStorage.getItem("organization_id")||"0")],password:["p@ssw0rD"]})}ngOnInit(){}close(){this.closeDrawer.emit(!1)}addUser(){return x(this,null,function*(){console.log(this.userForm),yield this.userService.createUser(this.userForm.value),this.closeDrawer.emit(!0)})}objectKeys(e){return Object.keys(e).map(n=>({key:n,value:e[n]}))}};o.\u0275fac=function(n){return new(n||o)(v(G),v(Z))},o.\u0275cmp=E({type:o,selectors:[["app-create-user-drawer"]],inputs:{visible:"visible",users:"users",userRoles:"userRoles",subOrganizations:"subOrganizations"},outputs:{closeDrawer:"closeDrawer"},decls:4,vars:6,consts:[["nzTitle","Create",3,"nzBodyStyle","nzMaskClosable","nzWidth","nzVisible","nzFooter","nzOnClose"],[3,"formGroup",4,"nzDrawerContent"],["footerTpl",""],[3,"formGroup"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","12"],["formControlName","name","nz-input","","placeholder","please enter user name"],["nz-col","","nz-col","","nzSpan","12"],["id","reports_to","formControlName","reports_to","placeholder","Select user",4,"ngIf"],["id","role","formControlName","role","placeholder","Select role"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["id","sub_organization_id","formControlName","sub_organization_id","placeholder","Select Organization",4,"ngIf"],["id","reports_to","formControlName","reports_to","placeholder","Select user"],[3,"nzValue","nzLabel"],["id","sub_organization_id","formControlName","sub_organization_id","placeholder","Select Organization"],[2,"float","right"],["nz-button","",2,"margin-right","8px",3,"click"],["nz-button","","nzType","primary",3,"disabled","click"]],template:function(n,r){if(n&1&&(s(0,"nz-drawer",0),z("nzOnClose",function(){return r.close()}),_(1,mt,30,8,"nz-form",1)(2,pt,5,1,"ng-template",null,2,T),a()),n&2){let c=N(3);m("nzBodyStyle",ue(5,ct))("nzMaskClosable",!1)("nzWidth",720)("nzVisible",r.visible)("nzFooter",c)}},dependencies:[V,F,k,P,U,Fe,Ve,Y,Q,ee,ie,te,I,K,J,R,M,j,q,H]});let i=o;return i})();function ft(i,o){if(i&1){let t=g();s(0,"app-create-user-drawer",6),z("closeDrawer",function(n){u(t);let r=l();return f(r.close(n))}),a()}if(i&2){let t=l();m("subOrganizations",t.subOrganizations)("visible",t.visible)("userRoles",t.userRoles)("users",t.listOfData)}}function zt(i,o){if(i&1&&(s(0,"th",7),d(1),a()),i&2){let t=o.$implicit;m("nzSortFn",t.compare)("nzSortPriority",t.priority),p(),A(" ",t.title," ")}}function Ct(i,o){if(i&1){let t=g();de(0),s(1,"td"),d(2),a(),s(3,"td"),d(4),a(),s(5,"td"),d(6),a(),s(7,"td"),d(8),a(),s(9,"td")(10,"a",10),z("click",function(){u(t);let n=l().$implicit,r=l();return f(r.startEdit(n.id))}),d(11,"Edit"),a()(),_e()}if(i&2){let t=l().$implicit;p(2),W(t.name),p(2),W(t.reportTo),p(2),W(t.roleName),p(2),W(t.sub_organization)}}function gt(i,o){if(i&1&&C(0,"nz-option",18),i&2){let t=o.$implicit;m("nzValue",t==null?null:t.id)("nzLabel",t==null?null:t.name)}}function ht(i,o){if(i&1){let t=g();s(0,"nz-select",17),b("ngModelChange",function(n){u(t);let r=l(2).$implicit,c=l();return w(c.editCache[r.id].data.reports_to,n)||(c.editCache[r.id].data.reports_to=n),f(n)}),_(1,gt,1,2,"nz-option",14),a()}if(i&2){let t=l(2).$implicit,e=l();y("ngModel",e.editCache[t.id].data.reports_to),p(),m("ngForOf",e.listOfData)}}function xt(i,o){if(i&1&&C(0,"nz-option",18),i&2){let t=o.$implicit;m("nzValue",t==null?null:t.value)("nzLabel",t==null?null:t.key)}}function vt(i,o){if(i&1&&C(0,"nz-option",18),i&2){let t=o.$implicit;m("nzValue",(t==null?null:t.value)||0)("nzLabel",(t==null?null:t.key)||"")}}function yt(i,o){if(i&1){let t=g();s(0,"td")(1,"input",11),b("ngModelChange",function(n){u(t);let r=l().$implicit,c=l();return w(c.editCache[r.id].data.name,n)||(c.editCache[r.id].data.name=n),f(n)}),a()(),s(2,"td"),_(3,ht,2,2,"nz-select",12),a(),s(4,"td")(5,"nz-select",13),b("ngModelChange",function(n){u(t);let r=l().$implicit,c=l();return w(c.editCache[r.id].data.role_id,n)||(c.editCache[r.id].data.role_id=n),f(n)}),_(6,xt,1,2,"nz-option",14),a()(),s(7,"td")(8,"nz-select",13),b("ngModelChange",function(n){u(t);let r=l().$implicit,c=l();return w(c.editCache[r.id].data.sub_organization_id,n)||(c.editCache[r.id].data.sub_organization_id=n),f(n)}),_(9,vt,1,2,"nz-option",14),a()(),s(10,"td")(11,"a",15),z("click",function(){u(t);let n=l().$implicit,r=l();return f(r.saveEdit(n.id))}),d(12,"Save"),a(),d(13," \xA0 "),s(14,"a",16),z("nzOnConfirm",function(){u(t);let n=l().$implicit,r=l();return f(r.cancelEdit(n.id))}),d(15,"Cancel"),a()()}if(i&2){let t=l().$implicit,e=l();p(),y("ngModel",e.editCache[t.id].data.name),p(2),m("ngIf",e.listOfData.length),p(2),y("ngModel",e.editCache[t.id].data.role_id),p(),m("ngForOf",e.userRoles),p(2),y("ngModel",e.editCache[t.id].data.sub_organization_id),p(),m("ngForOf",e.subOrganizations)}}function wt(i,o){if(i&1&&(s(0,"tr"),_(1,Ct,12,4,"ng-container",8)(2,yt,16,6,"ng-template",null,9,T),a()),i&2){let t=o.$implicit,e=N(3),n=l();p(),m("ngIf",!(n.editCache[t.id]!=null&&n.editCache[t.id].edit))("ngIfElse",e)}}var Ke=(()=>{let o=class o{constructor(e,n){this.userService=e,this.appService=n,this.listOfColumn=[{title:"Name",compare:(r,c)=>r.name.localeCompare(c.name),priority:!1},{title:"Reports To",compare:(r,c)=>r.reports_to-c.reports_to,priority:2},{title:"Role Name",compare:(r,c)=>r.role_id-c.role_id,priority:3},{title:"Sub Organization",compare:(r,c)=>r.sub_organization_id-c.sub_organization_id,priority:3},{title:"Action",compare:(r,c)=>r.role_id-c.role_id,priority:3}],this.listOfData=[],this.visible=!1,this.editCache={}}ngOnInit(){this.populateUserData()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateUserData()}populateUserData(){return x(this,null,function*(){this.listOfData=yield this.userService.getOrganizationUsers(),this.userRoles=yield this.appService.getRoles(),this.subOrganizations=yield this.appService.getSubOrganizations(),this.userRoles=this.userRoles.map(e=>({key:e.role_name,value:e.id})),this.subOrganizations=this.subOrganizations.map(e=>re(S({},e),{key:e.name,value:e.id})),this.mapUserData(),this.updateEditCache()})}mapUserData(){console.log("userRoles",this.userRoles),this.listOfData=this.listOfData.map(e=>{let n="",r=this.userRoles.find(O=>e.role.id===O.value),c=this.listOfData.find(O=>O.id==e.reports_to);e.reports_to=c?.id,e.role_id=r?.value;let h=this.subOrganizations.find(O=>O.id===parseInt(e.sub_organization_id.toString()));return e.sub_organization_id=h?.id,re(S({},e),{sub_organization:h?.name,roleName:r?.key,reportTo:this.listOfData.find(O=>O.id==e.reports_to)?.name})})}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let n=this.listOfData.findIndex(r=>r.id===e);this.editCache[e]={data:S({},this.listOfData[n]),edit:!1}}saveEdit(e){return x(this,null,function*(){let n=this.listOfData.findIndex(r=>r.id===e);yield this.userService.updateUser({id:e,organization_id:this.editCache[e].data.organization_id,role_id:this.editCache[e].data.role_id,reports_to:this.editCache[e].data.reports_to,name:this.editCache[e].data.name}),this.editCache[e].edit=!1,Object.assign(this.listOfData[n],this.editCache[e].data),this.populateUserData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:S({},e)}})}};o.\u0275fac=function(n){return new(n||o)(v(G),v($))},o.\u0275cmp=E({type:o,selectors:[["app-users"]],decls:11,vars:4,consts:[["nz-button","","nzType","primary",3,"click"],[3,"subOrganizations","visible","userRoles","users","closeDrawer",4,"ngIf"],["nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"subOrganizations","visible","userRoles","users","closeDrawer"],[3,"nzSortFn","nzSortPriority"],[4,"ngIf","ngIfElse"],["editTemplate",""],[3,"click"],["type","text","nz-input","",3,"ngModel","ngModelChange"],["id","reports_to","placeholder","Select user",3,"ngModel","ngModelChange",4,"ngIf"],["id","role_id","placeholder","Select role",3,"ngModel","ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],["id","reports_to","placeholder","Select user",3,"ngModel","ngModelChange"],[3,"nzValue","nzLabel"]],template:function(n,r){if(n&1&&(s(0,"button",0),z("click",function(){return r.open()}),d(1,"Add"),a(),_(2,ft,1,4,"app-create-user-drawer",1),s(3,"nz-table",2,3)(6,"thead")(7,"tr"),_(8,zt,2,3,"th",4),a()(),s(9,"tbody"),_(10,wt,4,2,"tr",5),a()()),n&2){let c=N(5);p(2),m("ngIf",r.visible),p(),m("nzData",r.listOfData),p(5),m("ngForOf",r.listOfColumn),p(2),m("ngForOf",c.data)}},dependencies:[V,F,k,P,U,I,ne,K,J,We,Pe,Ie,Ue,Le,ke,Ae,R,M,X,Ze]});let i=o;return i})();function bt(i,o){if(i&1&&(s(0,"nz-form",3)(1,"nz-form-item")(2,"nz-form-label",4),d(3,"Role Name"),a(),s(4,"nz-form-control",5),C(5,"input",6),a()()()),i&2){let t=l();m("formGroup",t.addRoleForm)}}function St(i,o){if(i&1){let t=g();s(0,"div")(1,"nz-form-item")(2,"nz-form-label",13),d(3,"Role Name"),a(),s(4,"nz-form-control",14)(5,"input",15),b("ngModelChange",function(n){u(t);let r=l().$implicit,c=l();return w(c.editCache[r.id].data.role_name,n)||(c.editCache[r.id].data.role_name=n),f(n)}),a()()()()}if(i&2){let t=l().$implicit,e=l();p(5),y("ngModel",e.editCache[t.id].data.role_name)}}function Ot(i,o){if(i&1){let t=g();s(0,"nz-col",16)(1,"label",17),b("ngModelChange",function(n){let c=u(t).$implicit,h=l().$implicit;return w(h.role_permissions[c.value],n)||(h.role_permissions[c.value]=n),f(n)}),a(),d(2),a()}if(i&2){let t=o.$implicit,e=l().$implicit,n=l();m("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",4),p(),m("disabled",!(n.editCache[e.id]!=null&&n.editCache[e.id].edit)),y("ngModel",e.role_permissions[t.value]),p(),A(" ",n.permissionNames[t.value]," ")}}function Nt(i,o){if(i&1){let t=g();s(0,"div")(1,"a",18),z("click",function(){u(t);let n=l().$implicit,r=l();return f(r.startEdit(n.id))}),d(2,"Edit"),a()()}}function Dt(i,o){if(i&1){let t=g();s(0,"div")(1,"a",19),z("click",function(){u(t);let n=l().$implicit,r=l();return f(r.saveEdit(n.id))}),d(2,"Save"),a(),d(3," \xA0 "),s(4,"a",20),z("nzOnConfirm",function(){u(t);let n=l().$implicit,r=l();return f(r.cancelEdit(n.id))}),d(5,"Cancel"),a()()}}function Et(i,o){if(i&1&&(d(0),C(1,"span",21)),i&2){let t=o.$implicit;l();let e=N(1);A(" ",t," "),p(),m("nzRotate",e.nzActive?90:-90)}}function Tt(i,o){if(i&1&&(s(0,"nz-collapse-panel",7,8),_(2,St,6,1,"div",9),s(3,"nz-row",10),_(4,Ot,3,8,"nz-col",11),fe(5,"keyvalue"),a(),_(6,Nt,3,0,"div",9)(7,Dt,6,0,"div",9)(8,Et,2,2,"ng-template",null,12,T),a()),i&2){let t=o.$implicit,e=l();m("nzHeader",t.role_name),p(2),m("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit),p(2),m("ngForOf",ze(5,5,e.appPermissions)),p(2),m("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit)),p(),m("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit)}}var Je=(()=>{let o=class o{constructor(e,n){this.fb=e,this.appService=n,this.isModalVisible=!1,this.defuaultpermissions=se,this.permissionNames=xe,this.appPermissions=he,this.rolePermissions={},this.editCache={},this.addRoleForm=this.fb.group({role_name:["",[D.required]],organization_id:[localStorage.getItem("organization_id")],role_permissions:[se]})}ngOnInit(){this.getAndSetRolesPermission()}getAndSetRolesPermission(){return x(this,null,function*(){this.roles=yield this.appService.getRolesAndPermissions(),this.updateEditCache()})}handleCancel(){this.isModalVisible=!1}showModal(){this.isModalVisible=!0}handleOk(){return x(this,null,function*(){yield this.appService.createRole(this.addRoleForm.value),this.isModalVisible=!1,this.getAndSetRolesPermission()})}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let n=this.roles.findIndex(r=>r.id.toString()===e);this.editCache[e]={data:S({},this.roles[n]),edit:!1}}saveEdit(e){return x(this,null,function*(){let n=this.roles.findIndex(r=>r.id.toString()===e);yield this.appService.updateRole({id:e,role_permissions:this.editCache[e].data.role_permissions,role_name:this.editCache[e].data.role_name}),this.editCache[e].edit=!1,Object.assign(this.roles[n],this.editCache[e].data)})}updateEditCache(){this.roles.forEach(e=>{this.editCache[e.id]={edit:!1,data:S({},e)}})}};o.\u0275fac=function(n){return new(n||o)(v(Z),v($))},o.\u0275cmp=E({type:o,selectors:[["app-role-permissions"]],decls:9,vars:1,consts:[["nz-button","","nzType","primary",3,"click"],["nzTitle","Add Role",3,"nzVisible","nzVisibleChange","nzOnCancel","nzOnOk"],[3,"formGroup",4,"nzModalContent"],[3,"formGroup"],["nzRequired",""],["nzHasFeedback","","nzErrorTip","Please input role name"],["nz-input","","formControlName","role_name"],[3,"nzHeader"],["p",""],[4,"ngIf"],["nzGutter","8"],[3,"nzSm","nzXs","nzMd","nzXl","nzXXl",4,"ngFor","ngForOf"],["expandedIcon",""],["nzFor","terms"],["nzErrorTip",""],["type","text","nz-input","",3,"ngModel","ngModelChange"],[3,"nzSm","nzXs","nzMd","nzXl","nzXXl"],["nz-checkbox","",3,"disabled","ngModel","ngModelChange"],[3,"click"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],["nz-icon","","nzType","caret-right",1,"ant-collapse-arrow",3,"nzRotate"]],template:function(n,r){n&1&&(s(0,"div")(1,"button",0),z("click",function(){return r.showModal()}),d(2,"Add Role"),a()(),s(3,"nz-modal",1),b("nzVisibleChange",function(h){return w(r.isModalVisible,h)||(r.isModalVisible=h),h}),z("nzOnCancel",function(){return r.handleCancel()})("nzOnOk",function(){return r.handleOk()}),_(4,bt,6,1,"nz-form",2),a(),s(5,"div")(6,"nz-collapse"),pe(7,Tt,10,7,"nz-collapse-panel",7,me),a()()),n&2&&(p(3),y("nzVisible",r.isModalVisible),p(4),ce(r.roles))},dependencies:[V,F,k,P,U,De,Te,Ee,we,Y,Q,ee,ie,te,I,Me,Re,ne,R,M,j,q,H,X,Ce]});let i=o;return i})();var Vt=[{path:"",component:Ke,data:{name:"Users"}},{path:"roles",component:Je,data:{name:"Roles"}}],Qe=(()=>{let o=class o{};o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=L({type:o}),o.\u0275inj=B({imports:[ae.forChild(Vt),ae]});let i=o;return i})();var Ye=ve,Ft=Object.keys(Ye).map(i=>Ye[i]),_i=(()=>{let o=class o{};o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=L({type:o}),o.\u0275inj=B({providers:[{provide:Ne,useValue:Oe},{provide:ye,useValue:Ft}],imports:[ge,Qe,Be,Se,be]});let i=o;return i})();export{_i as TeamModule};
