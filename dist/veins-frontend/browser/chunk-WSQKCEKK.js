import{a as Be,b as ne,d as Xe}from"./chunk-TDK2NTNW.js";import{a as le}from"./chunk-3XLXZY4S.js";import{a as S,b as he,c as ae}from"./chunk-MI2CZ2YP.js";import{$ as ce,$a as se,$b as Ue,A as f,Aa as G,Ac as Ae,B as z,Bb as L,Cc as Ge,Dc as je,E as I,Eb as $,Ec as qe,Fa as D,Fb as Z,Fc as We,Ga as O,Hb as Ee,Ia as ze,Ib as De,Jb as K,Ka as Ce,Lc as He,O as m,P as x,Rb as Oe,Sb as Te,T as u,U as l,Xb as J,Yb as Pe,Zb as Fe,_ as pe,a as w,aa as de,ac as Re,b as oe,ba as s,bb as j,bc as Q,ca as o,cb as q,cc as Y,da as v,dc as ee,e as b,eb as ve,fb as ge,fc as te,ga as g,gb as W,gc as ie,ha as C,hb as T,ia as p,ib as P,jb as F,lb as xe,ma as E,mb as be,na as c,oa as U,pa as R,pb as ye,qb as Se,ra as k,rb as we,sa as M,ta as A,tb as H,ua as _e,ub as h,uc as Ve,v as me,vb as B,vc as Ie,w as N,wb as X,x as V,xa as ue,xc as ke,ya as fe,zb as Ne,zc as Me}from"./chunk-F7DNT63C.js";function lt(t,n){if(t&1&&v(0,"nz-option",17),t&2){let i=n.$implicit;l("nzValue",i==null?null:i.id)("nzLabel",i==null?null:i.name)}}function mt(t,n){if(t&1&&(s(0,"nz-select",16),u(1,lt,1,2,"nz-option",10),o()),t&2){let i=p(2);m(),l("ngForOf",i.users)}}function pt(t,n){if(t&1&&v(0,"nz-option",17),t&2){let i=n.$implicit;l("nzValue",i==null?null:i.value)("nzLabel",i==null?null:i.key)}}function ct(t,n){if(t&1&&v(0,"nz-option",17),t&2){let i=n.$implicit;l("nzValue",i.id)("nzLabel",i.name)}}function dt(t,n){if(t&1&&(s(0,"nz-select",18),u(1,ct,1,2,"nz-option",10),o()),t&2){let i=p(2);m(),l("ngForOf",i.subOrganizations)}}function _t(t,n){if(t&1&&(s(0,"nz-form",3)(1,"div",4)(2,"div",5)(3,"nz-form-item")(4,"nz-form-label"),c(5,"Name"),o(),s(6,"nz-form-control"),v(7,"input",6),o()()()(),s(8,"div",4)(9,"div",7)(10,"nz-form-item")(11,"nz-form-label"),c(12,"Reports To"),o(),s(13,"nz-form-control"),u(14,mt,2,1,"nz-select",8),o()()()(),s(15,"div",4)(16,"div",5)(17,"nz-form-item")(18,"nz-form-label"),c(19,"Role Name"),o(),s(20,"nz-form-control")(21,"nz-select",9),u(22,pt,1,2,"nz-option",10),o()()()()(),s(23,"div",4)(24,"div",7)(25,"nz-form-item")(26,"nz-form-label"),c(27,"Organization "),o(),s(28,"nz-form-control"),u(29,dt,2,1,"nz-select",11),o()()()(),s(30,"div",4)(31,"div",7)(32,"nz-form-item")(33,"nz-form-label"),c(34,"Email "),o(),s(35,"nz-form-control"),v(36,"input",12),o()()()(),s(37,"div",4)(38,"div",7)(39,"nz-form-item")(40,"nz-form-label"),c(41,"Contact No "),o(),s(42,"nz-form-control"),v(43,"input",13),o()()()(),s(44,"div",4)(45,"div",7)(46,"nz-form-item")(47,"nz-form-label"),c(48,"Address "),o(),s(49,"nz-form-control"),v(50,"textarea",14),o()()()(),s(51,"div",4)(52,"div",7)(53,"nz-form-item")(54,"nz-form-label"),c(55,"Is Admin "),o(),s(56,"nz-form-control"),v(57,"label",15),o()()()()()),t&2){let i=p();l("formGroup",i.userForm),m(),l("nzGutter",8),m(7),l("nzGutter",8),m(6),l("ngIf",i.users.length),m(),l("nzGutter",8),m(7),l("ngForOf",i.userRoles),m(),l("nzGutter",8),m(6),l("ngIf",i.subOrganizations.length),m(),l("nzGutter",8),m(7),l("nzGutter",8),m(7),l("nzGutter",8),m(7),l("nzGutter",8)}}function ut(t,n){if(t&1){let i=g();s(0,"div",19)(1,"button",20),C("click",function(){f(i);let r=p();return z(r.close())}),c(2,"Cancel"),o(),s(3,"button",21),C("click",function(){f(i);let r=p();return z(r.addUser())}),c(4,"Submit"),o()()}if(t&2){let i=p();m(3),l("disabled",!i.userForm.valid)}}var ft=()=>({overflow:"auto"}),Je=(()=>{let n=class n{constructor(e,r,a){this.userService=e,this.fb=r,this.notification=a,this.visible=!1,this.users=[],this.userRoles=[],this.subOrganizations=[],this.isEdit=!1,this.closeDrawer=new me,this.userForm=this.fb.group({name:["",[h.required]],reports_to:[0,[h.required]],role:[null,[h.required]],sub_organization_id:[null,[h.required]],organization_id:[parseInt(localStorage.getItem("organization_id")||"0")],password:["p@ssw0rD"],email:["",[h.required]],contact_no:["",[h.required]],address:[""],is_admin:[!1]})}ngOnInit(){this.isEdit&&(this.userForm=this.fb.group({name:[this.selectedUser.name,[h.required]],reports_to:[this.selectedUser.reports_to,[h.required]],role:[this.selectedUser.role_id,[h.required]],sub_organization_id:[this.selectedUser.sub_organization_id,[h.required]],organization_id:[parseInt(localStorage.getItem("organization_id")||"0")],email:[this.selectedUser.email,[h.required]],contact_no:[this.selectedUser.contact_no,[h.required]],address:[this.selectedUser.address],is_admin:[this.selectedUser.is_admin]}))}close(){this.closeDrawer.emit(!1)}addUser(){return b(this,null,function*(){this.isEdit?(console.log(this.userForm),yield this.userService.updateUser(this.userForm.value,this.selectedUser.id),this.notification.create("success","User details update successfully",""),this.closeDrawer.emit(!0)):(console.log(this.userForm),yield this.userService.createUser(this.userForm.value),this.notification.create("success","User created successfully",""),this.closeDrawer.emit(!0))})}objectKeys(e){return Object.keys(e).map(r=>({key:r,value:e[r]}))}};n.\u0275fac=function(r){return new(r||n)(x(j),x(Z),x(Ve))},n.\u0275cmp=N({type:n,selectors:[["app-create-user-drawer"]],inputs:{visible:"visible",users:"users",userRoles:"userRoles",subOrganizations:"subOrganizations",isEdit:"isEdit",selectedUser:"selectedUser"},outputs:{closeDrawer:"closeDrawer"},decls:4,vars:7,consts:[[3,"nzBodyStyle","nzMaskClosable","nzWidth","nzVisible","nzTitle","nzFooter","nzOnClose"],[3,"formGroup",4,"nzDrawerContent"],["footerTpl",""],[3,"formGroup"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","24"],["formControlName","name","nz-input","","placeholder","please enter user name"],["nz-col","","nz-col","","nzSpan","24"],["id","reports_to","formControlName","reports_to","placeholder","Select user",4,"ngIf"],["id","role","formControlName","role","placeholder","Select role"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["id","sub_organization_id","formControlName","sub_organization_id","placeholder","Select Organization",4,"ngIf"],["formControlName","email","nz-input","","placeholder","Add email"],["formControlName","contact_no","nz-input","","placeholder","Add contact no"],["nz-input","","rows","2","formControlName","address","nz-input","","placeholder","Add address"],["nz-checkbox","","formControlName","is_admin","placeholder","Add is admin"],["id","reports_to","formControlName","reports_to","placeholder","Select user"],[3,"nzValue","nzLabel"],["id","sub_organization_id","formControlName","sub_organization_id","placeholder","Select Organization"],[2,"float","right"],["nz-button","",2,"margin-right","8px",3,"click"],["nz-button","","nzType","primary",3,"disabled","click"]],template:function(r,a){if(r&1&&(s(0,"nz-drawer",0),C("nzOnClose",function(){return a.close()}),u(1,_t,58,12,"nz-form",1)(2,ut,5,1,"ng-template",null,2,G),o()),r&2){let d=E(3);l("nzBodyStyle",_e(6,ft))("nzMaskClosable",!1)("nzWidth",720)("nzVisible",a.visible)("nzTitle",a.isEdit?"Edit User":"Create User")("nzFooter",d)}},dependencies:[D,O,F,T,P,J,Re,Ue,Y,Q,ee,ie,te,K,Oe,Te,H,B,X,L,$]});let t=n;return t})();function xt(t,n){if(t&1){let i=g();s(0,"button",6),C("click",function(){f(i);let r=p();return z(r.open())}),c(1,"Add"),o()}}function bt(t,n){if(t&1){let i=g();s(0,"app-create-user-drawer",7),C("closeDrawer",function(r){f(i);let a=p();return z(a.close(r))}),o()}if(t&2){let i=p();l("subOrganizations",i.subOrganizations)("visible",i.visible)("userRoles",i.userRoles)("users",i.listOfData)("isEdit",i.isEdit)("selectedUser",i.selectedUser)}}function yt(t,n){if(t&1&&(s(0,"th",8),c(1),o()),t&2){let i=n.$implicit;l("nzSortFn",i.compare)("nzSortPriority",i.priority),m(),R(" ",i.title," ")}}function St(t,n){if(t&1){let i=g();s(0,"a",10),C("click",function(){f(i);let r=p().index,a=p();return z(a.startEdit(r))}),c(1,"Edit"),o()}}function wt(t,n){if(t&1){let i=g();s(0,"a",10),C("click",function(){f(i);let r=p().index,a=p();return z(a.openChangePasswordModal(r))}),c(1,"Change "),v(2,"span",11),o()}}function Nt(t,n){if(t&1&&(s(0,"tr")(1,"td"),c(2),o(),s(3,"td"),c(4),o(),s(5,"td"),c(6),o(),s(7,"td"),c(8),o(),s(9,"td"),u(10,St,2,0,"a",9),o(),s(11,"td"),u(12,wt,3,0,"a",9),o()()),t&2){let i=n.$implicit,e=p();m(2),U(i.name),m(2),U(i.reportTo),m(2),U(i.roleName),m(2),U(i.sub_organization),m(2),l("appHasPermission",e.appPermissions.UpdateUsers),m(2),l("appHasPermission",e.appPermissions.UpdateUsers)}}var Qe=(()=>{let n=class n{constructor(e,r,a){this.userService=e,this.appService=r,this.modal=a,this.listOfColumn=[{title:"Name",compare:(d,_)=>d.name.localeCompare(_.name),priority:!1},{title:"Reports To",compare:(d,_)=>d.reports_to-_.reports_to,priority:2},{title:"Role Name",compare:(d,_)=>d.role_id-_.role_id,priority:3},{title:"Sub Organization",compare:(d,_)=>d.sub_organization_id-_.sub_organization_id,priority:3},{title:"Action",compare:(d,_)=>d.role_id-_.role_id,priority:3},{title:"",compare:(d,_)=>d.role_id-_.role_id,priority:3}],this.listOfData=[],this.visible=!1,this.isEdit=!1,this.appPermissions=S}ngOnInit(){this.populateUserData()}open(e=!1){this.visible=!0,this.isEdit=e}close(e=!1){this.visible=!1,this.isEdit=!1,e&&this.populateUserData()}populateUserData(){return b(this,null,function*(){this.listOfData=yield this.userService.getOrganizationUsers(),this.userRoles=yield this.appService.getRoles(),this.subOrganizations=yield this.appService.getSubOrganizations(),this.userRoles=this.userRoles.map(e=>({key:e.role_name,value:e.id})),this.subOrganizations=this.subOrganizations.map(e=>oe(w({},e),{key:e.name,value:e.id})),this.mapUserData()})}mapUserData(){console.log("userRoles",this.userRoles),this.listOfData=this.listOfData.map(e=>{let r="",a=this.userRoles.find(y=>e.role?.id===y.value),d=this.listOfData.find(y=>y.id==e.reports_to);e.reports_to=d?.id,e.role_id=a?.value;let _=this.subOrganizations.find(y=>y.id===parseInt(e.sub_organization_id.toString()));return e.sub_organization_id=_?.id,oe(w({},e),{sub_organization:_?.name,roleName:a?.key,reportTo:this.listOfData.find(y=>y.id==e.reports_to)?.name})})}startEdit(e){this.open(!0),this.selectedUser=this.listOfData[e]}openChangePasswordModal(e){this.modal.create({nzTitle:"Change Password ("+this.listOfData[e].name+")",nzContent:Be,nzFooter:null,nzData:{user:this.listOfData[e]}}).afterClose.subscribe(a=>{a&&console.log("Password changed",a)})}};n.\u0275fac=function(r){return new(r||n)(x(j),x(q),x(ye))},n.\u0275cmp=N({type:n,selectors:[["app-users"]],decls:10,vars:5,consts:[["nz-button","","nzType","primary",3,"click",4,"appHasPermission"],[3,"subOrganizations","visible","userRoles","users","isEdit","selectedUser","closeDrawer",4,"ngIf"],["nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["nz-button","","nzType","primary",3,"click"],[3,"subOrganizations","visible","userRoles","users","isEdit","selectedUser","closeDrawer"],[3,"nzSortFn","nzSortPriority"],[3,"click",4,"appHasPermission"],[3,"click"],["nz-icon","","nzType","unlock","nzTheme","outline"]],template:function(r,a){if(r&1&&(u(0,xt,2,0,"button",0)(1,bt,1,6,"app-create-user-drawer",1),s(2,"nz-table",2,3)(5,"thead")(6,"tr"),u(7,yt,2,3,"th",4),o()(),s(8,"tbody"),u(9,Nt,13,6,"tr",5),o()()),r&2){let d=E(4);l("appHasPermission",a.appPermissions.UpdateUsers),m(),l("ngIf",a.visible),m(),l("nzData",a.listOfData),m(5),l("ngForOf",a.listOfColumn),m(2),l("ngForOf",d.data)}},dependencies:[D,O,F,T,P,W,je,Me,ke,Ae,We,Ge,qe,ne,Je]});let t=n;return t})();function Et(t,n){if(t&1){let i=g();s(0,"div")(1,"button",3),C("click",function(){f(i);let r=p();return z(r.showModal())}),c(2,"Add Role"),o()()}}function Dt(t,n){if(t&1&&(s(0,"nz-form",4)(1,"nz-form-item")(2,"nz-form-label",5),c(3,"Role Name"),o(),s(4,"nz-form-control",6),v(5,"input",7),o()()()),t&2){let i=p();l("formGroup",i.addRoleForm)}}function Ot(t,n){if(t&1){let i=g();s(0,"div")(1,"nz-form-item")(2,"nz-form-label",14),c(3,"Role Name"),o(),s(4,"nz-form-control",15)(5,"input",16),A("ngModelChange",function(r){f(i);let a=p().$implicit,d=p();return M(d.editCache[a.id].data.role_name,r)||(d.editCache[a.id].data.role_name=r),z(r)}),o()()()()}if(t&2){let i=p().$implicit,e=p();m(5),k("ngModel",e.editCache[i.id].data.role_name)}}function Tt(t,n){if(t&1){let i=g();s(0,"nz-col",17)(1,"label",18),A("ngModelChange",function(r){let d=f(i).$implicit,_=p().$implicit;return M(_.role_permissions[d.value],r)||(_.role_permissions[d.value]=r),z(r)}),o(),c(2),o()}if(t&2){let i=n.$implicit,e=p().$implicit,r=p();l("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",4),m(),l("disabled",!(r.editCache[e.id]!=null&&r.editCache[e.id].edit)),k("ngModel",e.role_permissions[i.value]),m(),R(" ",r.permissionNames[i.value]," ")}}function Pt(t,n){if(t&1){let i=g();s(0,"div")(1,"a",19),C("click",function(){f(i);let r=p(2).$implicit,a=p();return z(a.startEdit(r.id))}),c(2,"Edit"),o()()}}function Ft(t,n){if(t&1){let i=g();s(0,"div")(1,"a",20),C("click",function(){f(i);let r=p(2).$implicit,a=p();return z(a.saveEdit(r.id))}),c(2,"Save"),o(),c(3," \xA0 "),s(4,"a",21),C("nzOnConfirm",function(){f(i);let r=p(2).$implicit,a=p();return z(a.cancelEdit(r.id))}),c(5,"Cancel"),o()()}}function Ut(t,n){if(t&1&&(s(0,"span"),u(1,Pt,3,0,"div",10)(2,Ft,6,0,"div",10),o()),t&2){let i=p().$implicit,e=p();m(),l("ngIf",!(e.editCache[i.id]!=null&&e.editCache[i.id].edit)),m(),l("ngIf",e.editCache[i.id]==null?null:e.editCache[i.id].edit)}}function Rt(t,n){if(t&1&&(c(0),v(1,"span",22)),t&2){let i=n.$implicit;p();let e=E(1);R(" ",i," "),m(),l("nzRotate",e.nzActive?90:-90)}}function Vt(t,n){if(t&1&&(s(0,"nz-collapse-panel",8,9),u(2,Ot,6,1,"div",10),s(3,"nz-row",11),u(4,Tt,3,8,"nz-col",12),ue(5,"keyvalue"),o(),u(6,Ut,3,2,"span",0)(7,Rt,2,2,"ng-template",null,13,G),o()),t&2){let i=n.$implicit,e=p();l("nzHeader",i.role_name),m(2),l("ngIf",e.editCache[i.id]==null?null:e.editCache[i.id].edit),m(2),l("ngForOf",fe(5,4,e.appPermissions)),m(2),l("appHasPermission",e.appPermissions.UpdatePermissions)}}var Ye=(()=>{let n=class n{constructor(e,r){this.fb=e,this.appService=r,this.isModalVisible=!1,this.defuaultpermissions=ae,this.permissionNames=he,this.appPermissions=S,this.rolePermissions={},this.editCache={},this.addRoleForm=this.fb.group({role_name:["",[h.required]],organization_id:[localStorage.getItem("organization_id")],role_permissions:[ae]})}ngOnInit(){this.getAndSetRolesPermission()}getAndSetRolesPermission(){return b(this,null,function*(){this.roles=yield this.appService.getRolesAndPermissions(),this.updateEditCache()})}handleCancel(){this.isModalVisible=!1}showModal(){this.isModalVisible=!0}handleOk(){return b(this,null,function*(){yield this.appService.createRole(this.addRoleForm.value),this.isModalVisible=!1,this.getAndSetRolesPermission()})}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let r=this.roles.findIndex(a=>a.id.toString()===e);this.editCache[e]={data:w({},this.roles[r]),edit:!1}}saveEdit(e){return b(this,null,function*(){let r=this.roles.findIndex(a=>a.id.toString()===e);yield this.appService.updateRole({id:e,role_permissions:this.editCache[e].data.role_permissions,role_name:this.editCache[e].data.role_name}),this.editCache[e].edit=!1,Object.assign(this.roles[r],this.editCache[e].data)})}updateEditCache(){this.roles.forEach(e=>{this.editCache[e.id]={edit:!1,data:w({},e)}})}};n.\u0275fac=function(r){return new(r||n)(x(Z),x(q))},n.\u0275cmp=N({type:n,selectors:[["app-role-permissions"]],decls:7,vars:2,consts:[[4,"appHasPermission"],["nzTitle","Add Role",3,"nzVisible","nzVisibleChange","nzOnCancel","nzOnOk"],[3,"formGroup",4,"nzModalContent"],["nz-button","","nzType","primary",3,"click"],[3,"formGroup"],["nzRequired",""],["nzHasFeedback","","nzErrorTip","Please input role name"],["nz-input","","formControlName","role_name"],[3,"nzHeader"],["p",""],[4,"ngIf"],["nzGutter","8"],[3,"nzSm","nzXs","nzMd","nzXl","nzXXl",4,"ngFor","ngForOf"],["expandedIcon",""],["nzFor","terms"],["nzErrorTip",""],["type","text","nz-input","",3,"ngModel","ngModelChange"],[3,"nzSm","nzXs","nzMd","nzXl","nzXXl"],["nz-checkbox","",3,"disabled","ngModel","ngModelChange"],[3,"click"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],["nz-icon","","nzType","caret-right",1,"ant-collapse-arrow",3,"nzRotate"]],template:function(r,a){r&1&&(u(0,Et,3,0,"div",0),s(1,"nz-modal",1),A("nzVisibleChange",function(_){return M(a.isModalVisible,_)||(a.isModalVisible=_),_}),C("nzOnCancel",function(){return a.handleCancel()})("nzOnOk",function(){return a.handleOk()}),u(2,Dt,6,1,"nz-form",2),o(),s(3,"div")(4,"nz-collapse"),ce(5,Vt,9,6,"nz-collapse-panel",8,pe),o()()),r&2&&(l("appHasPermission",a.appPermissions.UpdatePermissions),m(),k("nzVisible",a.isModalVisible),m(4),de(a.roles))},dependencies:[D,O,F,T,P,J,Fe,Pe,W,Y,Q,ee,ie,te,K,we,Se,Ie,H,B,X,L,$,Ne,ne,ze]});let t=n;return t})();var It=[{path:"",component:Qe,data:{name:"Users",permission:S.ManageUsers},canActivate:[le]},{path:"roles",component:Ye,data:{name:"Roles",permission:S.ViewPermissions},canActivate:[le]}],et=(()=>{let n=class n{};n.\u0275fac=function(r){return new(r||n)},n.\u0275mod=V({type:n}),n.\u0275inj=I({imports:[se.forChild(It),se]});let t=n;return t})();var tt=ve,kt=Object.keys(tt).map(t=>tt[t]),yi=(()=>{let n=class n{};n.\u0275fac=function(r){return new(r||n)},n.\u0275mod=V({type:n}),n.\u0275inj=I({providers:[{provide:be,useValue:xe},{provide:ge,useValue:kt}],imports:[Ce,et,He,De,Ee,Xe]});let t=n;return t})();export{yi as TeamModule};
