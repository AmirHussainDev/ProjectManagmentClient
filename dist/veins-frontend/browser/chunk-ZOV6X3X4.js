import{a as rt}from"./chunk-NGE6N3H6.js";import{Ab as B,E as v,Eb as J,Fa as S,Fb as H,G as N,Ia as y,Ib as Z,Kb as q,Lb as U,Mb as W,Na as b,Nb as $,O as s,Oa as u,P as p,Pb as K,Ra as _,Sc as it,Ta as w,U as C,Ua as F,V as l,ab as M,ac as Q,ca as n,cb as x,da as a,e as g,ea as c,eb as P,gc as X,hb as D,hc as Y,ia as I,jb as E,jc as tt,kb as O,kc as et,lc as ot,mb as j,nb as k,oa as f,ob as T,pb as A,qb as R,w as h,wb as V,x as z,xb as G,yb as d,zb as L}from"./chunk-I3YC35GG.js";function lt(e,t){e&1&&(n(0,"nz-form-item")(1,"nz-form-control",14),c(2,"nz-alert",15),a()()),e&2&&(s(),l("nzSpan",24))}var nt=(()=>{let t=class t{constructor(o,i,m,r,st){this.fb=o,this.http=i,this.platformId=m,this.router=r,this.appService=st,this.appurl=P.apiUrl,this.organization_id=0,this.showErrorMessage=!1,this.validateForm=this.fb.group({username:["",[d.required]],password:["",[d.required]],remember:[!0]}),u(this.platformId)&&(this.organization_id=parseInt(localStorage.getItem("organization_id")||""))}submitForm(){return g(this,null,function*(){this.showErrorMessage=!1;try{if(this.validateForm.valid){console.log("submit",this.validateForm.value);let o=20,i=this.validateForm.value.password||"",m=this.validateForm.value.username||"",r=yield this.http.post(`${this.appurl}/auth/login`,{organization_id:this.organization_id,username:m,password:i}).toPromise();u(this.platformId)&&r.access_token&&(localStorage.setItem("token",r.access_token),localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("permissions",JSON.stringify(r.user.role_permissions)),localStorage.setItem("sub_organization_id",JSON.stringify(r.user.sub_organization_id)),this.router.navigate(["/"]))}else Object.values(this.validateForm.controls).forEach(o=>{o.invalid&&(o.markAsDirty(),o.updateValueAndValidity({onlySelf:!0}),this.showErrorMessage=!0)})}catch{this.showErrorMessage=!0}})}};t.\u0275fac=function(i){return new(i||t)(p(q),p(_),p(N),p(M),p(D))},t.\u0275cmp=h({type:t,selectors:[["app-login"]],decls:20,vars:4,consts:[[1,"app-login"],[1,"text-center","p4"],["nz-form","",1,"login-form",3,"formGroup","ngSubmit"],["nzErrorTip","Please input your username!"],["nzPrefixIcon","user"],["type","text","nz-input","","formControlName","username","placeholder","username"],["nzErrorTip","Please input your Password!"],["nzPrefixIcon","lock"],["type","password","nz-input","","formControlName","password","placeholder","Password"],[4,"ngIf"],["nz-row","",1,"login-form-margin"],["nz-col","",3,"nzSpan"],["nz-checkbox","","formControlName","remember"],["nz-button","",1,"login-form-button","login-form-margin",3,"nzType"],[3,"nzSpan"],["nzType","error","nzMessage","Incorrect credentials !"]],template:function(i,m){i&1&&(n(0,"div",0)(1,"h2",1),f(2," Welcome Back!"),a(),n(3,"form",2),I("ngSubmit",function(){return m.submitForm()}),n(4,"nz-form-item")(5,"nz-form-control",3)(6,"nz-input-group",4),c(7,"input",5),a()()(),n(8,"nz-form-item")(9,"nz-form-control",6)(10,"nz-input-group",7),c(11,"input",8),a()()(),C(12,lt,3,1,"nz-form-item",9),n(13,"div",10)(14,"div",11)(15,"label",12)(16,"span"),f(17,"Remember me"),a()()()(),n(18,"button",13),f(19,"Log in"),a()()()),i&2&&(s(3),l("formGroup",m.validateForm),s(9),l("ngIf",m.showErrorMessage),s(2),l("nzSpan",12),s(4),l("nzType","primary"))},dependencies:[y,J,G,L,B,H,Z,V,T,j,k,Q,Y,X,et,tt,ot,$,K],styles:[".login-form[_ngcontent-%COMP%]{max-width:300px}.login-form-margin[_ngcontent-%COMP%]{margin-bottom:16px}.login-form-forgot[_ngcontent-%COMP%]{float:right}.login-form-button[_ngcontent-%COMP%]{width:100%}.app-login[_ngcontent-%COMP%]{background:#fff;padding:32px;margin:50px;border-radius:12px}"]});let e=t;return e})();var mt=[{path:"",component:nt}];S(rt);var at=E,ct=Object.keys(at).map(e=>at[e]),qt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=z({type:t}),t.\u0275inj=v({providers:[x(mt),{provide:R,useValue:A},{provide:O,useValue:ct}],imports:[b,U,w,F,W,it]});let e=t;return e})();export{qt as a};
