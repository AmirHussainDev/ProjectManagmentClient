import{b as G,d as Ie}from"./chunk-TDK2NTNW.js";import{a as he}from"./chunk-3XLXZY4S.js";import{a as g}from"./chunk-MI2CZ2YP.js";import{$a as K,$b as we,A as _,Aa as re,Ac as B,B as f,Bb as ze,Cc as L,Dc as W,E as T,Eb as ve,Ec as j,Fa as N,Fb as ge,Fc as H,Ga as ae,Hb as Ve,Ib as xe,Jb as k,Ka as se,Kc as Oe,Lc as Me,N as $,O as m,P as V,T as u,U as d,a as R,ab as le,ac as ye,ba as a,bc as De,ca as l,cb as P,cc as be,da as x,dc as Se,e as v,ea as q,eb as me,f as ie,fa as Z,fb as de,fc as Te,ga as C,gb as pe,gc as Ne,ha as h,hb as E,ia as s,ib as O,jb as M,lb as ce,ma as J,mb as _e,na as p,oa as oe,pa as Y,qb as fe,ra as w,rb as ue,sa as y,ta as D,tb as I,ub as Q,v as ne,vb as F,vc as Pe,w as b,wb as Ce,x as S,xc as U,zb as A,zc as Ee}from"./chunk-F7DNT63C.js";function Ze(e,r){if(e&1){let n=C();a(0,"span")(1,"input",7),D("ngModelChange",function(i){_(n);let o=s(2);return y(o.newProduct,i)||(o.newProduct=i),f(i)}),l(),a(2,"button",8),h("click",function(){_(n);let i=s(2);return f(i.handleAddProduct())}),p(3,"Add Product"),l()()}if(e&2){let n=s(2);m(),w("ngModel",n.newProduct)}}function Je(e,r){if(e&1&&(a(0,"tr")(1,"td"),p(2),l()()),e&2){let n=r.$implicit;m(2),oe(n.name)}}function Ye(e,r){if(e&1&&(a(0,"div",2),u(1,Ze,4,1,"span",3),a(2,"nz-table",4)(3,"thead")(4,"tr")(5,"th",5),p(6,"Product Name"),l()()(),a(7,"tbody"),u(8,Je,3,1,"tr",6),l()()()),e&2){let n=s();m(),d("appHasPermission",n.appPermissions.UpdateVendors),m(),d("nzData",n.products),m(6),d("ngForOf",n.products)}}var Fe=(()=>{let r=class r{constructor(t){this.appService=t,this.visible=!1,this.closeDrawer=new ne,this.placement="right",this.products=[],this.newProduct="",this.appPermissions=g}ngOnInit(){this.getAndSetItems()}getAndSetItems(){return v(this,null,function*(){this.products=yield this.appService.getVendorItems(this.vendor.id)})}addNewItem(){return v(this,null,function*(){this.newProduct&&this.newProduct.trim()&&(yield this.appService.addVendorItem(this.vendor.id,this.newProduct.trim()))})}showDrawer(){this.visible=!0}onClose(){this.visible=!1,this.closeDrawer.emit(!0)}handleAddProduct(){return v(this,null,function*(){this.newProduct.trim()!==""&&(this.products.push({name:this.newProduct.trim()}),yield this.addNewItem(),this.newProduct="",this.getAndSetItems())})}};r.\u0275fac=function(i){return new(i||r)(V(P))},r.\u0275cmp=b({type:r,selectors:[["app-vendor-details"]],inputs:{vendor:"vendor",visible:"visible"},outputs:{closeDrawer:"closeDrawer"},decls:2,vars:4,consts:[[3,"nzClosable","nzVisible","nzPlacement","nzTitle","nzOnClose"],["class","vendor-details",4,"nzDrawerContent"],[1,"vendor-details"],[4,"appHasPermission"],["nzShowPagination","false","nzBordered","",3,"nzData"],["nzWidth","50%"],[4,"ngFor","ngForOf"],["nz-input","","placeholder","Enter product name",2,"margin-bottom","12px",3,"ngModel","ngModelChange"],["nz-button","","nzType","primary",2,"margin-bottom","12px",3,"click"]],template:function(i,o){i&1&&(a(0,"nz-drawer",0),h("nzOnClose",function(){return o.onClose()}),u(1,Ye,9,3,"div",1),l()),i&2&&d("nzClosable",!1)("nzVisible",o.visible)("nzPlacement",o.placement)("nzTitle",o.vendor.name)},dependencies:[N,M,E,O,ye,we,k,W,U,B,H,L,j,I,F,A,G]});let e=r;return e})();function Qe(e,r){if(e&1){let n=C();a(0,"div")(1,"button",8),h("click",function(){_(n);let i=s();return f(i.showModal())}),p(2,"Add Vendor"),l()()}}function Xe(e,r){if(e&1){let n=C();a(0,"app-vendor-details",9),h("closeDrawer",function(){_(n);let i=s();return f(i.drawerVisible=!1)}),l()}if(e&2){let n=s();d("vendor",n.selectedVendor)("visible",n.drawerVisible)}}function et(e,r){if(e&1&&(q(0),x(1,"span",17),a(2,"div",18),p(3,"Upload"),l(),Z()),e&2){let n=s(2);m(),d("nzType",n.loading?"loading":"plus")}}function tt(e,r){if(e&1&&x(0,"img",19),e&2){let n=s(2);d("src",n.avatarUrl,$)}}function it(e,r){if(e&1){let n=C();a(0,"nz-form",10)(1,"nz-form-item")(2,"nz-form-label",11),p(3,"Vendor Name"),l(),a(4,"nz-form-control",12),x(5,"input",13),l()(),a(6,"nz-form-item")(7,"nz-form-label",11),p(8,"Vendor Name"),l(),a(9,"nz-form-control",12)(10,"nz-upload",14),h("nzChange",function(i){_(n);let o=s();return f(o.handleChange(i))}),u(11,et,4,1,"ng-container",15)(12,tt,1,1,"img",16),l()()()()}if(e&2){let n=s();d("formGroup",n.addVendorForm),m(10),d("nzShowUploadList",!1)("nzBeforeUpload",n.beforeUpload),m(),d("ngIf",!n.avatarUrl),m(),d("ngIf",n.avatarUrl)}}function nt(e,r){if(e&1&&(a(0,"th",20),p(1),l()),e&2){let n=r.$implicit;d("nzSortFn",n.compare)("nzSortPriority",n.priority),m(),Y(" ",n.title," ")}}function ot(e,r){if(e&1){let n=C();a(0,"a",26),h("click",function(){_(n);let i=s(2).$implicit,o=s();return f(o.startEdit(i.id))}),p(1,"Edit"),l()}}function rt(e,r){if(e&1){let n=C();q(0),a(1,"td")(2,"div")(3,"span",23),h("click",function(){_(n);let i=s().$implicit,o=s();return f(o.viewDetails(i))}),l(),x(4,"img",24),a(5,"span"),p(6),l()()(),a(7,"td"),u(8,ot,2,0,"a",25),l(),Z()}if(e&2){let n=s().$implicit,t=s();m(4),d("src",t.apiUrl+"/images/"+n.filename,$),m(2),Y(" ",n.name,""),m(2),d("appHasPermission",t.appPermissions.UpdateVendors)}}function at(e,r){if(e&1){let n=C();a(0,"td")(1,"input",27),D("ngModelChange",function(i){_(n);let o=s().$implicit,c=s();return y(c.editCache[o.id].data.name,i)||(c.editCache[o.id].data.name=i),f(i)}),l()(),a(2,"td")(3,"a",28),h("click",function(){_(n);let i=s().$implicit,o=s();return f(o.saveEdit(i.id))}),p(4,"Save"),l(),p(5," \xA0 "),a(6,"a",29),h("nzOnConfirm",function(){_(n);let i=s().$implicit,o=s();return f(o.cancelEdit(i.id))}),p(7,"Cancel"),l()()}if(e&2){let n=s().$implicit,t=s();m(),w("ngModel",t.editCache[n.id].data.name)}}function st(e,r){if(e&1&&(a(0,"tr"),u(1,rt,9,3,"ng-container",21)(2,at,8,1,"ng-template",null,22,re),l()),e&2){let n=r.$implicit,t=J(3),i=s();m(),d("ngIf",!(i.editCache[n.id]!=null&&i.editCache[n.id].edit))("ngIfElse",t)}}var Ae=(()=>{let r=class r{constructor(t,i){this.appService=t,this.fb=i,this.apiUrl=le.apiUrl,this.isModalVisible=!1,this.drawerVisible=!1,this.selectedVendor={},this.appPermissions=g,this.listOfColumn=[{title:"Name",compare:(o,c)=>o.name.localeCompare(c.name),priority:!1},{title:"Action",compare:(o,c)=>o.role_id-c.role_id,priority:!1}],this.listOfData=[],this.visible=!1,this.editCache={},this.beforeUpload=(o,c)=>new ie(z=>{let ee=o.type==="image/jpeg"||o.type==="image/png";if(!ee){this.msg.error("You can only upload JPG file!"),z.complete();return}let te=o.size/1024/1024<2;if(!te){this.msg.error("Image must smaller than 2MB!"),z.complete();return}this.addVendorForm.patchValue({file:o}),z.next(ee&&te),z.complete()}),this.addVendorForm=this.fb.group({name:["",[Q.required]],file:["",[Q.required]]})}showModal(){this.isModalVisible=!0}handleOk(){return v(this,null,function*(){yield this.appService.createVendor(this.addVendorForm.value.name,this.addVendorForm.value.file),this.isModalVisible=!1,this.populateVendorData()})}handleCancel(){this.isModalVisible=!1}ngOnInit(){this.populateVendorData()}open(){this.visible=!0}close(t=!1){this.visible=!1,t&&this.populateVendorData()}populateVendorData(){return v(this,null,function*(){this.listOfData=yield this.appService.getVendors(),this.updateEditCache()})}startEdit(t){this.editCache[t].edit=!0}cancelEdit(t){let i=this.listOfData.findIndex(o=>o.id===t);this.editCache[t]={data:R({},this.listOfData[i]),edit:!1}}saveEdit(t){return v(this,null,function*(){let i=this.listOfData.findIndex(o=>o.id===t);yield this.appService.updateVendor({id:t,organization_id:this.editCache[t].data.organization_id,role_id:this.editCache[t].data.role_id,reports_to:this.editCache[t].data.reports_to,name:this.editCache[t].data.name}),this.editCache[t].edit=!1,Object.assign(this.listOfData[i],this.editCache[t].data),this.populateVendorData()})}updateEditCache(){this.listOfData.forEach(t=>{this.editCache[t.id]={edit:!1,data:R({},t)}})}viewDetails(t){this.selectedVendor=t,this.drawerVisible=!0}getBase64(t,i){let o=new FileReader;o.addEventListener("load",()=>i(o.result.toString())),o.readAsDataURL(t)}handleChange(t){this.getBase64(t.file.originFileObj,i=>{this.loading=!1,this.avatarUrl=i})}};r.\u0275fac=function(i){return new(i||r)(V(P),V(ge))},r.\u0275cmp=b({type:r,selectors:[["app-vendor"]],decls:12,vars:6,consts:[[4,"appHasPermission"],[3,"vendor","visible","closeDrawer",4,"ngIf"],["nzTitle","Add Vendor",3,"nzVisible","nzVisibleChange","nzOnCancel","nzOnOk"],[3,"formGroup",4,"nzModalContent"],["nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["nz-button","","nzType","primary",3,"click"],[3,"vendor","visible","closeDrawer"],[3,"formGroup"],["nzRequired",""],["nzHasFeedback","","nzErrorTip","Please input Vendor name"],["nz-input","","formControlName","name"],["nzAction","null","nzName","avatar","nzListType","picture-card",1,"avatar-uploader",3,"nzShowUploadList","nzBeforeUpload","nzChange"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"],[3,"nzSortFn","nzSortPriority"],[4,"ngIf","ngIfElse"],["editTemplate",""],["nz-button","","nz-icon","","nzType","profile","nzTheme","outline",3,"click"],["alt","",1,"smallIcon",3,"src"],[3,"click",4,"appHasPermission"],[3,"click"],["type","text","nz-input","",3,"ngModel","ngModelChange"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"]],template:function(i,o){if(i&1&&(u(0,Qe,3,0,"div",0)(1,Xe,1,2,"app-vendor-details",1),a(2,"nz-modal",2),D("nzVisibleChange",function(z){return y(o.isModalVisible,z)||(o.isModalVisible=z),z}),h("nzOnCancel",function(){return o.handleCancel()})("nzOnOk",function(){return o.handleOk()}),u(3,it,13,5,"nz-form",3),l(),a(4,"nz-table",4,5)(7,"thead")(8,"tr"),u(9,nt,2,3,"th",6),l()(),a(10,"tbody"),u(11,st,4,2,"tr",7),l()()),i&2){let c=J(6);d("appHasPermission",o.appPermissions.UpdateVendors),m(),d("ngIf",o.drawerVisible),m(),w("nzVisible",o.isModalVisible),m(2),d("nzData",o.listOfData),m(5),d("ngForOf",o.listOfColumn),m(2),d("ngForOf",c.data)}},dependencies:[N,ae,M,E,O,pe,be,De,Se,Ne,Te,k,ue,fe,Pe,W,Ee,U,B,H,L,j,Oe,I,F,Ce,ze,ve,A,G,Fe],styles:["[_nghost-%COMP%]     .avatar-uploader>.ant-upload{width:128px;height:128px}"]});let e=r;return e})();var lt=[{path:"",component:Ae,children:[],data:{name:"",permission:g.ViewVendors},canActivate:[he]}],ke=(()=>{let r=class r{};r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=S({type:r}),r.\u0275inj=T({imports:[K.forChild(lt),K]});let e=r;return e})();var Ue=me,mt=Object.keys(Ue).map(e=>Ue[e]),Zt=(()=>{let r=class r{};r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=S({type:r}),r.\u0275inj=T({providers:[{provide:_e,useValue:ce},{provide:de,useValue:mt}],imports:[se,ke,Me,xe,Ve,Ie]});let e=r;return e})();export{Zt as VendorModule};
