import{a as it}from"./chunk-NGE6N3H6.js";import{$ as a,$a as P,B as N,Ba as S,Bb as Z,Cb as q,Da as y,Db as W,Ha as b,Hb as U,Ia as u,Ib as K,Ic as ot,K as s,L as p,La as _,Na as w,Oa as F,Pb as Q,Q as C,R as l,Va as M,Vb as X,Wb as Y,Xa as x,Xb as $,Yb as tt,Zb as et,_ as n,aa as c,bb as D,cb as E,ea as I,eb as O,fb as j,gb as d,hb as k,ib as T,ka as f,mb as A,nb as R,qb as V,r as z,s as h,sb as G,tb as L,ub as B,vb as J,wb as H,z as v}from"./chunk-3TINHIPJ.js";import{g}from"./chunk-MON7YFGF.js";function pt(e,t){e&1&&(n(0,"nz-form-item")(1,"nz-form-control",14),c(2,"nz-alert",15),a()()),e&2&&(s(),l("nzSpan",24))}var rt=(()=>{let t=class t{constructor(o,i,m,r,at){this.fb=o,this.http=i,this.platformId=m,this.router=r,this.appService=at,this.organization_id=0,this.showErrorMessage=!1,this.validateForm=this.fb.group({username:["",[d.required]],password:["",[d.required]],remember:[!0]}),u(this.platformId)&&(this.organization_id=parseInt(localStorage.getItem("organization_id")||""))}submitForm(){return g(this,null,function*(){this.showErrorMessage=!1;try{if(this.validateForm.valid){console.log("submit",this.validateForm.value);let o=20,i=this.validateForm.value.password||"",m=this.validateForm.value.username||"",r=yield this.http.post("/api/auth/login",{organization_id:this.organization_id,username:m,password:i}).toPromise();u(this.platformId)&&r.access_token&&(localStorage.setItem("token",r.access_token),localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("permissions",JSON.stringify(r.user.role_permissions)),localStorage.setItem("sub_organization_id",JSON.stringify(r.user.sub_organization_id)),this.router.navigate(["/"]))}else Object.values(this.validateForm.controls).forEach(o=>{o.invalid&&(o.markAsDirty(),o.updateValueAndValidity({onlySelf:!0}),this.showErrorMessage=!0)})}catch{this.showErrorMessage=!0}})}};t.\u0275fac=function(i){return new(i||t)(p(G),p(_),p(N),p(M),p(P))},t.\u0275cmp=z({type:t,selectors:[["app-login"]],decls:20,vars:4,consts:[[1,"app-login"],[1,"text-center","p4"],["nz-form","",1,"login-form",3,"formGroup","ngSubmit"],["nzErrorTip","Please input your username!"],["nzPrefixIcon","user"],["type","text","nz-input","","formControlName","username","placeholder","username"],["nzErrorTip","Please input your Password!"],["nzPrefixIcon","lock"],["type","password","nz-input","","formControlName","password","placeholder","Password"],[4,"ngIf"],["nz-row","",1,"login-form-margin"],["nz-col","",3,"nzSpan"],["nz-checkbox","","formControlName","remember"],["nz-button","",1,"login-form-button","login-form-margin",3,"nzType"],[3,"nzSpan"],["nzType","error","nzMessage","Incorrect credentials !"]],template:function(i,m){i&1&&(n(0,"div",0)(1,"h2",1),f(2," Welcome Back!"),a(),n(3,"form",2),I("ngSubmit",function(){return m.submitForm()}),n(4,"nz-form-item")(5,"nz-form-control",3)(6,"nz-input-group",4),c(7,"input",5),a()()(),n(8,"nz-form-item")(9,"nz-form-control",6)(10,"nz-input-group",7),c(11,"input",8),a()()(),C(12,pt,3,1,"nz-form-item",9),n(13,"div",10)(14,"div",11)(15,"label",12)(16,"span"),f(17,"Remember me"),a()()()(),n(18,"button",13),f(19,"Log in"),a()()()),i&2&&(s(3),l("formGroup",m.validateForm),s(9),l("ngIf",m.showErrorMessage),s(2),l("nzSpan",12),s(4),l("nzType","primary"))},dependencies:[y,A,j,k,T,R,V,O,W,Z,q,Q,Y,X,tt,$,et,J,H],styles:[".login-form[_ngcontent-%COMP%]{max-width:300px}.login-form-margin[_ngcontent-%COMP%]{margin-bottom:16px}.login-form-forgot[_ngcontent-%COMP%]{float:right}.login-form-button[_ngcontent-%COMP%]{width:100%}.app-login[_ngcontent-%COMP%]{background:#fff;padding:32px;margin:50px;border-radius:12px}"]});let e=t;return e})();var nt=[{path:"",component:rt}];S(it);var mt=D,lt=Object.keys(mt).map(e=>mt[e]),Ht=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=h({type:t}),t.\u0275inj=v({providers:[x(nt),{provide:K,useValue:U},{provide:E,useValue:lt}],imports:[b,L,w,F,B,ot]});let e=t;return e})();export{Ht as a};
