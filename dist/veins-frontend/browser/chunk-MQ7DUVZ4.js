import{b as Z,d as Fe}from"./chunk-MWKGTREX.js";import{a as he}from"./chunk-GG53NFM7.js";import{a as S}from"./chunk-IOGPI7L7.js";import{A as _,Ac as L,B as f,Ba as ae,Bb as W,Cc as Me,Db as ge,Dc as H,E as P,Fc as j,Ga as M,Gb as xe,Gc as G,Ha as se,Hb as ve,Hc as R,Ic as q,Jb as Ve,Kb as we,Lb as B,Ma as le,N as J,Nc as Oe,O as m,Oc as Ie,P as D,U as u,V as p,a as T,b as ne,bb as X,bc as ye,ca as a,cb as de,cc as Se,da as s,dc as be,e as g,ea as x,eb as O,ec as De,f as oe,fa as Y,ga as $,gb as me,gc as Te,ha as h,hb as pe,ia as C,ib as ce,ic as Ee,ja as l,jb as I,jc as Ne,kb as F,lb as k,na as K,nb as _e,oa as c,ob as fe,pa as y,qa as Q,sa as v,sb as ue,ta as V,tb as Ce,ua as w,v as re,vb as A,w as E,wb as b,x as N,xb as U,yb as ze,yc as Pe}from"./chunk-T6XUJHRI.js";function Ye(o,r){if(o&1){let n=h();a(0,"span")(1,"input",7),w("ngModelChange",function(e){_(n);let t=l(2);return V(t.newProduct,e)||(t.newProduct=e),f(e)}),s(),a(2,"button",8),C("click",function(){_(n);let e=l(2);return f(e.handleAddProduct())}),c(3,"Add Product"),s()()}if(o&2){let n=l(2);m(),v("ngModel",n.newProduct)}}function $e(o,r){if(o&1&&(a(0,"tr")(1,"td"),c(2),s()()),o&2){let n=r.$implicit;m(2),y(n.name)}}function Ke(o,r){if(o&1&&(a(0,"div",2),u(1,Ye,4,1,"span",3),a(2,"nz-table",4)(3,"thead")(4,"tr")(5,"th",5),c(6,"Product Name"),s()()(),a(7,"tbody"),u(8,$e,3,1,"tr",6),s()()()),o&2){let n=l();m(),p("appHasPermission",n.appPermissions.UpdateVendors),m(),p("nzPageSize",1e3)("nzData",n.products),m(6),p("ngForOf",n.products)}}var ke=(()=>{let r=class r{constructor(i){this.appService=i,this.visible=!1,this.closeDrawer=new re,this.placement="right",this.products=[],this.newProduct="",this.appPermissions=S}ngOnInit(){this.getAndSetItems()}getAndSetItems(){return g(this,null,function*(){this.products=yield this.appService.getVendorItems(this.vendor.id)})}addNewItem(){return g(this,null,function*(){this.newProduct&&this.newProduct.trim()&&(yield this.appService.addVendorItem(this.vendor.id,this.newProduct.trim()))})}showDrawer(){this.visible=!0}onClose(){this.visible=!1,this.closeDrawer.emit(!0)}handleAddProduct(){return g(this,null,function*(){this.newProduct.trim()!==""&&(this.products.push({name:this.newProduct.trim()}),yield this.addNewItem(),this.newProduct="",this.getAndSetItems())})}};r.\u0275fac=function(e){return new(e||r)(D(O))},r.\u0275cmp=E({type:r,selectors:[["app-vendor-details"]],inputs:{vendor:"vendor",visible:"visible"},outputs:{closeDrawer:"closeDrawer"},decls:2,vars:4,consts:[[3,"nzClosable","nzVisible","nzPlacement","nzTitle","nzOnClose"],["class","vendor-details",4,"nzDrawerContent"],[1,"vendor-details"],[4,"appHasPermission"],["nzShowPagination","false","nzBordered","",3,"nzPageSize","nzData"],["nzWidth","50%"],[4,"ngFor","ngForOf"],["nz-input","","placeholder","Enter product name",2,"margin-bottom","12px",3,"ngModel","ngModelChange"],["nz-button","","nzType","primary",2,"margin-bottom","12px",3,"click"]],template:function(e,t){e&1&&(a(0,"nz-drawer",0),C("nzOnClose",function(){return t.onClose()}),u(1,Ke,9,4,"div",1),s()),e&2&&p("nzClosable",!1)("nzVisible",t.visible)("nzPlacement",t.placement)("nzTitle",t.vendor.name)},dependencies:[M,k,I,F,Se,ye,B,G,L,H,q,j,R,A,U,W,Z]});let o=r;return o})();function Xe(o,r){if(o&1){let n=h();a(0,"div")(1,"button",8),C("click",function(){_(n);let e=l();return f(e.showModal())}),c(2,"Add Vendor"),s()()}}function et(o,r){if(o&1){let n=h();a(0,"app-vendor-details",9),C("closeDrawer",function(){_(n);let e=l();return f(e.drawerVisible=!1)}),s()}if(o&2){let n=l();p("vendor",n.selectedVendor)("visible",n.drawerVisible)}}function tt(o,r){if(o&1&&(Y(0),x(1,"span",23),a(2,"div",24),c(3,"Upload"),s(),$()),o&2){let n=l(2);m(),p("nzType",n.loading?"loading":"plus")}}function it(o,r){if(o&1&&x(0,"img",25),o&2){let n=l(2);p("src",n.avatarUrl,J)}}function nt(o,r){if(o&1){let n=h();a(0,"nz-form",10)(1,"nz-form-item")(2,"nz-form-label",11),c(3,"Vendor Name"),s(),a(4,"nz-form-control",12),x(5,"input",13),s()(),a(6,"nz-form-item")(7,"nz-form-label",11),c(8,"Contact No"),s(),a(9,"nz-form-control",14),x(10,"input",15),s()(),a(11,"nz-form-item")(12,"nz-form-label",11),c(13,"Email"),s(),a(14,"nz-form-control",16),x(15,"input",17),s()(),a(16,"nz-form-item")(17,"nz-form-label",11),c(18,"Address"),s(),a(19,"nz-form-control",18),x(20,"input",19),s()(),a(21,"nz-form-item")(22,"nz-form-label",11),c(23,"Vendor Image"),s(),a(24,"nz-form-control",12)(25,"nz-upload",20),C("nzChange",function(e){_(n);let t=l();return f(t.handleChange(e))}),u(26,tt,4,1,"ng-container",21)(27,it,1,1,"img",22),s()()()()}if(o&2){let n=l();p("formGroup",n.addVendorForm),m(25),p("nzShowUploadList",!1)("nzBeforeUpload",n.beforeUpload),m(),p("ngIf",!n.avatarUrl),m(),p("ngIf",n.avatarUrl)}}function ot(o,r){if(o&1&&(a(0,"th",26),c(1),s()),o&2){let n=r.$implicit;p("nzSortFn",n.compare)("nzSortPriority",n.priority),m(),Q(" ",n.title," ")}}function rt(o,r){if(o&1){let n=h();a(0,"a",32),C("click",function(){_(n);let e=l(2).$implicit,t=l();return f(t.startEdit(e.id))}),c(1,"Edit"),s()}}function at(o,r){if(o&1){let n=h();Y(0),a(1,"td")(2,"div")(3,"span",29),C("click",function(){_(n);let e=l().$implicit,t=l();return f(t.viewDetails(e))}),s(),x(4,"img",30),a(5,"span"),c(6),s()()(),a(7,"td"),c(8),s(),a(9,"td"),c(10),s(),a(11,"td"),c(12),s(),a(13,"td"),u(14,rt,2,0,"a",31),s(),$()}if(o&2){let n=l().$implicit,i=l();m(4),p("src",i.apiUrl+"/images/"+n.filename,J),m(2),Q(" ",n.name,""),m(2),y(n.contact_no),m(2),y(n.address),m(2),y(n.email),m(2),p("appHasPermission",i.appPermissions.UpdateVendors)}}function st(o,r){if(o&1){let n=h();a(0,"td")(1,"input",33),w("ngModelChange",function(e){_(n);let t=l().$implicit,d=l();return V(d.editCache[t.id].data.name,e)||(d.editCache[t.id].data.name=e),f(e)}),s()(),a(2,"td")(3,"input",33),w("ngModelChange",function(e){_(n);let t=l().$implicit,d=l();return V(d.editCache[t.id].data.contact_no,e)||(d.editCache[t.id].data.contact_no=e),f(e)}),s()(),a(4,"td")(5,"input",33),w("ngModelChange",function(e){_(n);let t=l().$implicit,d=l();return V(d.editCache[t.id].data.address,e)||(d.editCache[t.id].data.address=e),f(e)}),s()(),a(6,"td")(7,"input",33),w("ngModelChange",function(e){_(n);let t=l().$implicit,d=l();return V(d.editCache[t.id].data.email,e)||(d.editCache[t.id].data.email=e),f(e)}),s()(),a(8,"td")(9,"a",34),C("click",function(){_(n);let e=l().$implicit,t=l();return f(t.saveEdit(e.id))}),c(10,"Save"),s(),c(11," \xA0 "),a(12,"a",35),C("nzOnConfirm",function(){_(n);let e=l().$implicit,t=l();return f(t.cancelEdit(e.id))}),c(13,"Cancel"),s()()}if(o&2){let n=l().$implicit,i=l();m(),v("ngModel",i.editCache[n.id].data.name),m(2),v("ngModel",i.editCache[n.id].data.contact_no),m(2),v("ngModel",i.editCache[n.id].data.address),m(2),v("ngModel",i.editCache[n.id].data.email)}}function lt(o,r){if(o&1&&(a(0,"tr"),u(1,at,15,6,"ng-container",27)(2,st,14,4,"ng-template",null,28,ae),s()),o&2){let n=r.$implicit,i=K(3),e=l();m(),p("ngIf",!(e.editCache[n.id]!=null&&e.editCache[n.id].edit))("ngIfElse",i)}}var Ae=(()=>{let r=class r{constructor(i,e){this.appService=i,this.fb=e,this.apiUrl=de.apiUrl,this.isModalVisible=!1,this.drawerVisible=!1,this.selectedVendor={},this.appPermissions=S,this.listOfColumn=[{title:"Name",compare:(t,d)=>t.name.localeCompare(d.name),priority:!1},{title:"Contact No",compare:(t,d)=>t.contact_no.localeCompare(d.contact_no),priority:!1},{title:"Address",compare:(t,d)=>t.address.localeCompare(d.address),priority:!1},{title:"Email",compare:(t,d)=>t.email.localeCompare(d.email),priority:!1},{title:"Action",compare:(t,d)=>t.role_id-d.role_id,priority:!1}],this.listOfData=[],this.visible=!1,this.editCache={},this.beforeUpload=(t,d)=>new oe(z=>{let te=t.type==="image/jpeg"||t.type==="image/png";if(!te){this.msg.error("You can only upload JPG file!"),z.complete();return}let ie=t.size/1024/1024<2;if(!ie){this.msg.error("Image must smaller than 2MB!"),z.complete();return}this.addVendorForm.patchValue({file:t}),z.next(te&&ie),z.complete()}),this.addVendorForm=this.fb.group({name:["",[b.required]],contact_no:["",[b.required]],email:["",[b.required]],address:["",[b.required]],file:["",[b.required]]})}showModal(){this.isModalVisible=!0}handleOk(){return g(this,null,function*(){yield this.appService.createVendor(this.addVendorForm.value.name,this.addVendorForm.value.file),this.isModalVisible=!1,this.populateVendorData()})}handleCancel(){this.isModalVisible=!1}ngOnInit(){this.currentSubOrganizationSubscription=this.appService.currentSubOrganization.subscribe(i=>{i&&i.id>0&&this.populateVendorData()})}ngOnDestroy(){this.currentSubOrganizationSubscription&&this.currentSubOrganizationSubscription.unsubscribe()}open(){this.visible=!0}close(i=!1){this.visible=!1,i&&this.populateVendorData()}populateVendorData(){return g(this,null,function*(){this.listOfData=yield this.appService.getVendors(),this.updateEditCache()})}startEdit(i){this.editCache[i].edit=!0}cancelEdit(i){let e=this.listOfData.findIndex(t=>t.id===i);this.editCache[i]={data:T({},this.listOfData[e]),edit:!1}}saveEdit(i){return g(this,null,function*(){let e=this.listOfData.findIndex(t=>t.id===i);yield this.appService.updateVendor(ne(T({id:i},this.editCache[i].data),{organization_id:this.editCache[i].data.organization_id,role_id:this.editCache[i].data.role_id,reports_to:this.editCache[i].data.reports_to,name:this.editCache[i].data.name})),this.editCache[i].edit=!1,Object.assign(this.listOfData[e],this.editCache[i].data),this.populateVendorData()})}updateEditCache(){this.listOfData.forEach(i=>{this.editCache[i.id]={edit:!1,data:T({},i)}})}viewDetails(i){this.selectedVendor=i,this.drawerVisible=!0}getBase64(i,e){let t=new FileReader;t.addEventListener("load",()=>e(t.result.toString())),t.readAsDataURL(i)}handleChange(i){this.getBase64(i.file.originFileObj,e=>{this.loading=!1,this.avatarUrl=e})}};r.\u0275fac=function(e){return new(e||r)(D(O),D(ve))},r.\u0275cmp=E({type:r,selectors:[["app-vendor"]],decls:12,vars:7,consts:[[4,"appHasPermission"],[3,"vendor","visible","closeDrawer",4,"ngIf"],["nzTitle","Add Vendor",3,"nzVisible","nzVisibleChange","nzOnCancel","nzOnOk"],[3,"formGroup",4,"nzModalContent"],["nzShowPagination","false","nzTableLayout","fixed",3,"nzPageSize","nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["nz-button","","nzType","primary",3,"click"],[3,"vendor","visible","closeDrawer"],[3,"formGroup"],["nzRequired",""],["nzHasFeedback","","nzErrorTip","Please input Vendor name"],["nz-input","","formControlName","name"],["nzHasFeedback","","nzErrorTip","Please input Vendor contact no"],["nz-input","","formControlName","contact_no"],["nzHasFeedback","","nzErrorTip","Please input Vendor email"],["nz-input","","formControlName","email"],["nzHasFeedback","","nzErrorTip","Please input vendor address"],["nz-input","","formControlName","address"],["nzAction","null","nzName","avatar","nzListType","picture-card",1,"avatar-uploader",3,"nzShowUploadList","nzBeforeUpload","nzChange"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"],[3,"nzSortFn","nzSortPriority"],[4,"ngIf","ngIfElse"],["editTemplate",""],["nz-button","","nz-icon","","nzType","profile","nzSize","large","nzTheme","outline",3,"click"],["alt","",1,"smallIcon",3,"src"],[3,"click",4,"appHasPermission"],[3,"click"],["type","text","nz-input","",3,"ngModel","ngModelChange"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"]],template:function(e,t){if(e&1&&(u(0,Xe,3,0,"div",0)(1,et,1,2,"app-vendor-details",1),a(2,"nz-modal",2),w("nzVisibleChange",function(z){return V(t.isModalVisible,z)||(t.isModalVisible=z),z}),C("nzOnCancel",function(){return t.handleCancel()})("nzOnOk",function(){return t.handleOk()}),u(3,nt,28,5,"nz-form",3),s(),a(4,"nz-table",4,5)(7,"thead")(8,"tr"),u(9,ot,2,3,"th",6),s()(),a(10,"tbody"),u(11,lt,4,2,"tr",7),s()()),e&2){let d=K(6);p("appHasPermission",t.appPermissions.UpdateVendors),m(),p("ngIf",t.drawerVisible),m(),v("nzVisible",t.isModalVisible),m(2),p("nzPageSize",1e3)("nzData",t.listOfData),m(5),p("ngForOf",t.listOfColumn),m(2),p("ngForOf",d.data)}},dependencies:[M,se,k,I,F,ce,De,be,Te,Ne,Ee,B,Ce,ue,Pe,G,Me,L,H,q,j,R,Oe,A,U,ze,ge,xe,W,Z,ke],styles:["[_nghost-%COMP%]     .avatar-uploader>.ant-upload{width:128px;height:128px}"]});let o=r;return o})();var dt=[{path:"",component:Ae,children:[],data:{name:"",permission:S.ViewVendors},canActivate:[he]}],Ue=(()=>{let r=class r{};r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=N({type:r}),r.\u0275inj=P({imports:[X.forChild(dt),X]});let o=r;return o})();var We=me,mt=Object.keys(We).map(o=>We[o]),Yt=(()=>{let r=class r{};r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=N({type:r}),r.\u0275inj=P({providers:[{provide:fe,useValue:_e},{provide:pe,useValue:mt}],imports:[le,Ue,Ie,we,Ve,Fe]});let o=r;return o})();export{Yt as VendorModule};
