import{a as dt}from"./chunk-FJMKEXM4.js";import{a as nt,b as it}from"./chunk-5DX3OOMX.js";import{a as R}from"./chunk-JD43ETEY.js";import{a as W}from"./chunk-ILRJTMHX.js";import{$b as Y,Aa as I,Db as J,E as v,Ha as D,Ia as H,Lb as Z,Ma as k,Mb as K,Na as F,O as i,P as T,Rc as et,U as g,V as o,Wb as U,Xb as Q,a as C,b as O,ca as p,d as pt,da as c,db as M,e as z,ea as u,gc as $,hb as j,hc as tt,ia as P,ja as y,jb as V,kb as B,oa as m,pb as L,qa as S,qb as q,sa as E,ta as A,ua as N,w,x,ya as _,zb as G}from"./chunk-T7SK3QLE.js";var ot=pt(dt());function ht(t,e){if(t&1&&(p(0,"nz-card",15),u(1,"highcharts-chart",16),c()),t&2){let s=y();i(),o("Highcharts",s.Highcharts)("options",s.siteChartOptions)("constructorType",s.chartConstructor)}}function mt(t,e){if(t&1&&(p(0,"nz-card",15),u(1,"highcharts-chart",16),c()),t&2){let s=y();i(),o("Highcharts",s.Highcharts)("options",s.chartOptions)("constructorType",s.chartConstructor)}}function ft(t,e){if(t&1&&(p(0,"nz-card"),u(1,"highcharts-chart",16),c()),t&2){let s=y();i(),o("Highcharts",s.Highcharts)("options",s.piechartOptions)("constructorType",s.chartConstructor)}}function gt(t,e){if(t&1&&u(0,"nz-option",17),t&2){let s=e.$implicit;o("nzLabel",s)("nzValue",s)}}function ut(t,e){if(t&1&&u(0,"highcharts-chart",16),t&2){let s=y();o("Highcharts",s.Highcharts)("options",s.lineChartOptions)("constructorType",s.chartConstructor)}}var rt=(()=>{let e=class e{constructor(r){this.appService=r,this.isHighcharts=typeof ot=="object",this.title="UnivHighCharts",this.Highcharts=ot,this.chartConstructor="chart",this.chartOptions={},this.siteChartOptions={},this.piechartOptions={},this.lineChartOptions={},this.showTopTen=!1,this.currentOrganizationId=0,this.selectedItem="",this.showMonthly=!1,this.inventoryStats={},this.chartOptions={chart:{type:"column",backgroundColor:"transparent",height:300},credits:{enabled:!1},title:{text:"Top 10 Products in Hand",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},xAxis:{categories:[],crosshair:!0,accessibility:{description:"Countries"},labels:{style:{fontSize:"11px"}}},yAxis:{min:0,title:{text:"",style:{fontSize:"12px"}},labels:{style:{fontSize:"11px"}}},tooltip:{valueSuffix:" ",style:{fontSize:"11px"}},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[]},this.siteChartOptions={chart:{type:"column",backgroundColor:"transparent",height:300},credits:{enabled:!1},title:{text:"Site Expenses",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},xAxis:{categories:[],crosshair:!0,accessibility:{description:"Countries"},labels:{style:{fontSize:"11px"}}},yAxis:{min:0,title:{text:"",style:{fontSize:"12px"}},labels:{style:{fontSize:"11px"}}},tooltip:{valueSuffix:" ",style:{fontSize:"11px"}},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[]},this.piechartOptions={chart:{plotShadow:!1,type:"pie",height:250,backgroundColor:"transparent"},title:{text:"Available Stock",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},tooltip:{valueSuffix:"",style:{fontSize:"11px"}},credits:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},legend:{align:"right",verticalAlign:"middle",layout:"vertical"},series:[]},this.lineChartOptions={chart:{type:"line",backgroundColor:"transparent",height:218},credits:{enabled:!1},title:{text:"",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},plotOptions:{series:{label:{connectorAllowed:!1},pointStart:0}},xAxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},series:[],responsive:{rules:[{condition:{maxWidth:500},chartOptions:{}}]},legend:{enabled:!0}}}ngAfterViewInit(){}ngOnDestroy(){}ngOnInit(){this.subOrgSubscription=this.appService.currentSubOrganization.subscribe(r=>{r&&r.id>0&&this.currentOrganizationId!=r.id&&(this.currentOrganizationId=r.id,this.loadInventory(this.currentOrganizationId),this.getInventoryStats(this.currentOrganizationId),this.loadStatistics(this.currentOrganizationId))})}loadStatistics(r){return z(this,null,function*(){this.showChart=!1;let l=yield this.appService.retireveAllSiteStatistics(r),n=l.map(d=>d.siteName),h=[];l.forEach((d,b)=>{Object.entries(d).forEach(([a,f])=>{if(a!=="siteId"&&a!=="siteName")if(b===0)h.push({name:a,data:[f]});else{let X=h.find(ct=>ct.name===a);X&&X.data.push(f)}})}),this.showChart=!0,this.siteChartOptions=O(C({},this.siteChartOptions),{xAxis:O(C({},this.siteChartOptions.xAxis),{categories:n}),series:h})})}getInventoryStats(r=0){return z(this,null,function*(){this.inventoryStats=yield this.appService.getInventoryStatsBySubOrganization(r)})}loadInventory(r=0){return z(this,null,function*(){this.showTopTen=!1;let l=yield this.appService.getInventory(r),n={};this.items=l.map(a=>a.item_name),this.selectedItem=this.items[0],l.forEach(a=>{n[a.vendor_name]||(n[a.vendor_name]=[]),n[a.vendor_name].push({name:a.item_name,y:parseFloat((parseInt(a.qty)*parseInt(a.latest_unit_price)).toString())})});let h=Object.entries(n).map(([a,f])=>({name:a,data:f}));this.chartOptions.series=h;let d=[];l.forEach(a=>{d.push({name:a.item_name,y:parseFloat(a.qty)})});let b=[{name:"Quantity",colorByPoint:!0,data:d}];this.piechartOptions.series=b,this.showTopTen=!0,this.setItemBasedTrend()})}setItemBasedTrend(){return z(this,null,function*(){this.showMonthly=!1;let r=yield this.appService.getInventoryItemDetails(this.selectedItem);console.log(r);let l=Array(12).fill(0),n=Array(12).fill(0);r.forEach(d=>{let a=new Date(d.date_created).getMonth(),f=parseInt(d.qty);d.stock_in?l[a]+=f:n[a]+=f});let h=[{name:"Purchase",data:l},{name:"Sale",data:n}];console.log(h),this.lineChartOptions.series=h,this.showMonthly=!0})}};e.\u0275fac=function(l){return new(l||e)(T(j))},e.\u0275cmp=w({type:e,selectors:[["app-dashboard"]],decls:44,vars:63,consts:[[1,"dashboard"],["nzGutter","16",2,"margin-bottom","12px"],[3,"nzSm","nzXs","nzMd","nzXl","nzXXl"],["style","margin-bottom: 12px;",4,"ngIf"],[4,"ngIf"],[1,"flex","space-between","center"],[2,"text-wrap","nowrap","margin-right","10px"],["nzPlaceHolder","Select item",1,"inputField",2,"width","50px",3,"ngModel","ngModelChange"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["style","width: 100%;display: block;",3,"Highcharts","options","constructorType",4,"ngIf"],[1,"num_details",3,"nzSm","nzXs","nzMd","nzXl","nzXXl"],["nzGutter","8"],[2,"margin-top","12px",";margin-bottom","12px",3,"title"],[2,"margin-top","12px","margin-bottom","12px",3,"title"],[2,"margin-top","12px","margin-bottom","12px"],[2,"margin-bottom","12px"],[2,"width","100%","display","block",3,"Highcharts","options","constructorType"],[3,"nzLabel","nzValue"]],template:function(l,n){l&1&&(p(0,"div",0)(1,"nz-row",1)(2,"nz-col",2),g(3,ht,2,3,"nz-card",3),c(),p(4,"nz-col",2),g(5,mt,2,3,"nz-card",3),c(),p(6,"nz-col",2),g(7,ft,2,3,"nz-card",4),c(),p(8,"nz-col",2)(9,"nz-card")(10,"div",5)(11,"h5",6),m(12,"Monthly Stock Trend"),c(),p(13,"nz-select",7),N("ngModelChange",function(d){return A(n.selectedItem,d)||(n.selectedItem=d),d}),P("ngModelChange",function(){return n.setItemBasedTrend()}),g(14,gt,1,2,"nz-option",8),c()(),g(15,ut,1,3,"highcharts-chart",9),c()(),p(16,"nz-col",10)(17,"nz-row",11)(18,"nz-col",2)(19,"nz-card",12)(20,"h3"),m(21," Current Stock"),c(),p(22,"h5"),m(23),c()()(),p(24,"nz-col",2)(25,"nz-card",13)(26,"h3"),m(27," Max Sales"),c(),p(28,"h5"),m(29),_(30,"currency"),c()()(),p(31,"nz-col",2)(32,"nz-card",14)(33,"h3"),m(34," Products Sold"),c(),p(35,"h5"),m(36),c()()(),p(37,"nz-col",2)(38,"nz-card",14)(39,"h3"),m(40," Current Stock Value"),c(),p(41,"h5"),m(42),_(43,"currency"),c()()()()()()()),l&2&&(i(2),o("nzSm",24)("nzXs",24)("nzMd",14)("nzXl",14)("nzXXl",14),i(),o("ngIf",n.showChart),i(),o("nzSm",24)("nzXs",24)("nzMd",10)("nzXl",10)("nzXXl",10),i(),o("ngIf",n.showTopTen),i(),o("nzSm",24)("nzXs",24)("nzMd",14)("nzXl",14)("nzXXl",14),i(),o("ngIf",n.showTopTen),i(),o("nzSm",24)("nzXs",24)("nzMd",10)("nzXl",10)("nzXXl",10),i(5),E("ngModel",n.selectedItem),i(),o("ngForOf",n.items),i(),o("ngIf",n.showMonthly),i(),o("nzSm",24)("nzXs",24)("nzMd",24)("nzXl",24)("nzXXl",24),i(2),o("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),i(),o("title","Current Stock"),i(4),S(" ",n.inventoryStats==null?null:n.inventoryStats.currentStock," Items"),i(),o("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),i(),o("title","Max Sales"),i(4),S(" ",I(30,57,n.inventoryStats==null?null:n.inventoryStats.maxSales,"PKR "),""),i(2),o("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),i(5),S(" ",n.inventoryStats==null?null:n.inventoryStats.productsSold," Items"),i(),o("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),i(5),S(" ",I(43,60,n.inventoryStats==null?null:n.inventoryStats.currentStockValue,"PKR "),""))},dependencies:[D,H,Y,tt,$,U,Q,G,nt,J,k],styles:[".green-button[_ngcontent-%COMP%]{background-color:#72e272}.green-button[_ngcontent-%COMP%], .default[_ngcontent-%COMP%]{font-size:11px;text-wrap:nowrap;border:none}[_nghost-%COMP%]{display:block;height:100%}.card-container[_ngcontent-%COMP%]     p{margin:0}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-content{margin-top:-16px;margin-bottom:16px}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-content>.ant-tabs-tabpane{background:#ffffffb6;padding:16px}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card>.ant-tabs-nav:before{display:none}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-tab{border-color:transparent;background:transparent}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-tab-active{background:#ffffffb6}.num_details[_ngcontent-%COMP%]    >.ant-card-body{padding:4px}"]});let t=e;return t})();var zt=[{path:"",component:rt,data:{name:"Purchase Requests",permission:W.MainDashboardView},canActivate:[R]}],st=(()=>{let e=class e{};e.\u0275fac=function(l){return new(l||e)},e.\u0275mod=x({type:e}),e.\u0275inj=v({imports:[M.forChild(zt),M]});let t=e;return t})();var lt=V,yt=Object.keys(lt).map(t=>lt[t]),Bt=(()=>{let e=class e{};e.\u0275fac=function(l){return new(l||e)},e.\u0275mod=x({type:e}),e.\u0275inj=v({providers:[{provide:q,useValue:L},{provide:B,useValue:yt}],imports:[F,st,et,K,it,Z]});let t=e;return t})();export{Bt as DashboardModule};
