import{f as Ye,g as xe,j as et,k as tt}from"./chunk-VP57HQK5.js";import{a as ht,b as ie,c as F}from"./chunk-74YWM6Q3.js";import{$ as ne,$a as G,$b as $e,Aa as R,Ab as vt,Ba as Xe,Bb as xt,Cb as me,Da as zt,Db as pe,Ea as _t,Eb as je,Fb as de,Gb as ue,Ha as ft,Hb as bt,Ib as wt,J as i,Jb as Be,K as y,Mb as ze,N as h,Nb as _e,O as r,Ob as fe,Pa as Re,Pb as he,Q as rt,Qb as ge,Ra as Le,Rb as Ce,Sa as Ae,Ua as st,Wa as gt,X as o,Xa as Ct,Xb as We,Y as s,Ya as L,Yb as Ue,Z as z,Za as U,Zb as Ge,_ as te,a as Me,aa as v,ab as ae,ac as Qe,ba as C,bb as oe,bc as He,ca as u,cb as m,cc as Je,da as Fe,db as qe,dc as Dt,ea as Ve,eb as re,ec as Et,fa as ke,fb as se,fc as Ke,ga as D,gc as Ze,ha as d,ia as O,ib as le,ja as w,jb as ce,jc as Q,ka as W,kc as Nt,la as E,lb as yt,lc as ye,ma as N,mb as St,mc as Se,na as T,nb as $,nc as Tt,oa as Y,oc as H,pa as Pe,pc as J,qa as ut,qc as K,ra as De,rc as ve,s as M,sc as Mt,t as Oe,ta as Ee,ua as I,ub as A,v as _,vb as q,w as f,wb as j,yc as Ot,z as Ie,za as X,zc as It}from"./chunk-FKVIMGRR.js";import{a as Ft}from"./chunk-X5O7WZVH.js";import"./chunk-NFQMHT45.js";import{a as x,b as P,f as dt,g as S}from"./chunk-MON7YFGF.js";var en=(l,c)=>[l,"contract",c];function tn(l,c){if(l&1&&(o(0,"tr")(1,"td",7)(2,"nz-list",8)(3,"nz-list-item")(4,"nz-list-item-meta")(5,"nz-list-item-meta-title")(6,"span",9)(7,"span"),d(8),s()()(),o(9,"nz-list-item-meta-description")(10,"span",9)(11,"span")(12,"a",10),d(13),s(),z(14,"nz-divider",11),o(15,"span",12),d(16),De(17,"date"),s()()()()()()()(),o(18,"td",13)(19,"span",14),d(20),s()()()),l&2){let a=c.$implicit,e=u();i(),r("width","80%"),i(7),W("",a.contractor," - ",a.subject,""),i(4),r("routerLink",ut(11,en,e.site_id,a.id)),i(),w("CR-",a.id,""),i(3),w(" ",Ee(17,8,a.date_created,"dd MMM yyyy"),""),i(3),r("className",a.state===e.states.Completed?"status-chip green-button":"status-chip"),i(),w(" ",e.stateNames[a.state]," ")}}var nn=l=>[l,"contract","new"],an=()=>({tracingId:2}),Vt=(()=>{let c=class c{constructor(e){this.appService=e,this.site_id=0,this.loading=!0,this.apiUrl=ht.apiUrl,this.filterStates=Object.keys(xe).map(t=>({text:xe[t],value:t})),this.contracts=[],this.states=Ye,this.stateNames=xe}ngOnInit(){this.subOrgSubscription=this.appService.currentSubOrganization.subscribe(e=>{this.loadContractsDataFromServer()})}onContractsQueryParamsChange(e){console.log(e);let{pageSize:t,pageIndex:n,sort:p,filter:g}=e,b=p.find(k=>k.value!==null),V=b&&b.key||null,Z=b&&b.value||null;this.loadContractsDataFromServer(n,t,V,Z,g)}loadContractsDataFromServer(e=1,t=1e3,n="id",p="asc",g=[]){this.loading=!0;let b=new ft().append("page",`${e}`).append("results",`${t}`).append("sortField",`${n}`).append("sortOrder",`${p}`);g.forEach(V=>{V.value.forEach(Z=>{b=b.append(V.key,Z)})}),this.getAndSetContracts(this.site_id,b)}getAndSetContracts(e,t){return S(this,null,function*(){this.contracts=yield this.appService.retireveContracts(e,t),this.loading=!1})}ngOnDestroy(){this.subOrgSubscription&&this.subOrgSubscription.unsubscribe()}};c.\u0275fac=function(t){return new(t||c)(y(F))},c.\u0275cmp=M({type:c,selectors:[["app-site-contractors"]],inputs:{site_id:"site_id"},decls:10,vars:11,consts:[[1,"contract-container"],[1,"flex","space-between",2,"margin-bottom","5px"],[3,"routerLink","state"],["nz-button","","nzType","primary",3,"nzSize"],["nz-icon","","nzType","plus"],[3,"nzShowPagination","nzData","nzFrontPagination","nzLoading","nzQueryParams"],[4,"ngFor","ngForOf"],[3,"width"],["nzItemLayout","horizontal"],[1,"flex","space-between"],["href","",3,"routerLink"],["nzType","vertical"],[1,"dateDisplay"],[2,"text-align","end"],["nz-button","",3,"className"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),d(3,"Contracts"),s(),o(4,"a",2)(5,"button",3),z(6,"span",4),s()()(),o(7,"nz-table",5),C("nzQueryParams",function(g){return n.onContractsQueryParamsChange(g)}),o(8,"tbody"),h(9,tn,21,14,"tr",6),s()()()),t&2&&(i(4),r("routerLink",Pe(8,nn,n.site_id))("state",Y(10,an)),i(),r("nzSize","small"),i(2),r("nzShowPagination",!1)("nzData",n.contracts)("nzFrontPagination",!1)("nzLoading",n.loading),i(2),r("ngForOf",n.contracts))},dependencies:[X,Ae,j,A,q,L,Be,$e,Qe,Ge,We,Ue,J,Q,H,K,Xe],styles:[".ant-table-wrapper[_ngcontent-%COMP%]{margin:0!important}.contract-container[_ngcontent-%COMP%]{padding:12px;border-radius:12px;background:#0000001a}"]});let l=c;return l})();function rn(l,c){if(l&1&&z(0,"app-site-contractors",19),l&2){let a=u().$implicit;r("site_id",a.id)}}function sn(l,c){if(l&1){let a=v();o(0,"span",22),C("click",function(){_(a);let t=u(2).$implicit,n=u();return f(n.onExpandChange(t.id,!0))}),s()}}function ln(l,c){if(l&1){let a=v();o(0,"span",23),C("click",function(){_(a);let t=u(2).$implicit,n=u();return f(n.onExpandChange(t.id,!1))}),s()}l&2&&r("nzRotate",90)}function cn(l,c){if(l&1&&h(0,sn,1,0,"span",20)(1,ln,1,1,"span",21),l&2){let a=u().$implicit,e=u();r("ngIf",!e.expandSet.has(a.id)),i(),r("ngIf",e.expandSet.has(a.id))}}var mn=l=>[l];function pn(l,c){if(l&1){let a=v();te(0),o(1,"tr")(2,"td",8),C("nzExpandChange",function(t){let p=_(a).$implicit,g=u();return f(g.onExpandChange(p.id,t))}),s(),o(3,"td")(4,"nz-list",9)(5,"nz-list-item")(6,"nz-list-item-meta")(7,"nz-list-item-meta-title")(8,"span",10)(9,"span"),d(10),s(),o(11,"span"),d(12),De(13,"currency"),s()()(),o(14,"nz-list-item-meta-description")(15,"span",10)(16,"span")(17,"a",11),d(18),s(),z(19,"nz-divider",12),o(20,"span",13),d(21),De(22,"date"),s()()()()()()()(),o(23,"td",14)(24,"button",15),d(25),s()()(),o(26,"tr",16),h(27,rn,1,1,"app-site-contractors",17),s(),h(28,cn,2,2,"ng-template",null,18,I),ne()}if(l&2){let a=c.$implicit,e=D(29),t=u();i(),rt("expanded",t.expandSet.has(a.id)),i(),r("nzExpandIcon",e)("nzExpand",t.expandSet.has(a.id)),i(8),W("",a.name," - ",a.subject,""),i(2),O(Ee(13,18,a.amount,"PKR")),i(5),r("routerLink",Pe(24,mn,a.id)),i(),w("Site-",a.id,""),i(3),w(" ",Ee(22,21,a.date_created,"dd MMM yyyy"),""),i(3),r("className",a.state===t.siteStates.Completed?"green-button":"default")("nzDanger",a.state===t.siteStates.Cancelled)("nzSize","small"),i(),w(" ",t.siteStateNames[a.state]," "),i(),rt("expanded",t.expandSet.has(a.id)),r("nzExpand",t.expandSet.has(a.id)),i(),r("ngIf",t.expandSet.has(a.id))}}var dn=()=>["./","new"],un=()=>({tracingId:2}),kt=(()=>{let c=class c{onExpandChange(e,t){t?this.expandSet.add(e):this.expandSet.delete(e)}constructor(e){this.appService=e,this.siteStates=et,this.siteStateNames=tt,this.expandSet=new Set,this.listOfColumn=[{title:"id"},{title:"Name"}],this.visible=!1}ngOnInit(){this.subOrgSubscription=this.appService.currentSubOrganization.subscribe(e=>{this.populateSiteData()})}ngOnDestroy(){this.subOrgSubscription&&this.subOrgSubscription.unsubscribe()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateSiteData()}populateSiteData(){return S(this,null,function*(){this.sites=yield this.appService.getSites()})}};c.\u0275fac=function(t){return new(t||c)(y(F))},c.\u0275cmp=M({type:c,selectors:[["app-sites"]],decls:14,vars:10,consts:[[3,"routerLink","state"],["nz-button","","nzType","primary",3,"nzSize"],["nz-icon","","nzType","plus"],[3,"nzShowPagination","nzData","nzFrontPagination"],["nzWidth","60px"],["nzColumnKey","name","nzWidth","80%",3,"nzSortFn"],["nzColumnKey","gender"],[4,"ngFor","ngForOf"],[3,"nzExpandIcon","nzExpand","nzExpandChange"],["nzItemLayout","horizontal"],[1,"flex","space-between"],["href","",3,"routerLink"],["nzType","vertical"],[1,"dateDisplay"],[2,"text-align","end"],["nz-button","","nzType","primary","nzShape","round",3,"className","nzDanger","nzSize"],[1,"expanded-table",3,"nzExpand"],[3,"site_id",4,"ngIf"],["expandIcon",""],[3,"site_id"],["nz-icon","","nzType","double-right","nzTheme","outline",3,"click",4,"ngIf"],["nz-icon","","nzType","double-right","nzTheme","outline",3,"nzRotate","click",4,"ngIf"],["nz-icon","","nzType","double-right","nzTheme","outline",3,"click"],["nz-icon","","nzType","double-right","nzTheme","outline",3,"nzRotate","click"]],template:function(t,n){t&1&&(o(0,"a",0)(1,"button",1),z(2,"span",2),d(3," New Site "),s()(),o(4,"nz-table",3)(5,"thead")(6,"tr"),z(7,"th",4),o(8,"th",5),d(9,"Site"),s(),o(10,"th",6),d(11,"Status"),s()()(),o(12,"tbody"),h(13,pn,30,26,"ng-container",7),s()()),t&2&&(r("routerLink",Y(8,dn))("state",Y(9,un)),i(),r("nzSize","small"),i(3),r("nzShowPagination",!1)("nzData",n.sites)("nzFrontPagination",!1),i(4),r("nzSortFn",!0),i(5),r("ngForOf",n.sites))},dependencies:[X,R,Ae,j,A,q,L,Be,$e,Qe,Ge,We,Ue,J,ye,Q,Se,Nt,ve,H,K,Mt,Tt,Vt,zt,Xe],styles:[".expanded-table[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{background:transparent!important}  .expanded{background:#ffffffb8}"]});let l=c;return l})();var Bt=dt(Ft());var hn=["content"];function gn(l,c){if(l&1&&z(0,"nz-option",39),l&2){let a=c.$implicit;r("nzValue",a==null?null:a.id)("nzLabel",a==null?null:a.name)}}var Cn=()=>({authorization:"authorization-text"});function yn(l,c){if(l&1){let a=v();o(0,"nz-card",40)(1,"nz-form-item")(2,"nz-form-label",41),d(3,"Terms & Conditions"),s(),o(4,"nz-form-control",42),z(5,"textarea",43),s()(),o(6,"nz-form-item")(7,"nz-form-label",44),d(8,"Attachments"),s(),o(9,"nz-form-control",45)(10,"nz-upload",46),C("nzChange",function(t){_(a);let n=u();return f(n.handleChange(t))}),o(11,"button",47),z(12,"span",48),d(13," Click to Upload "),s()()()()()}l&2&&(i(4),r("nzMd",8)("nzSm",24)("nzXs",12)("nzMd",24)("nzXl",24)("nzXXl",24),i(5),r("nzMd",8)("nzSm",24)("nzXs",12)("nzMd",24)("nzXl",24)("nzXXl",24),i(),r("nzHeaders",Y(13,Cn)))}function Sn(l,c){if(l&1){let a=v();o(0,"button",49),C("click",function(){_(a);let t=u();return f(t.cancelPaymentDetails())}),d(1,"Cancel"),s()}}function vn(l,c){if(l&1){let a=v();o(0,"button",50),C("click",function(){_(a);let t=u();return f(t.submitRequest())}),d(1,"Submit"),s()}}function xn(l,c){if(l&1){let a=v();o(0,"button",50),C("click",function(){_(a);let t=u();return f(t.confirmInvoiceDetails())}),d(1,"Confirm Contract"),s()}}function bn(l,c){}var Wt=(()=>{let c=class c{constructor(e,t,n,p,g,b,V,Z){this.appService=e,this.route=t,this.userService=n,this.fb=p,this.notification=g,this.router=b,this.msg=V,this.modal=Z,this.vendors=[],this.vendorItems=[],this.discountTotal=0,this.contractTotal=0,this.loading=!1,this.contractStates=Ye,this.stateNames=xe,this.listOfData=[],this.defaultItemValues={id:0,name:"",qty:0,contract_id:0,discount:0,total:0,date_created:new Date,isCustom:!1,unit_price:0},this.contractDetails=new oe({id:new m,contractor:new m,subject:new m,contract_type:new m,state:new m(this.contractStates.Draft),with_material:new m(0),payment_schedule:new m(0),amount_per_schedule:new m(0),amount_per_day:new m(0),created_by:new m(0),site:new m(0),total:new m(0),organization:new m(0),subOrganization:new m(0),contract_start_date:new m(new Date),contract_end_date:new m(new Date),attachment:new m,terms:new m("")}),this.beforeUpload=(k,Kt)=>new Me(B=>{let be=k.type==="image/jpeg"||k.type==="image/png";if(!be){this.msg.error("You can only upload JPG file!"),B.complete();return}let we=k.size/1024/1024<2;if(!we){this.msg.error("Image must smaller than 2MB!"),B.complete();return}this.contractDetails.patchValue({attachment:k}),B.next(be&&we),B.complete()}),this.contractDetails=this.fb.group({id:new m,contractor:new m,subject:new m,contract_type:new m,state:new m(this.contractStates.Draft),with_material:new m(0),payment_schedule:new m(0),amount_per_schedule:new m(0),amount_per_day:new m(0),created_by:new m(0),site:new m(0),total:new m(0),organization:new m(0),subOrganization:new m(0),contract_start_date:new m(new Date),contract_end_date:new m(new Date),attachment:new m,terms:new m("")})}submitForm(){}ngOnInit(){this.loadAndUsers(),this.setSitesData(),this.route.paramMap.subscribe(e=>{e.get("contractId")||(this.contractDetails.reset({state:this.contractStates.Draft,id:0}),this.contractDetails.enable(),this.contractDetails.updateValueAndValidity()),this.contractDetails.controls.id.setValue(e.get("contractId")!=="new"?e.get("contractId"):0),this.contractDetails.controls.site.setValue(e.get("siteId")||0),this.setContractRequestDetails()})}setSitesData(){return S(this,null,function*(){let e=yield this.appService.getAndSetSites(),t=e&&e.length?e.map(n=>x({label:n.name},n)):[];this.sites=[...t]})}setContractRequestDetails(){return S(this,null,function*(){this.loading=!0,this.contractDetails.controls.id.value?yield this.getExistingContract():(this.contractDetails.controls.organization.setValue(parseInt(localStorage.getItem("organization_id")||"")),this.currentSubOrganizationSubscription=this.appService.currentSubOrganization.subscribe(e=>{this.contractDetails.controls.subOrganization.setValue(e.id)}),this.contractDetails.controls.created_by.setValue(this.userService.loggedInUser.id)),this.disableAndEnableSpecificControls(),this.loading=!1})}getExistingContract(){return S(this,null,function*(){let e=yield this.appService.retireveContractById(this.contractDetails.controls.site.value,this.contractDetails.controls.id.value);e&&this.contractDetails.patchValue({id:e.id,subject:e.subject,state:e.state,created_by:e.created_by,total:e.total,organization:e.organization_id,subOrganization:e.sub_organization_id,contractor:e.contractor,contract_type:e.contract_type,with_material:e.with_material,payment_schedule:e.payment_schedule,amount_per_schedule:e.amount_per_schedule,amount_per_day:e.amount_per_day,site:e.site_id,contract_start_date:e.contract_start_date,contract_end_date:e.contract_end_date,attachment:e.attachment,terms:e.terms}),this.previousContractDetails=this.contractDetails.getRawValue()})}loadAndUsers(){return S(this,null,function*(){this.listOfData=yield this.userService.getOrganizationUsers()})}submitRequest(){return S(this,null,function*(){let e=yield this.appService.createContract(P(x({},this.contractDetails.value),{state:this.contractStates.PendingApproval}));e&&this.notification.create("success","Contract Order - "+e.id,"Contract order submitted successfly. Please check for invoice and update later").onClose.subscribe(t=>{this.router.navigate(["/"])})})}cancelPaymentDetails(){return S(this,null,function*(){})}confirmInvoiceDetails(){return S(this,null,function*(){let e=this.appService.findObjectDifferences(this.previousContractDetails,this.contractDetails.getRawValue());console.log(e);let t=x({id:this.previousContractDetails.id},e);(yield this.appService.updateContractRequest(P(x({},t),{state:this.contractStates.Completed})))&&this.notification.create("success","Contract Order - "+this.previousContractDetails.id,"Contract order invoice submitted successfly. Please proceed next for payment details").onClose.subscribe(p=>{this.router.navigate(["/"])})})}printCard(){let e=this.content.nativeElement.innerHTML,t=window.open("","_blank","top=0,left=0,height=100%,width=auto");t&&(t.document.open(),t.document.write(`
      <html>
        <head>
          <title>Print</title>
          <style>
            /* Define print styles here */
          </style>
        </head>
        <body onload="window.print();window.close()">
          ${e}
        </body>
      </html>
    `),t.print())}generatePDF(){let e=this.content.nativeElement;(0,Bt.default)(e).then(t=>{let n=t.toDataURL("image/png")})}disableAndEnableSpecificControls(){let e=this.contractDetails.get("state");e&&e.value!==this.contractStates.Draft&&(console.log(this.contractDetails),Object.keys(this.contractDetails.controls).forEach(t=>{let n=this.contractDetails.get(t);n&&(t!=="attachment"&&t!=="terms"&&e.value===this.contractStates.PendingApproval||e.value===this.contractStates.Completed)&&n.disable()}),console.log(this.contractDetails),this.contractDetails.updateValueAndValidity())}getBase64(e,t){let n=new FileReader;n.addEventListener("load",()=>t(n.result.toString())),n.readAsDataURL(e)}handleChange(e){this.getBase64(e.file.originFileObj,t=>{this.loading=!1})}};c.\u0275fac=function(t){return new(t||c)(y(F),y(Re),y(ie),y(ce),y(Ke),y(Le),y(He),y(Je))},c.\u0275cmp=M({type:c,selectors:[["app-create-contract"]],viewQuery:function(t,n){if(t&1&&Fe(hn,5),t&2){let p;Ve(p=ke())&&(n.content=p.first)}},decls:83,vars:72,consts:[[1,"detailBar"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","download"],["nz-button","","nzType","primary","printSectionId","print-section","ngxPrint","","printTitle","MyTitle",2,"margin-left","12px"],["nz-icon","","nzType","printer","nzTheme","outline"],["id","print-section",1,"purchase-request"],[2,"width","100%"],["nz-form","",3,"formGroup","ngSubmit"],["content",""],["nzGutter","2",2,"margin-bottom","12px"],[3,"nzMd","nzSm","nzXs"],["nzRequired","","nzFor","contract_type",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",3,"nzSm","nzXs"],["zShowSearch","","nzAllowClear","","nzPlaceHolder","Select a person","formControlName","contract_type",1,"control","inputField"],["nzLabel","Duration Based","nzValue","1"],["nzLabel","Measurement Based","nzValue","2"],["nzRequired","","nzFor","with_material"],["nzErrorTip","The input is not valid date!"],["nz-checkbox","","formControlName","with_material"],["nzRequired","","nzFor","contractor",3,"nzMd","nzSm","nzXs"],["d","contractor","formControlName","contractor","placeholder","Select user",1,"control","inputField"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzRequired","","nzFor","contract_start_date",3,"nzMd","nzSm","nzXs"],["formControlName","contract_start_date",1,"control","inputField"],["nzRequired","","nzFor","contract_end_date",3,"nzMd","nzSm","nzXs"],["formControlName","contract_end_date",1,"control","inputField"],["nzRequired","","nzFor","payment_schedule",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","payment_schedule",1,"control","inputField"],["nzRequired","","nzFor","subject",3,"nzMd","nzSm","nzXs"],["z-input","","formControlName","subject",1,"control","inputField"],["nzRequired","","nzFor","amount_per_schedule",3,"nzMd","nzSm","nzXs"],["z-input","","formControlName","amount_per_schedule",1,"control","inputField"],["nzRequired","","nzFor","amount_per_day",3,"nzMd","nzSm","nzXs"],["z-input","","formControlName","amount_per_day",1,"control","inputField"],["style","width:100%;margin-bottom: 12px;",4,"ngIf"],[1,"flex","space-between"],["nz-button","","nzType","primary","nzDanger","","style","margin-bottom: 12px;float: right;",3,"click",4,"ngIf"],["nz-button","","nzType","primary","style","margin-bottom: 12px;float: right;",3,"click",4,"ngIf"],["customNoDataTemplate",""],[3,"nzValue","nzLabel"],[2,"width","100%","margin-bottom","12px"],["nzFor","terms"],["nzErrorTip","",3,"nzMd","nzSm","nzXs","nzXl","nzXXl"],["nz-input","","formControlName","terms","placeholder","textarea with clear icon"],["nzRequired","","nzFor","contract_start_date"],["nzErrorTip","The input is not valid date!",3,"nzMd","nzSm","nzXs","nzXl","nzXXl"],["nzAction","https://www.mocky.io/v2/5cc8019d300000980a055e76",3,"nzHeaders","nzChange"],["nz-button",""],["nz-icon","","nzType","upload"],["nz-button","","nzType","primary","nzDanger","",2,"margin-bottom","12px","float","right",3,"click"],["nz-button","","nzType","primary",2,"margin-bottom","12px","float","right",3,"click"]],template:function(t,n){if(t&1&&(o(0,"div",0)(1,"span")(2,"h4"),d(3),s()(),o(4,"span")(5,"button",1),C("click",function(){return n.generatePDF()}),z(6,"span",2),s(),o(7,"button",3),z(8,"span",4),s()()(),o(9,"div",5)(10,"nz-card",6)(11,"form",7),C("ngSubmit",function(){return n.submitForm()}),o(12,"div",null,8)(14,"nz-row",9)(15,"nz-col",10)(16,"nz-form-item")(17,"nz-form-label",11),d(18,"Contract Type"),s(),o(19,"nz-form-control",12)(20,"nz-select",13),z(21,"nz-option",14)(22,"nz-option",15),s()()()(),o(23,"nz-col",10)(24,"nz-form-item")(25,"nz-form-label",16),d(26,"with_material"),s(),o(27,"nz-form-control",17),z(28,"label",18),s()()()(),o(29,"nz-row",9)(30,"nz-col",10)(31,"nz-form-item")(32,"nz-form-label",19),d(33,"Contractor"),s(),o(34,"nz-form-control",12)(35,"nz-select",20),h(36,gn,1,2,"nz-option",21),s()()()(),o(37,"nz-col",10)(38,"nz-form-item")(39,"nz-form-label",22),d(40,"contract_start_date"),s(),o(41,"nz-form-control",12),z(42,"nz-date-picker",23),s()()()(),o(43,"nz-row",9)(44,"nz-col",10)(45,"nz-form-item")(46,"nz-form-label",24),d(47,"contract_end_date"),s(),o(48,"nz-form-control",12),z(49,"nz-date-picker",25),s()()(),o(50,"nz-col",10)(51,"nz-form-item")(52,"nz-form-label",26),d(53,"payment_schedule"),s(),o(54,"nz-form-control",12),z(55,"input",27),s()()()(),o(56,"nz-row",9)(57,"nz-col",10)(58,"nz-form-item")(59,"nz-form-label",28),d(60,"Subject"),s(),o(61,"nz-form-control",12),z(62,"input",29),s()()(),o(63,"nz-col",10)(64,"nz-form-item")(65,"nz-form-label",30),d(66,"amount_per_schedule"),s(),o(67,"nz-form-control",12),z(68,"input",31),s()()()(),o(69,"nz-form-item")(70,"nz-form-label",32),d(71,"amount_per_day"),s(),o(72,"nz-form-control",12),z(73,"input",33),s()(),h(74,yn,14,14,"nz-card",34),s(),o(75,"span",35)(76,"span"),h(77,Sn,2,0,"button",36),s(),o(78,"span"),h(79,vn,2,0,"button",37)(80,xn,2,0,"button",37),s()()()()(),h(81,bn,0,0,"ng-template",null,38,I)),t&2){let p;i(3),W(" Site - ",((p=n.contractDetails.get("id"))==null?null:p.value)||"New"," / ",n.stateNames[(p=n.contractDetails.get("state"))==null?null:p.value]," "),i(8),r("formGroup",n.contractDetails),i(4),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(4),r("nzMd",4)("nzSm",24)("nzXs",12),i(7),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("ngForOf",n.listOfData),i(),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("ngIf",n.contractDetails.controls.state.value!==n.contractStates.Draft),i(3),r("ngIf",n.contractDetails.controls.state.value==n.contractStates.PendingApproval),i(2),r("ngIf",n.contractDetails.controls.state.value==n.contractStates.Draft),i(),r("ngIf",n.contractDetails.controls.state.value==n.contractStates.PendingApproval)}},dependencies:[X,R,j,A,q,de,ue,L,je,_e,ze,he,fe,Ce,ge,$,me,pe,Ot,re,U,G,ae,se,le]});let l=c;return l})();var $t=dt(Ft());function Dn(l,c){if(l&1&&z(0,"nz-option",24),l&2){let a=c.$implicit;r("nzLabel",a.name)("nzValue",a.name)}}function En(l,c){if(l&1&&z(0,"nz-option",25),l&2){let a=c.$implicit;r("nzValue",a==null?null:a.id)("nzLabel",a==null?null:a.name)}}function Nn(l,c){if(l&1){let a=v();o(0,"nz-card",8)(1,"form",9),C("ngSubmit",function(){_(a);let t=u();return f(t.handleOk())}),o(2,"nz-row",10)(3,"nz-col",11)(4,"nz-form-item")(5,"nz-form-label",12),d(6,"Name"),s(),o(7,"nz-form-control",13)(8,"nz-select",14),h(9,Dn,1,2,"nz-option",15),s()()()(),o(10,"nz-col",11)(11,"nz-form-item")(12,"nz-form-label",16),d(13,"Quantity"),s(),o(14,"nz-form-control",13),z(15,"input",17),s()()()(),o(16,"nz-row",10)(17,"nz-col",11)(18,"nz-form-item")(19,"nz-form-label",12),d(20,"amount"),s(),o(21,"nz-form-control",18),z(22,"input",19),d(23," \xA0 "),o(24,"label",20),d(25,"Paid"),s()()()(),o(26,"nz-col",11)(27,"nz-form-item")(28,"nz-form-label",21),d(29,"refered_by"),s(),o(30,"nz-form-control",13)(31,"nz-select",22),h(32,En,1,2,"nz-option",23),s()()()()()()()}if(l&2){let a=u(),e=D(8),t;i(),r("formGroup",a.addExpenseForm),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(),r("nzDropdownRender",e),i(),r("ngForOf",a.vendorItems),i(),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzChecked",(t=a.addExpenseForm.get("isPaid"))==null?null:t.value),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("ngForOf",a.users)}}function Tn(l,c){if(l&1){let a=v();o(0,"div",26),z(1,"input",27,28),o(3,"a",29),C("click",function(){_(a);let t=D(2),n=u();return f(n.addItem(t))}),z(4,"span",30),d(5," Add item "),s()()}}function Mn(l,c){if(l&1&&(o(0,"th",31),d(1),s()),l&2){let a=c.$implicit;r("nzSortFn",a.compare)("nzSortPriority",a.priority),i(),w(" ",a.title," ")}}function On(l,c){if(l&1){let a=v();te(0),o(1,"td"),d(2),s(),o(3,"td"),d(4),s(),o(5,"td"),d(6),s(),o(7,"td"),d(8),s(),o(9,"td")(10,"label",34),T("ngModelChange",function(t){_(a);let n=u().$implicit,p=u();return N(p.editCache[n.id].data.is_paid,t)||(p.editCache[n.id].data.is_paid=t),f(t)}),s()(),o(11,"td")(12,"a",35),C("click",function(){_(a);let t=u().$implicit,n=u();return f(n.startEdit(t.id))}),d(13,"Edit"),s()(),ne()}if(l&2){let a=u().$implicit,e=u();i(2),O(a.refered_by),i(2),O(a.name),i(2),O(a.quantity),i(2),O(a.amount),i(2),r("nzChecked",e.editCache[a.id].data.is_paid),E("ngModel",e.editCache[a.id].data.is_paid)}}function In(l,c){if(l&1&&z(0,"nz-option",25),l&2){let a=c.$implicit;r("nzValue",(a==null?null:a.value)||0)("nzLabel",(a==null?null:a.key)||"")}}function Fn(l,c){if(l&1){let a=v();z(0,"td"),o(1,"td")(2,"nz-select",36),T("ngModelChange",function(t){_(a);let n=u().$implicit,p=u();return N(p.editCache[n.id].data.name,t)||(p.editCache[n.id].data.name=t),f(t)}),h(3,In,1,2,"nz-option",23),s()(),o(4,"td")(5,"input",37),T("ngModelChange",function(t){_(a);let n=u().$implicit,p=u();return N(p.editCache[n.id].data.amount,t)||(p.editCache[n.id].data.amount=t),f(t)}),s()(),o(6,"td")(7,"input",38),T("ngModelChange",function(t){_(a);let n=u().$implicit,p=u();return N(p.editCache[n.id].data.quantity,t)||(p.editCache[n.id].data.quantity=t),f(t)}),s()(),o(8,"td")(9,"label",39),T("ngModelChange",function(t){_(a);let n=u().$implicit,p=u();return N(p.editCache[n.id].data.is_paid,t)||(p.editCache[n.id].data.is_paid=t),f(t)}),s()(),o(10,"td")(11,"a",40),C("click",function(){_(a);let t=u().$implicit,n=u();return f(n.saveEdit(t.id))}),d(12,"Save"),s(),d(13," \xA0 "),o(14,"a",41),C("nzOnConfirm",function(){_(a);let t=u().$implicit,n=u();return f(n.cancelEdit(t.id))}),d(15,"Cancel"),s()()}if(l&2){let a=u().$implicit,e=u();i(2),E("ngModel",e.editCache[a.id].data.name),i(),r("ngForOf",e.subOrganizations),i(2),E("ngModel",e.editCache[a.id].data.amount),i(2),E("ngModel",e.editCache[a.id].data.quantity),i(2),r("nzChecked",e.editCache[a.id].data.is_paid),E("ngModel",e.editCache[a.id].data.is_paid)}}function Vn(l,c){if(l&1&&(o(0,"tr"),h(1,On,14,6,"ng-container",32)(2,Fn,16,6,"ng-template",null,33,I),s()),l&2){let a=c.$implicit,e=D(3),t=u();i(),r("ngIf",!(t.editCache[a.id]!=null&&t.editCache[a.id].edit))("ngIfElse",e)}}var Ut=(()=>{let c=class c{constructor(e,t,n){this.appService=e,this.userService=t,this.fb=n,this.vendorItems=[],this.listOfColumn=[{title:"Reference By",compare:(p,g)=>p.refered_by-g.refered_by,priority:3},{title:"Name",compare:(p,g)=>p.name.localeCompare(g.name),priority:!1},{title:"Quanitity",compare:(p,g)=>p.quantity-g.quantity,priority:2},{title:"Amount",compare:(p,g)=>p.amount-g.amount,priority:2},{title:"Paid",compare:(p,g)=>(p.is_paid?1:0)-(g.is_paid?1:0),priority:2},{title:"Action",compare:(p,g)=>p.refered_by-g.refered_by,priority:3}],this.listOfData=[],this.visible=!1,this.isVisible=!1,this.isOkLoading=!1,this.index=0,this.editCache={},this.addExpenseForm=new oe({id:new m,name:new m,is_general:new m,quantity:new m,amount:new m,refered_by:new m,purchase_id:new m,is_paid:new m,site:new m,organization:new m,subOrganization:new m,createdBy:new m})}showModal(){this.isVisible=!0}handleOk(){this.isOkLoading=!0,setTimeout(()=>{this.isVisible=!1,this.isOkLoading=!1},3e3)}handleCancel(){this.isVisible=!1}ngOnInit(){this.populateExpenseData()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateExpenseData()}populateExpenseData(){return S(this,null,function*(){this.listOfData=[{id:1,name:"Item",is_general:!1,quantity:10,amount:1e3,refered_by:1,purchase_id:36,is_paid:!0,site:11,organization:1,subOrganization:1,createdBy:1},{id:1,name:"Item",is_general:!1,quantity:10,amount:1e3,refered_by:1,purchase_id:36,is_paid:!0,site:11,organization:1,subOrganization:1,createdBy:1},{id:1,name:"Item",is_general:!1,quantity:10,amount:1e3,refered_by:1,purchase_id:36,is_paid:!0,site:11,organization:1,subOrganization:1,createdBy:1}],this.users=yield this.userService.getOrganizationUsers(),this.ExpenseRoles=yield this.appService.getRoles(),this.subOrganizations=yield this.appService.getSubOrganizations(),this.vendorItems=yield this.appService.getInventoryBySiteId(this.site_id),this.ExpenseRoles=this.ExpenseRoles.map(e=>({key:e.role_name,value:e.id})),this.subOrganizations=this.subOrganizations.map(e=>P(x({},e),{key:e.name,value:e.id})),this.updateEditCache()})}addItem(e){let t=e.value;this.vendorItems.some(n=>!t||n.name===t.trim())||(this.vendorItems=[...this.vendorItems,{name:e.value}])}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e]={data:x({},this.listOfData[t]),edit:!1}}saveEdit(e){return S(this,null,function*(){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e].edit=!1,Object.assign(this.listOfData[t],this.editCache[e].data),this.populateExpenseData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:x({},e)}})}};c.\u0275fac=function(t){return new(t||c)(y(F),y(ie),y(ce))},c.\u0275cmp=M({type:c,selectors:[["app-expenses"]],inputs:{site_id:"site_id"},decls:17,vars:6,consts:[["nz-button","","nzType","primary",3,"click"],["nzTitle","Add Expense",3,"nzVisible","nzOkDisabled","nzOkLoading","nzVisibleChange","nzOnCancel","nzOnOk"],["style","width:100%",4,"nzModalContent"],["renderTemplate",""],["nzShowPagination","false","nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[2,"width","100%"],["nz-form","",3,"formGroup","ngSubmit"],["nzGutter","2",2,"margin-bottom","12px"],[3,"nzMd","nzSm","nzXs"],["nzRequired","","nzFor","name",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",3,"nzSm","nzXs"],["formControlName","name","nzAllowClear","","nzPlaceHolder","Select item",1,"control","inputField",3,"nzDropdownRender"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzRequired","","nzFor","quantity",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","quantity",1,"control","inputField"],["nzErrorTip","The input is not valid date!",1,"flex","space-between","center",3,"nzSm","nzXs"],["nz-input","","formControlName","amount",1,"control","inputField"],["nz-checkbox","","formControlName","is_paid",3,"nzChecked"],["nzRequired","","nzFor","refered_by",3,"nzMd","nzSm","nzXs"],["id","reports_to","formControlName","refered_by","placeholder","Select user"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzLabel","nzValue"],[3,"nzValue","nzLabel"],[1,"container"],["type","text","nz-input",""],["inputElement",""],[1,"add-item",3,"click"],["nz-icon","","nzType","plus"],[3,"nzSortFn","nzSortPriority"],[4,"ngIf","ngIfElse"],["editTemplate",""],["nz-checkbox","","disabled","",3,"nzChecked","ngModel","ngModelChange"],[3,"click"],["id","role_id","placeholder","Select role",3,"ngModel","ngModelChange"],["nz-input","","id","amount",3,"ngModel","ngModelChange"],["nz-input","","id","quantity",3,"ngModel","ngModelChange"],["nz-checkbox","",3,"nzChecked","ngModel","ngModelChange"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"]],template:function(t,n){if(t&1&&(o(0,"h3"),d(1,"Expense"),s(),o(2,"button",0),C("click",function(){return n.showModal()}),o(3,"span"),d(4,"Show Modal"),s()(),o(5,"nz-modal",1),T("nzVisibleChange",function(g){return N(n.isVisible,g)||(n.isVisible=g),g}),C("nzOnCancel",function(){return n.handleCancel()})("nzOnOk",function(){return n.handleOk()}),h(6,Nn,33,37,"nz-card",2),s(),h(7,Tn,6,0,"ng-template",null,3,I),o(9,"nz-table",4,5)(12,"thead")(13,"tr"),h(14,Mn,2,3,"th",6),s()(),o(15,"tbody"),h(16,Vn,4,2,"tr",7),s()()),t&2){let p=D(11);i(5),E("nzVisible",n.isVisible),r("nzOkDisabled",n.addExpenseForm.invalid)("nzOkLoading",n.isOkLoading),i(4),r("nzData",n.listOfData),i(5),r("ngForOf",n.listOfColumn),i(2),r("ngForOf",p.data)}},dependencies:[X,R,j,A,q,de,ue,L,_e,ze,he,fe,Ce,ge,$,Et,Dt,Ze,me,pe,J,ye,Q,Se,ve,H,K,re,U,G,ae,se,le,qe]});let l=c;return l})();function Pn(l,c){if(l&1&&(o(0,"th",4),d(1),s()),l&2){let a=c.$implicit;r("nzSortFn",a.compare)("nzSortPriority",a.priority),i(),w(" ",a.title," ")}}function Xn(l,c){if(l&1){let a=v();te(0),o(1,"td"),d(2),s(),o(3,"td"),d(4),s(),o(5,"td"),d(6),s(),o(7,"td"),d(8),s(),o(9,"td")(10,"label",7),T("ngModelChange",function(t){_(a);let n=u().$implicit,p=u();return N(p.editCache[n.id].data.is_paid,t)||(p.editCache[n.id].data.is_paid=t),f(t)}),s()(),o(11,"td")(12,"a",8),C("click",function(){_(a);let t=u().$implicit,n=u();return f(n.startEdit(t.id))}),d(13,"Edit"),s()(),ne()}if(l&2){let a=u().$implicit,e=u();i(2),O(a.refered_by),i(2),O(a.name),i(2),O(a.quantity),i(2),O(a.amount),i(2),r("nzChecked",e.editCache[a.id].data.is_paid),E("ngModel",e.editCache[a.id].data.is_paid)}}function Rn(l,c){if(l&1&&z(0,"nz-option",16),l&2){let a=c.$implicit;r("nzValue",(a==null?null:a.value)||0)("nzLabel",(a==null?null:a.key)||"")}}function Ln(l,c){if(l&1){let a=v();z(0,"td"),o(1,"td")(2,"nz-select",9),T("ngModelChange",function(t){_(a);let n=u().$implicit,p=u();return N(p.editCache[n.id].data.name,t)||(p.editCache[n.id].data.name=t),f(t)}),h(3,Rn,1,2,"nz-option",10),s()(),o(4,"td")(5,"input",11),T("ngModelChange",function(t){_(a);let n=u().$implicit,p=u();return N(p.editCache[n.id].data.amount,t)||(p.editCache[n.id].data.amount=t),f(t)}),s()(),o(6,"td")(7,"input",12),T("ngModelChange",function(t){_(a);let n=u().$implicit,p=u();return N(p.editCache[n.id].data.quantity,t)||(p.editCache[n.id].data.quantity=t),f(t)}),s()(),o(8,"td")(9,"label",13),T("ngModelChange",function(t){_(a);let n=u().$implicit,p=u();return N(p.editCache[n.id].data.is_paid,t)||(p.editCache[n.id].data.is_paid=t),f(t)}),s()(),o(10,"td")(11,"a",14),C("click",function(){_(a);let t=u().$implicit,n=u();return f(n.saveEdit(t.id))}),d(12,"Save"),s(),d(13," \xA0 "),o(14,"a",15),C("nzOnConfirm",function(){_(a);let t=u().$implicit,n=u();return f(n.cancelEdit(t.id))}),d(15,"Cancel"),s()()}if(l&2){let a=u().$implicit,e=u();i(2),E("ngModel",e.editCache[a.id].data.name),i(),r("ngForOf",e.subOrganizations),i(2),E("ngModel",e.editCache[a.id].data.amount),i(2),E("ngModel",e.editCache[a.id].data.quantity),i(2),r("nzChecked",e.editCache[a.id].data.is_paid),E("ngModel",e.editCache[a.id].data.is_paid)}}function An(l,c){if(l&1&&(o(0,"tr"),h(1,Xn,14,6,"ng-container",5)(2,Ln,16,6,"ng-template",null,6,I),s()),l&2){let a=c.$implicit,e=D(3),t=u();i(),r("ngIf",!(t.editCache[a.id]!=null&&t.editCache[a.id].edit))("ngIfElse",e)}}var Gt=(()=>{let c=class c{constructor(e){this.appService=e,this.listOfColumn=[{title:"Reference By",compare:(t,n)=>t.refered_by-n.refered_by,priority:3},{title:"Name",compare:(t,n)=>t.name.localeCompare(n.name),priority:!1},{title:"Quanitity",compare:(t,n)=>t.quantity-n.quantity,priority:2},{title:"Amount",compare:(t,n)=>t.amount-n.amount,priority:2},{title:"Paid",compare:(t,n)=>(t.is_paid?1:0)-(n.is_paid?1:0),priority:2},{title:"Action",compare:(t,n)=>t.refered_by-n.refered_by,priority:3}],this.listOfData=[],this.visible=!1,this.editCache={}}ngOnInit(){this.populateExpenseData()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateExpenseData()}populateExpenseData(){return S(this,null,function*(){this.listOfData=[{id:1,name:"Item",is_general:!1,quantity:10,amount:1e3,refered_by:1,purchase_id:36,is_paid:!0,site:11,organization:1,subOrganization:1,createdBy:1},{id:1,name:"Item",is_general:!1,quantity:10,amount:1e3,refered_by:1,purchase_id:36,is_paid:!0,site:11,organization:1,subOrganization:1,createdBy:1},{id:1,name:"Item",is_general:!1,quantity:10,amount:1e3,refered_by:1,purchase_id:36,is_paid:!0,site:11,organization:1,subOrganization:1,createdBy:1}],this.ExpenseRoles=yield this.appService.getRoles(),this.subOrganizations=yield this.appService.getSubOrganizations(),this.ExpenseRoles=this.ExpenseRoles.map(e=>({key:e.role_name,value:e.id})),this.subOrganizations=this.subOrganizations.map(e=>P(x({},e),{key:e.name,value:e.id})),this.updateEditCache()})}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e]={data:x({},this.listOfData[t]),edit:!1}}saveEdit(e){return S(this,null,function*(){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e].edit=!1,Object.assign(this.listOfData[t],this.editCache[e].data),this.populateExpenseData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:x({},e)}})}};c.\u0275fac=function(t){return new(t||c)(y(F))},c.\u0275cmp=M({type:c,selectors:[["app-owner-payments"]],decls:10,vars:3,consts:[["nzShowPagination","false","nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"nzSortFn","nzSortPriority"],[4,"ngIf","ngIfElse"],["editTemplate",""],["nz-checkbox","","disabled","",3,"nzChecked","ngModel","ngModelChange"],[3,"click"],["id","role_id","placeholder","Select role",3,"ngModel","ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nz-input","","id","amount",3,"ngModel","ngModelChange"],["nz-input","","id","quantity",3,"ngModel","ngModelChange"],["nz-checkbox","",3,"nzChecked","ngModel","ngModelChange"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],[3,"nzValue","nzLabel"]],template:function(t,n){if(t&1&&(o(0,"h3"),d(1,"Owner Payments"),s(),o(2,"nz-table",0,1)(5,"thead")(6,"tr"),h(7,Pn,2,3,"th",2),s()(),o(8,"tbody"),h(9,An,4,2,"tr",3),s()()),t&2){let p=D(4);i(2),r("nzData",n.listOfData),i(5),r("ngForOf",n.listOfColumn),i(2),r("ngForOf",p.data)}},dependencies:[X,R,ue,$,Ze,me,pe,J,ye,Q,Se,ve,H,K,U,G,qe]});let l=c;return l})();var jn=["content"];function Bn(l,c){if(l&1){let a=v();o(0,"div",32)(1,"span")(2,"h4"),d(3),s()(),o(4,"span")(5,"button",33),C("click",function(){_(a);let t=u();return f(t.generatePDF())}),z(6,"span",34),s(),o(7,"button",35),z(8,"span",36),s()()()}if(l&2){let a=u(),e;i(3),W(" ",((e=a.siteDetails.get("id"))==null?null:e.value)||"New"," - / ",(e=a.siteDetails.get("name"))==null?null:e.value," ")}}function Wn(l,c){if(l&1){let a=v();o(0,"button",37),C("click",function(){_(a);let t=u();return f(t.cancelPaymentDetails())}),d(1,"Cancel"),s()}}function Un(l,c){if(l&1){let a=v();o(0,"button",38),C("click",function(){_(a);let t=u();return f(t.submitRequest())}),d(1,"Submit"),s()}}function Gn(l,c){if(l&1){let a=v();o(0,"button",38),C("click",function(){_(a);let t=u();return f(t.approveDetails())}),d(1,"Approve Site"),s()}}function $n(l,c){if(l&1&&(d(0),z(1,"span",39)),l&2){let a=c.$implicit;u();let e=D(4);w(" ",a," "),i(),r("nzRotate",e.nzActive?90:-90)}}function Qn(l,c){if(l&1&&(o(0,"div",40)(1,"nz-row",41)(2,"nz-col",9)(3,"nz-card",5),z(4,"app-expenses",42),s()(),o(5,"nz-col",9)(6,"nz-card",5),z(7,"app-owner-payments"),s()()()()),l&2){let a=u();i(2),r("nzMd",12)("nzSm",24)("nzXs",24),i(2),r("site_id",a.site_id),i(),r("nzMd",12)("nzSm",24)("nzXs",24)}}var Qt=(()=>{let c=class c{constructor(e,t,n,p,g,b,V,Z){this.appService=e,this.route=t,this.userService=n,this.fb=p,this.notification=g,this.router=b,this.msg=V,this.modal=Z,this.vendors=[],this.isActive=!1,this.vendorItems=[],this.discountTotal=0,this.siteTotal=0,this.loading=!1,this.siteStates=et,this.stateNames=tt,this.site_id=0,this.listOfData=[],this.defaultItemValues={id:0,name:"",qty:0,discount:0,total:0,date_created:new Date,isCustom:!1,unit_price:0},this.siteDetails=new oe({id:new m,name:new m,budget:new m,owner:new m,contact_no:new m,state:new m(this.siteStates.Draft),address:new m,site_start_date:new m(new Date),site_end_date:new m(new Date),details:new m,created_by:new m(0),total:new m(0),organization:new m(0),subOrganization:new m(0)}),this.beforeUpload=(k,Kt)=>new Me(B=>{let be=k.type==="image/jpeg"||k.type==="image/png";if(!be){this.msg.error("You can only upload JPG file!"),B.complete();return}let we=k.size/1024/1024<2;if(!we){this.msg.error("Image must smaller than 2MB!"),B.complete();return}B.next(be&&we),B.complete()}),this.siteDetails=this.fb.group({id:new m,name:new m,budget:new m,owner:new m,contact_no:new m,state:new m(this.siteStates.Draft),address:new m,site_start_date:new m(new Date),site_end_date:new m(new Date),details:new m,created_by:new m(0),total:new m(0),organization:new m(0),subOrganization:new m(0)})}submitForm(){}ngOnInit(){this.loadAndUsers(),this.setSitesData(),this.route.paramMap.subscribe(e=>{e.get("siteId")||(this.siteDetails.reset({state:this.siteStates.Draft,id:0}),this.siteDetails.enable(),this.siteDetails.updateValueAndValidity()),this.siteDetails.controls.id.setValue(e.get("siteId")!=="new"?e.get("siteId"):0),this.site_id=this.siteDetails.controls.id.value,this.setSiteDetails()})}ngOnDestroy(){}setSitesData(){return S(this,null,function*(){let e=yield this.appService.getAndSetSites(),t=e&&e.length?e.map(n=>x({label:n.name},n)):[];this.sites=[...t]})}setSiteDetails(){return S(this,null,function*(){this.loading=!0,this.siteDetails.controls.id.value&&(yield this.getExistingsite()),this.disableAndEnableSpecificControls(),this.loading=!1})}getExistingsite(){return S(this,null,function*(){let e=yield this.appService.retireveSiteById(this.siteDetails.controls.id.value);e&&this.siteDetails.patchValue({id:e.id,state:e.state,created_by:e.created_by,total:e.total,organization:e.organization_id,subOrganization:e.sub_organization_id,owner:e.owner,site_start_date:e.site_start_date,site_end_date:e.site_end_date,name:e.name,budget:e.budget,contact_no:e.contact_no,address:e.address,details:e.details}),this.previoussiteDetails=this.siteDetails.getRawValue()})}loadAndUsers(){return S(this,null,function*(){this.listOfData=yield this.userService.getOrganizationUsers()})}submitRequest(){return S(this,null,function*(){let e=yield this.appService.createSite(P(x({},this.siteDetails.value),{state:this.siteStates.PendingApproval}));e&&this.notification.create("success","site Order - "+e.id,"site order submitted successfly. Please check for invoice and update later").onClose.subscribe(t=>{this.router.navigate(["/"])})})}cancelPaymentDetails(){return S(this,null,function*(){})}approveDetails(){return S(this,null,function*(){let e=this.appService.findObjectDifferences(this.previoussiteDetails,this.siteDetails.getRawValue());console.log(e);let t=x({id:this.previoussiteDetails.id},e);(yield this.appService.updateSiteRequest(P(x({},t),{state:this.siteStates.Approved})))&&this.notification.create("success","site Order - "+this.previoussiteDetails.id,"site order invoice submitted successfly. Please proceed next for payment details").onClose.subscribe(p=>{this.router.navigate(["/"])})})}printCard(){let e=this.content.nativeElement.innerHTML,t=window.open("","_blank","top=0,left=0,height=100%,width=auto");t&&(t.document.open(),t.document.write(`
      <html>
        <head>
          <title>Print</title>
          <style>
            /* Define print styles here */
          </style>
        </head>
        <body onload="window.print();window.close()">
          ${e}
        </body>
      </html>
    `),t.print())}generatePDF(){let e=this.content.nativeElement;(0,$t.default)(e).then(t=>{let n=t.toDataURL("image/png")})}disableAndEnableSpecificControls(){let e=this.siteDetails.get("state");e&&e.value!==this.siteStates.Draft&&(console.log(this.siteDetails),Object.keys(this.siteDetails.controls).forEach(t=>{let n=this.siteDetails.get(t);n&&(t!=="attachment"&&t!=="terms"&&e.value===this.siteStates.PendingApproval||e.value===this.siteStates.Completed)&&n.disable()}),console.log(this.siteDetails),this.siteDetails.updateValueAndValidity())}getBase64(e,t){let n=new FileReader;n.addEventListener("load",()=>t(n.result.toString())),n.readAsDataURL(e)}handleChange(e){this.getBase64(e.file.originFileObj,t=>{this.loading=!1})}};c.\u0275fac=function(t){return new(t||c)(y(F),y(Re),y(ie),y(ce),y(Ke),y(Le),y(He),y(Je))},c.\u0275cmp=M({type:c,selectors:[["app-site"]],viewQuery:function(t,n){if(t&1&&Fe(jn,5),t&2){let p;Ve(p=ke())&&(n.content=p.first)}},decls:73,vars:74,consts:[["renderHome",""],["nzAccordion",""],["nzExpandedIcon","double-right",3,"nzHeader","nzActive","nzDisabled"],["p",""],["id","print-section",1,"purchase-request"],[2,"width","100%"],["nz-form","",3,"formGroup","ngSubmit"],["content",""],["nzGutter","2",2,"margin-bottom","12px"],[3,"nzMd","nzSm","nzXs"],["nzRequired","","nzFor","name",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",3,"nzSm","nzXs"],["nz-input","","formControlName","name",1,"control","inputField"],["nzRequired","","nzFor","budget",3,"nzMd","nzSm","nzXs"],["z-input","","formControlName","budget",1,"control","inputField"],["nzRequired","","nzFor","owner",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","owner",1,"control","inputField"],["nzRequired","","nzFor","contact_no",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","contact_no",1,"control","inputField"],["nzRequired","","nzFor","address",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","address",1,"control","inputField",3,"rows"],["nzRequired","","nzFor","site_start_date",3,"nzMd","nzSm","nzXs"],["formControlName","site_start_date",1,"control","inputField"],["nzRequired","","nzFor","site_end_date",3,"nzMd","nzSm","nzXs"],["formControlName","site_end_date",1,"control","inputField"],["nzRequired","","nzFor","details",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","details",1,"control","inputField",3,"rows"],[1,"flex","space-between"],["nz-button","","nzType","primary","nzDanger","","style","margin-bottom: 12px;float: right;",3,"click",4,"ngIf"],["nz-button","","nzType","primary","style","margin-bottom: 12px;float: right;",3,"click",4,"ngIf"],["expandedIcon",""],["style","margin-top: 12px;",4,"ngIf"],[1,"detailBar-collapsible"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","download"],["nz-button","","nzType","primary","printSectionId","print-section","ngxPrint","","printTitle","MyTitle",2,"margin-left","12px"],["nz-icon","","nzType","printer","nzTheme","outline"],["nz-button","","nzType","primary","nzDanger","",2,"margin-bottom","12px","float","right",3,"click"],["nz-button","","nzType","primary",2,"margin-bottom","12px","float","right",3,"click"],["nz-icon","","nzType","caret-right",1,"ant-collapse-arrow",3,"nzRotate"],[2,"margin-top","12px"],["nzGutter","4",2,"margin-bottom","12px"],[3,"site_id"]],template:function(t,n){if(t&1&&(h(0,Bn,9,2,"ng-template",null,0,I),o(2,"nz-collapse",1)(3,"nz-collapse-panel",2,3)(5,"div",4)(6,"nz-card",5)(7,"form",6),C("ngSubmit",function(){return n.submitForm()}),o(8,"div",null,7)(10,"nz-row",8)(11,"nz-col",9)(12,"nz-form-item")(13,"nz-form-label",10),d(14," Name"),s(),o(15,"nz-form-control",11),z(16,"input",12),s()()(),o(17,"nz-col",9)(18,"nz-form-item")(19,"nz-form-label",13),d(20,"budget"),s(),o(21,"nz-form-control",11),z(22,"input",14),s()()()(),o(23,"nz-row",8)(24,"nz-col",9)(25,"nz-form-item")(26,"nz-form-label",15),d(27,"owner"),s(),o(28,"nz-form-control",11),z(29,"input",16),s()()(),o(30,"nz-col",9)(31,"nz-form-item")(32,"nz-form-label",17),d(33,"Contact No"),s(),o(34,"nz-form-control",11),z(35,"input",18),s()()()(),o(36,"nz-row",8)(37,"nz-col",9)(38,"nz-form-item")(39,"nz-form-label",19),d(40," Address"),s(),o(41,"nz-form-control",11),z(42,"textarea",20),s()()()(),o(43,"nz-row",8)(44,"nz-col",9)(45,"nz-form-item")(46,"nz-form-label",21),d(47,"site_start_date"),s(),o(48,"nz-form-control",11),z(49,"nz-date-picker",22),s()()(),o(50,"nz-col",9)(51,"nz-form-item")(52,"nz-form-label",23),d(53,"site_end_date"),s(),o(54,"nz-form-control",11),z(55,"nz-date-picker",24),s()()()(),o(56,"nz-row",8)(57,"nz-col",9)(58,"nz-form-item")(59,"nz-form-label",25),d(60," Contract Details "),s(),o(61,"nz-form-control",11)(62,"textarea",26),d(63,"                        "),s()()()()()(),o(64,"span",27)(65,"span"),h(66,Wn,2,0,"button",28),s(),o(67,"span"),h(68,Un,2,0,"button",29)(69,Gn,2,0,"button",29),s()()()()(),h(70,$n,2,2,"ng-template",null,30,I),s()(),h(72,Qn,8,7,"div",31)),t&2){let p=D(1),g,b,V;i(3),r("nzHeader",p)("nzActive",n.isActive||((g=n.siteDetails.get("state"))==null?null:g.value)!==n.siteStates.Approved&&((g=n.siteDetails.get("state"))==null?null:g.value)!==n.siteStates.Completed)("nzDisabled",((b=n.siteDetails.get("state"))==null?null:b.value)!==n.siteStates.Approved&&((b=n.siteDetails.get("state"))==null?null:b.value)!==n.siteStates.Completed),i(4),r("formGroup",n.siteDetails),i(4),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(),r("rows",2),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",24)("nzSm",24)("nzXs",24),i(2),r("nzMd",4)("nzSm",24)("nzXs",24),i(2),r("nzSm",20)("nzXs",24),i(),r("rows",6),i(4),r("ngIf",n.siteDetails.controls.state.value==n.siteStates.PendingApproval),i(2),r("ngIf",n.siteDetails.controls.state.value==n.siteStates.Draft),i(),r("ngIf",n.siteDetails.controls.state.value==n.siteStates.PendingApproval),i(3),r("ngIf",((V=n.siteDetails.get("state"))==null?null:V.value)===n.siteStates.Approved)}},dependencies:[R,j,A,q,de,wt,bt,L,je,_e,ze,he,fe,Ce,ge,$,re,U,G,ae,se,le,Ut,Gt],styles:[".ant-collapse-arrow{margin-top:10px}"]});let l=c;return l})();var Hn=[{path:"",component:kt,data:{name:"All Sites"}},{path:":siteId",component:Qt,data:{name:"Site"}},{path:":siteId/contract/:contractId",component:Wt,data:{name:"Create Contract"}}],Ht=(()=>{let c=class c{};c.\u0275fac=function(t){return new(t||c)},c.\u0275mod=Oe({type:c}),c.\u0275inj=Ie({imports:[st.forChild(Hn),st]});let l=c;return l})();var Jt=gt,Jn=Object.keys(Jt).map(l=>Jt[l]),Ui=(()=>{let c=class c{};c.\u0275fac=function(t){return new(t||c)},c.\u0275mod=Oe({type:c}),c.\u0275inj=Ie({providers:[{provide:xt,useValue:vt},{provide:Ct,useValue:Jn}],imports:[_t,Ht,It,St,yt]});let l=c;return l})();export{Ui as SitesModule};
