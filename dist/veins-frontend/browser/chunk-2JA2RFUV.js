import{a as Se}from"./chunk-3RWGU7OD.js";import{b as ze,e as St,f as bt}from"./chunk-VRB533SF.js";import{a as nt}from"./chunk-WEORZT4K.js";import{a as J}from"./chunk-7RB6QFZN.js";import{$c as zt,A as _,Aa as Re,B as h,Ba as Pe,Ca as f,Cb as U,D as Ue,Da as me,E as se,Ea as x,Eb as N,Fa as P,Fb as L,Gb as at,Jb as Q,La as k,Lb as ot,Ma as V,Mc as xe,Nc as ve,O as Me,Oa as Z,Ob as rt,Oc as R,P as s,Pb as lt,Q as b,Qa as pe,Qc as Ct,Ra as Ge,Rb as st,Rc as ee,Sb as ct,Tb as q,Tc as te,Ub as mt,Uc as ie,V as u,Vb as pt,Vc as ne,Wc as ae,X as p,Yc as xt,Zc as vt,a as X,aa as Le,ab as $e,bc as ue,cb as Ke,cc as _e,dc as dt,e as S,ea as o,eb as Ye,fa as a,ga as z,gc as ut,ha as K,hb as Ne,hc as he,ia as Y,ic as _t,ja as v,jb as Xe,jc as ht,ka as y,la as m,lb as j,lc as ye,mc as ge,nb as Ze,nc as fe,ob as Je,oc as Ce,pa as T,pb as de,qa as c,qb as H,qc as yt,ra as I,rb as B,sa as C,sb as W,sc as gt,ta as qe,tb as Qe,tc as ft,ua as w,ub as et,v as Be,va as E,w as A,wa as D,x as le,ya as ce,yb as tt,z as We,zb as it}from"./chunk-NE6OXDYI.js";function Ht(n,l){if(n&1&&z(0,"nz-option",17),n&2){let t=l.$implicit;p("nzValue",t==null?null:t.id)("nzLabel",t==null?null:t.name)}}function Ft(n,l){if(n&1&&(o(0,"nz-select",15),u(1,Ht,1,2,"nz-option",16),a()),n&2){let t=m(2);s(),p("ngForOf",t.users)}}function Bt(n,l){if(n&1&&z(0,"nz-option",17),n&2){let t=l.$implicit;p("nzValue",t==null?null:t.id)("nzLabel",t==null?null:t.name)}}function Wt(n,l){if(n&1&&(o(0,"nz-select",18),u(1,Bt,1,2,"nz-option",16),a()),n&2){let t=m(2);s(),p("ngForOf",t.users)}}function Ut(n,l){if(n&1&&(o(0,"nz-form",3)(1,"div",4)(2,"div",5)(3,"nz-form-item")(4,"nz-form-label"),c(5,"Employee"),a(),o(6,"nz-form-control"),u(7,Ft,2,1,"nz-select",6),a()()()(),o(8,"div",4)(9,"div",5)(10,"nz-form-item")(11,"nz-form-label"),c(12,"Supervisor"),a(),o(13,"nz-form-control"),u(14,Wt,2,1,"nz-select",7),a()()()(),o(15,"div",4)(16,"div",8)(17,"nz-form-item")(18,"nz-form-label"),c(19,"Salary Nature"),a(),o(20,"nz-form-control"),z(21,"nz-switch",9),a()()()(),o(22,"div",4)(23,"div",8)(24,"nz-form-item")(25,"nz-form-label"),c(26,"Working Hours"),a(),o(27,"nz-form-control"),z(28,"input",10),a()()()(),o(29,"div",4)(30,"div",8)(31,"nz-form-item")(32,"nz-form-label"),c(33,"Salary"),a(),o(34,"nz-form-control"),z(35,"input",11),a()()()(),o(36,"div",4)(37,"div",8)(38,"nz-form-item")(39,"nz-form-label"),c(40,"Over time allowed"),a(),o(41,"nz-form-control"),z(42,"label",12),a()()()(),o(43,"div",4)(44,"div",8)(45,"nz-form-item")(46,"nz-form-label"),c(47,"Signout Required"),a(),o(48,"nz-form-control"),z(49,"label",13),a()()()(),o(50,"div",4)(51,"div",8)(52,"nz-form-item")(53,"nz-form-label"),c(54,"Employement Details"),a(),o(55,"nz-form-control"),z(56,"textarea",14),a()()()()()),n&2){let t=m();p("formGroup",t.employeeForm),s(),p("nzGutter",8),s(6),p("ngIf",t.users.length),s(),p("nzGutter",8),s(6),p("ngIf",t.users.length),s(),p("nzGutter",8),s(7),p("nzGutter",8),s(7),p("nzGutter",8),s(7),p("nzGutter",8),s(7),p("nzGutter",8),s(7),p("nzGutter",8),s(6),p("rows",3)}}function Lt(n,l){if(n&1){let t=v();o(0,"div",19)(1,"button",20),y("click",function(){_(t);let i=m();return h(i.close())}),c(2,"Cancel"),a(),o(3,"button",21),y("click",function(){_(t);let i=m();return h(i.addUser())}),c(4,"Submit"),a()()}if(n&2){let t=m();s(3),p("disabled",!t.employeeForm.valid)}}var qt=()=>({overflow:"auto"}),De=(()=>{let l=class l{constructor(e,i){this.appService=e,this.fb=i,this.visible=!1,this.users=[],this.userRoles=[],this.subOrganizations=[],this.editableItem={},this.isNew=!0,this.closeDrawer=new Be,this.employeeForm=this.fb.group({id:[0,[]],employee:[0,[N.required]],isSalaryHourly:[!1],salary:[0,[N.required]],overtime:[!1],siginout_required:[!1],organization:[parseInt(localStorage.getItem("organization_id")||"0")],subOrganization:[0],supervisor:[0,[N.required]],details:["",[N.required]],workingHours:[8,[N.required]]})}ngOnInit(){this.isNew&&this.employeeForm.reset(),this.employeeForm=this.fb.group({id:[this.editableItem.id],employee:[this.editableItem.employee,[N.required]],isSalaryHourly:[this.editableItem.isSalaryHourly],salary:[this.editableItem.salary,[N.required]],overtime:[this.editableItem.overtime],siginout_required:[this.editableItem.siginout_required],organization:[parseInt(localStorage.getItem("organization_id")||"0")],subOrganization:[this.editableItem.subOrganization],supervisor:[this.editableItem.supervisor,[N.required]],details:[this.editableItem.details,[N.required]],workingHours:[this.editableItem.workingHours,[N.required]]})}close(){this.closeDrawer.emit(!1)}addUser(){return S(this,null,function*(){console.log(this.employeeForm),this.isNew?yield this.appService.createEmployee({employee:this.employeeForm.value.employee,supervisor:this.employeeForm.value.supervisor,salary:this.employeeForm.value.salary,overtime:this.employeeForm.value.overtime,isSalaryHourly:this.employeeForm.value.isSalaryHourly,workingHours:this.employeeForm.value.workingHours,siginout_required:this.employeeForm.value.siginout_required,details:this.employeeForm.value.details}):yield this.appService.updateEmployee({id:this.editableItem.id,employee:this.employeeForm.value.employee,supervisor:this.employeeForm.value.supervisor,salary:this.employeeForm.value.salary,overtime:this.employeeForm.value.overtime,isSalaryHourly:this.employeeForm.value.isSalaryHourly,workingHours:this.employeeForm.value.workingHours,siginout_required:this.employeeForm.value.siginout_required,details:this.employeeForm.value.details}),this.closeDrawer.emit(!0)})}objectKeys(e){return Object.keys(e).map(i=>({key:i,value:e[i]}))}};l.\u0275fac=function(i){return new(i||l)(b(j),b(lt))},l.\u0275cmp=A({type:l,selectors:[["app-employee-contract"]],inputs:{visible:"visible",users:"users",userRoles:"userRoles",subOrganizations:"subOrganizations",editableItem:"editableItem",isNew:"isNew"},outputs:{closeDrawer:"closeDrawer"},decls:4,vars:7,consts:[[3,"nzBodyStyle","nzMaskClosable","nzWidth","nzVisible","nzTitle","nzFooter","nzOnClose"],[3,"formGroup",4,"nzDrawerContent"],["footerTpl",""],[3,"formGroup"],["nz-row","",3,"nzGutter"],["nz-col","","nz-col","","nzSpan","12"],["id","employee","formControlName","employee","placeholder","Select user",4,"ngIf"],["id","supervisor","formControlName","supervisor","placeholder","Select user",4,"ngIf"],["nz-col","","nzSpan","12"],["formControlName","isSalaryHourly","nzCheckedChildren","Hourly","nzUnCheckedChildren","Monthly"],["formControlName","workingHours","nz-input","","placeholder","please enter working hours"],["formControlName","salary","nz-input","","placeholder","please enter user salary"],["nz-checkbox","","formControlName","overtime"],["nz-checkbox","","formControlName","siginout_required"],["nz-input","","formControlName","details",3,"rows"],["id","employee","formControlName","employee","placeholder","Select user"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],["id","supervisor","formControlName","supervisor","placeholder","Select user"],[2,"float","right"],["nz-button","",2,"margin-right","8px",3,"click"],["nz-button","","nzType","primary",3,"disabled","click"]],template:function(i,r){if(i&1&&(o(0,"nz-drawer",0),y("nzOnClose",function(){return r.close()}),u(1,Ut,57,12,"nz-form",1)(2,Lt,5,1,"ng-template",null,2,P),a()),i&2){let d=T(3);p("nzBodyStyle",ce(6,qt))("nzMaskClosable",!1)("nzWidth",720)("nzVisible",r.visible)("nzTitle",r.isNew?"Create Employee":"Update Employee")("nzFooter",d)}},dependencies:[k,V,W,H,B,he,ge,ye,Ce,fe,yt,ft,gt,q,ue,_e,ve,U,L,at,ot,rt]});let n=l;return n})();function Yt(n,l){if(n&1){let t=v();o(0,"span",14),y("click",function(){_(t);let i=m(2);return i.searchValue="",h(i.search())}),a()}}function Xt(n,l){n&1&&z(0,"span",15)}function Zt(n,l){if(n&1&&u(0,Yt,1,0,"span",13)(1,Xt,1,0),n&2){let t=m();Le(0,t.searchValue?0:1)}}function Jt(n,l){n&1&&z(0,"span",15)}function Qt(n,l){if(n&1){let t=v();o(0,"button",16),y("click",function(){_(t);let i=m();return h(i.open())}),c(1,"Add"),a()}}function ei(n,l){if(n&1){let t=v();o(0,"app-employee-contract",17),y("closeDrawer",function(i){_(t);let r=m();return h(r.close(i))}),a()}if(n&2){let t=m();p("subOrganizations",t.subOrganizations)("visible",t.visible)("users",t.users)("editableItem",t.editableItem)("isNew",t.isNew)}}function ti(n,l){if(n&1&&(o(0,"th",18),c(1),a()),n&2){let t=l.$implicit;p("nzSortFn",t.compare)("nzSortPriority",t.priority),s(),C(" ",t.title," ")}}function ii(n,l){if(n&1&&(o(0,"td"),c(1),a()),n&2){let t=m(3).$implicit;s(),qe("",t.salary," ",t.isSalaryHourly?"/h":"/m","")}}function ni(n,l){if(n&1){let t=v();o(0,"a",23),y("click",function(){_(t);let i=m(3).$implicit,r=m();return r.startEdit(i.id),h(r.open(!1))}),c(1,"Edit"),a()}}var ai=()=>[],wt=(n,l,t)=>({user:n,permissionName:0,isAdmin:l,isContractor:!1,userIds:t});function oi(n,l){if(n&1&&(K(0),o(1,"td"),c(2),f(3,"username"),a(),o(4,"td"),c(5),f(6,"username"),a(),u(7,ii,2,2,"td",19),o(8,"td"),c(9),a(),o(10,"td"),c(11),a(),o(12,"td"),c(13),a(),o(14,"td"),u(15,ni,2,0,"a",22),a(),Y()),n&2){let t=m(2).$implicit,e=m();s(2),I(me(3,7,t.employee)),s(3),I(me(6,9,t.supervisor)),s(2),p("filterUser",Pe(12,wt,e.loggedInUser,e.loggedInUser.is_admin,ce(11,ai))),s(2),I(t.overtime),s(2),I(t.siginout_required),s(2),I(t.workingHours),s(2),p("appHasPermission",e.appPermissions.AddEmployees)}}function ri(n,l){if(n&1&&z(0,"nz-option",31),n&2){let t=l.$implicit;p("nzValue",t==null?null:t.id)("nzLabel",t==null?null:t.name)}}function li(n,l){if(n&1){let t=v();o(0,"nz-select",29),D("ngModelChange",function(i){_(t);let r=m(3).$implicit,d=m();return E(d.editCache[r.id].data.supervisor,i)||(d.editCache[r.id].data.supervisor=i),h(i)}),u(1,ri,1,2,"nz-option",30),a()}if(n&2){let t=m(3).$implicit,e=m();w("ngModel",e.editCache[t.id].data.supervisor),s(),p("ngForOf",e.users)}}function si(n,l){if(n&1){let t=v();o(0,"td"),c(1),f(2,"username"),a(),o(3,"td"),u(4,li,2,2,"nz-select",24),a(),o(5,"td")(6,"input",25),D("ngModelChange",function(i){_(t);let r=m(2).$implicit,d=m();return E(d.editCache[r.id].data.salary,i)||(d.editCache[r.id].data.salary=i),h(i)}),a(),c(7),a(),o(8,"td")(9,"label",26),D("ngModelChange",function(i){_(t);let r=m(2).$implicit,d=m();return E(d.editCache[r.id].data.overtime,i)||(d.editCache[r.id].data.overtime=i),h(i)}),a()(),o(10,"td")(11,"label",26),D("ngModelChange",function(i){_(t);let r=m(2).$implicit,d=m();return E(d.editCache[r.id].data.siginout_required,i)||(d.editCache[r.id].data.siginout_required=i),h(i)}),a()(),o(12,"td")(13,"input",25),D("ngModelChange",function(i){_(t);let r=m(2).$implicit,d=m();return E(d.editCache[r.id].data.workingHours,i)||(d.editCache[r.id].data.workingHours=i),h(i)}),a()(),o(14,"td")(15,"a",27),y("click",function(){_(t);let i=m(2).$implicit,r=m();return h(r.saveEdit(i.id))}),c(16,"Save"),a(),c(17," \xA0 "),o(18,"a",28),y("nzOnConfirm",function(){_(t);let i=m(2).$implicit,r=m();return h(r.cancelEdit(i.id))}),c(19,"Cancel"),a()()}if(n&2){let t=m(2).$implicit,e=m();s(),I(me(2,9,t.employee)),s(3),p("ngIf",e.listOfData.length),s(2),w("ngModel",e.editCache[t.id].data.salary),s(),C(" ",e.editCache[t.id].data.isSalaryHourly?"/h":"/m",""),s(2),w("ngModel",e.editCache[t.id].data.overtime),p("nzChecked",e.editCache[t.id].data.overtime),s(2),w("ngModel",e.editCache[t.id].data.siginout_required),p("nzChecked",e.editCache[t.id].data.siginout_required),s(2),w("ngModel",e.editCache[t.id].data.workingHours)}}function ci(n,l){if(n&1&&(o(0,"tr"),u(1,oi,16,16,"ng-container",20)(2,si,20,11,"ng-template",null,21,P),a()),n&2){let t=T(3),e=m().$implicit,i=m();s(),p("ngIf",!(i.editCache[e.id]!=null&&i.editCache[e.id].edit))("ngIfElse",t)}}var mi=(n,l)=>[n,l];function pi(n,l){if(n&1&&(K(0),u(1,ci,4,2,"tr",19),Y()),n&2){let t=l.$implicit,e=m();s(),p("filterUser",Pe(4,wt,e.loggedInUser,e.loggedInUser.is_admin,Re(1,mi,t.employee,t.supervisor)))}}var Et=(()=>{let l=class l{constructor(e,i){this.appService=e,this.userService=i,this.listOfColumn=[{title:"Employee",compare:(r,d)=>r.employeeName.localeCompare(d.employeeName),priority:1},{title:"Supervisor",compare:(r,d)=>r.supervisorName-d.supervisorName,priority:2},{title:"Overtime",compare:(r,d)=>r.overtime-d.overtime,priority:4},{title:"Signout Required",compare:(r,d)=>r.siginout_required-d.siginout_required,priority:5},{title:"Working Hours",compare:(r,d)=>r.workingHours-d.workingHours,priority:6},{title:"Action",compare:(r,d)=>(r.id||0)-(d.id||0),priority:7}],this.listOfData=[],this.users=[],this.visible=!1,this.appPermissions=J,this.listOfDisplayData=[],this.editCache={}}ngOnInit(){this.loggedInUser=this.userService.loggedInUser,this.getUsers(),this.loggedInUser.is_admin&&(this.listOfColumn.push({title:"Salary",compare:(e,i)=>e.salary-i.salary,priority:3}),this.listOfColumn=this.listOfColumn.sort((e,i)=>e.priority-i.priority))}getUsers(){return S(this,null,function*(){this.users=yield this.userService.getOrganizationUsers(),this.subOrgSubscription=this.appService.currentSubOrganization.subscribe(e=>{e&&e.id>0&&this.currentOrganizationId!=e.id&&(this.populateEmployeeData(),this.currentOrganizationId=e.id)})})}ngOnDestroy(){this.subOrgSubscription&&this.subOrgSubscription.unsubscribe()}open(e=!0){this.visible=!0,this.isNew=e}close(e=!1){this.visible=!1,e&&this.populateEmployeeData()}populateEmployeeData(){return S(this,null,function*(){this.listOfData=yield this.appService.getOrganizationEmployees(),this.listOfDisplayData=this.listOfData,this.updateEditCache()})}startEdit(e){this.editableItem=this.editCache[e].data}cancelEdit(e){let i=this.listOfData.findIndex(r=>r.id===e);this.editCache[e]={data:X({},this.listOfData[i]),edit:!1}}saveEdit(e){return S(this,null,function*(){let i=this.listOfData.findIndex(r=>r.id===e);yield this.appService.updateEmployee({id:this.editCache[e].data.id,employee:this.editCache[e].data.employee,supervisor:this.editCache[e].data.supervisor,salary:this.editCache[e].data.salary,overtime:this.editCache[e].data.overtime,isSalaryHourly:this.editCache[e].data.isSalaryHourly,workingHours:this.editCache[e].data.workingHours,siginout_required:this.editCache[e].data.siginout_required,details:this.editCache[e].data.details}),this.editCache[e].edit=!1,Object.assign(this.listOfData[i],this.editCache[e].data),this.populateEmployeeData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:X({},e)}})}search(){this.searchVisible=!1,this.searchValue?(this.listOfDisplayData=this.listOfData.filter(e=>e.employeeName&&e.employeeName.toLowerCase().indexOf(this.searchValue.toLowerCase())>-1||e.supervisorName&&e.supervisorName.toLowerCase().indexOf(this.searchValue.toLowerCase())>-1),console.log(this.listOfDisplayData)):this.listOfDisplayData=this.listOfData}};l.\u0275fac=function(i){return new(i||l)(b(j),b(Xe))},l.\u0275cmp=A({type:l,selectors:[["app-employee-management"]],decls:20,vars:9,consts:[[1,"flex","space-between"],[2,"display","-webkit-box","width","100%"],[2,"margin-right","5px"],[3,"nzSuffix"],["type","text","placeholder","Search here","nz-input","",3,"ngModel","ngModelChange","keyup"],["inputClearTpl",""],["suffixIconSearch",""],["nz-button","","nzType","primary",3,"click",4,"appHasPermission"],[3,"subOrganizations","visible","users","editableItem","isNew","closeDrawer",4,"ngIf"],["nzShowPagination","false",3,"nzPageSize","nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["nz-icon","","class","ant-input-clear-icon","nzTheme","fill","nzType","close-circle"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],["nz-icon","","nzType","search"],["nz-button","","nzType","primary",3,"click"],[3,"subOrganizations","visible","users","editableItem","isNew","closeDrawer"],[3,"nzSortFn","nzSortPriority"],[4,"filterUser"],[4,"ngIf","ngIfElse"],["editTemplate",""],[3,"click",4,"appHasPermission"],[3,"click"],["id","supervisor","placeholder","Select user",3,"ngModel","ngModelChange",4,"ngIf"],["type","text","nz-input","",3,"ngModel","ngModelChange"],["nz-checkbox","",3,"ngModel","nzChecked","ngModelChange"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],["id","supervisor","placeholder","Select user",3,"ngModel","ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"]],template:function(i,r){if(i&1&&(o(0,"div",0)(1,"span",1)(2,"h3",2),c(3," Employees "),a(),o(4,"nz-input-group",3)(5,"input",4),D("ngModelChange",function(g){return E(r.searchValue,g)||(r.searchValue=g),g}),y("keyup",function(){return r.search()}),a()(),u(6,Zt,2,1,"ng-template",null,5,P)(8,Jt,1,0,"ng-template",null,6,P),a(),u(10,Qt,2,0,"button",7),a(),u(11,ei,1,5,"app-employee-contract",8),o(12,"nz-table",9,10)(15,"thead")(16,"tr"),u(17,ti,2,3,"th",11),a()(),o(18,"tbody"),u(19,pi,2,8,"ng-container",12),a()()),i&2){let d=T(7),g=T(9),O=T(14);s(4),p("nzSuffix",g)("nzSuffix",d),s(),w("ngModel",r.searchValue),s(5),p("appHasPermission",r.appPermissions.AddEmployees),s(),p("ngIf",r.visible),s(),p("nzPageSize",1e3)("nzData",r.listOfDisplayData),s(5),p("ngForOf",r.listOfColumn),s(2),p("ngForOf",O.data)}},dependencies:[k,V,W,H,B,he,de,q,pt,mt,xe,ue,_e,ie,Ct,R,ee,ae,te,ne,U,L,Q,ze,St,De,Se]});let n=l;return n})();var oe=(()=>{let l=class l{constructor(){}calculateHourlyRate(e,i,r,d=!0){if(d)return e;{let g=i.getFullYear(),O=i.getMonth(),re=new Date(g,O+1,0).getDate(),F=0;for(let $=1;$<=re;$++)new Date(g,O,$).getDay()!==0&&F++;return e/(F*r)}}isDateInLastOrCurrentMonth(e){let i=new Date,r=i.getMonth(),d=i.getFullYear(),g=e.getMonth(),O=e.getFullYear();return d===O&&r===g||d===O&&r-1===g||d-1===O&&r===0&&g===11}getDifferenceInHours(e,i){let r=new Date(e).getHours()*3600+new Date(e).getMinutes()*60+new Date(e).getSeconds(),d=new Date(i).getHours()*3600+new Date(i).getMinutes()*60+new Date(i).getSeconds(),O=Math.abs(d-r)/3600;return isNaN(O)?0:O}calculateWorkingHours(e,i){let r=e.overtime,d=e.siginout_required,g=e.workingHours;return r?i:d?i>g?g||8:i:i==0?0:g}};l.\u0275fac=function(i){return new(i||l)},l.\u0275prov=Ue({token:l,factory:l.\u0275fac,providedIn:"root"});let n=l;return n})();function di(n,l){n&1&&(o(0,"th"),c(1," Action "),a())}function ui(n,l){if(n&1&&(o(0,"span",8),c(1),f(2,"date"),o(3,"a",9),z(4,"span",10),a()()),n&2){let t=m().$implicit;s(),C(" ",x(2,2,t.attendanceObj==null?null:t.attendanceObj.sign_in,"hh:mm a")," "),s(2),p("href","https://www.google.com/maps?q="+(t.attendanceObj==null?null:t.attendanceObj.sign_in_corrd),Me)}}function _i(n,l){if(n&1){let t=v();o(0,"nz-time-picker",11),y("ngModelChange",function(){_(t);let i=m().$implicit,r=m();return h(r.signIn(i.id))}),D("ngModelChange",function(i){_(t);let r=m().$implicit,d=m();return E(d.editCache[r.id].data.attendanceObj.sign_in,i)||(d.editCache[r.id].data.attendanceObj.sign_in=i),h(i)}),a()}if(n&2){let t=m().$implicit,e=m();p("nzUse12Hours",!0),w("ngModel",e.editCache[t.id].data.attendanceObj.sign_in)}}function hi(n,l){if(n&1&&(o(0,"a",9),z(1,"span",10),a()),n&2){let t=m(2).$implicit;p("href","https://www.google.com/maps?q="+(t.attendanceObj==null?null:t.attendanceObj.sign_out_corrd),Me)}}function yi(n,l){if(n&1&&(o(0,"span",8),c(1),f(2,"date"),u(3,hi,2,1,"a",12),a()),n&2){let t=m().$implicit,e=m();s(),C("",x(2,2,t.attendanceObj==null?null:t.attendanceObj.sign_out,"hh:mm a")," "),s(2),p("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit))}}function gi(n,l){if(n&1){let t=v();o(0,"nz-time-picker",11),y("ngModelChange",function(){_(t);let i=m().$implicit,r=m();return h(r.signOut(i.id))}),D("ngModelChange",function(i){_(t);let r=m().$implicit,d=m();return E(d.editCache[r.id].data.attendanceObj.sign_out,i)||(d.editCache[r.id].data.attendanceObj.sign_out=i),h(i)}),a()}if(n&2){let t=m().$implicit,e=m();p("nzUse12Hours",!0),w("ngModel",e.editCache[t.id].data.attendanceObj.sign_out)}}function fi(n,l){if(n&1&&(o(0,"span"),c(1),a()),n&2){let t=m().$implicit;s(),C(" ",t.attendanceObj==null?null:t.attendanceObj.approved_hours," ")}}function Ci(n,l){if(n&1){let t=v();o(0,"input",13),y("ngModelChange",function(){_(t);let i=m().$implicit,r=m();return h(r.claculateAndSetAmount(i.id))}),D("ngModelChange",function(i){_(t);let r=m().$implicit,d=m();return E(d.editCache[r.id].data.attendanceObj.approved_hours,i)||(d.editCache[r.id].data.attendanceObj.approved_hours=i),h(i)}),a()}if(n&2){let t=m().$implicit,e=m();w("ngModel",e.editCache[t.id].data.attendanceObj.approved_hours)}}function xi(n,l){if(n&1&&(o(0,"span"),c(1),f(2,"currency"),a()),n&2){let t=m().$implicit,e=m();s(),I(x(2,1,(e.editCache[t.id].data==null||e.editCache[t.id].data.attendanceObj==null?null:e.editCache[t.id].data.attendanceObj.amount)||0," "))}}function vi(n,l){if(n&1&&(o(0,"span"),c(1),f(2,"currency"),a()),n&2){let t=m().$implicit;s(),I(x(2,1,(t.attendanceObj==null?null:t.attendanceObj.amount)||0," "))}}function zi(n,l){if(n&1){let t=v();o(0,"a",17),y("click",function(){_(t);let i=m(2).$implicit,r=m();return h(r.startEdit(i.id))}),c(1,"Edit"),a()}}function Si(n,l){if(n&1){let t=v();o(0,"a",18),y("click",function(){_(t);let i=m(2).$implicit,r=m();return h(r.saveEdit(i.id))}),c(1,"Save"),a()}}function bi(n,l){if(n&1){let t=v();o(0,"a",19),y("nzOnConfirm",function(){_(t);let i=m(2).$implicit,r=m();return h(r.cancelEdit(i.id))}),c(1,"Cancel"),a()}}function wi(n,l){if(n&1&&(o(0,"td"),u(1,zi,2,0,"a",14)(2,Si,2,0,"a",15),c(3," \xA0 "),u(4,bi,2,0,"a",16),a()),n&2){let t=m().$implicit,e=m();s(),p("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit)),s(),p("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit),s(2),p("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit)}}function Ei(n,l){if(n&1&&(o(0,"tr")(1,"td"),c(2),f(3,"date"),a(),o(4,"td"),u(5,ui,5,5,"span",5)(6,_i,1,2,"nz-time-picker",6),a(),o(7,"td"),u(8,yi,4,5,"span",5)(9,gi,1,2,"nz-time-picker",6),a(),o(10,"td"),c(11),a(),o(12,"td"),u(13,fi,2,1,"span",2)(14,Ci,1,1,"input",7),a(),o(15,"td"),u(16,xi,3,4,"span",2)(17,vi,3,4,"span",2),a(),u(18,wi,5,3,"td",2),a()),n&2){let t=l.$implicit,e=m();s(2),C("",x(3,11,t.date," dd MMM yyyy")," "),s(3),p("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit)),s(),p("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit),s(2),p("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit)),s(),p("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit),s(2),I(t.attendanceObj==null?null:t.attendanceObj.hours_worked),s(2),p("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit)),s(),p("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit),s(2),p("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit),s(),p("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit)),s(),p("ngIf",e.isSupervisor)}}function Di(n,l){if(n&1&&(o(0,"span",20),z(1,"span"),o(2,"span")(3,"b"),c(4),f(5,"currency"),a()()()),n&2){let t=m();s(4),C(" Total: ",x(5,1,t.totalAmount,"PKR "),"")}}var Ie=(()=>{let l=class l{constructor(e,i){this.appService=e,this.employeeManagementService=i,this.supervisorData=[],this.totalAmount=0,this.editCache={}}ngOnInit(){this.getCurrentUserAttance(),this.sunscribeToGeoLocation()}sunscribeToGeoLocation(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{this.latitude=e.coords.latitude,this.longitude=e.coords.longitude})}getCurrentUserAttance(){return S(this,null,function*(){let e=yield this.appService.getCurrentUserAttendance(this.employee.id);e&&this.initializeSupervisorTableData(e.lastPayment,e.attendances),this.updateEditCache()})}initializeSupervisorTableData(e,i){let r=new Date,d=e?new Date(e.date_created):null,g=i.map(M=>new Date(M.attendance_date)),O;d&&(Math.min(...g.map(M=>M.getTime()))===1/0||d<=new Date(Math.min(...g.map(M=>M.getTime()))))?O=d:g&&g.length?O=new Date(Math.min(...g.map(M=>M.getTime()))):O=new Date(this.employee.date_created);let re=[],F=new Date(O),Oe=0;for(;F<=r;){let M=i.find($=>{let Te=new Date($.attendance_date);return Te.setHours(0,0,0,0),F.setHours(0,0,0,0),Te.getTime()===F.getTime()});re.push({id:Oe,date:new Date(F),attendanceObj:M||{}}),F.setDate(F.getDate()+1),Oe++}this.supervisorData=re,this.totalAmount=this.supervisorData.reduce((M,$)=>M+(Number($.attendanceObj.amount)||0),0)}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let i=this.supervisorData.findIndex(r=>r.id===e);this.editCache[e]={data:X({},this.supervisorData[i]),edit:!1}}claculateAndSetAmount(e){let i=this.employeeManagementService.calculateHourlyRate(this.employee.salary,this.editCache[e].data.date,this.employee.workingHours||8,this.employee.isSalaryHourly);setTimeout(()=>{this.editCache[e].data.attendanceObj.amount=i*this.employeeManagementService.calculateWorkingHours(this.employee,this.editCache[e].data.attendanceObj.approved_hours||this.editCache[e].data.attendanceObj.hours_worked)})}signIn(e){this.editCache[e].data.attendanceObj.sign_in_corrd=this.latitude+","+this.longitude}signOut(e){this.editCache[e].data.attendanceObj.sign_out_corrd=this.latitude+","+this.longitude,this.editCache[e].data.attendanceObj.hours_worked=Math.round(this.employeeManagementService.getDifferenceInHours(this.editCache[e].data.attendanceObj.sign_in,this.editCache[e].data.attendanceObj.sign_out));let i=this.employeeManagementService.calculateHourlyRate(this.employee.salary,this.editCache[e].data.date,this.employee.workingHours||8,this.employee.isSalaryHourly);this.editCache[e].data.attendanceObj.amount=i*this.employeeManagementService.calculateWorkingHours(this.employee,this.editCache[e].data.attendanceObj.approved_hours||this.editCache[e].data.attendanceObj.hours_worked)}saveEdit(e){return S(this,null,function*(){let i=this.supervisorData.findIndex(r=>r.id===e);this.editCache[e].data.attendanceObj.id?yield this.appService.updateAttendance({id:this.editCache[e].data.attendanceObj.id,sign_in:this.editCache[e].data.attendanceObj.sign_in,sign_out:this.editCache[e].data.attendanceObj.sign_out,sign_in_corrd:this.editCache[e].data.attendanceObj.sign_in_corrd,sign_out_corrd:this.editCache[e].data.attendanceObj.sign_out_corrd,hours_worked:this.editCache[e].data.attendanceObj.hours_worked,approved_hours:this.editCache[e].data.attendanceObj.approved_hours,amount:this.editCache[e].data.attendanceObj.amount}):yield this.appService.createAttendance({employee:this.employee.id,sign_in:this.editCache[e].data.attendanceObj.sign_in,sign_out:this.editCache[e].data.attendanceObj.sign_out,sign_in_corrd:this.editCache[e].data.attendanceObj.sign_in_corrd,sign_out_corrd:this.editCache[e].data.attendanceObj.sign_out_corrd,hours_worked:this.editCache[e].data.attendanceObj.hours_worked,approved_hours:this.editCache[e].data.attendanceObj.approved_hours,attendance_date:this.editCache[e].data.date,amount:this.editCache[e].data.attendanceObj.amount}),this.editCache[e].edit=!1,Object.assign(this.supervisorData[i],this.editCache[e].data),this.getCurrentUserAttance()})}updateEditCache(){this.supervisorData.forEach(e=>{this.editCache[e.id]={edit:!1,data:X({},e)}})}};l.\u0275fac=function(i){return new(i||l)(b(j),b(oe))},l.\u0275cmp=A({type:l,selectors:[["app-attendance-details"]],inputs:{employee:"employee",isSupervisor:"isSupervisor"},decls:21,vars:6,consts:[["nzShowPagination","false",3,"nzPageSize","nzFooter","nzData","nzBordered"],["basicTable",""],[4,"ngIf"],[4,"ngFor","ngForOf"],["footerDetails",""],["class","flex space-between",4,"ngIf"],["nzFormat","HH:mm",3,"nzUse12Hours","ngModel","ngModelChange",4,"ngIf"],["nz-input","",3,"ngModel","ngModelChange",4,"ngIf"],[1,"flex","space-between"],["target","_blank","nzType","default","nzShape","circle","nzShape","round",3,"href"],["nz-icon","","nzType","environment","nzTheme","outline"],["nzFormat","HH:mm",3,"nzUse12Hours","ngModel","ngModelChange"],["target","_blank","nzType","default","nzShape","circle","nzShape","round",3,"href",4,"ngIf"],["nz-input","",3,"ngModel","ngModelChange"],[3,"click",4,"ngIf"],["class","save",3,"click",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm",4,"ngIf"],[3,"click"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],[1,"flex","space-between","center"]],template:function(i,r){if(i&1&&(o(0,"nz-table",0,1)(2,"thead")(3,"tr")(4,"th"),c(5,"Date"),a(),o(6,"th"),c(7,"Sign In"),a(),o(8,"th"),c(9,"Sign Out"),a(),o(10,"th"),c(11,"Hours Worked"),a(),o(12,"th"),c(13,"Approved Hours"),a(),o(14,"th"),c(15,"Amount"),a(),u(16,di,2,0,"th",2),a()(),o(17,"tbody"),u(18,Ei,19,14,"tr",3),a()(),u(19,Di,6,4,"ng-template",null,4,P)),i&2){let d=T(20);p("nzPageSize",1e3)("nzFooter",d)("nzData",r.supervisorData)("nzBordered",!0),s(16),p("ngIf",r.isSupervisor),s(2),p("ngForOf",r.supervisorData)}},dependencies:[k,V,H,de,q,xe,ie,R,ee,ae,te,ne,dt,U,L,Q,pe,Z]});let n=l;return n})();function Ii(n,l){if(n&1&&(o(0,"div"),c(1),f(2,"date"),a()),n&2){let t=m(2);s(),C(" ",x(2,1,t.signInTime,"hh:mm a"),"")}}function Oi(n,l){if(n&1){let t=v();o(0,"button",7),y("click",function(){_(t);let i=m(2);return h(i.signIn())}),c(1,"Sign In"),a()}}function Ti(n,l){if(n&1&&(o(0,"div"),c(1),f(2,"date"),a()),n&2){let t=m(2);s(),C(" ",x(2,1,t.signOutTime,"hh:mm a"),"")}}function Mi(n,l){if(n&1){let t=v();o(0,"button",7),y("click",function(){_(t);let i=m(2);return h(i.signOut())}),c(1,"Sign Out"),a()}}function Pi(n,l){if(n&1&&(o(0,"div",4)(1,"strong"),c(2),f(3,"date"),a(),u(4,Ii,3,4,"div",5)(5,Oi,2,0,"button",6)(6,Ti,3,4,"div",5)(7,Mi,2,0,"button",6),a()),n&2){let t=m();s(2),I(x(3,5,t.currentDate,"longDate")),s(2),p("ngIf",t.signInTime),s(),p("ngIf",!t.signInTime),s(),p("ngIf",t.signOutTime),s(),p("ngIf",t.signInTime&&!t.signOutTime)}}function Ni(n,l){if(n&1&&(o(0,"td"),c(1),a()),n&2){let t=m().$implicit;s(),I(t.employee==null?null:t.employee.employee.name)}}function Ai(n,l){if(n&1&&z(0,"app-attendance-details",11),n&2){let t=m().$implicit;p("employee",t.employee)("isSupervisor",t.isSupervisor)}}function ki(n,l){if(n&1&&(o(0,"nz-tab",8),u(1,Ni,2,1,"ng-template",null,9,P)(3,Ai,1,2,"app-attendance-details",10),a()),n&2){let t=l.$implicit,e=T(2);p("nzTitle",e),s(3),p("ngIf",t.employee)}}function Vi(n,l){n&1&&(K(0),o(1,"div",12)(2,"p"),c(3,"We need your location to provide the best experience. Please follow these steps to enable location access:"),a(),o(4,"ul")(5,"li")(6,"strong"),c(7,"Chrome:"),a(),c(8," Go to Settings > Privacy and Security > Site Settings > Location, and allow location access for this site."),a(),o(9,"li")(10,"strong"),c(11,"Firefox:"),a(),c(12," Go to Preferences > Privacy & Security > Permissions > Location, and allow location access for this site."),a(),o(13,"li")(14,"strong"),c(15,"Safari:"),a(),c(16," Go to Preferences > Websites > Location, and allow location access for this site. "),a()()(),Y())}var It=(()=>{let l=class l{constructor(e,i,r,d){this.route=e,this.router=i,this.appService=r,this.employeeManagementService=d,this.currentDate=new Date,this.supervisorUsers=[],this.currentDateAttendanceIndex=0,this.isVisible=!1}ngOnInit(){this.subOrganizationSubscription=this.appService.currentSubOrganization.subscribe(e=>{e&&e.id>0&&this.currentOrganizationId!=e.id&&(this.currentOrganizationId=e.id,this.route.paramMap.subscribe(i=>{e&&e.id>0&&i.get("userId")&&(this.currentUserId=parseInt(i.get("userId")||"0"),this.setCurrentUserDetails(e.id))}))}),this.sunscribeToGeoLocation()}handleOk(){this.isVisible=!1}sunscribeToGeoLocation(){setTimeout(()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{this.longitude=e.coords.longitude,this.latitude=e.coords.latitude},e=>{switch(console.error(`Error occurred: ${e.message}`),this.isVisible=!0,e.code){case e.PERMISSION_DENIED:alert("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:alert("Location information is unavailable.");break;case e.TIMEOUT:alert("The request to get user location timed out.");break}this.router.navigate(["employee"])}):(alert("Geolocation is not supported by this browser."),this.router.navigate(["employee"]))},2e3)}setCurrentUserDetails(e){return S(this,null,function*(){this.employee=yield this.appService.getEmployeeDetail(this.currentUserId,e),this.employee&&this.employee.id&&this.getCurrentDayAttance(this.employee.id),this.fetchSupervisorUsers()})}getCurrentDayAttance(e){return S(this,null,function*(){let i=yield this.appService.getCurrentDateAttendance(e);this.processCurentDayAttendance(i)})}processCurentDayAttendance(e){e?(this.currentDateAttendanceIndex=e.id,e.sign_in&&(this.signInTime=new Date(e.sign_in)),e.sign_out&&(this.signOutTime=new Date(e.sign_out))):this.currentDateAttendanceIndex=0}signIn(){return S(this,null,function*(){let e=yield this.appService.createAttendance({employee:this.employee.id,sign_in:new Date,sign_in_corrd:this.latitude+","+this.longitude});this.processCurentDayAttendance(e)})}signOut(){return S(this,null,function*(){let e=Math.round(this.employeeManagementService.getDifferenceInHours(this.signInTime,new Date)),r=this.employeeManagementService.calculateHourlyRate(this.employee.salary,new Date,this.employee.workingHours||8,this.employee.isSalaryHourly)*this.employeeManagementService.calculateWorkingHours(this.employee,e),d=yield this.appService.updateAttendance({id:this.currentDateAttendanceIndex,sign_out:new Date,sign_out_corrd:this.latitude+","+this.longitude,hours_worked:e,amount:r});this.processCurentDayAttendance(d)})}fetchSupervisorUsers(){return S(this,null,function*(){this.supervisorUsers=[],this.employee&&this.employee.id&&this.supervisorUsers.push({employee:this.employee,isSupervisor:!1});let e=yield this.appService.getCurrentEmployeeSubordinates(this.currentUserId);e&&e.length&&(this.supervisorUsers=[...this.supervisorUsers,...e.map(i=>({employee:i,isSupervisor:!0}))])})}generateUserData(){let e=new Date("2024-01-01"),i=new Date("2024-01-31"),r=[],d=new Date(e);for(;d<=i;)r.push({date:d}),d=new Date(d.setDate(d.getDate()+1));return r}ngOnDestroy(){this.subOrganizationSubscription&&this.subOrganizationSubscription.unsubscribe()}};l.\u0275fac=function(i){return new(i||l)(b(Ke),b(Ye),b(j),b(oe))},l.\u0275cmp=A({type:l,selectors:[["app-attendance"]],decls:7,vars:4,consts:[["class","flex center space-between",4,"ngIf"],[3,"nzTitle",4,"ngFor","ngForOf"],["nzTitle","Enable Location",3,"nzVisible","nzCancelDisabled","nzVisibleChange","nzOnOk"],[4,"nzModalContent"],[1,"flex","center","space-between"],[4,"ngIf"],["nz-button","","nzType","primary","mat-button","",3,"click",4,"ngIf"],["nz-button","","nzType","primary","mat-button","",3,"click"],[3,"nzTitle"],["titleTemplate",""],[3,"employee","isSupervisor",4,"ngIf"],[3,"employee","isSupervisor"],["id","geolocation-error-message"]],template:function(i,r){i&1&&(o(0,"h3"),c(1,"Attendance"),a(),u(2,Pi,8,8,"div",0),o(3,"nz-tabset"),u(4,ki,4,2,"nz-tab",1),a(),o(5,"nz-modal",2),D("nzVisibleChange",function(g){return E(r.isVisible,g)||(r.isVisible=g),g}),y("nzOnOk",function(){return r.handleOk()}),u(6,Vi,17,0,"ng-container",3),a()),i&2&&(s(2),p("ngIf",r.employee&&r.employee.id),s(2),p("ngForOf",r.supervisorUsers),s(),w("nzVisible",r.isVisible),p("nzCancelDisabled",!0))},dependencies:[k,V,W,H,B,it,tt,R,vt,xt,Ie,Z]});let n=l;return n})();function ji(n,l){if(n&1){let t=v();o(0,"a",6),y("click",function(){_(t);let i=m().$implicit,r=m();return h(r.open(i))}),c(1,"Pay"),a()}}function Hi(n,l){if(n&1&&(o(0,"tr")(1,"td"),c(2),a(),o(3,"td"),c(4),f(5,"currency"),a(),o(6,"td")(7,"span"),c(8),f(9,"date"),a()(),o(10,"td"),c(11),f(12,"currency"),a(),o(13,"td"),c(14),f(15,"currency"),a(),o(16,"td")(17,"span"),c(18),f(19,"currency"),a()(),o(20,"td"),u(21,ji,2,0,"a",5),a()()),n&2){let t=l.$implicit,e=m();s(2),C("",t.employee==null||t.employee.employee==null?null:t.employee.employee.name," "),s(2),C("",x(5,7,t.employee==null?null:t.employee.salary," ")," "),s(4),C("",x(9,10,t.paymentObject==null?null:t.paymentObject.minDateCreated,"dd MMM yyyy")," "),s(3),I(x(12,13,(t.paymentObject==null?null:t.paymentObject.totalAmount)||0," ")),s(3),C("",x(15,16,(t.paymentObject==null?null:t.paymentObject.balance)||0," ")," "),s(4),I(x(19,19,(t.paymentObject==null?null:t.paymentObject.advanceBalance)||0," ")),s(3),p("appHasPermission",e.appPermissions.EmployeeSalaryManagment)}}function Fi(n,l){if(n&1&&z(0,"app-attendance-details",26),n&2){let t=m(2);p("employee",t.selectedEmployee.employee)}}function Bi(n,l){if(n&1&&(o(0,"tr")(1,"td"),c(2),f(3,"date"),a(),o(4,"td"),c(5),f(6,"currency"),a(),o(7,"td"),c(8),f(9,"currency"),a(),o(10,"td"),c(11),a()()),n&2){let t=l.$implicit;s(2),C("",x(3,4,t.date_created,"dd MMM yyyy")," "),s(3),C("",x(6,7,t.amount," ")," "),s(3),C("",x(9,10,t.balance," ")," "),s(3),C("",t.payment_notes," ")}}function Wi(n,l){n&1&&c(0," Payment History ")}function Ui(n,l){n&1&&c(0," Advance History ")}function Li(n,l){if(n&1){let t=v();K(0),o(1,"h3")(2,"strong"),c(3," Employee Attendance "),a()(),u(4,Fi,1,1,"app-attendance-details",7),o(5,"nz-row",8)(6,"nz-col",9)(7,"nz-card",10)(8,"div",11)(9,"h4")(10,"b"),c(11," Payment Amount "),a()(),o(12,"div")(13,"div",12)(14,"span")(15,"b"),c(16,"Amount:"),a()(),o(17,"span"),c(18),f(19,"currency"),a()(),o(20,"b"),c(21,"Notes"),a(),o(22,"div",13)(23,"span")(24,"b"),c(25,"Balance:"),a()(),o(26,"span"),c(27),f(28,"currency"),a()(),o(29,"input",14),D("ngModelChange",function(i){_(t);let r=m();return E(r.amountPayment,i)||(r.amountPayment=i),h(i)}),a(),o(30,"textarea",14),D("ngModelChange",function(i){_(t);let r=m();return E(r.paymentNotes,i)||(r.paymentNotes=i),h(i)}),a(),o(31,"button",15),y("click",function(){_(t);let i=m();return h(i.createPayment())}),c(32," Pay"),a()()(),o(33,"nz-collapse",16)(34,"nz-collapse-panel",17),y("nzActiveChange",function(i){_(t);let r=m();return h(r.getEmployeePayments(i))}),o(35,"p",18)(36,"nz-table",0,1)(38,"thead")(39,"tr")(40,"th"),c(41,"Date"),a(),o(42,"th"),c(43,"Amount"),a(),o(44,"th"),c(45,"Balance"),a(),o(46,"th"),c(47,"Notes"),a()()(),o(48,"tbody"),u(49,Bi,12,13,"tr",2),a()()()()(),u(50,Wi,1,0,"ng-template",null,19,P),a()(),o(52,"nz-col",9)(53,"nz-card",10)(54,"div",11)(55,"h4")(56,"b"),c(57," Advance Payments "),a()(),o(58,"div",12)(59,"span"),c(60," \xA0"),a()(),o(61,"div",13)(62,"span")(63,"b"),c(64,"Balance:"),a()(),o(65,"span"),c(66),f(67,"currency"),a()(),o(68,"span")(69,"input",20),D("ngModelChange",function(i){_(t);let r=m();return E(r.amountPayment,i)||(r.amountPayment=i),h(i)}),a(),o(70,"span",21)(71,"nz-switch",22),D("ngModelChange",function(i){_(t);let r=m();return E(r.advancePayment,i)||(r.advancePayment=i),h(i)}),a(),o(72,"button",23),c(73),a()()()(),o(74,"nz-collapse",16)(75,"nz-collapse-panel",24)(76,"p",18),c(77," A dog is a type of domesticated animal. Known for its loyalty and faithfulness, it can be found as a welcome guest in many households across the world. "),a()()(),u(78,Ui,1,0,"ng-template",null,25,P),a()()(),Y()}if(n&2){let t=T(51),e=T(79),i=m();s(4),p("ngIf",i.selectedEmployee),s(2),p("nzMd",12)("nzSm",24)("nzXs",24),s(12),C(" ",x(19,26,i.selectedEmployee.paymentObject.totalAmount||0,"PKR "),""),s(9),C(" ",x(28,29,i.selectedEmployee.paymentObject.balance||0,"PKR "),""),s(2),p("disabled",i.disablePayment),w("ngModel",i.amountPayment),s(),p("disabled",i.disablePayment),w("ngModel",i.paymentNotes),s(),p("disabled",i.disablePayment),s(3),p("nzHeader",t)("nzActive",i.activeSalaryHistory),s(2),p("nzPageSize",1e3)("nzData",i.payments)("nzBordered",!0),s(13),p("ngForOf",i.payments),s(3),p("nzMd",12)("nzSm",24)("nzXs",24),s(14),C(" ",x(67,32,i.selectedEmployee.paymentObject.advanceBalance||0,"PKR "),""),s(3),w("ngModel",i.amountPayment),s(2),w("ngModel",i.advancePayment),s(2),C(" ",i.advancePayment?"Pay":"Recieve",""),s(2),p("nzHeader",e)("nzActive",i.activeAdvanceHistory)}}var Ot=(()=>{let l=class l{constructor(e,i){this.appService=e,this.employeeManagementService=i,this.isMobile=this.appService.isMobile,this.appPermissions=J,this.today=new Date,this.amountPayment=0,this.advanceAmount=0,this.paymentNotes="",this.advancePayment=!0,this.disablePayment=!1,this.payments=[],this.visible=!1}ngOnInit(){this.subOrganizationSubscription=this.appService.currentSubOrganization.subscribe(e=>{e&&e.id>0&&this.currentOrganizationId!=e.id&&(this.setEmployeePayments(e.id),this.currentOrganizationId=e.id)})}ngOnDestroy(){this.subOrganizationSubscription&&this.subOrganizationSubscription.unsubscribe}setEmployeePayments(e){return S(this,null,function*(){this.paymentData=yield this.appService.getEmployeePaymentsDetail(e)})}open(e){this.selectedEmployee=e,this.visible=!0,this.activeSalaryHistory=!1,this.activeAdvanceHistory=!1,this.amountPayment=0,this.advanceAmount=0,this.disablePayment=this.selectedEmployee?.paymentObject.minDateCreated&&this.employeeManagementService.isDateInLastOrCurrentMonth(this.selectedEmployee?.paymentObject.minDateCreated)}close(){this.visible=!1}createPayment(){return S(this,null,function*(){let e={payment_type:"salary",employee:this.selectedEmployee.employee.id,payment_notes:this.paymentNotes,amount:this.amountPayment,balance:this.selectedEmployee.paymentObject.balance+this.selectedEmployee.paymentObject.totalAmount-this.amountPayment};yield this.appService.createPayment(e),this.visible=!1,this.paymentData=yield this.appService.getEmployeePaymentsDetail()})}getEmployeePayments(e){return S(this,null,function*(){e&&(this.payments=[],this.payments=yield this.appService.getPayments(this.selectedEmployee.employee.id))})}};l.\u0275fac=function(i){return new(i||l)(b(j),b(oe))},l.\u0275cmp=A({type:l,selectors:[["app-pay-processing"]],decls:24,vars:8,consts:[["nzShowPagination","false",3,"nzPageSize","nzData","nzBordered"],["basicTable",""],[4,"ngFor","ngForOf"],["nzPlacement","right",3,"nzClosable","nzVisible","nzTitle","nzWidth","nzOnClose"],[4,"nzDrawerContent"],["nzType","primary",3,"click",4,"appHasPermission"],["nzType","primary",3,"click"],[3,"employee",4,"ngIf"],["nzGutter","4",2,"margin-top","12px"],[3,"nzMd","nzSm","nzXs"],[2,"width","100%","margin-top","12px"],[2,"width","100%","display","inline-block"],[1,"flex","space-between"],[1,"flex","space-between",2,"margin-bottom","10px"],["nz-input","",3,"disabled","ngModel","ngModelChange"],["nz-button","","nzType","primary","nzSize","small",2,"margin-top","12px","float","right",3,"disabled","click"],["nzGhost",""],[3,"nzHeader","nzActive","nzActiveChange"],[2,"margin","0"],["expandTitle",""],["nz-input","",3,"ngModel","ngModelChange"],[1,"flex","space-between",2,"width","100%","margin-top","12px","float","right"],["nzCheckedChildren","Pay","nzUnCheckedChildren","Recieve",3,"ngModel","ngModelChange"],["nz-button","","nzType","primary","nzSize","small"],[3,"nzHeader","nzActive"],["expandAdvanceTitle",""],[3,"employee"]],template:function(i,r){i&1&&(o(0,"h3"),c(1,"Employee Payments"),a(),o(2,"nz-table",0,1)(4,"thead")(5,"tr")(6,"th"),c(7,"Employee"),a(),o(8,"th"),c(9,"Salary"),a(),o(10,"th"),c(11,"Payment From"),a(),o(12,"th"),c(13,"Amount"),a(),o(14,"th"),c(15,"Balance"),a(),o(16,"th"),c(17,"Advance Balance"),a(),o(18,"th"),c(19," Proceed For Payment "),a()()(),o(20,"tbody"),u(21,Hi,22,22,"tr",2),a()(),o(22,"nz-drawer",3),y("nzOnClose",function(){return r.close()}),u(23,Li,80,35,"ng-container",4),a()),i&2&&(s(2),p("nzPageSize",1e3)("nzData",r.paymentData)("nzBordered",!0),s(19),p("ngForOf",r.paymentData),s(),p("nzClosable",!1)("nzVisible",r.visible)("nzTitle","Payment for Employee: "+(r.selectedEmployee==null||r.selectedEmployee.employee==null?null:r.selectedEmployee.employee.employee.name))("nzWidth",r.isMobile()?"100%":"50%"))},dependencies:[k,V,W,H,B,ut,ht,_t,ge,ye,Ce,fe,q,ve,ie,R,ee,ae,te,ne,U,L,Q,ze,Ie,pe,Z]});let n=l;return n})();var qi=[{path:"",component:Et,data:{name:"All Employee"}},{path:"pay-processing",component:Ot,data:{name:"Payment",permission:J.EmployeeSalaryManagment},canActivate:[nt]},{path:":employeeId",component:De,data:{name:"Employee"}},{path:":userId/attendance",component:It,data:{name:"Attendance"}}],Tt=(()=>{let l=class l{};l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=le({type:l}),l.\u0275inj=se({imports:[Ne.forChild(qi),Ne]});let n=l;return n})();var Mt=(()=>{let l=class l{constructor(e){this.sanitizer=e}transform(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)}};l.\u0275fac=function(i){return new(i||l)(b($e,16))},l.\u0275pipe=We({name:"safe",type:l,pure:!0,standalone:!0});let n=l;return n})();var Pt=Ze,Ri=Object.keys(Pt).map(n=>Pt[n]),$n=(()=>{let l=class l{};l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=le({type:l}),l.\u0275inj=se({providers:[{provide:et,useValue:Qe},{provide:Je,useValue:Ri},Se,Mt],imports:[Tt,Ge,zt,ct,st,bt]});let n=l;return n})();export{$n as EmployeeManagementModule};
