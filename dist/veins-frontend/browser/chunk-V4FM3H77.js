import{a as de}from"./chunk-NGE6N3H6.js";import{Bb as A,Ca as F,Da as f,F as C,G as N,Gc as me,J as S,K as I,Lb as R,Mc as se,N as b,Nb as L,Nc as pe,Ob as G,P as x,Pb as B,Pc as le,Qb as U,Qc as ce,Rb as J,Rc as fe,Sb as H,Ta as M,Tb as W,Ub as Z,Z as p,_ as l,_b as q,ab as E,ac as $,cc as _,db as D,dc as K,ec as Q,f as y,ga as g,ia as n,ib as P,ic as X,jb as v,jc as Y,mb as T,mc as ee,ob as V,oc as te,pb as O,pc as ie,qc as oe,ra as a,rc as re,sa as m,sc as ne,ta as c,tc as ae,wa as w,xa as z,xb as k,ya as h,yd as ue,zb as j}from"./chunk-HO7FLDMT.js";function _e(t,e){if(t&1){let u=w();a(0,"span",15),z("click",function(){S(u);let i=h();return I(i.passwordVisible=!i.passwordVisible)}),m()}if(t&2){let u=h();n("nzType",u.passwordVisible?"eye-invisible":"eye")}}function ye(t,e){t&1&&(a(0,"nz-form-item")(1,"nz-form-control",16),c(2,"nz-alert",17),m()()),t&2&&(p(),n("nzSpan",24))}var ge=(()=>{let e=class e{constructor(o,i,s,r,d){this.fb=o,this.http=i,this.platformId=s,this.router=r,this.appService=d,this.appurl=A.apiUrl,this.organization_id=0,this.showErrorMessage=!1,this.passwordVisible=!1,this.validateForm=this.fb.group({username:["",[_.required]],password:["",[_.required]],remember:[!0]}),v(this.platformId)&&(this.organization_id=parseInt(localStorage.getItem("organization_id")||""))}submitForm(){return y(this,null,function*(){this.showErrorMessage=!1;try{if(this.validateForm.valid){console.log("submit",this.validateForm.value);let o=20,i=this.validateForm.value.password||"",s=this.validateForm.value.username||"",r=yield this.http.post(`${this.appurl}/auth/login`,{organization_id:this.organization_id,username:s,password:i}).toPromise();if(v(this.platformId)&&r.access_token){localStorage.setItem("token",r.access_token),localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("permissions",JSON.stringify(r.user.role_permissions)),localStorage.setItem("client_id",JSON.stringify(r.user.client_id));let d=localStorage.getItem("redirectUrl");this.router.navigateByUrl(d||"/")}}else Object.values(this.validateForm.controls).forEach(o=>{o.invalid&&(o.markAsDirty(),o.updateValueAndValidity({onlySelf:!0}),this.showErrorMessage=!0)})}catch{this.showErrorMessage=!0}})}};e.\u0275fac=function(i){return new(i||e)(l(te),l(T),l(x),l(k),l(R))},e.\u0275cmp=C({type:e,selectors:[["app-login"]],decls:22,vars:6,consts:[[1,"app-login"],[1,"text-center","p4"],["nz-form","",1,"login-form",3,"formGroup","ngSubmit"],["nzErrorTip","Please input your username!"],["nzPrefixIcon","user"],["type","text","nz-input","","formControlName","username","placeholder","username"],["nzErrorTip","Please input your Password!"],["nzPrefixIcon","lock",3,"nzSuffix"],["nz-input","","formControlName","password","placeholder","Password",3,"type"],["suffixTemplate",""],[4,"ngIf"],["nz-row","",1,"login-form-margin"],["nz-col","",3,"nzSpan"],["nz-checkbox","","formControlName","remember"],["nz-button","",1,"login-form-button","login-form-margin",3,"nzType"],["nz-icon","",3,"nzType","click"],[3,"nzSpan"],["nzType","error","nzMessage","Incorrect credentials !"]],template:function(i,s){if(i&1&&(a(0,"div",0)(1,"h2",1),f(2," Welcome Back!"),m(),a(3,"form",2),z("ngSubmit",function(){return s.submitForm()}),a(4,"nz-form-item")(5,"nz-form-control",3)(6,"nz-input-group",4),c(7,"input",5),m()()(),a(8,"nz-form-item")(9,"nz-form-control",6)(10,"nz-input-group",7),c(11,"input",8),m(),g(12,_e,1,1,"ng-template",null,9,M),m()(),g(14,ye,3,1,"nz-form-item",10),a(15,"div",11)(16,"div",12)(17,"label",13)(18,"span"),f(19,"Remember me"),m()()()(),a(20,"button",14),f(21,"Log in"),m()()()),i&2){let r=F(13);p(3),n("formGroup",s.validateForm),p(7),n("nzSuffix",r),p(),n("type",s.passwordVisible?"text":"password"),p(3),n("ngIf",s.showErrorMessage),p(2),n("nzSpan",12),p(4),n("nzType","primary")}},dependencies:[D,X,$,K,Q,Y,ee,q,H,U,J,me,B,pe,se,ce,le,fe,re,ae,ne],styles:[".login-form[_ngcontent-%COMP%]{max-width:300px}.login-form-margin[_ngcontent-%COMP%]{margin-bottom:16px}.login-form-forgot[_ngcontent-%COMP%]{float:right}.login-form-button[_ngcontent-%COMP%]{width:100%}.app-login[_ngcontent-%COMP%]{background:#fff;padding:32px;margin:50px;border-radius:12px}"]});let t=e;return t})();var ze=[{path:"",component:ge}];E(de);var he=L,Ce=Object.keys(he).map(t=>he[t]),ot=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=N({type:e}),e.\u0275inj=b({providers:[j(ze),{provide:Z,useValue:W},{provide:G,useValue:Ce}],imports:[P,ie,V,O,oe,ue]});let t=e;return t})();export{ot as a};
