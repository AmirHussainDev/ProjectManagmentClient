import{a as Pe}from"./chunk-4QP7QYCO.js";import{f as gt,g as Ve,j as yt,k as St}from"./chunk-VP57HQK5.js";import{a as Nt,b as U,c as N}from"./chunk-JLTUEODB.js";import{$ as Je,$a as X,$b as ct,A as He,Aa as P,Ba as W,Ca as nt,Cb as kt,Cc as At,Db as Vt,Dc as Wt,Ea as Te,Eb as ot,Fa as Et,Fb as rt,Hb as Me,Ia as Ot,Ib as Pt,Jb as ne,K as i,Kb as ke,L as S,Lb as st,Mb as lt,Nb as mt,O as f,P as r,Qb as ie,R as xt,Rb as ae,Sa as it,Sb as oe,Tb as re,Ua as at,Ub as se,Va as Fe,Vb as le,Xa as wt,Y as o,Z as s,Za as Tt,_,_a as Ft,a as $e,aa as Ke,ab as $,ac as pt,ba as v,bb as ze,bc as dt,ca as h,cb as Q,da as z,db as H,dc as zt,ea as Ze,eb as J,ec as ut,fa as Ye,fb as d,fc as _t,ga as et,gb as Ie,gc as ft,ha as D,hb as K,hc as ye,ia as c,ib as Z,ic as Se,ja as I,jc as ht,ka as x,kc as Ct,la as _e,lb as Y,ma as M,mb as ee,na as k,nc as q,oa as V,ob as It,oc as Xt,pa as Ce,pb as Mt,pc as me,qa as Ne,qb as te,qc as ce,ra as Dt,rc as Lt,s as O,sa as de,sc as j,t as Qe,ta as tt,tc as B,ua as ge,uc as G,va as T,vc as pe,w as C,wb as L,wc as Rt,x as g,xb as R,yb as A}from"./chunk-6KWXZKYL.js";import{a as qt}from"./chunk-X5O7WZVH.js";import"./chunk-NFQMHT45.js";import{a as b,b as F,f as bt,g as y}from"./chunk-MON7YFGF.js";var ln=(l,m)=>[l,"contract",m];function mn(l,m){if(l&1&&(o(0,"tr")(1,"td",7)(2,"nz-list",8)(3,"nz-list-item")(4,"nz-list-item-meta")(5,"nz-list-item-meta-title")(6,"span",9)(7,"span"),c(8),s()()(),o(9,"nz-list-item-meta-description")(10,"span",9)(11,"span")(12,"a",10),c(13),s(),_(14,"nz-divider",11),o(15,"span",12),c(16),de(17,"date"),s()()()()()()()(),o(18,"td",13)(19,"span",14),c(20),s()()()),l&2){let a=m.$implicit,e=z();i(),r("width","80%"),i(7),_e("",a.contractor," - ",a.subject,""),i(4),r("routerLink",Dt(11,ln,e.site_id,a.id)),i(),x("CR-",a.id,""),i(3),x(" ",ge(17,8,a.date_created,"dd MMM yyyy"),""),i(3),r("className",a.state===e.states.Completed?"status-chip green-button":"status-chip"),i(),x(" ",e.stateNames[a.state]," ")}}var cn=l=>[l,"contract","new"],pn=()=>({tracingId:2}),jt=(()=>{let m=class m{constructor(e){this.appService=e,this.site_id=0,this.loading=!0,this.apiUrl=Nt.apiUrl,this.filterStates=Object.keys(Ve).map(t=>({text:Ve[t],value:t})),this.contracts=[],this.states=gt,this.stateNames=Ve}ngOnInit(){this.subOrgSubscription=this.appService.currentSubOrganization.subscribe(e=>{this.loadContractsDataFromServer()})}onContractsQueryParamsChange(e){console.log(e);let{pageSize:t,pageIndex:n,sort:p,filter:u}=e,w=p.find(ue=>ue.value!==null),E=w&&w.key||null,we=w&&w.value||null;this.loadContractsDataFromServer(n,t,E,we,u)}loadContractsDataFromServer(e=1,t=1e3,n="id",p="asc",u=[]){this.loading=!0;let w=new Ot().append("page",`${e}`).append("results",`${t}`).append("sortField",`${n}`).append("sortOrder",`${p}`);u.forEach(E=>{E.value.forEach(we=>{w=w.append(E.key,we)})}),this.getAndSetContracts(this.site_id,w)}getAndSetContracts(e,t){return y(this,null,function*(){this.contracts=yield this.appService.retireveContracts(e,t),this.loading=!1})}ngOnDestroy(){this.subOrgSubscription&&this.subOrgSubscription.unsubscribe()}};m.\u0275fac=function(t){return new(t||m)(S(N))},m.\u0275cmp=O({type:m,selectors:[["app-site-contractors"]],inputs:{site_id:"site_id"},decls:10,vars:11,consts:[[1,"contract-container"],[1,"flex","space-between",2,"margin-bottom","5px"],[3,"routerLink","state"],["nz-button","","nzType","primary",3,"nzSize"],["nz-icon","","nzType","plus"],[3,"nzShowPagination","nzData","nzFrontPagination","nzLoading","nzQueryParams"],[4,"ngFor","ngForOf"],[3,"width"],["nzItemLayout","horizontal"],[1,"flex","space-between"],["href","",3,"routerLink"],["nzType","vertical"],[1,"dateDisplay"],[2,"text-align","end"],["nz-button","",3,"className"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),c(3,"Contracts"),s(),o(4,"a",2)(5,"button",3),_(6,"span",4),s()()(),o(7,"nz-table",5),h("nzQueryParams",function(u){return n.onContractsQueryParamsChange(u)}),o(8,"tbody"),f(9,mn,21,14,"tr",6),s()()()),t&2&&(i(4),r("routerLink",Ne(8,cn,n.site_id))("state",Ce(10,pn)),i(),r("nzSize","small"),i(2),r("nzShowPagination",!1)("nzData",n.contracts)("nzFrontPagination",!1)("nzLoading",n.loading),i(2),r("ngForOf",n.contracts))},dependencies:[P,Fe,A,L,R,X,mt,zt,ut,dt,ct,pt,B,q,j,G,nt],styles:[".ant-table-wrapper[_ngcontent-%COMP%]{margin:0!important}.contract-container[_ngcontent-%COMP%]{padding:12px;border-radius:12px;background:#0000001a}"]});let l=m;return l})();function zn(l,m){if(l&1&&_(0,"app-site-contractors",19),l&2){let a=z().$implicit;r("site_id",a.id)}}function un(l,m){if(l&1){let a=v();o(0,"span",22),h("click",function(){C(a);let t=z(2).$implicit,n=z();return g(n.onExpandChange(t.id,!0))}),s()}}function _n(l,m){if(l&1){let a=v();o(0,"span",23),h("click",function(){C(a);let t=z(2).$implicit,n=z();return g(n.onExpandChange(t.id,!1))}),s()}l&2&&r("nzRotate",90)}function fn(l,m){if(l&1&&f(0,un,1,0,"span",20)(1,_n,1,1,"span",21),l&2){let a=z().$implicit,e=z();r("ngIf",!e.expandSet.has(a.id)),i(),r("ngIf",e.expandSet.has(a.id))}}var hn=l=>[l];function Cn(l,m){if(l&1){let a=v();Je(0),o(1,"tr")(2,"td",8),h("nzExpandChange",function(t){let p=C(a).$implicit,u=z();return g(u.onExpandChange(p.id,t))}),s(),o(3,"td")(4,"nz-list",9)(5,"nz-list-item")(6,"nz-list-item-meta")(7,"nz-list-item-meta-title")(8,"span",10)(9,"span"),c(10),s(),o(11,"span"),c(12),de(13,"currency"),s()()(),o(14,"nz-list-item-meta-description")(15,"span",10)(16,"span")(17,"a",11),c(18),s(),_(19,"nz-divider",12),o(20,"span",13),c(21),de(22,"date"),s()()()()()()()(),o(23,"td",14)(24,"button",15),c(25),s()()(),o(26,"tr",16),f(27,zn,1,1,"app-site-contractors",17),s(),f(28,fn,2,2,"ng-template",null,18,T),Ke()}if(l&2){let a=m.$implicit,e=D(29),t=z();i(),xt("expanded",t.expandSet.has(a.id)),i(),r("nzExpandIcon",e)("nzExpand",t.expandSet.has(a.id)),i(8),_e("",a.name," - ",a.subject,""),i(2),I(ge(13,18,a.amount,"PKR")),i(5),r("routerLink",Ne(24,hn,a.id)),i(),x("Site-",a.id,""),i(3),x(" ",ge(22,21,a.date_created,"dd MMM yyyy"),""),i(3),r("className",a.state===t.siteStates.Completed?"green-button":"default")("nzDanger",a.state===t.siteStates.Cancelled)("nzSize","small"),i(),x(" ",t.siteStateNames[a.state]," "),i(),xt("expanded",t.expandSet.has(a.id)),r("nzExpand",t.expandSet.has(a.id)),i(),r("ngIf",t.expandSet.has(a.id))}}var gn=()=>["./","new"],yn=()=>({tracingId:2}),Bt=(()=>{let m=class m{onExpandChange(e,t){t?this.expandSet.add(e):this.expandSet.delete(e)}constructor(e){this.appService=e,this.siteStates=yt,this.siteStateNames=St,this.expandSet=new Set,this.listOfColumn=[{title:"id"},{title:"Name"}],this.visible=!1}ngOnInit(){this.subOrgSubscription=this.appService.currentSubOrganization.subscribe(e=>{this.populateSiteData()})}ngOnDestroy(){this.subOrgSubscription&&this.subOrgSubscription.unsubscribe()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateSiteData()}populateSiteData(){return y(this,null,function*(){this.sites=yield this.appService.getSites()})}};m.\u0275fac=function(t){return new(t||m)(S(N))},m.\u0275cmp=O({type:m,selectors:[["app-sites"]],decls:14,vars:10,consts:[[3,"routerLink","state"],["nz-button","","nzType","primary",3,"nzSize"],["nz-icon","","nzType","plus"],[3,"nzShowPagination","nzData","nzFrontPagination"],["nzWidth","60px"],["nzColumnKey","name","nzWidth","80%",3,"nzSortFn"],["nzColumnKey","gender"],[4,"ngFor","ngForOf"],[3,"nzExpandIcon","nzExpand","nzExpandChange"],["nzItemLayout","horizontal"],[1,"flex","space-between"],["href","",3,"routerLink"],["nzType","vertical"],[1,"dateDisplay"],[2,"text-align","end"],["nz-button","","nzType","primary","nzShape","round",3,"className","nzDanger","nzSize"],[1,"expanded-table",3,"nzExpand"],[3,"site_id",4,"ngIf"],["expandIcon",""],[3,"site_id"],["nz-icon","","nzType","double-right","nzTheme","outline","style","font-size: 16px; color: #08c;",3,"click",4,"ngIf"],["nz-icon","","nzType","double-right","nzTheme","outline","style","font-size: 16px; color: #08c;",3,"nzRotate","click",4,"ngIf"],["nz-icon","","nzType","double-right","nzTheme","outline",2,"font-size","16px","color","#08c",3,"click"],["nz-icon","","nzType","double-right","nzTheme","outline",2,"font-size","16px","color","#08c",3,"nzRotate","click"]],template:function(t,n){t&1&&(o(0,"a",0)(1,"button",1),_(2,"span",2),c(3," New Site "),s()(),o(4,"nz-table",3)(5,"thead")(6,"tr"),_(7,"th",4),o(8,"th",5),c(9,"Site"),s(),o(10,"th",6),c(11,"Status"),s()()(),o(12,"tbody"),f(13,Cn,30,26,"ng-container",7),s()()),t&2&&(r("routerLink",Ce(8,gn))("state",Ce(9,yn)),i(),r("nzSize","small"),i(3),r("nzShowPagination",!1)("nzData",n.sites)("nzFrontPagination",!1),i(4),r("nzSortFn",!0),i(5),r("ngForOf",n.sites))},dependencies:[P,W,Fe,A,L,R,X,mt,zt,ut,dt,ct,pt,B,me,q,ce,Xt,pe,j,G,Rt,Lt,jt,Te,nt],styles:[".expanded-table[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{background:transparent!important}  .expanded{background:#ffffffb8}"]});let l=m;return l})();var Ht=bt(qt());function Sn(l,m){if(l&1&&(o(0,"nz-col",12)(1,"nz-form-item")(2,"nz-form-label",20),c(3,"No of units worked"),s(),o(4,"nz-form-control",14),c(5),s()()()),l&2){let a=z(2),e;r("nzMd",10)("nzSm",16)("nzXs",16),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(),x(" ",(e=a.addContractorWorkLogForm.get("no_of_units"))==null?null:e.value," ")}}var vn=()=>({standalone:!0});function xn(l,m){if(l&1){let a=v();o(0,"nz-card",9)(1,"form",10),h("ngSubmit",function(){C(a);let t=z();return g(t.handleOk())}),o(2,"nz-row",11)(3,"nz-col",12)(4,"nz-form-item")(5,"nz-form-label",13),c(6,"From"),s(),o(7,"nz-form-control",14)(8,"nz-range-picker",15),V("ngModelChange",function(t){C(a);let n=z();return k(n.date,t)||(n.date=t),g(t)}),h("ngModelChange",function(t){C(a);let n=z();return g(n.onChange(t))}),s()()()(),f(9,Sn,6,9,"nz-col",16),s(),o(10,"nz-row",11)(11,"nz-col",12)(12,"nz-form-item")(13,"nz-form-label",17),c(14,"WorkLog Notes"),s(),o(15,"nz-form-control",18),_(16,"textarea",19),s()()()()()()}if(l&2){let a=z();i(),r("formGroup",a.addContractorWorkLogForm),i(2),r("nzMd",10)("nzSm",24)("nzXs",24),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(),r("ngModelOptions",Ce(20,vn)),M("ngModel",a.date),i(),r("ngIf",a.contractDetails.contract_type=="1"),i(2),r("nzMd",24)("nzSm",24)("nzXs",24),i(2),r("nzMd",8)("nzSm",24)("nzXs",24),i(2),r("nzSm",14)("nzXs",24)}}function wn(l,m){if(l&1){let a=v();o(0,"div",21),_(1,"input",22,23),o(3,"a",24),h("click",function(){C(a);let t=D(2),n=z();return g(n.addItem(t))}),_(4,"span",25),c(5," Add item "),s()()}}function bn(l,m){if(l&1&&(o(0,"th",26),c(1),s()),l&2){let a=m.$implicit;r("nzSortFn",a.compare)("nzSortPriority",a.priority),i(),x(" ",a.title," ")}}function Dn(l,m){if(l&1&&(o(0,"tr")(1,"td"),c(2),s(),o(3,"td"),c(4),s(),o(5,"td"),c(6),s()()),l&2){let a=m.$implicit;i(2),x(" ",a.note,""),i(2),I(a.amount),i(2),x(" ",a.no_of_units," ")}}var Ut=(()=>{let m=class m{constructor(e,t,n){this.appService=e,this.userService=t,this.fb=n,this.vendorItems=[],this.listOfColumn=[{title:"Note",compare:(p,u)=>p.note.localeCompare(u.note),priority:!1},{title:"Amount",compare:(p,u)=>p.amount-u.amount,priority:2},{title:"No Of Units",compare:(p,u)=>(p.no_of_units?1:0)-(u.no_of_units?1:0),priority:2}],this.listOfData=[],this.visible=!1,this.isVisible=!1,this.isOkLoading=!1,this.index=0,this.editCache={}}showModal(){this.isVisible=!0}handleOk(){return y(this,null,function*(){try{this.isOkLoading=!0,yield this.addContractorWorkLog(),this.isVisible=!1,this.addContractorWorkLogForm.reset()}catch{}finally{this.isOkLoading=!1,this.populateContractorWorkLogData()}})}addContractorWorkLog(){return y(this,null,function*(){this.subOrganizations=yield this.appService.saveSiteContractorWorkLog(F(b({},this.addContractorWorkLogForm.getRawValue()),{site:this.site_id}))})}handleCancel(){this.isVisible=!1}ngOnInit(){this.addContractorWorkLogForm=new J({id:new d(0),amount:new d(0,[ze.required]),note:new d,work_from:new d(new Date),work_to:new d(new Date),no_of_units:new d(0),contract:new d(this.contractDetails.id),site:new d(this.site_id)}),this.populateContractorWorkLogData()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateContractorWorkLogData()}populateContractorWorkLogData(){return y(this,null,function*(){this.listOfData=yield this.appService.retrieveSiteContractWorkLogBySiteId(this.site_id,this.contractDetails.id),this.updateEditCache()})}addItem(e){let t=e.value;this.vendorItems.some(n=>!t||n.name===t.trim())||(this.vendorItems=[...this.vendorItems,{name:e.value,isCustom:!0}],e.value="")}onChange(e){if(e&&e.length>1){let t=this.getNumberOfDays(e[0],e[1],this.contractDetails.includeWeekends);this.addContractorWorkLogForm.patchValue({work_from:e[0],work_to:e[1],no_of_units:t,amount:t*this.contractDetails.amount_per_day})}}getNumberOfDays(e,t,n=!1){let p=new Date(e),u=Math.ceil((t.getTime()-e.getTime())/(1e3*3600*24)),w=0;for(let E=0;E<=u;E++){if(!n&&(p.getDay()===0||p.getDay()===6)){p.setDate(p.getDate()+1);continue}w++,p.setDate(p.getDate()+1)}return w}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e]={data:b({},this.listOfData[t]),edit:!1}}saveEdit(e){return y(this,null,function*(){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e].edit=!1,Object.assign(this.listOfData[t],this.editCache[e].data),this.populateContractorWorkLogData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:b({},e)}})}};m.\u0275fac=function(t){return new(t||m)(S(N),S(U),S(ee))},m.\u0275cmp=O({type:m,selectors:[["app-work-log"]],inputs:{contractDetails:"contractDetails",site_id:"site_id"},decls:18,vars:6,consts:[[1,"flex","center","space-between"],["nz-button","","nzType","primary",3,"click"],["nzTitle","Add Work Log",3,"nzVisible","nzOkDisabled","nzOkLoading","nzVisibleChange","nzOnCancel","nzOnOk"],["style","width:100%",4,"nzModalContent"],["renderTemplate",""],["nzShowPagination","false","nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[2,"width","100%"],["nz-form","",3,"formGroup","ngSubmit"],["nzGutter","2",2,"margin-bottom","12px"],[3,"nzMd","nzSm","nzXs"],["nzRequired","","nzFor","from",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",3,"nzSm","nzXs"],[3,"ngModelOptions","ngModel","ngModelChange"],[3,"nzMd","nzSm","nzXs",4,"ngIf"],["nzRequired","","nzFor","name",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",1,"flex","space-between","center",3,"nzSm","nzXs"],["nz-input","","formControlName","note",1,"control","inputField"],["nzRequired","","nzFor","no_of_units",3,"nzMd","nzSm","nzXs"],[1,"container"],["type","text","nz-input",""],["inputElement",""],[1,"add-item",3,"click"],["nz-icon","","nzType","plus"],[3,"nzSortFn","nzSortPriority"]],template:function(t,n){if(t&1&&(o(0,"div",0)(1,"h3"),c(2,"Work Log"),s(),o(3,"button",1),h("click",function(){return n.showModal()}),o(4,"span"),c(5,"Add Work Log"),s()()(),o(6,"nz-modal",2),V("nzVisibleChange",function(u){return k(n.isVisible,u)||(n.isVisible=u),u}),h("nzOnCancel",function(){return n.handleCancel()})("nzOnOk",function(){return n.handleOk()}),f(7,xn,17,21,"nz-card",3),s(),f(8,wn,6,0,"ng-template",null,4,T),o(10,"nz-table",5,6)(13,"thead")(14,"tr"),f(15,bn,2,3,"th",7),s()(),o(16,"tbody"),f(17,Dn,7,3,"tr",8),s()()),t&2){let p=D(12);i(6),M("nzVisible",n.isVisible),r("nzOkDisabled",n.addContractorWorkLogForm.invalid)("nzOkLoading",n.isOkLoading),i(4),r("nzData",n.listOfData),i(5),r("ngForOf",n.listOfColumn),i(2),r("ngForOf",p.data)}},dependencies:[P,W,A,L,R,ne,X,Me,Pt,ae,ie,re,oe,le,se,te,Se,ye,B,me,q,ce,pe,j,G,K,$,Q,H,Z,Y,Ie]});let l=m;return l})();function On(l,m){l&1&&(o(0,"nz-col",13)(1,"nz-form-item")(2,"nz-form-label",17),c(3,"Amount "),s(),o(4,"nz-form-control",18),_(5,"input",19),s()()()),l&2&&(r("nzMd",10)("nzSm",16)("nzXs",16),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24))}function Nn(l,m){if(l&1){let a=v();o(0,"nz-card",9)(1,"form",10),h("ngSubmit",function(){C(a);let t=z();return g(t.handleOk())}),o(2,"nz-row",11),f(3,On,6,8,"nz-col",12),s(),o(4,"nz-row",11)(5,"nz-col",13)(6,"nz-form-item")(7,"nz-form-label",14),c(8,"Payment Notes"),s(),o(9,"nz-form-control",15),_(10,"textarea",16),s()()()()()()}if(l&2){let a=z();i(),r("formGroup",a.addContractorPaymentForm),i(2),r("ngIf",a.contractDetails.contract_type=="1"),i(2),r("nzMd",24)("nzSm",24)("nzXs",24),i(2),r("nzMd",8)("nzSm",24)("nzXs",24),i(2),r("nzSm",14)("nzXs",24)}}function Tn(l,m){if(l&1){let a=v();o(0,"div",20),_(1,"input",21,22),o(3,"a",23),h("click",function(){C(a);let t=D(2),n=z();return g(n.addItem(t))}),_(4,"span",24),c(5," Add item "),s()()}}function Fn(l,m){if(l&1&&(o(0,"th",25),c(1),s()),l&2){let a=m.$implicit;r("nzSortFn",a.compare)("nzSortPriority",a.priority),i(),x(" ",a.title," ")}}function In(l,m){if(l&1&&(o(0,"tr")(1,"td"),c(2),s(),o(3,"td"),c(4),s()()),l&2){let a=m.$implicit;i(2),x(" ",a.note,""),i(2),I(a.amount)}}var $t=(()=>{let m=class m{constructor(e,t,n){this.appService=e,this.userService=t,this.fb=n,this.vendorItems=[],this.listOfColumn=[{title:"Note",compare:(p,u)=>p.note.localeCompare(u.note),priority:!1},{title:"Amount",compare:(p,u)=>p.amount-u.amount,priority:2}],this.listOfData=[],this.visible=!1,this.isVisible=!1,this.isOkLoading=!1,this.index=0,this.editCache={}}showModal(){this.isVisible=!0}handleOk(){return y(this,null,function*(){try{this.isOkLoading=!0,yield this.addContractorPayment(),this.isVisible=!1,this.addContractorPaymentForm.reset()}catch{}finally{this.isOkLoading=!1,this.populateContractorPaymentData()}})}addContractorPayment(){return y(this,null,function*(){this.subOrganizations=yield this.appService.saveSiteContractorPayment(F(b({},this.addContractorPaymentForm.getRawValue()),{site:this.site_id}))})}handleCancel(){this.isVisible=!1}ngOnInit(){this.addContractorPaymentForm=new J({id:new d(0),amount:new d(0,[ze.required]),note:new d,contract:new d(this.contractDetails.id),site:new d(this.site_id)}),this.populateContractorPaymentData()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateContractorPaymentData()}populateContractorPaymentData(){return y(this,null,function*(){this.listOfData=yield this.appService.retrieveSiteContractPaymentBySiteId(this.site_id,this.contractDetails.id),this.updateEditCache()})}addItem(e){let t=e.value;this.vendorItems.some(n=>!t||n.name===t.trim())||(this.vendorItems=[...this.vendorItems,{name:e.value,isCustom:!0}],e.value="")}getNumberOfDays(e,t,n=!1){let p=new Date(e),u=Math.ceil((t.getTime()-e.getTime())/(1e3*3600*24)),w=0;for(let E=0;E<=u;E++){if(!n&&(p.getDay()===0||p.getDay()===6)){p.setDate(p.getDate()+1);continue}w++,p.setDate(p.getDate()+1)}return w}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e]={data:b({},this.listOfData[t]),edit:!1}}saveEdit(e){return y(this,null,function*(){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e].edit=!1,Object.assign(this.listOfData[t],this.editCache[e].data),this.populateContractorPaymentData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:b({},e)}})}};m.\u0275fac=function(t){return new(t||m)(S(N),S(U),S(ee))},m.\u0275cmp=O({type:m,selectors:[["app-contract-payment"]],inputs:{contractDetails:"contractDetails",site_id:"site_id"},decls:18,vars:6,consts:[[1,"flex","center","space-between"],["nz-button","","nzType","primary",3,"click"],["nzTitle","Add Contractor Payment",3,"nzVisible","nzOkDisabled","nzOkLoading","nzVisibleChange","nzOnCancel","nzOnOk"],["style","width:100%",4,"nzModalContent"],["renderTemplate",""],["nzShowPagination","false","nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[2,"width","100%"],["nz-form","",3,"formGroup","ngSubmit"],["nzGutter","2",2,"margin-bottom","12px"],[3,"nzMd","nzSm","nzXs",4,"ngIf"],[3,"nzMd","nzSm","nzXs"],["nzRequired","","nzFor","name",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",1,"flex","space-between","center",3,"nzSm","nzXs"],["nz-input","","formControlName","note",1,"control","inputField"],["nzRequired","","nzFor","amount",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",3,"nzSm","nzXs"],["nz-input","","formControlName","amount"],[1,"container"],["type","text","nz-input",""],["inputElement",""],[1,"add-item",3,"click"],["nz-icon","","nzType","plus"],[3,"nzSortFn","nzSortPriority"]],template:function(t,n){if(t&1&&(o(0,"div",0)(1,"h3"),c(2,"Payments"),s(),o(3,"button",1),h("click",function(){return n.showModal()}),o(4,"span"),c(5,"Add Payment"),s()()(),o(6,"nz-modal",2),V("nzVisibleChange",function(u){return k(n.isVisible,u)||(n.isVisible=u),u}),h("nzOnCancel",function(){return n.handleCancel()})("nzOnOk",function(){return n.handleOk()}),f(7,Nn,11,10,"nz-card",3),s(),f(8,Tn,6,0,"ng-template",null,4,T),o(10,"nz-table",5,6)(13,"thead")(14,"tr"),f(15,Fn,2,3,"th",7),s()(),o(16,"tbody"),f(17,In,5,2,"tr",8),s()()),t&2){let p=D(12);i(6),M("nzVisible",n.isVisible),r("nzOkDisabled",n.addContractorPaymentForm.invalid)("nzOkLoading",n.isOkLoading),i(4),r("nzData",n.listOfData),i(5),r("ngForOf",n.listOfColumn),i(2),r("ngForOf",p.data)}},dependencies:[P,W,A,L,R,ne,X,ae,ie,re,oe,le,se,te,Se,ye,B,me,q,ce,pe,j,G,K,$,Q,H,Z,Y]});let l=m;return l})();var Ln=["content"];function Rn(l,m){if(l&1){let a=v();o(0,"div",39)(1,"span")(2,"h4"),c(3),s()(),o(4,"span")(5,"button",40),h("click",function(){C(a);let t=z();return g(t.generatePDF())}),_(6,"span",41),s(),o(7,"button",42),_(8,"span",43),s()()()}if(l&2){let a=z(),e;i(3),_e(" Contract - ",((e=a.contractDetails.get("id"))==null?null:e.value)||"New"," / ",a.stateNames[(e=a.contractDetails.get("state"))==null?null:e.value]," ")}}function An(l,m){if(l&1&&_(0,"nz-option",44),l&2){let a=m.$implicit;r("nzValue",a==null?null:a.id)("nzLabel",a==null?null:a.name)}}var Wn=()=>({authorization:"authorization-text"});function qn(l,m){if(l&1){let a=v();o(0,"nz-card",45)(1,"nz-form-item")(2,"nz-form-label",46),c(3,"Terms & Conditions"),s(),o(4,"nz-form-control",47),_(5,"textarea",48),s()(),o(6,"nz-form-item")(7,"nz-form-label",49),c(8,"Attachments"),s(),o(9,"nz-form-control",50)(10,"nz-upload",51),h("nzChange",function(t){C(a);let n=z();return g(n.handleChange(t))}),o(11,"button",52),_(12,"span",53),c(13," Click to Upload "),s()()()()()}l&2&&(i(4),r("nzMd",8)("nzSm",24)("nzXs",12)("nzMd",24)("nzXl",24)("nzXXl",24),i(5),r("nzMd",8)("nzSm",24)("nzXs",12)("nzMd",24)("nzXl",24)("nzXXl",24),i(),r("nzHeaders",Ce(13,Wn)))}function jn(l,m){if(l&1){let a=v();o(0,"button",54),h("click",function(){C(a);let t=z();return g(t.cancelPaymentDetails())}),c(1,"Cancel"),s()}}function Bn(l,m){if(l&1){let a=v();o(0,"button",55),h("click",function(){C(a);let t=z();return g(t.submitRequest())}),c(1,"Submit"),s()}}function Gn(l,m){if(l&1){let a=v();o(0,"button",55),h("click",function(){C(a);let t=z();return g(t.confirmInvoiceDetails())}),c(1,"Confirm Contract"),s()}}function Un(l,m){if(l&1&&(c(0),_(1,"span",56)),l&2){let a=m.$implicit;z();let e=D(4);x(" ",a," "),i(),r("nzRotate",e.nzActive?90:-90)}}function $n(l,m){if(l&1&&(o(0,"div",57)(1,"nz-row",58)(2,"nz-col",9)(3,"nz-card",5),_(4,"app-work-log",59),s()(),o(5,"nz-col",9)(6,"nz-card",5),_(7,"app-contract-payment",59),s()()()()),l&2){let a=z();i(2),r("nzMd",12)("nzSm",24)("nzXs",24),i(2),r("site_id",a.site_id)("contractDetails",a.contractDetails.getRawValue()),i(),r("nzMd",12)("nzSm",24)("nzXs",24),i(2),r("site_id",a.site_id)("contractDetails",a.contractDetails.getRawValue())}}var Jt=(()=>{let m=class m{constructor(e,t,n,p,u,w,E,we){this.appService=e,this.route=t,this.userService=n,this.fb=p,this.notification=u,this.router=w,this.msg=E,this.modal=we,this.isActive=!1,this.vendors=[],this.vendorItems=[],this.discountTotal=0,this.contractTotal=0,this.loading=!1,this.contractStates=gt,this.stateNames=Ve,this.site_id=0,this.listOfData=[],this.defaultItemValues={id:0,name:"",qty:0,contract_id:0,discount:0,total:0,date_created:new Date,isCustom:!1,unit_price:0},this.contractDetails=new J({id:new d,contractor:new d,subject:new d,contract_type:new d,state:new d(this.contractStates.Draft),with_material:new d(0),payment_schedule:new d(0),amount_per_schedule:new d(0),amount_per_day:new d(0),created_by:new d(0),site:new d(0),total:new d(0),organization:new d(0),subOrganization:new d(0),contract_start_date:new d(new Date),contract_end_date:new d(new Date),attachment:new d,terms:new d("")}),this.beforeUpload=(ue,on)=>new $e(he=>{let Le=ue.type==="image/jpeg"||ue.type==="image/png";if(!Le){this.msg.error("You can only upload JPG file!"),he.complete();return}let Re=ue.size/1024/1024<2;if(!Re){this.msg.error("Image must smaller than 2MB!"),he.complete();return}this.contractDetails.patchValue({attachment:ue}),he.next(Le&&Re),he.complete()}),this.contractDetails=this.fb.group({id:new d,contractor:new d,subject:new d,contract_type:new d,state:new d(this.contractStates.Draft),with_material:new d(0),payment_schedule:new d(0),amount_per_schedule:new d(0),amount_per_day:new d(0),created_by:new d(0),site:new d(0),total:new d(0),organization:new d(0),subOrganization:new d(0),contract_start_date:new d(new Date),contract_end_date:new d(new Date),attachment:new d,terms:new d("")})}submitForm(){}ngOnInit(){this.loadAndUsers(),this.setSitesData(),this.route.paramMap.subscribe(e=>{e.get("contractId")||(this.contractDetails.reset({state:this.contractStates.Draft,id:0}),this.contractDetails.enable(),this.contractDetails.updateValueAndValidity()),this.site_id=parseInt(e.get("siteId")?.toString()||"0"),this.contractDetails.controls.id.setValue(e.get("contractId")!=="new"?e.get("contractId"):0),this.contractDetails.controls.site.setValue(e.get("siteId")||0),this.setContractRequestDetails()})}setSitesData(){return y(this,null,function*(){let e=yield this.appService.getAndSetSites(),t=e&&e.length?e.map(n=>b({label:n.name},n)):[];this.sites=[...t]})}setContractRequestDetails(){return y(this,null,function*(){this.loading=!0,this.contractDetails.controls.id.value?yield this.getExistingContract():(this.contractDetails.controls.organization.setValue(parseInt(localStorage.getItem("organization_id")||"")),this.currentSubOrganizationSubscription=this.appService.currentSubOrganization.subscribe(e=>{this.contractDetails.controls.subOrganization.setValue(e.id)}),this.contractDetails.controls.created_by.setValue(this.userService.loggedInUser.id)),this.disableAndEnableSpecificControls(),this.loading=!1})}getExistingContract(){return y(this,null,function*(){let e=yield this.appService.retireveContractById(this.contractDetails.controls.site.value,this.contractDetails.controls.id.value);e&&this.contractDetails.patchValue({id:e.id,subject:e.subject,state:e.state,created_by:e.created_by,total:e.total,organization:e.organization_id,subOrganization:e.sub_organization_id,contractor:e.contractor,contract_type:e.contract_type,with_material:e.with_material,payment_schedule:e.payment_schedule,amount_per_schedule:e.amount_per_schedule,amount_per_day:e.amount_per_day,site:e.site_id,contract_start_date:e.contract_start_date,contract_end_date:e.contract_end_date,attachment:e.attachment,terms:e.terms}),this.previousContractDetails=this.contractDetails.getRawValue()})}loadAndUsers(){return y(this,null,function*(){this.listOfData=yield this.userService.getOrganizationUsers()})}submitRequest(){return y(this,null,function*(){let e=yield this.appService.createContract(F(b({},this.contractDetails.value),{state:this.contractStates.PendingApproval}));e&&this.notification.create("success","Contract Order - "+e.id,"Contract order submitted successfly. Please check for invoice and update later").onClose.subscribe(t=>{this.router.navigate(["/"])})})}cancelPaymentDetails(){return y(this,null,function*(){})}confirmInvoiceDetails(){return y(this,null,function*(){let e=this.appService.findObjectDifferences(this.previousContractDetails,this.contractDetails.getRawValue());console.log(e);let t=b({id:this.previousContractDetails.id},e);(yield this.appService.updateContractRequest(F(b({},t),{state:this.contractStates.Completed})))&&this.notification.create("success","Contract Order - "+this.previousContractDetails.id,"Contract order invoice submitted successfly. Please proceed next for payment details").onClose.subscribe(p=>{this.router.navigate(["/"])})})}printCard(){let e=this.content.nativeElement.innerHTML,t=window.open("","_blank","top=0,left=0,height=100%,width=auto");t&&(t.document.open(),t.document.write(`
      <html>
        <head>
          <title>Print</title>
          <style>
            /* Define print styles here */
          </style>
        </head>
        <body onload="window.print();window.close()">
          ${e}
        </body>
      </html>
    `),t.print())}generatePDF(){let e=this.content.nativeElement;(0,Ht.default)(e).then(t=>{let n=t.toDataURL("image/png")})}disableAndEnableSpecificControls(){let e=this.contractDetails.get("state");e&&e.value!==this.contractStates.Draft&&(console.log(this.contractDetails),Object.keys(this.contractDetails.controls).forEach(t=>{let n=this.contractDetails.get(t);n&&(t!=="attachment"&&t!=="terms"&&e.value===this.contractStates.PendingApproval||e.value===this.contractStates.Completed)&&n.disable()}),console.log(this.contractDetails),this.contractDetails.updateValueAndValidity())}getBase64(e,t){let n=new FileReader;n.addEventListener("load",()=>t(n.result.toString())),n.readAsDataURL(e)}handleChange(e){this.getBase64(e.file.originFileObj,t=>{this.loading=!1})}};m.\u0275fac=function(t){return new(t||m)(S(N),S(it),S(U),S(ee),S(ht),S(at),S(_t),S(ft))},m.\u0275cmp=O({type:m,selectors:[["app-site-contract"]],viewQuery:function(t,n){if(t&1&&Ze(Ln,5),t&2){let p;Ye(p=et())&&(n.content=p.first)}},decls:80,vars:74,consts:[["renderHome",""],["nzAccordion",""],["nzExpandedIcon","double-right",3,"nzHeader","nzActive","nzDisabled"],["p",""],["id","print-section",1,"purchase-request"],[2,"width","100%"],["nz-form","",3,"formGroup","ngSubmit"],["content",""],["nzGutter","2",2,"margin-bottom","12px"],[3,"nzMd","nzSm","nzXs"],["nzRequired","","nzFor","contract_type",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",3,"nzSm","nzXs"],["zShowSearch","","nzAllowClear","","nzPlaceHolder","Select a person","formControlName","contract_type",1,"control","inputField"],["nzLabel","Duration Based","nzValue","1"],["nzLabel","Measurement Based","nzValue","2"],["nzRequired","","nzFor","with_material"],["nzErrorTip","The input is not valid date!"],["nz-checkbox","","formControlName","with_material"],["nzRequired","","nzFor","contractor",3,"nzMd","nzSm","nzXs"],["d","contractor","formControlName","contractor","placeholder","Select user",1,"control","inputField"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzRequired","","nzFor","contract_start_date",3,"nzMd","nzSm","nzXs"],["formControlName","contract_start_date",1,"control","inputField"],["nzRequired","","nzFor","contract_end_date",3,"nzMd","nzSm","nzXs"],["formControlName","contract_end_date",1,"control","inputField"],["nzRequired","","nzFor","payment_schedule",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","payment_schedule",1,"control","inputField"],["nzRequired","","nzFor","subject",3,"nzMd","nzSm","nzXs"],["z-input","","formControlName","subject",1,"control","inputField"],["nzRequired","","nzFor","amount_per_schedule",3,"nzMd","nzSm","nzXs"],["z-input","","formControlName","amount_per_schedule",1,"control","inputField"],["nzRequired","","nzFor","amount_per_day",3,"nzMd","nzSm","nzXs"],["z-input","","formControlName","amount_per_day",1,"control","inputField"],["style","width:100%;margin-bottom: 12px;",4,"ngIf"],[1,"flex","space-between"],["nz-button","","nzType","primary","nzDanger","","style","margin-bottom: 12px;float: right;",3,"click",4,"ngIf"],["nz-button","","nzType","primary","style","margin-bottom: 12px;float: right;",3,"click",4,"ngIf"],["expandedIcon",""],["style","margin-top: 12px;",4,"ngIf"],[1,"detailBar-collapsible"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","download"],["nz-button","","nzType","primary","printSectionId","print-section","ngxPrint","","printTitle","MyTitle",2,"margin-left","12px"],["nz-icon","","nzType","printer","nzTheme","outline"],[3,"nzValue","nzLabel"],[2,"width","100%","margin-bottom","12px"],["nzFor","terms"],["nzErrorTip","",3,"nzMd","nzSm","nzXs","nzXl","nzXXl"],["nz-input","","formControlName","terms","placeholder","textarea with clear icon"],["nzRequired","","nzFor","contract_start_date"],["nzErrorTip","The input is not valid date!",3,"nzMd","nzSm","nzXs","nzXl","nzXXl"],["nzAction","https://www.mocky.io/v2/5cc8019d300000980a055e76",3,"nzHeaders","nzChange"],["nz-button",""],["nz-icon","","nzType","upload"],["nz-button","","nzType","primary","nzDanger","",2,"margin-bottom","12px","float","right",3,"click"],["nz-button","","nzType","primary",2,"margin-bottom","12px","float","right",3,"click"],["nz-icon","","nzType","caret-right",1,"ant-collapse-arrow",3,"nzRotate"],[2,"margin-top","12px"],["nzGutter","4",2,"margin-bottom","12px"],[3,"site_id","contractDetails"]],template:function(t,n){if(t&1&&(f(0,Rn,9,2,"ng-template",null,0,T),o(2,"nz-collapse",1)(3,"nz-collapse-panel",2,3)(5,"div",4)(6,"nz-card",5)(7,"form",6),h("ngSubmit",function(){return n.submitForm()}),o(8,"div",null,7)(10,"nz-row",8)(11,"nz-col",9)(12,"nz-form-item")(13,"nz-form-label",10),c(14,"Contract Type"),s(),o(15,"nz-form-control",11)(16,"nz-select",12),_(17,"nz-option",13)(18,"nz-option",14),s()()()(),o(19,"nz-col",9)(20,"nz-form-item")(21,"nz-form-label",15),c(22,"with_material"),s(),o(23,"nz-form-control",16),_(24,"label",17),s()()()(),o(25,"nz-row",8)(26,"nz-col",9)(27,"nz-form-item")(28,"nz-form-label",18),c(29,"Contractor"),s(),o(30,"nz-form-control",11)(31,"nz-select",19),f(32,An,1,2,"nz-option",20),s()()()(),o(33,"nz-col",9)(34,"nz-form-item")(35,"nz-form-label",21),c(36,"contract_start_date"),s(),o(37,"nz-form-control",11),_(38,"nz-date-picker",22),s()()()(),o(39,"nz-row",8)(40,"nz-col",9)(41,"nz-form-item")(42,"nz-form-label",23),c(43,"contract_end_date"),s(),o(44,"nz-form-control",11),_(45,"nz-date-picker",24),s()()(),o(46,"nz-col",9)(47,"nz-form-item")(48,"nz-form-label",25),c(49,"payment_schedule"),s(),o(50,"nz-form-control",11),_(51,"input",26),s()()()(),o(52,"nz-row",8)(53,"nz-col",9)(54,"nz-form-item")(55,"nz-form-label",27),c(56,"Subject"),s(),o(57,"nz-form-control",11),_(58,"input",28),s()()(),o(59,"nz-col",9)(60,"nz-form-item")(61,"nz-form-label",29),c(62,"amount_per_schedule"),s(),o(63,"nz-form-control",11),_(64,"input",30),s()()()(),o(65,"nz-form-item")(66,"nz-form-label",31),c(67,"amount_per_day"),s(),o(68,"nz-form-control",11),_(69,"input",32),s()(),f(70,qn,14,14,"nz-card",33),s(),o(71,"span",34)(72,"span"),f(73,jn,2,0,"button",35),s(),o(74,"span"),f(75,Bn,2,0,"button",36)(76,Gn,2,0,"button",36),s()()()()(),f(77,Un,2,2,"ng-template",null,37,T),s()(),f(79,$n,8,10,"div",38)),t&2){let p=D(1),u,w,E;i(3),r("nzHeader",p)("nzActive",n.isActive||((u=n.contractDetails.get("state"))==null?null:u.value)!==n.contractStates.Approved&&((u=n.contractDetails.get("state"))==null?null:u.value)!==n.contractStates.Completed)("nzDisabled",((w=n.contractDetails.get("state"))==null?null:w.value)!==n.contractStates.Approved&&((w=n.contractDetails.get("state"))==null?null:w.value)!==n.contractStates.Completed),i(4),r("formGroup",n.contractDetails),i(4),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(4),r("nzMd",4)("nzSm",24)("nzXs",12),i(7),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("ngForOf",n.listOfData),i(),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("ngIf",n.contractDetails.controls.state.value!==n.contractStates.Draft),i(3),r("ngIf",n.contractDetails.controls.state.value==n.contractStates.PendingApproval),i(2),r("ngIf",n.contractDetails.controls.state.value==n.contractStates.Draft),i(),r("ngIf",n.contractDetails.controls.state.value==n.contractStates.PendingApproval),i(3),r("ngIf",((E=n.contractDetails.get("state"))==null?null:E.value)===n.contractStates.Completed)}},dependencies:[P,W,A,L,R,ne,ke,lt,st,X,Me,ae,ie,re,oe,le,se,te,ot,rt,At,K,$,Q,H,Z,Y,Ut,$t]});let l=m;return l})();var en=bt(qt());function Jn(l,m){if(l&1&&_(0,"nz-option",26),l&2){let a=m.$implicit;r("nzLabel",a.name)("nzValue",a.name)}}function Kn(l,m){if(l&1&&_(0,"nz-option",27),l&2){let a=m.$implicit;r("nzValue",a==null?null:a.id)("nzLabel",a==null?null:a.name)}}function Zn(l,m){if(l&1){let a=v();o(0,"nz-card",9)(1,"form",10),h("ngSubmit",function(){C(a);let t=z();return g(t.handleOk())}),o(2,"nz-row",11)(3,"nz-col",12)(4,"nz-form-item")(5,"nz-form-label",13),c(6,"Name"),s(),o(7,"nz-form-control",14)(8,"nz-select",15),h("ngModelChange",function(t){C(a);let n=z();return g(n.onExpenseNameChange(t))}),f(9,Jn,1,2,"nz-option",16),s()()()(),o(10,"nz-col",12)(11,"nz-form-item")(12,"nz-form-label",17),c(13,"Quantity"),s(),o(14,"nz-form-control",14)(15,"input",18),h("change",function(){C(a);let t=z();return g(t.onQuantityChange())}),s()()()()(),o(16,"nz-row",11)(17,"nz-col",12)(18,"nz-form-item")(19,"nz-form-label",13),c(20,"Unit Price"),s(),o(21,"nz-form-control",19)(22,"input",20),h("change",function(){C(a);let t=z();return g(t.onUnitPriceChange())}),s(),c(23," \xA0 "),s()()(),o(24,"nz-col",12)(25,"nz-form-item")(26,"nz-form-label",13),c(27,"Amount"),s(),o(28,"nz-form-control",19)(29,"div",0)(30,"span"),c(31),de(32,"currency"),s(),o(33,"label",21),c(34,"Paid"),s()()()()()(),o(35,"nz-row",11)(36,"nz-col",12)(37,"nz-form-item")(38,"nz-form-label",22),c(39,"Refered By"),s(),o(40,"nz-form-control",14)(41,"nz-select",23),f(42,Kn,1,2,"nz-option",24),s()()()()(),o(43,"nz-row",11)(44,"nz-col",12)(45,"nz-form-item")(46,"nz-form-label",13),c(47,"Payment Notes"),s(),o(48,"nz-form-control",19),_(49,"textarea",25),s()()()()()()}if(l&2){let a=z(),e=D(9),t,n;i(),r("formGroup",a.addExpenseForm),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(),r("nzDropdownRender",e),i(),r("ngForOf",a.vendorItems),i(),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),x(" ",ge(32,54,(t=a.addExpenseForm.get("amount"))==null?null:t.value," ")," "),i(2),r("nzChecked",(n=a.addExpenseForm.get("is_paid"))==null?null:n.value),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("ngForOf",a.users),i(2),r("nzMd",24)("nzSm",24)("nzXs",24),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24)}}function Yn(l,m){if(l&1){let a=v();o(0,"div",28),_(1,"input",29,30),o(3,"a",31),h("click",function(){C(a);let t=D(2),n=z();return g(n.addItem(t))}),_(4,"span",32),c(5," Add item "),s()()}}function ei(l,m){if(l&1&&(o(0,"th",33),c(1),s()),l&2){let a=m.$implicit;r("nzSortFn",a.compare)("nzSortPriority",a.priority),i(),x(" ",a.title," ")}}function ti(l,m){if(l&1){let a=v();Je(0),o(1,"td"),c(2),de(3,"username"),s(),o(4,"td"),c(5),s(),o(6,"td"),c(7),s(),o(8,"td"),c(9),s(),o(10,"td"),c(11),s(),o(12,"td")(13,"label",36),V("ngModelChange",function(t){C(a);let n=z().$implicit,p=z();return k(p.editCache[n.id].data.is_paid,t)||(p.editCache[n.id].data.is_paid=t),g(t)}),s()(),o(14,"td")(15,"a",37),h("click",function(){C(a);let t=z().$implicit,n=z();return g(n.startEdit(t.id))}),c(16,"Edit"),s()(),Ke()}if(l&2){let a=z().$implicit,e=z();i(2),I(tt(3,8,a.refered_by)),i(3),_e("",a.is_general?"":"PO - "+a.purchase_id+" "," ",a.name,""),i(2),I(a.quantity),i(2),I(a.unit_price),i(2),I(a.amount),i(2),r("nzChecked",e.editCache[a.id].data.is_paid),M("ngModel",e.editCache[a.id].data.is_paid)}}function ni(l,m){if(l&1){let a=v();o(0,"span")(1,"input",44),V("ngModelChange",function(t){C(a);let n=z(2).$implicit,p=z();return k(p.editCache[n.id].data.name,t)||(p.editCache[n.id].data.name=t),g(t)}),s()()}if(l&2){let a=z(2).$implicit,e=z();i(),M("ngModel",e.editCache[a.id].data.name)}}function ii(l,m){if(l&1&&(o(0,"span"),c(1),s()),l&2){let a=z(2).$implicit,e=z();i(),I(e.editCache[a.id].data.name)}}function ai(l,m){if(l&1){let a=v();o(0,"span")(1,"input",45),h("ngModelChange",function(){C(a);let t=z(2).$implicit,n=z();return g(n.onItemQuantityChange(t.id))}),V("ngModelChange",function(t){C(a);let n=z(2).$implicit,p=z();return k(p.editCache[n.id].data.unit_price,t)||(p.editCache[n.id].data.unit_price=t),g(t)}),s()()}if(l&2){let a=z(2).$implicit,e=z();i(),M("ngModel",e.editCache[a.id].data.unit_price)}}function oi(l,m){if(l&1&&(o(0,"span"),c(1),s()),l&2){let a=z(2).$implicit,e=z();i(),I(e.editCache[a.id].data.unit_price)}}function ri(l,m){if(l&1){let a=v();o(0,"td"),c(1),s(),o(2,"td"),f(3,ni,2,1,"span",38)(4,ii,2,1,"span",38),s(),o(5,"td")(6,"input",39),h("ngModelChange",function(){C(a);let t=z().$implicit,n=z();return g(n.onItemQuantityChange(t.id))}),V("ngModelChange",function(t){C(a);let n=z().$implicit,p=z();return k(p.editCache[n.id].data.quantity,t)||(p.editCache[n.id].data.quantity=t),g(t)}),s()(),o(7,"td"),f(8,ai,2,1,"span",38)(9,oi,2,1,"span",38),s(),o(10,"td")(11,"input",40),V("ngModelChange",function(t){C(a);let n=z().$implicit,p=z();return k(p.editCache[n.id].data.amount,t)||(p.editCache[n.id].data.amount=t),g(t)}),s()(),o(12,"td")(13,"label",41),V("ngModelChange",function(t){C(a);let n=z().$implicit,p=z();return k(p.editCache[n.id].data.is_paid,t)||(p.editCache[n.id].data.is_paid=t),g(t)}),s()(),o(14,"td")(15,"a",42),h("click",function(){C(a);let t=z().$implicit,n=z();return g(n.saveEdit(t.id))}),c(16,"Save"),s(),c(17," \xA0 "),o(18,"a",43),h("nzOnConfirm",function(){C(a);let t=z().$implicit,n=z();return g(n.cancelEdit(t.id))}),c(19,"Cancel"),s()()}if(l&2){let a=z().$implicit,e=z();i(),I(a.refered_by),i(2),r("ngIf",a.is_general),i(),r("ngIf",!a.is_general),i(2),M("ngModel",e.editCache[a.id].data.quantity),i(2),r("ngIf",a.is_general),i(),r("ngIf",!a.is_general),i(2),M("ngModel",e.editCache[a.id].data.amount),i(2),r("disabled",!a.is_general)("nzChecked",e.editCache[a.id].data.is_paid),M("ngModel",e.editCache[a.id].data.is_paid)}}function si(l,m){if(l&1&&(o(0,"tr"),f(1,ti,17,10,"ng-container",34)(2,ri,20,10,"ng-template",null,35,T),s()),l&2){let a=m.$implicit,e=D(3),t=z();i(),r("ngIf",!(t.editCache[a.id]!=null&&t.editCache[a.id].edit))("ngIfElse",e)}}var Kt=(()=>{let m=class m{constructor(e,t,n){this.appService=e,this.userService=t,this.fb=n,this.vendorItems=[],this.listOfColumn=[{title:"Reference By",compare:(p,u)=>p.refered_by-u.refered_by,priority:3},{title:"Name",compare:(p,u)=>p.name.localeCompare(u.name),priority:!1},{title:"Quantity",compare:(p,u)=>p.quantity-u.quantity,priority:2},{title:"Unit Price",compare:(p,u)=>(p.unit_price||0)-(u.unit_price||0),priority:2},{title:"Amount",compare:(p,u)=>p.amount-u.amount,priority:2},{title:"Paid",compare:(p,u)=>(p.is_paid?1:0)-(u.is_paid?1:0),priority:2},{title:"Action",compare:(p,u)=>p.refered_by-u.refered_by,priority:3}],this.listOfData=[],this.visible=!1,this.isVisible=!1,this.isOkLoading=!1,this.index=0,this.editCache={},this.addExpenseForm=new J({id:new d(0),name:new d("",[ze.required]),is_general:new d(!0),quantity:new d(0,[ze.required]),amount:new d({value:0,disabled:!0}),refered_by:new d(0),purchase_id:new d(0),is_paid:new d(0),site:new d(this.site_id),note:new d,unit_price:new d(0,[ze.required])})}showModal(){this.isVisible=!0}handleOk(){return y(this,null,function*(){try{this.isOkLoading=!0,yield this.addExpense(),this.isVisible=!1,this.addExpenseForm.reset()}catch{}finally{this.isOkLoading=!1,this.populateExpenseData()}})}addExpense(){return y(this,null,function*(){this.subOrganizations=yield this.appService.saveSiteExpense(F(b({},this.addExpenseForm.getRawValue()),{site:this.site_id}))})}handleCancel(){this.isVisible=!1}ngOnInit(){this.populateExpenseData()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateExpenseData()}populateExpenseData(){return y(this,null,function*(){this.listOfData=yield this.appService.retrieveExpensesBySiteId(this.site_id),this.users=yield this.userService.getOrganizationUsers(),this.ExpenseRoles=yield this.appService.getRoles(),this.subOrganizations=yield this.appService.getSubOrganizations(),this.vendorItems=yield this.appService.getInventoryBySiteId(this.site_id),this.ExpenseRoles=this.ExpenseRoles.map(e=>({key:e.role_name,value:e.id})),this.subOrganizations=this.subOrganizations.map(e=>F(b({},e),{key:e.name,value:e.id})),this.updateEditCache()})}addItem(e){let t=e.value;this.vendorItems.some(n=>!t||n.name===t.trim())||(this.vendorItems=[...this.vendorItems,{name:e.value,isCustom:!0}],e.value="")}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e]={data:b({},this.listOfData[t]),edit:!1}}saveEdit(e){return y(this,null,function*(){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e].edit=!1,Object.assign(this.listOfData[t],this.editCache[e].data),yield this.appService.updateSiteExpense(this.editCache[e].data),this.populateExpenseData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:b({},e)}})}onExpenseNameChange(e){let t=this.vendorItems.find(n=>n.name===e.trim());t.isCustom?(this.addExpenseForm.controls.is_general.setValue(!0),this.addExpenseForm.controls.is_paid.enable(),this.addExpenseForm.controls.unit_price.enable(),this.addExpenseForm.controls.is_paid.setValue(!1),this.addExpenseForm.controls.quantity.setValue(0),this.addExpenseForm.controls.amount.setValue(0),this.addExpenseForm.controls.purchase_id?.setValue(0),this.addExpenseForm.controls.unit_price?.setValue(0)):(this.addExpenseForm.controls.is_general.setValue(!1),this.addExpenseForm.controls.is_paid.setValue(!0),this.addExpenseForm.controls.quantity.setValue(0),this.addExpenseForm.controls.amount.setValue(0),this.addExpenseForm.controls.is_paid.disable(),this.addExpenseForm.controls.purchase_id?.setValue(t.purchase_id),this.addExpenseForm.controls.unit_price?.setValue(t.unit_price),this.addExpenseForm.controls.unit_price.disable())}onQuantityChange(){if(this.addExpenseForm.controls.is_general.value)this.onUnitPriceChange();else{let e=this.vendorItems.find(t=>t.name===this.addExpenseForm.controls.name.value);this.addExpenseForm.patchValue({amount:this.addExpenseForm.controls.quantity.value*parseFloat(e.unit_price)})}}onUnitPriceChange(){this.addExpenseForm.controls.is_general.value&&this.addExpenseForm.patchValue({amount:this.addExpenseForm.controls.quantity.value*this.addExpenseForm.controls.unit_price.value})}onItemQuantityChange(e){setTimeout(()=>{this.editCache[e].data.amount=this.editCache[e].data.quantity*(parseFloat(this.editCache[e].data.unit_price?.toString()||"0")||0)})}};m.\u0275fac=function(t){return new(t||m)(S(N),S(U),S(ee))},m.\u0275cmp=O({type:m,selectors:[["app-expenses"]],inputs:{site_id:"site_id"},decls:18,vars:6,consts:[[1,"flex","center","space-between"],["nz-button","","nzType","primary",3,"click"],["nzTitle","Add Expense",3,"nzVisible","nzOkDisabled","nzOkLoading","nzVisibleChange","nzOnCancel","nzOnOk"],["style","width:100%",4,"nzModalContent"],["renderTemplate",""],["nzShowPagination","false","nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[2,"width","100%"],["nz-form","",3,"formGroup","ngSubmit"],["nzGutter","2",2,"margin-bottom","12px"],[3,"nzMd","nzSm","nzXs"],["nzRequired","","nzFor","name",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",3,"nzSm","nzXs"],["formControlName","name","nzAllowClear","","nzPlaceHolder","Select item",1,"control","inputField",3,"nzDropdownRender","ngModelChange"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzRequired","","nzFor","quantity",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","quantity",1,"control","inputField",3,"change"],["nzErrorTip","The input is not valid date!",1,"flex","space-between","center",3,"nzSm","nzXs"],["nz-input","","formControlName","unit_price",1,"control","inputField",3,"change"],["nz-checkbox","","formControlName","is_paid",3,"nzChecked"],["nzFor","refered_by",3,"nzMd","nzSm","nzXs"],["id","reports_to","formControlName","refered_by","placeholder","Select user",1,"control","inputField"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nz-input","","formControlName","note",1,"control","inputField"],[3,"nzLabel","nzValue"],[3,"nzValue","nzLabel"],[1,"container"],["type","text","nz-input",""],["inputElement",""],[1,"add-item",3,"click"],["nz-icon","","nzType","plus"],[3,"nzSortFn","nzSortPriority"],[4,"ngIf","ngIfElse"],["editTemplate",""],["nz-checkbox","","disabled","",3,"nzChecked","ngModel","ngModelChange"],[3,"click"],[4,"ngIf"],["nz-input","","id","quantity",3,"ngModel","ngModelChange"],["nz-input","","disabled","","id","unit_price",3,"ngModel","ngModelChange"],["nz-checkbox","",3,"disabled","nzChecked","ngModel","ngModelChange"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],["nz-input","",3,"ngModel","ngModelChange"],["nz-input","","id","unit_price",3,"ngModel","ngModelChange"]],template:function(t,n){if(t&1&&(o(0,"div",0)(1,"h3"),c(2,"Expense"),s(),o(3,"button",1),h("click",function(){return n.showModal()}),o(4,"span"),c(5,"Add Expense"),s()()(),o(6,"nz-modal",2),V("nzVisibleChange",function(u){return k(n.isVisible,u)||(n.isVisible=u),u}),h("nzOnCancel",function(){return n.handleCancel()})("nzOnOk",function(){return n.handleOk()}),f(7,Zn,50,57,"nz-card",3),s(),f(8,Yn,6,0,"ng-template",null,4,T),o(10,"nz-table",5,6)(13,"thead")(14,"tr"),f(15,ei,2,3,"th",7),s()(),o(16,"tbody"),f(17,si,4,2,"tr",8),s()()),t&2){let p=D(12);i(6),M("nzVisible",n.isVisible),r("nzOkDisabled",n.addExpenseForm.invalid)("nzOkLoading",n.isOkLoading),i(4),r("nzData",n.listOfData),i(5),r("ngForOf",n.listOfColumn),i(2),r("ngForOf",p.data)}},dependencies:[P,W,A,L,R,ne,ke,X,ae,ie,re,oe,le,se,te,Se,ye,Ct,ot,rt,B,me,q,ce,pe,j,G,K,$,Q,H,Z,Y,Ie,Te,Pe]});let l=m;return l})();function mi(l,m){if(l&1){let a=v();o(0,"nz-card",9)(1,"form",10),h("ngSubmit",function(){C(a);let t=z();return g(t.handleOk())}),o(2,"nz-row",11)(3,"nz-col",12)(4,"nz-form-item")(5,"nz-form-label",13),c(6,"Name"),s(),o(7,"nz-form-control",14),_(8,"input",15),s()()(),o(9,"nz-col",12)(10,"nz-form-item")(11,"nz-form-label",16),c(12,"Amount"),s(),o(13,"nz-form-control",14),_(14,"input",17),s()()(),o(15,"nz-col",12)(16,"nz-form-item")(17,"nz-form-label",13),c(18," Is Paid"),s(),o(19,"nz-form-control",18)(20,"label",19),c(21,"Paid"),s()()()()(),o(22,"nz-row",11)(23,"nz-col",12)(24,"nz-form-item")(25,"nz-form-label",13),c(26,"Payment Notes"),s(),o(27,"nz-form-control",18),_(28,"textarea",20),s()()()()()()}if(l&2){let a=z(),e;i(),r("formGroup",a.addOwnerPaymentForm),i(2),r("nzMd",10)("nzSm",24)("nzXs",24),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",10)("nzSm",16)("nzXs",16),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",4)("nzSm",8)("nzXs",8),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(),r("nzChecked",(e=a.addOwnerPaymentForm.get("is_paid"))==null?null:e.value),i(3),r("nzMd",24)("nzSm",24)("nzXs",24),i(2),r("nzMd",8)("nzSm",24)("nzXs",24),i(2),r("nzSm",14)("nzXs",24)}}function ci(l,m){if(l&1){let a=v();o(0,"div",21),_(1,"input",22,23),o(3,"a",24),h("click",function(){C(a);let t=D(2),n=z();return g(n.addItem(t))}),_(4,"span",25),c(5," Add item "),s()()}}function pi(l,m){if(l&1&&(o(0,"th",26),c(1),s()),l&2){let a=m.$implicit;r("nzSortFn",a.compare)("nzSortPriority",a.priority),i(),x(" ",a.title," ")}}function di(l,m){if(l&1){let a=v();o(0,"a",31),h("click",function(){C(a);let t=z().$implicit,n=z();return g(n.startEdit(t.id))}),c(1,"Edit"),s()}}function zi(l,m){if(l&1){let a=v();o(0,"a",32),h("click",function(){C(a);let t=z().$implicit,n=z();return g(n.saveEdit(t.id))}),c(1,"Save"),s()}}function ui(l,m){if(l&1){let a=v();o(0,"a",33),h("nzOnConfirm",function(){C(a);let t=z().$implicit,n=z();return g(n.cancelEdit(t.id))}),c(1,"Cancel"),s()}}function _i(l,m){if(l&1){let a=v();o(0,"tr")(1,"td"),c(2),s(),o(3,"td"),c(4),s(),o(5,"td")(6,"label",27),V("ngModelChange",function(t){let p=C(a).$implicit,u=z();return k(u.editCache[p.id].data.is_paid,t)||(u.editCache[p.id].data.is_paid=t),g(t)}),s()(),o(7,"td"),f(8,di,2,0,"a",28)(9,zi,2,0,"a",29),c(10," \xA0 "),f(11,ui,2,0,"a",30),s()()}if(l&2){let a=m.$implicit,e=z();i(2),x(" ",a.name,""),i(2),I(a.amount),i(2),r("disabled",!(e.editCache[a.id]!=null&&e.editCache[a.id].edit))("nzChecked",e.editCache[a.id].data.is_paid),M("ngModel",e.editCache[a.id].data.is_paid),i(2),r("ngIf",!(e.editCache[a.id]!=null&&e.editCache[a.id].edit)),i(),r("ngIf",e.editCache[a.id]==null?null:e.editCache[a.id].edit),i(2),r("ngIf",e.editCache[a.id]==null?null:e.editCache[a.id].edit)}}var Zt=(()=>{let m=class m{constructor(e,t,n){this.appService=e,this.userService=t,this.fb=n,this.vendorItems=[],this.listOfColumn=[{title:"Name",compare:(p,u)=>p.name.localeCompare(u.name),priority:!1},{title:"Amount",compare:(p,u)=>p.amount-u.amount,priority:2},{title:"Paid",compare:(p,u)=>(p.is_paid?1:0)-(u.is_paid?1:0),priority:2},{title:"Action",compare:(p,u)=>p.amount-u.amount,priority:3}],this.listOfData=[],this.visible=!1,this.isVisible=!1,this.isOkLoading=!1,this.index=0,this.editCache={},this.addOwnerPaymentForm=new J({id:new d(0),name:new d("",[ze.required]),amount:new d(0,[ze.required]),is_paid:new d(0),site:new d(this.site_id),note:new d})}showModal(){this.isVisible=!0}handleOk(){return y(this,null,function*(){try{this.isOkLoading=!0,yield this.addOwnerPayment(),this.isVisible=!1,this.addOwnerPaymentForm.reset()}catch{}finally{this.isOkLoading=!1,this.populateOwnerPaymentData()}})}addOwnerPayment(){return y(this,null,function*(){this.subOrganizations=yield this.appService.saveSiteOwnerPayment(F(b({},this.addOwnerPaymentForm.getRawValue()),{site:this.site_id}))})}handleCancel(){this.isVisible=!1}ngOnInit(){this.populateOwnerPaymentData()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateOwnerPaymentData()}populateOwnerPaymentData(){return y(this,null,function*(){this.listOfData=yield this.appService.retrieveOwnerPaymentsBySiteId(this.site_id),this.users=yield this.userService.getOrganizationUsers(),this.OwnerPaymentRoles=yield this.appService.getRoles(),this.subOrganizations=yield this.appService.getSubOrganizations(),this.vendorItems=yield this.appService.getInventoryBySiteId(this.site_id),this.OwnerPaymentRoles=this.OwnerPaymentRoles.map(e=>({key:e.role_name,value:e.id})),this.subOrganizations=this.subOrganizations.map(e=>F(b({},e),{key:e.name,value:e.id})),this.updateEditCache()})}addItem(e){let t=e.value;this.vendorItems.some(n=>!t||n.name===t.trim())||(this.vendorItems=[...this.vendorItems,{name:e.value,isCustom:!0}],e.value="")}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e]={data:b({},this.listOfData[t]),edit:!1}}saveEdit(e){return y(this,null,function*(){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e].edit=!1,Object.assign(this.listOfData[t],this.editCache[e].data),yield this.appService.updateSiteOwnerPayment(this.editCache[e].data),this.populateOwnerPaymentData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:b({},e)}})}};m.\u0275fac=function(t){return new(t||m)(S(N),S(U),S(ee))},m.\u0275cmp=O({type:m,selectors:[["app-owner-payments"]],inputs:{site_id:"site_id"},decls:18,vars:6,consts:[[1,"flex","center","space-between"],["nz-button","","nzType","primary",3,"click"],["nzTitle","Add Owner Payment",3,"nzVisible","nzOkDisabled","nzOkLoading","nzVisibleChange","nzOnCancel","nzOnOk"],["style","width:100%",4,"nzModalContent"],["renderTemplate",""],["nzShowPagination","false","nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[2,"width","100%"],["nz-form","",3,"formGroup","ngSubmit"],["nzGutter","2",2,"margin-bottom","12px"],[3,"nzMd","nzSm","nzXs"],["nzRequired","","nzFor","name",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",3,"nzSm","nzXs"],["nz-input","","formControlName","name",1,"control","inputField"],["nzRequired","","nzFor","amount",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","amount",1,"control","inputField"],["nzErrorTip","The input is not valid date!",1,"flex","space-between","center",3,"nzSm","nzXs"],["nz-checkbox","","formControlName","is_paid",3,"nzChecked"],["nz-input","","formControlName","note",1,"control","inputField"],[1,"container"],["type","text","nz-input",""],["inputElement",""],[1,"add-item",3,"click"],["nz-icon","","nzType","plus"],[3,"nzSortFn","nzSortPriority"],["nz-checkbox","",3,"disabled","nzChecked","ngModel","ngModelChange"],[3,"click",4,"ngIf"],["class","save",3,"click",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm",4,"ngIf"],[3,"click"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"]],template:function(t,n){if(t&1&&(o(0,"div",0)(1,"h3"),c(2,"Owner Payment"),s(),o(3,"button",1),h("click",function(){return n.showModal()}),o(4,"span"),c(5,"Add Owner Payment"),s()()(),o(6,"nz-modal",2),V("nzVisibleChange",function(u){return k(n.isVisible,u)||(n.isVisible=u),u}),h("nzOnCancel",function(){return n.handleCancel()})("nzOnOk",function(){return n.handleOk()}),f(7,mi,29,34,"nz-card",3),s(),f(8,ci,6,0,"ng-template",null,4,T),o(10,"nz-table",5,6)(13,"thead")(14,"tr"),f(15,pi,2,3,"th",7),s()(),o(16,"tbody"),f(17,_i,12,8,"tr",8),s()()),t&2){let p=D(12);i(6),M("nzVisible",n.isVisible),r("nzOkDisabled",n.addOwnerPaymentForm.invalid)("nzOkLoading",n.isOkLoading),i(4),r("nzData",n.listOfData),i(5),r("ngForOf",n.listOfColumn),i(2),r("ngForOf",p.data)}},dependencies:[P,W,A,L,R,ne,ke,X,ae,ie,re,oe,le,se,te,Se,ye,Ct,B,me,q,ce,pe,j,G,K,$,Q,H,Z,Y,Ie]});let l=m;return l})();function hi(l,m){if(l&1&&(o(0,"th",5),c(1),s()),l&2){let a=m.$implicit;r("nzSortFn",a.compare)("nzSortPriority",a.priority)("nzWidth",a.width),i(),x(" ",a.title," ")}}var Ci=l=>["contract",l];function gi(l,m){if(l&1&&(o(0,"tr")(1,"td"),c(2),de(3,"username"),s(),o(4,"td"),c(5),s(),o(6,"td"),c(7),de(8,"currency"),s(),o(9,"td")(10,"a",6),c(11),s()()()),l&2){let a=m.$implicit;i(2),x(" ",tt(3,5,a.contractor),""),i(3),x(" ",a.subject,""),i(2),x(" ",ge(8,7,a.amount," "),""),i(3),r("routerLink",Ne(10,Ci,a.id)),i(),x("CR-",a.id,"")}}var Yt=(()=>{let m=class m{constructor(e){this.appService=e,this.listOfColumn=[{title:"Contractor",compare:(t,n)=>t.contractor-n.contractor,priority:1,with:"30%"},{title:"Title",compare:(t,n)=>t.subject.localeCompare(n.subject),priority:2,with:"30%"},{title:"Amount",compare:(t,n)=>t.amount-n.amount,priority:2,with:"20%"},{title:"+Work-Payment",compare:(t,n)=>t.amount-n.amount,priority:3,with:"20%"}],this.listOfData=[],this.visible=!1}ngOnInit(){this.populateContractPaymentData()}open(e){this.visible=!0}populateContractPaymentData(){return y(this,null,function*(){this.listOfData=yield this.appService.retrieveContractPaymentsBySiteId(this.site_id)})}};m.\u0275fac=function(t){return new(t||m)(S(N))},m.\u0275cmp=O({type:m,selectors:[["app-contractor-payments"]],inputs:{site_id:"site_id"},decls:11,vars:3,consts:[[1,"flex","center","space-between"],["nzShowPagination","false","nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority","nzWidth",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"nzSortFn","nzSortPriority","nzWidth"],["href","",3,"routerLink"]],template:function(t,n){if(t&1&&(o(0,"div",0)(1,"h3"),c(2,"Contractors Payments"),s()(),o(3,"nz-table",1,2)(6,"thead")(7,"tr"),f(8,hi,2,4,"th",3),s()(),o(9,"tbody"),f(10,gi,12,12,"tr",4),s()()),t&2){let p=D(5);i(3),r("nzData",n.listOfData),i(5),r("ngForOf",n.listOfColumn),i(2),r("ngForOf",p.data)}},dependencies:[P,Fe,B,me,q,ce,pe,j,G,Te,Pe]});let l=m;return l})();var Si=["content"];function vi(l,m){if(l&1){let a=v();o(0,"div",32)(1,"span")(2,"h4"),c(3),s()(),o(4,"span")(5,"button",33),h("click",function(){C(a);let t=z();return g(t.generatePDF())}),_(6,"span",34),s(),o(7,"button",35),_(8,"span",36),s()()()}if(l&2){let a=z(),e;i(3),_e(" ",((e=a.siteDetails.get("id"))==null?null:e.value)||"New"," - / ",(e=a.siteDetails.get("name"))==null?null:e.value," ")}}function xi(l,m){if(l&1){let a=v();o(0,"button",37),h("click",function(){C(a);let t=z();return g(t.cancelPaymentDetails())}),c(1,"Cancel"),s()}}function wi(l,m){if(l&1){let a=v();o(0,"button",38),h("click",function(){C(a);let t=z();return g(t.submitRequest())}),c(1,"Submit"),s()}}function bi(l,m){if(l&1){let a=v();o(0,"button",38),h("click",function(){C(a);let t=z();return g(t.approveDetails())}),c(1,"Approve Site"),s()}}function Di(l,m){if(l&1&&(c(0),_(1,"span",39)),l&2){let a=m.$implicit;z();let e=D(4);x(" ",a," "),i(),r("nzRotate",e.nzActive?90:-90)}}function Ei(l,m){if(l&1&&(o(0,"div",40)(1,"nz-row",41)(2,"nz-col",9)(3,"nz-card",5),_(4,"app-expenses",42),s()(),o(5,"nz-col",9)(6,"nz-card",5),_(7,"app-owner-payments",42),s(),o(8,"nz-card",43),_(9,"app-contractor-payments",42),s()()()()),l&2){let a=z();i(2),r("nzMd",16)("nzSm",24)("nzXs",24),i(2),r("site_id",a.site_id),i(),r("nzMd",8)("nzSm",24)("nzXs",24),i(2),r("site_id",a.site_id),i(2),r("site_id",a.site_id)}}var tn=(()=>{let m=class m{constructor(e,t,n,p,u,w,E,we){this.appService=e,this.route=t,this.userService=n,this.fb=p,this.notification=u,this.router=w,this.msg=E,this.modal=we,this.vendors=[],this.isActive=!1,this.vendorItems=[],this.discountTotal=0,this.siteTotal=0,this.loading=!1,this.siteStates=yt,this.stateNames=St,this.site_id=0,this.listOfData=[],this.defaultItemValues={id:0,name:"",qty:0,discount:0,total:0,date_created:new Date,isCustom:!1,unit_price:0},this.siteDetails=new J({id:new d,name:new d,budget:new d,owner:new d,contact_no:new d,state:new d(this.siteStates.Draft),address:new d,site_start_date:new d(new Date),site_end_date:new d(new Date),details:new d,created_by:new d(0),total:new d(0),organization:new d(0),subOrganization:new d(0)}),this.beforeUpload=(ue,on)=>new $e(he=>{let Le=ue.type==="image/jpeg"||ue.type==="image/png";if(!Le){this.msg.error("You can only upload JPG file!"),he.complete();return}let Re=ue.size/1024/1024<2;if(!Re){this.msg.error("Image must smaller than 2MB!"),he.complete();return}he.next(Le&&Re),he.complete()}),this.siteDetails=this.fb.group({id:new d,name:new d,budget:new d,owner:new d,contact_no:new d,state:new d(this.siteStates.Draft),address:new d,site_start_date:new d(new Date),site_end_date:new d(new Date),details:new d,created_by:new d(0),total:new d(0),organization:new d(0),subOrganization:new d(0)})}submitForm(){}ngOnInit(){this.loadAndUsers(),this.setSitesData(),this.route.paramMap.subscribe(e=>{e.get("siteId")||(this.siteDetails.reset({state:this.siteStates.Draft,id:0}),this.siteDetails.enable(),this.siteDetails.updateValueAndValidity()),this.siteDetails.controls.id.setValue(e.get("siteId")!=="new"?e.get("siteId"):0),this.site_id=this.siteDetails.controls.id.value,this.setSiteDetails()})}ngOnDestroy(){}setSitesData(){return y(this,null,function*(){let e=yield this.appService.getAndSetSites(),t=e&&e.length?e.map(n=>b({label:n.name},n)):[];this.sites=[...t]})}setSiteDetails(){return y(this,null,function*(){this.loading=!0,this.siteDetails.controls.id.value&&(yield this.getExistingsite()),this.disableAndEnableSpecificControls(),this.loading=!1})}getExistingsite(){return y(this,null,function*(){let e=yield this.appService.retireveSiteById(this.siteDetails.controls.id.value);e&&this.siteDetails.patchValue({id:e.id,state:e.state,created_by:e.created_by,total:e.total,organization:e.organization_id,subOrganization:e.sub_organization_id,owner:e.owner,site_start_date:e.site_start_date,site_end_date:e.site_end_date,name:e.name,budget:e.budget,contact_no:e.contact_no,address:e.address,details:e.details}),this.previoussiteDetails=this.siteDetails.getRawValue()})}loadAndUsers(){return y(this,null,function*(){this.listOfData=yield this.userService.getOrganizationUsers()})}submitRequest(){return y(this,null,function*(){let e=yield this.appService.createSite(F(b({},this.siteDetails.value),{state:this.siteStates.PendingApproval}));e&&this.notification.create("success","site Order - "+e.id,"site order submitted successfly. Please check for invoice and update later").onClose.subscribe(t=>{this.router.navigate(["/"])})})}cancelPaymentDetails(){return y(this,null,function*(){})}approveDetails(){return y(this,null,function*(){let e=this.appService.findObjectDifferences(this.previoussiteDetails,this.siteDetails.getRawValue());console.log(e);let t=b({id:this.previoussiteDetails.id},e);(yield this.appService.updateSiteRequest(F(b({},t),{state:this.siteStates.Approved})))&&this.notification.create("success","site Order - "+this.previoussiteDetails.id,"site order invoice submitted successfly. Please proceed next for payment details").onClose.subscribe(p=>{this.router.navigate(["/"])})})}printCard(){let e=this.content.nativeElement.innerHTML,t=window.open("","_blank","top=0,left=0,height=100%,width=auto");t&&(t.document.open(),t.document.write(`
      <html>
        <head>
          <title>Print</title>
          <style>
            /* Define print styles here */
          </style>
        </head>
        <body onload="window.print();window.close()">
          ${e}
        </body>
      </html>
    `),t.print())}generatePDF(){let e=this.content.nativeElement;(0,en.default)(e).then(t=>{let n=t.toDataURL("image/png")})}disableAndEnableSpecificControls(){let e=this.siteDetails.get("state");e&&e.value!==this.siteStates.Draft&&(console.log(this.siteDetails),Object.keys(this.siteDetails.controls).forEach(t=>{let n=this.siteDetails.get(t);n&&(t!=="attachment"&&t!=="terms"&&e.value===this.siteStates.PendingApproval||e.value===this.siteStates.Completed)&&n.disable()}),console.log(this.siteDetails),this.siteDetails.updateValueAndValidity())}getBase64(e,t){let n=new FileReader;n.addEventListener("load",()=>t(n.result.toString())),n.readAsDataURL(e)}handleChange(e){this.getBase64(e.file.originFileObj,t=>{this.loading=!1})}};m.\u0275fac=function(t){return new(t||m)(S(N),S(it),S(U),S(ee),S(ht),S(at),S(_t),S(ft))},m.\u0275cmp=O({type:m,selectors:[["app-site"]],viewQuery:function(t,n){if(t&1&&Ze(Si,5),t&2){let p;Ye(p=et())&&(n.content=p.first)}},decls:73,vars:74,consts:[["renderHome",""],["nzAccordion",""],["nzExpandedIcon","double-right",3,"nzHeader","nzActive","nzDisabled"],["p",""],["id","print-section",1,"purchase-request"],[2,"width","100%"],["nz-form","",3,"formGroup","ngSubmit"],["content",""],["nzGutter","2",2,"margin-bottom","12px"],[3,"nzMd","nzSm","nzXs"],["nzRequired","","nzFor","name",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",3,"nzSm","nzXs"],["nz-input","","formControlName","name",1,"control","inputField"],["nzRequired","","nzFor","budget",3,"nzMd","nzSm","nzXs"],["z-input","","formControlName","budget",1,"control","inputField"],["nzRequired","","nzFor","owner",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","owner",1,"control","inputField"],["nzRequired","","nzFor","contact_no",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","contact_no",1,"control","inputField"],["nzRequired","","nzFor","address",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","address",1,"control","inputField",3,"rows"],["nzRequired","","nzFor","site_start_date",3,"nzMd","nzSm","nzXs"],["formControlName","site_start_date",1,"control","inputField"],["nzRequired","","nzFor","site_end_date",3,"nzMd","nzSm","nzXs"],["formControlName","site_end_date",1,"control","inputField"],["nzRequired","","nzFor","details",3,"nzMd","nzSm","nzXs"],["nz-input","","formControlName","details",1,"control","inputField",3,"rows"],[1,"flex","space-between"],["nz-button","","nzType","primary","nzDanger","","style","margin-bottom: 12px;float: right;",3,"click",4,"ngIf"],["nz-button","","nzType","primary","style","margin-bottom: 12px;float: right;",3,"click",4,"ngIf"],["expandedIcon",""],["style","margin-top: 12px;",4,"ngIf"],[1,"detailBar-collapsible"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzType","download"],["nz-button","","nzType","primary","printSectionId","print-section","ngxPrint","","printTitle","MyTitle",2,"margin-left","12px"],["nz-icon","","nzType","printer","nzTheme","outline"],["nz-button","","nzType","primary","nzDanger","",2,"margin-bottom","12px","float","right",3,"click"],["nz-button","","nzType","primary",2,"margin-bottom","12px","float","right",3,"click"],["nz-icon","","nzType","caret-right",1,"ant-collapse-arrow",3,"nzRotate"],[2,"margin-top","12px"],["nzGutter","4",2,"margin-bottom","12px"],[3,"site_id"],[2,"width","100%","margin-top","4px"]],template:function(t,n){if(t&1&&(f(0,vi,9,2,"ng-template",null,0,T),o(2,"nz-collapse",1)(3,"nz-collapse-panel",2,3)(5,"div",4)(6,"nz-card",5)(7,"form",6),h("ngSubmit",function(){return n.submitForm()}),o(8,"div",null,7)(10,"nz-row",8)(11,"nz-col",9)(12,"nz-form-item")(13,"nz-form-label",10),c(14," Name"),s(),o(15,"nz-form-control",11),_(16,"input",12),s()()(),o(17,"nz-col",9)(18,"nz-form-item")(19,"nz-form-label",13),c(20,"budget"),s(),o(21,"nz-form-control",11),_(22,"input",14),s()()()(),o(23,"nz-row",8)(24,"nz-col",9)(25,"nz-form-item")(26,"nz-form-label",15),c(27,"owner"),s(),o(28,"nz-form-control",11),_(29,"input",16),s()()(),o(30,"nz-col",9)(31,"nz-form-item")(32,"nz-form-label",17),c(33,"Contact No"),s(),o(34,"nz-form-control",11),_(35,"input",18),s()()()(),o(36,"nz-row",8)(37,"nz-col",9)(38,"nz-form-item")(39,"nz-form-label",19),c(40," Address"),s(),o(41,"nz-form-control",11),_(42,"textarea",20),s()()()(),o(43,"nz-row",8)(44,"nz-col",9)(45,"nz-form-item")(46,"nz-form-label",21),c(47,"site_start_date"),s(),o(48,"nz-form-control",11),_(49,"nz-date-picker",22),s()()(),o(50,"nz-col",9)(51,"nz-form-item")(52,"nz-form-label",23),c(53,"site_end_date"),s(),o(54,"nz-form-control",11),_(55,"nz-date-picker",24),s()()()(),o(56,"nz-row",8)(57,"nz-col",9)(58,"nz-form-item")(59,"nz-form-label",25),c(60," Contract Details "),s(),o(61,"nz-form-control",11)(62,"textarea",26),c(63,"                        "),s()()()()()(),o(64,"span",27)(65,"span"),f(66,xi,2,0,"button",28),s(),o(67,"span"),f(68,wi,2,0,"button",29)(69,bi,2,0,"button",29),s()()()()(),f(70,Di,2,2,"ng-template",null,30,T),s()(),f(72,Ei,10,9,"div",31)),t&2){let p=D(1),u,w,E;i(3),r("nzHeader",p)("nzActive",n.isActive||((u=n.siteDetails.get("state"))==null?null:u.value)!==n.siteStates.Approved&&((u=n.siteDetails.get("state"))==null?null:u.value)!==n.siteStates.Completed)("nzDisabled",((w=n.siteDetails.get("state"))==null?null:w.value)!==n.siteStates.Approved&&((w=n.siteDetails.get("state"))==null?null:w.value)!==n.siteStates.Completed),i(4),r("formGroup",n.siteDetails),i(4),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(),r("rows",2),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(2),r("nzMd",12)("nzSm",24)("nzXs",12),i(2),r("nzMd",8)("nzSm",24)("nzXs",12),i(2),r("nzSm",14)("nzXs",24),i(3),r("nzMd",24)("nzSm",24)("nzXs",24),i(2),r("nzMd",4)("nzSm",24)("nzXs",24),i(2),r("nzSm",20)("nzXs",24),i(),r("rows",6),i(4),r("ngIf",n.siteDetails.controls.state.value==n.siteStates.PendingApproval),i(2),r("ngIf",n.siteDetails.controls.state.value==n.siteStates.Draft),i(),r("ngIf",n.siteDetails.controls.state.value==n.siteStates.PendingApproval),i(3),r("ngIf",((E=n.siteDetails.get("state"))==null?null:E.value)===n.siteStates.Approved)}},dependencies:[W,A,L,R,ne,lt,st,X,Me,ae,ie,re,oe,le,se,te,K,$,Q,H,Z,Y,Kt,Zt,Yt],styles:[".ant-collapse-arrow{margin-top:10px}"]});let l=m;return l})();var Oi=[{path:"",component:Bt,data:{name:"All Sites"}},{path:":siteId",component:tn,data:{name:"Site"}},{path:":siteId/contract/:contractId",component:Jt,data:{name:"Create Contract"}}],nn=(()=>{let m=class m{};m.\u0275fac=function(t){return new(t||m)},m.\u0275mod=Qe({type:m}),m.\u0275inj=He({imports:[wt.forChild(Oi),wt]});let l=m;return l})();var an=Tt,Ni=Object.keys(an).map(l=>an[l]),Ma=(()=>{let m=class m{};m.\u0275fac=function(t){return new(t||m)},m.\u0275mod=Qe({type:m}),m.\u0275inj=He({providers:[{provide:Vt,useValue:kt},{provide:Ft,useValue:Ni},Pe],imports:[Et,nn,Wt,Mt,It]});let l=m;return l})();export{Ma as SitesModule};
