import{a as de}from"./chunk-3Z6UWFR6.js";import{b as Ae,c as N}from"./chunk-HRJXDA5B.js";import{$ as ie,$a as je,A as te,Aa as O,Ac as tt,Ba as I,Ca as $,Cb as Le,Db as qe,Dc as it,Ea as Te,Eb as re,Fa as Oe,Fb as le,Gb as Ge,J as he,K as s,Kb as se,L as S,Lb as Re,Mb as He,O as u,Ob as pe,P as m,Pb as ce,Qa as Ie,Qb as Ze,Rb as Ke,Sa as Ne,Sb as Je,Ua as Me,Ub as Qe,Vb as Xe,Xa as Ce,Y as r,Z as a,Za as Ve,_ as z,_a as Pe,aa as ne,ab as L,ba as C,bb as P,ca as g,cb as q,da as c,db as ke,gb as oe,ha as M,ia as p,ib as Fe,ja as x,ka as v,kc as me,lb as Be,ma as w,mb as We,na as D,nc as F,oa as T,ob as Ue,pa as De,pb as $e,pc as Ye,qb as G,qc as H,r as Ee,s as E,sa as h,sc as Z,t as ee,ta as ae,tc as K,ua as b,uc as J,v as we,va as V,vc as Q,w as _,wb as j,x as f,xb as R,yb as k,zc as et}from"./chunk-6KWXZKYL.js";import"./chunk-NFQMHT45.js";import{a as B,g as y}from"./chunk-MON7YFGF.js";function ht(i,o){if(i&1&&z(0,"nz-option",16),i&2){let t=o.$implicit;m("nzValue",t==null?null:t.id)("nzLabel",t==null?null:t.name)}}function Ct(i,o){if(i&1&&(r(0,"nz-select",14),u(1,ht,1,2,"nz-option",15),a()),i&2){let t=c(2);s(),m("ngForOf",t.users)}}function yt(i,o){if(i&1&&z(0,"nz-option",16),i&2){let t=o.$implicit;m("nzValue",t==null?null:t.id)("nzLabel",t==null?null:t.name)}}function zt(i,o){if(i&1&&(r(0,"nz-select",17),u(1,yt,1,2,"nz-option",15),a()),i&2){let t=c(2);s(),m("ngForOf",t.users)}}function xt(i,o){if(i&1&&(r(0,"nz-form",3)(1,"div",4)(2,"div",5)(3,"nz-form-item")(4,"nz-form-label"),p(5,"Position"),a(),r(6,"nz-form-control"),z(7,"input",6),a()()()(),r(8,"div",4)(9,"div",7)(10,"nz-form-item")(11,"nz-form-label"),p(12,"Employee"),a(),r(13,"nz-form-control"),u(14,Ct,2,1,"nz-select",8),a()()()(),r(15,"div",4)(16,"div",7)(17,"nz-form-item")(18,"nz-form-label"),p(19,"Supervisor"),a(),r(20,"nz-form-control"),u(21,zt,2,1,"nz-select",9),a()()()(),r(22,"div",4)(23,"div",5)(24,"nz-form-item")(25,"nz-form-label"),p(26,"Salary"),a(),r(27,"nz-form-control"),z(28,"input",10),a()()()(),r(29,"div",4)(30,"div",5)(31,"nz-form-item")(32,"nz-form-label"),p(33,"Over time allowed"),a(),r(34,"nz-form-control"),z(35,"label",11),a()()()(),r(36,"div",4)(37,"div",5)(38,"nz-form-item")(39,"nz-form-label"),p(40,"Signout Required"),a(),r(41,"nz-form-control"),z(42,"label",12),a()()()(),r(43,"div",4)(44,"div",5)(45,"nz-form-item")(46,"nz-form-label"),p(47,"Employement Details"),a(),r(48,"nz-form-control"),z(49,"textarea",13),a()()()()()),i&2){let t=c();m("formGroup",t.employeeForm),s(),m("nzGutter",8),s(7),m("nzGutter",8),s(6),m("ngIf",t.users.length),s(),m("nzGutter",8),s(6),m("ngIf",t.users.length),s(),m("nzGutter",8),s(7),m("nzGutter",8),s(7),m("nzGutter",8),s(7),m("nzGutter",8),s(6),m("rows",3)}}function vt(i,o){if(i&1){let t=C();r(0,"div",18)(1,"button",19),g("click",function(){_(t);let n=c();return f(n.close())}),p(2,"Cancel"),a(),r(3,"button",20),g("click",function(){_(t);let n=c();return f(n.addUser())}),p(4,"Submit"),a()()}if(i&2){let t=c();s(3),m("disabled",!t.employeeForm.valid)}}var St=()=>({overflow:"auto"}),fe=(()=>{let o=class o{constructor(e,n){this.appService=e,this.fb=n,this.visible=!1,this.users=[],this.userRoles=[],this.subOrganizations=[],this.closeDrawer=new Ee,this.employeeForm=this.fb.group({employee:[0,[P.required]],position:["",[P.required]],salary:[0,[P.required]],overtime:[!1,[P.required]],siginout_required:[!1,[P.required]],organization:[parseInt(localStorage.getItem("organization_id")||"0")],subOrganization:[0],supervisor:[0,[P.required]],details:["",[P.required]]})}ngOnInit(){}close(){this.closeDrawer.emit(!1)}addUser(){return y(this,null,function*(){console.log(this.employeeForm),yield this.appService.createEmployee(this.employeeForm.value),this.closeDrawer.emit(!0)})}objectKeys(e){return Object.keys(e).map(n=>({key:n,value:e[n]}))}};o.\u0275fac=function(n){return new(n||o)(S(N),S(We))},o.\u0275cmp=E({type:o,selectors:[["app-employee-contract"]],inputs:{visible:"visible",users:"users",userRoles:"userRoles",subOrganizations:"subOrganizations"},outputs:{closeDrawer:"closeDrawer"},decls:4,vars:6,consts:[["nzTitle","Create",3,"nzBodyStyle","nzMaskClosable","nzWidth","nzVisible","nzFooter","nzOnClose"],[3,"formGroup",4,"nzDrawerContent"],["footerTpl",""],[3,"formGroup"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","12"],["formControlName","position","nz-input","","placeholder","please enter user position"],["nz-col","","nz-col","","nzSpan","12"],["id","employee","formControlName","employee","placeholder","Select user",4,"ngIf"],["id","supervisor","formControlName","supervisor","placeholder","Select user",4,"ngIf"],["formControlName","salary","nz-input","","placeholder","please enter user salary"],["nz-checkbox","","formControlName","overtime"],["nz-checkbox","","formControlName","siginout_required"],["nz-input","","formControlName","details",3,"rows"],["id","employee","formControlName","employee","placeholder","Select user"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],["id","supervisor","formControlName","supervisor","placeholder","Select user"],[2,"float","right"],["nz-button","",2,"margin-right","8px",3,"click"],["nz-button","","nzType","primary",3,"disabled","click"]],template:function(n,l){if(n&1&&(r(0,"nz-drawer",0),g("nzOnClose",function(){return l.close()}),u(1,xt,50,11,"nz-form",1)(2,vt,5,1,"ng-template",null,2,V),a()),n&2){let d=M(3);m("nzBodyStyle",De(5,St))("nzMaskClosable",!1)("nzWidth",720)("nzVisible",l.visible)("nzFooter",d)}},dependencies:[O,I,k,j,R,se,ce,pe,Ke,Ze,Je,Xe,Qe,G,re,le,L,q,ke,Fe,Be]});let i=o;return i})();function wt(i,o){if(i&1){let t=C();r(0,"app-employee-contract",6),g("closeDrawer",function(n){_(t);let l=c();return f(l.close(n))}),a()}if(i&2){let t=c();m("subOrganizations",t.subOrganizations)("visible",t.visible)("users",t.users)}}function Dt(i,o){if(i&1&&(r(0,"th",7),p(1),a()),i&2){let t=o.$implicit;m("nzSortFn",t.compare)("nzSortPriority",t.priority),s(),v(" ",t.title," ")}}function Tt(i,o){if(i&1){let t=C();ie(0),r(1,"td"),p(2),h(3,"username"),a(),r(4,"td"),p(5),a(),r(6,"td"),p(7),h(8,"username"),a(),r(9,"td"),p(10),a(),r(11,"td"),p(12),a(),r(13,"td"),p(14),a(),r(15,"td")(16,"a",10),g("click",function(){_(t);let n=c().$implicit,l=c();return f(l.startEdit(n.id))}),p(17,"Edit"),a()(),ne()}if(i&2){let t=c().$implicit;s(2),x(ae(3,6,t.employee)),s(3),x(t.position),s(2),x(ae(8,8,t.supervisor)),s(3),x(t.salary),s(2),x(t.overtime),s(2),x(t.siginout_required)}}function Ot(i,o){if(i&1&&z(0,"nz-option",18),i&2){let t=o.$implicit;m("nzValue",t==null?null:t.id)("nzLabel",t==null?null:t.name)}}function It(i,o){if(i&1){let t=C();r(0,"nz-select",16),T("ngModelChange",function(n){_(t);let l=c(2).$implicit,d=c();return D(d.editCache[l.id].data.supervisor,n)||(d.editCache[l.id].data.supervisor=n),f(n)}),u(1,Ot,1,2,"nz-option",17),a()}if(i&2){let t=c(2).$implicit,e=c();w("ngModel",e.editCache[t.id].data.supervisor),s(),m("ngForOf",e.users)}}function Nt(i,o){if(i&1){let t=C();r(0,"td"),p(1),h(2,"username"),a(),r(3,"td")(4,"input",11),T("ngModelChange",function(n){_(t);let l=c().$implicit,d=c();return D(d.editCache[l.id].data.position,n)||(d.editCache[l.id].data.position=n),f(n)}),a()(),r(5,"td"),u(6,It,2,2,"nz-select",12),a(),r(7,"td")(8,"input",11),T("ngModelChange",function(n){_(t);let l=c().$implicit,d=c();return D(d.editCache[l.id].data.salary,n)||(d.editCache[l.id].data.salary=n),f(n)}),a()(),r(9,"td")(10,"label",13),T("ngModelChange",function(n){_(t);let l=c().$implicit,d=c();return D(d.editCache[l.id].data.overtime,n)||(d.editCache[l.id].data.overtime=n),f(n)}),a()(),r(11,"td")(12,"label",13),T("ngModelChange",function(n){_(t);let l=c().$implicit,d=c();return D(d.editCache[l.id].data.siginout_required,n)||(d.editCache[l.id].data.siginout_required=n),f(n)}),a()(),r(13,"td")(14,"a",14),g("click",function(){_(t);let n=c().$implicit,l=c();return f(l.saveEdit(n.id))}),p(15,"Save"),a(),p(16," \xA0 "),r(17,"a",15),g("nzOnConfirm",function(){_(t);let n=c().$implicit,l=c();return f(l.cancelEdit(n.id))}),p(18,"Cancel"),a()()}if(i&2){let t=c().$implicit,e=c();s(),x(ae(2,8,t.employee)),s(3),w("ngModel",e.editCache[t.id].data.position),s(2),m("ngIf",e.listOfData.length),s(2),w("ngModel",e.editCache[t.id].data.salary),s(2),w("ngModel",e.editCache[t.id].data.overtime),m("nzChecked",e.editCache[t.id].data.overtime),s(2),w("ngModel",e.editCache[t.id].data.siginout_required),m("nzChecked",e.editCache[t.id].data.siginout_required)}}function Mt(i,o){if(i&1&&(r(0,"tr"),u(1,Tt,18,10,"ng-container",8)(2,Nt,19,10,"ng-template",null,9,V),a()),i&2){let t=o.$implicit,e=M(3),n=c();s(),m("ngIf",!(n.editCache[t.id]!=null&&n.editCache[t.id].edit))("ngIfElse",e)}}var rt=(()=>{let o=class o{constructor(e,n){this.appService=e,this.userService=n,this.listOfColumn=[{title:"Employee",compare:(l,d)=>l.employee-d.employee,priority:!1},{title:"Position",compare:(l,d)=>l.position.localeCompare(d.position),priority:!1},{title:"Supervisor",compare:(l,d)=>l.supervisor-d.supervisor,priority:2},{title:"Salary",compare:(l,d)=>l.salary-d.salary,priority:3},{title:"Overtime",compare:(l,d)=>l.salary-d.salary,priority:3},{title:"Signout Required",compare:(l,d)=>l.salary-d.salary,priority:3},{title:"Action",compare:(l,d)=>(l.id||0)-(d.id||0),priority:3}],this.listOfData=[],this.users=[],this.visible=!1,this.editCache={}}ngOnInit(){this.subOrgSubscription=this.appService.currentSubOrganization.subscribe(e=>{this.populateEmployeeData()}),this.getUsers()}getUsers(){return y(this,null,function*(){this.users=yield this.userService.getOrganizationUsers()})}ngOnDestroy(){this.subOrgSubscription&&this.subOrgSubscription.unsubscribe()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateEmployeeData()}populateEmployeeData(){return y(this,null,function*(){this.listOfData=yield this.appService.getOrganizationEmployees(),this.updateEditCache()})}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let n=this.listOfData.findIndex(l=>l.id===e);this.editCache[e]={data:B({},this.listOfData[n]),edit:!1}}saveEdit(e){return y(this,null,function*(){let n=this.listOfData.findIndex(l=>l.id===e);yield this.appService.updateEmployee(B({},this.editCache[e].data)),this.editCache[e].edit=!1,Object.assign(this.listOfData[n],this.editCache[e].data),this.populateEmployeeData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:B({},e)}})}};o.\u0275fac=function(n){return new(n||o)(S(N),S(Ae))},o.\u0275cmp=E({type:o,selectors:[["app-employee-management"]],decls:11,vars:4,consts:[["nz-button","","nzType","primary",3,"click"],[3,"subOrganizations","visible","users","closeDrawer",4,"ngIf"],["nzShowPagination","false","nzTableLayout","fixed",3,"nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"subOrganizations","visible","users","closeDrawer"],[3,"nzSortFn","nzSortPriority"],[4,"ngIf","ngIfElse"],["editTemplate",""],[3,"click"],["type","text","nz-input","",3,"ngModel","ngModelChange"],["id","supervisor","placeholder","Select user",3,"ngModel","ngModelChange",4,"ngIf"],["nz-checkbox","",3,"ngModel","nzChecked","ngModelChange"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],["id","supervisor","placeholder","Select user",3,"ngModel","ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"]],template:function(n,l){if(n&1&&(r(0,"button",0),g("click",function(){return l.open()}),p(1,"Add"),a(),u(2,wt,1,3,"app-employee-contract",1),r(3,"nz-table",2,3)(6,"thead")(7,"tr"),u(8,Dt,2,3,"th",4),a()(),r(9,"tbody"),u(10,Mt,4,2,"tr",5),a()()),n&2){let d=M(5);s(2),m("ngIf",l.visible),s(),m("nzData",l.listOfData),s(5),m("ngForOf",l.listOfColumn),s(2),m("ngForOf",d.data)}},dependencies:[O,I,k,j,R,se,G,me,re,le,K,Ye,F,H,Q,Z,J,L,q,oe,fe,de]});let i=o;return i})();function At(i,o){i&1&&(r(0,"th"),p(1," Action "),a())}function Vt(i,o){if(i&1&&(r(0,"span"),p(1),h(2,"date"),r(3,"a",6),z(4,"span",7),a()()),i&2){let t=c().$implicit;s(),v(" ",b(2,3,t.attendanceObj==null?null:t.attendanceObj.sign_in,"hh:mm a")," "),s(2),m("href","https://www.google.com/maps?q="+(t.attendanceObj==null?null:t.attendanceObj.sign_in_corrd),he)("nzSize","small")}}function Pt(i,o){if(i&1){let t=C();r(0,"nz-time-picker",8),T("ngModelChange",function(n){_(t);let l=c().$implicit;return D(l.attendanceObj.sign_in,n)||(l.attendanceObj.sign_in=n),f(n)}),a()}if(i&2){let t=c().$implicit;w("ngModel",t.attendanceObj.sign_in)}}function jt(i,o){if(i&1&&(r(0,"a",6),z(1,"span",7),a()),i&2){let t=c(2).$implicit;m("href","https://www.google.com/maps?q="+(t.attendanceObj==null?null:t.attendanceObj.sign_out_corrd),he)("nzSize","small")}}function kt(i,o){if(i&1&&(r(0,"span"),p(1),h(2,"date"),u(3,jt,2,2,"a",9),a()),i&2){let t=c().$implicit,e=c();s(),v("",b(2,2,t.attendanceObj==null?null:t.attendanceObj.sign_out,"hh:mm a")," "),s(2),m("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit))}}function Ft(i,o){if(i&1){let t=C();r(0,"nz-time-picker",8),T("ngModelChange",function(n){_(t);let l=c().$implicit;return D(l.attendanceObj.sign_out,n)||(l.attendanceObj.sign_out=n),f(n)}),a()}if(i&2){let t=c().$implicit;w("ngModel",t.attendanceObj.sign_out)}}function Bt(i,o){if(i&1&&(r(0,"span"),p(1),a()),i&2){let t=c().$implicit;s(),v(" ",t.attendanceObj==null?null:t.attendanceObj.approved_hours," ")}}function Wt(i,o){if(i&1){let t=C();r(0,"input",10),T("ngModelChange",function(n){_(t);let l=c().$implicit;return D(l.attendanceObj.approved_hours,n)||(l.attendanceObj.approved_hours=n),f(n)}),a()}if(i&2){let t=c().$implicit;w("ngModel",t.attendanceObj.approved_hours)}}function Ut(i,o){if(i&1){let t=C();r(0,"a",14),g("click",function(){_(t);let n=c(2).$implicit,l=c();return f(l.startEdit(n.id))}),p(1,"Edit"),a()}}function $t(i,o){if(i&1){let t=C();r(0,"a",15),g("click",function(){_(t);let n=c(2).$implicit,l=c();return f(l.saveEdit(n.id))}),p(1,"Save"),a()}}function Lt(i,o){if(i&1){let t=C();r(0,"a",16),g("nzOnConfirm",function(){_(t);let n=c(2).$implicit,l=c();return f(l.cancelEdit(n.id))}),p(1,"Cancel"),a()}}function qt(i,o){if(i&1&&(r(0,"td"),u(1,Ut,2,0,"a",11)(2,$t,2,0,"a",12),p(3," \xA0 "),u(4,Lt,2,0,"a",13),a()),i&2){let t=c().$implicit,e=c();s(),m("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit)),s(),m("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit),s(2),m("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit)}}function Gt(i,o){if(i&1&&(r(0,"tr")(1,"td"),p(2),h(3,"date"),a(),r(4,"td"),u(5,Vt,5,6,"span",2)(6,Pt,1,1,"nz-time-picker",4),a(),r(7,"td"),u(8,kt,4,5,"span",2)(9,Ft,1,1,"nz-time-picker",4),a(),r(10,"td"),p(11),a(),r(12,"td"),u(13,Bt,2,1,"span",2)(14,Wt,1,1,"input",5),a(),r(15,"td")(16,"span"),p(17),a()(),u(18,qt,5,3,"td",2),a()),i&2){let t=o.$implicit,e=c();s(2),v("",b(3,10,t.date,"EEEE d MMM yyyy")," "),s(3),m("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit)),s(),m("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit),s(2),m("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit)),s(),m("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit),s(2),x(t.attendanceObj==null?null:t.attendanceObj.hours_worked),s(2),m("ngIf",!(e.editCache[t.id]!=null&&e.editCache[t.id].edit)),s(),m("ngIf",e.editCache[t.id]==null?null:e.editCache[t.id].edit),s(3),x(t.attendanceObj==null?null:t.attendanceObj.amount),s(),m("ngIf",e.isSupervisor)}}var ge=(()=>{let o=class o{constructor(e){this.appService=e,this.supervisorData=[],this.editCache={}}ngOnInit(){this.getCurrentUserAttance()}getCurrentUserAttance(){return y(this,null,function*(){let e=yield this.appService.getCurrentUserAttendance(this.employee.id);e&&this.initializeSupervisorTableData(e.lastPayment,e.attendances),this.updateEditCache()})}initializeSupervisorTableData(e,n){let l=new Date,d=e?new Date(e.date_created):null,X=n.map(A=>new Date(A.date_created)),Y;d&&d>=new Date(Math.min(...X.map(A=>A.getTime())))?Y=d:X&&X.length?Y=new Date(Math.min(...X.map(A=>A.getTime()))):Y=new Date(this.employee.date_created);let ve=[],U=new Date(Y),Se=0;for(;U<=l;){let A=n.find(ut=>{let be=new Date(ut.date_created);return be.setHours(0,0,0,0),U.setHours(0,0,0,0),be.getTime()===U.getTime()});ve.push({id:Se,date:new Date(U),attendanceObj:A||{}}),U.setDate(U.getDate()+1),Se++}this.supervisorData=ve}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let n=this.supervisorData.findIndex(l=>l.id===e);this.editCache[e]={data:B({},this.supervisorData[n]),edit:!1}}saveEdit(e){return y(this,null,function*(){let n=this.supervisorData.findIndex(l=>l.id===e);this.editCache[e].data.attendanceObj.id?yield this.appService.updateAttendance({id:this.editCache[e].data.attendanceObj.id,sign_in:this.editCache[e].data.attendanceObj.sign_in,sign_out:this.editCache[e].data.attendanceObj.sign_out,hours_worked:this.editCache[e].data.attendanceObj.hours_worked,approved_hours:this.editCache[e].data.attendanceObj.approved_hours,amount:this.editCache[e].data.attendanceObj.approved_hours}):yield this.appService.createAttendance({sign_in:this.editCache[e].data.attendanceObj.sign_in,sign_out:this.editCache[e].data.attendanceObj.sign_out,hours_worked:this.editCache[e].data.attendanceObj.hours_worked,approved_hours:this.editCache[e].data.attendanceObj.approved_hours,amount:this.editCache[e].data.attendanceObj.approved_hours}),this.editCache[e].edit=!1,Object.assign(this.supervisorData[n],this.editCache[e].data),this.getCurrentUserAttance()})}updateEditCache(){this.supervisorData.forEach(e=>{this.editCache[e.id]={edit:!1,data:B({},e)}})}};o.\u0275fac=function(n){return new(n||o)(S(N))},o.\u0275cmp=E({type:o,selectors:[["app-attendance-details"]],inputs:{employee:"employee",isSupervisor:"isSupervisor"},decls:19,vars:4,consts:[["nzShowPagination","false",3,"nzData","nzBordered"],["basicTable",""],[4,"ngIf"],[4,"ngFor","ngForOf"],["nzFormat","HH:mm",3,"ngModel","ngModelChange",4,"ngIf"],["nz-input","",3,"ngModel","ngModelChange",4,"ngIf"],["target","_blank","nz-button","","nzType","default","nzShape","circle","nzShape","round",3,"href","nzSize"],["nz-icon","","nzType","environment","nzTheme","outline"],["nzFormat","HH:mm",3,"ngModel","ngModelChange"],["target","_blank","nz-button","","nzType","default","nzShape","circle","nzShape","round",3,"href","nzSize",4,"ngIf"],["nz-input","",3,"ngModel","ngModelChange"],[3,"click",4,"ngIf"],["class","save",3,"click",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm",4,"ngIf"],[3,"click"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"]],template:function(n,l){n&1&&(r(0,"nz-table",0,1)(2,"thead")(3,"tr")(4,"th"),p(5,"Date"),a(),r(6,"th"),p(7,"Sign In"),a(),r(8,"th"),p(9,"Sign Out"),a(),r(10,"th"),p(11,"Hours Worked"),a(),r(12,"th"),p(13,"Approved Hours"),a(),r(14,"th"),p(15,"Amount"),a(),u(16,At,2,0,"th",2),a()(),r(17,"tbody"),u(18,Gt,19,13,"tr",3),a()()),n&2&&(m("nzData",l.supervisorData)("nzBordered",!0),s(16),m("ngIf",l.isSupervisor),s(2),m("ngForOf",l.supervisorData))},dependencies:[O,I,k,j,je,G,me,K,F,H,Q,Z,J,Ge,L,q,oe,$]});let i=o;return i})();function Rt(i,o){if(i&1&&(r(0,"div"),p(1),h(2,"date"),a()),i&2){let t=c();s(),v(" ",b(2,1,t.signInTime,"hh:mm a"),"")}}function Ht(i,o){if(i&1){let t=C();r(0,"button",4),g("click",function(){_(t);let n=c();return f(n.signIn())}),p(1,"Sign In"),a()}}function Zt(i,o){if(i&1&&(r(0,"div"),p(1),h(2,"date"),a()),i&2){let t=c();s(),v(" ",b(2,1,t.signOutTime,"hh:mm a"),"")}}function Kt(i,o){if(i&1){let t=C();r(0,"button",4),g("click",function(){_(t);let n=c();return f(n.signOut())}),p(1,"Sign Out"),a()}}function Jt(i,o){if(i&1&&(r(0,"td"),p(1),a()),i&2){let t=c().$implicit;s(),x(t.employee==null?null:t.employee.employee.name)}}function Qt(i,o){if(i&1&&z(0,"app-attendance-details",8),i&2){let t=c().$implicit;m("employee",t.employee)("isSupervisor",t.isSupervisor)}}function Xt(i,o){if(i&1&&(r(0,"nz-tab",5),u(1,Jt,2,1,"ng-template",null,6,V)(3,Qt,1,2,"app-attendance-details",7),a()),i&2){let t=o.$implicit,e=M(2);m("nzTitle",e),s(3),m("ngIf",t.employee)}}var st=(()=>{let o=class o{constructor(e,n,l){this.route=e,this.router=n,this.appService=l,this.currentDate=new Date,this.supervisorUsers=[],this.currentDateAttendanceIndex=0}ngOnInit(){this.subOrganizationSubscription=this.appService.currentSubOrganization.subscribe(e=>{this.route.paramMap.subscribe(n=>{e&&e.id>0&&n.get("userId")&&(this.currentUserId=parseInt(n.get("userId")||"0"),this.setCurrentUserDetails(e.id))})}),this.sunscribeToGeoLocation()}sunscribeToGeoLocation(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{this.latitude=e.coords.latitude,this.longitude=e.coords.longitude})}setCurrentUserDetails(e){return y(this,null,function*(){this.employee=yield this.appService.getEmployeeDetail(this.currentUserId,e),this.employee||(alert("No employee found"),this.router.navigate(["/"])),this.getCurrentDayAttance(this.employee.id),this.fetchSupervisorUsers()})}getCurrentDayAttance(e){return y(this,null,function*(){let n=yield this.appService.getCurrentDateAttendance(e);this.processCurentDayAttendance(n)})}processCurentDayAttendance(e){e?(this.currentDateAttendanceIndex=e.id,e.sign_in&&(this.signInTime=new Date(e.sign_in)),e.sign_out&&(this.signOutTime=new Date(e.sign_out))):this.currentDateAttendanceIndex=0}signIn(){return y(this,null,function*(){let e=yield this.appService.createAttendance({employee:this.employee.id,sign_in:new Date,sign_in_corrd:this.latitude+","+this.longitude});this.processCurentDayAttendance(e)})}signOut(){return y(this,null,function*(){let e=yield this.appService.updateAttendance({id:this.currentDateAttendanceIndex,sign_out:new Date,sign_out_corrd:this.latitude+","+this.longitude,hours_worked:Math.round(this.getDifferenceInHours(this.signInTime,new Date))});this.processCurentDayAttendance(e)})}getDifferenceInHours(e,n){return Math.abs(n.getTime()-e.getTime())/(1e3*60*60)}fetchSupervisorUsers(){return y(this,null,function*(){this.supervisorUsers=[{employee:this.employee,isSupervisor:!1}];let e=yield this.appService.getCurrentEmployeeSubordinates(this.currentUserId);e&&e.length&&(this.supervisorUsers=[...this.supervisorUsers,...e.map(n=>({employee:n,isSupervisor:!0}))])})}generateUserData(){let e=new Date("2024-01-01"),n=new Date("2024-01-31"),l=[],d=new Date(e);for(;d<=n;)l.push({date:d}),d=new Date(d.setDate(d.getDate()+1));return l}ngOnDestroy(){this.subOrganizationSubscription&&this.subOrganizationSubscription.unsubscribe()}};o.\u0275fac=function(n){return new(n||o)(S(Ne),S(Me),S(N))},o.\u0275cmp=E({type:o,selectors:[["app-attendance"]],decls:12,vars:9,consts:[[1,"flex","center","space-between"],[4,"ngIf"],["nz-button","","nzType","primary","mat-button","",3,"click",4,"ngIf"],[3,"nzTitle",4,"ngFor","ngForOf"],["nz-button","","nzType","primary","mat-button","",3,"click"],[3,"nzTitle"],["titleTemplate",""],[3,"employee","isSupervisor",4,"ngIf"],[3,"employee","isSupervisor"]],template:function(n,l){n&1&&(r(0,"h1"),p(1,"Attendance"),a(),r(2,"div",0)(3,"strong"),p(4),h(5,"date"),a(),u(6,Rt,3,4,"div",1)(7,Ht,2,0,"button",2)(8,Zt,3,4,"div",1)(9,Kt,2,0,"button",2),a(),r(10,"nz-tabset"),u(11,Xt,4,2,"nz-tab",3),a()),n&2&&(s(4),x(b(5,6,l.currentDate,"longDate")),s(2),m("ngIf",l.signInTime),s(),m("ngIf",!l.signInTime),s(),m("ngIf",l.signOutTime),s(),m("ngIf",l.signInTime&&!l.signOutTime),s(2),m("ngForOf",l.supervisorUsers))},dependencies:[O,I,k,j,R,F,tt,et,ge,$]});let i=o;return i})();function Yt(i,o){if(i&1){let t=C();r(0,"tr")(1,"td"),p(2),a(),r(3,"td"),p(4),h(5,"currency"),a(),r(6,"td")(7,"span"),p(8),h(9,"date"),a()(),r(10,"td"),p(11),h(12,"currency"),a(),r(13,"td"),p(14),h(15,"currency"),a(),r(16,"td")(17,"span"),p(18),h(19,"currency"),a()(),r(20,"td")(21,"a",5),g("click",function(){let l=_(t).$implicit,d=c();return f(d.open(l))}),p(22,"Pay"),a()()()}if(i&2){let t=o.$implicit;s(2),v("",t.employee==null||t.employee.employee==null?null:t.employee.employee.name," "),s(2),v("",b(5,6,t.employee==null?null:t.employee.salary," ")," "),s(4),v("",b(9,9,t.paymentObject==null?null:t.paymentObject.minDateCreated,"dd-mm-yyyy")," "),s(3),x(b(12,12,(t.paymentObject==null?null:t.paymentObject.totalAmount)||0," ")),s(3),v("",b(15,15,(t.paymentObject==null?null:t.paymentObject.balance)||0," ")," "),s(4),x(b(19,18,(t.paymentObject==null?null:t.paymentObject.advanceBalance)||0," "))}}function ei(i,o){if(i&1&&z(0,"app-attendance-details",11),i&2){let t=c(2);m("employee",t.selectedEmployee.employee)}}function ti(i,o){if(i&1&&(r(0,"div",12)(1,"span"),p(2),h(3,"date"),a(),r(4,"span")(5,"b"),p(6),h(7,"currency"),a()()()),i&2){let t=c(2);s(2),v(" Today : ",b(3,2,t.today,"EEEE d MMM yyyy")," "),s(4),v(" Payment ",b(7,5,t.selectedEmployee.paymentObject.totalAmount||0," ")," ")}}function ii(i,o){if(i&1&&(ie(0),r(1,"h3")(2,"strong"),p(3," Employee Attendance "),a()(),u(4,ei,1,1,"app-attendance-details",6),r(5,"nz-collapse",7)(6,"nz-collapse-panel",8)(7,"p",9),p(8," A dog is a type of domesticated animal. Known for its loyalty and faithfulness, it can be found as a welcome guest in many households across the world. "),a()()(),u(9,ti,8,8,"ng-template",null,10,V),ne()),i&2){let t=M(10),e=c();s(4),m("ngIf",e.selectedEmployee),s(2),m("nzHeader",t)("nzActive",e.activeSalaryHistory)}}var pt=(()=>{let o=class o{constructor(e){this.appService=e,this.today=new Date,this.visible=!1}ngOnInit(){this.subOrganizationSubscription=this.appService.currentSubOrganization.subscribe(e=>{e&&e.id>0&&this.setEmployeePayments(e.id)})}ngOnDestroy(){this.subOrganizationSubscription&&this.subOrganizationSubscription.unsubscribe}setEmployeePayments(e){return y(this,null,function*(){this.paymentData=yield this.appService.getEmployeePaymentsDetail(e)})}open(e){this.selectedEmployee=e,this.visible=!0,this.activeSalaryHistory=!1}close(){this.visible=!1}};o.\u0275fac=function(n){return new(n||o)(S(N))},o.\u0275cmp=E({type:o,selectors:[["app-pay-processing"]],decls:24,vars:6,consts:[["nzShowPagination","false",3,"nzData","nzBordered"],["basicTable",""],[4,"ngFor","ngForOf"],["nzPlacement","right","nzWidth","50%",3,"nzClosable","nzVisible","nzTitle","nzOnClose"],[4,"nzDrawerContent"],["nzType","primary",3,"click"],[3,"employee",4,"ngIf"],["nzGhost",""],[3,"nzHeader","nzActive"],[2,"margin","0"],["expandTitle",""],[3,"employee"],[1,"flex","space-between",2,"width","100%"]],template:function(n,l){n&1&&(r(0,"h3"),p(1,"Employee Payments"),a(),r(2,"nz-table",0,1)(4,"thead")(5,"tr")(6,"th"),p(7,"Employee"),a(),r(8,"th"),p(9,"Salary"),a(),r(10,"th"),p(11,"Payment From"),a(),r(12,"th"),p(13,"Amount"),a(),r(14,"th"),p(15,"Balance"),a(),r(16,"th"),p(17,"Advance Balance"),a(),r(18,"th"),p(19," Proceed For Payment "),a()()(),r(20,"tbody"),u(21,Yt,23,21,"tr",2),a()(),r(22,"nz-drawer",3),g("nzOnClose",function(){return l.close()}),u(23,ii,11,3,"ng-container",4),a()),n&2&&(s(2),m("nzData",l.paymentData)("nzBordered",!0),s(19),m("ngForOf",l.paymentData),s(),m("nzClosable",!1)("nzVisible",l.visible)("nzTitle","Payment for Employee: "+(l.selectedEmployee==null||l.selectedEmployee.employee==null?null:l.selectedEmployee.employee.employee.name)))},dependencies:[O,I,He,Re,ce,pe,K,F,H,Q,Z,J,ge,Te,$]});let i=o;return i})();var ni=[{path:"",component:rt,data:{name:"All Employee"}},{path:"pay-processing",component:pt,data:{name:"Payment"}},{path:":employeeId",component:fe,data:{name:"Employee"}},{path:":userId/attendance",component:st,data:{name:"Attendance"}}],ct=(()=>{let o=class o{};o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=ee({type:o}),o.\u0275inj=te({imports:[Ce.forChild(ni),Ce]});let i=o;return i})();var mt=(()=>{let o=class o{constructor(e){this.sanitizer=e}transform(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)}};o.\u0275fac=function(n){return new(n||o)(S(Ie,16))},o.\u0275pipe=we({name:"safe",type:o,pure:!0,standalone:!0});let i=o;return i})();var dt=Ve,ai=Object.keys(dt).map(i=>dt[i]),Yi=(()=>{let o=class o{};o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=ee({type:o}),o.\u0275inj=te({providers:[{provide:qe,useValue:Le},{provide:Pe,useValue:ai},de,mt],imports:[ct,Oe,it,$e,Ue]});let i=o;return i})();export{Yi as EmployeeManagementModule};
