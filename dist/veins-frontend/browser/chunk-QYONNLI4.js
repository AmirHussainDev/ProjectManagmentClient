import{a as ue}from"./chunk-NGE6N3H6.js";import{$c as fe,A as N,Ab as q,B as S,Cb as U,E as b,Eb as v,Fa as F,Fb as $,G as I,Gb as K,Ja as M,Kb as Q,Lb as X,Ma as E,Ob as Y,P as p,Q as l,Qb as ee,Ra as D,Rb as te,Sa as h,Sb as ie,Tb as oe,Ub as re,V as d,Va as P,Vb as ne,X as n,Xa as T,Ya as V,e as _,ea as a,eb as O,fa as m,ga as c,gb as k,hc as ae,ib as j,ja as x,ka as g,la as z,lb as A,nb as R,nc as me,ob as L,oc as se,pa as w,pb as G,qa as f,qb as B,qc as pe,rb as J,rc as le,sb as H,sc as ce,tb as W,ub as Z,w as y,x as C}from"./chunk-YAX6DQEX.js";function _e(t,e){if(t&1){let u=x();a(0,"span",15),g("click",function(){N(u);let i=z();return S(i.passwordVisible=!i.passwordVisible)}),m()}if(t&2){let u=z();n("nzType",u.passwordVisible?"eye-invisible":"eye")}}function ye(t,e){t&1&&(a(0,"nz-form-item")(1,"nz-form-control",16),c(2,"nz-alert",17),m()()),t&2&&(p(),n("nzSpan",24))}var de=(()=>{let e=class e{constructor(o,i,s,r,he){this.fb=o,this.http=i,this.platformId=s,this.router=r,this.appService=he,this.appurl=j.apiUrl,this.organization_id=0,this.showErrorMessage=!1,this.passwordVisible=!1,this.validateForm=this.fb.group({username:["",[v.required]],password:["",[v.required]],remember:[!0]}),h(this.platformId)&&(this.organization_id=parseInt(localStorage.getItem("organization_id")||""))}submitForm(){return _(this,null,function*(){this.showErrorMessage=!1;try{if(this.validateForm.valid){console.log("submit",this.validateForm.value);let o=20,i=this.validateForm.value.password||"",s=this.validateForm.value.username||"",r=yield this.http.post(`${this.appurl}/auth/login`,{organization_id:this.organization_id,username:s,password:i}).toPromise();h(this.platformId)&&r.access_token&&(localStorage.setItem("token",r.access_token),localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("permissions",JSON.stringify(r.user.role_permissions)),localStorage.setItem("sub_organization_id",JSON.stringify(r.user.sub_organization_id)),this.router.navigate(["/"]))}else Object.values(this.validateForm.controls).forEach(o=>{o.invalid&&(o.markAsDirty(),o.updateValueAndValidity({onlySelf:!0}),this.showErrorMessage=!0)})}catch{this.showErrorMessage=!0}})}};e.\u0275fac=function(i){return new(i||e)(l(ee),l(P),l(I),l(O),l(A))},e.\u0275cmp=y({type:e,selectors:[["app-login"]],decls:22,vars:6,consts:[[1,"app-login"],[1,"text-center","p4"],["nz-form","",1,"login-form",3,"formGroup","ngSubmit"],["nzErrorTip","Please input your username!"],["nzPrefixIcon","user"],["type","text","nz-input","","formControlName","username","placeholder","username"],["nzErrorTip","Please input your Password!"],["nzPrefixIcon","lock",3,"nzSuffix"],["nz-input","","formControlName","password","placeholder","Password",3,"type"],["suffixTemplate",""],[4,"ngIf"],["nz-row","",1,"login-form-margin"],["nz-col","",3,"nzSpan"],["nz-checkbox","","formControlName","remember"],["nz-button","",1,"login-form-button","login-form-margin",3,"nzType"],["nz-icon","",3,"nzType","click"],[3,"nzSpan"],["nzType","error","nzMessage","Incorrect credentials !"]],template:function(i,s){if(i&1&&(a(0,"div",0)(1,"h2",1),f(2," Welcome Back!"),m(),a(3,"form",2),g("ngSubmit",function(){return s.submitForm()}),a(4,"nz-form-item")(5,"nz-form-control",3)(6,"nz-input-group",4),c(7,"input",5),m()()(),a(8,"nz-form-item")(9,"nz-form-control",6)(10,"nz-input-group",7),c(11,"input",8),m(),d(12,_e,1,1,"ng-template",null,9,F),m()(),d(14,ye,3,1,"nz-form-item",10),a(15,"div",11)(16,"div",12)(17,"label",13)(18,"span"),f(19,"Remember me"),m()()()(),a(20,"button",14),f(21,"Log in"),m()()()),i&2){let r=w(13);p(3),n("formGroup",s.validateForm),p(7),n("nzSuffix",r),p(),n("type",s.passwordVisible?"text":"password"),p(3),n("ngIf",s.showErrorMessage),p(2),n("nzSpan",12),p(4),n("nzType","primary")}},dependencies:[E,Q,U,$,K,X,Y,q,H,B,J,ae,G,se,me,le,pe,ce,oe,ne,re],styles:[".login-form[_ngcontent-%COMP%]{max-width:300px}.login-form-margin[_ngcontent-%COMP%]{margin-bottom:16px}.login-form-forgot[_ngcontent-%COMP%]{float:right}.login-form-button[_ngcontent-%COMP%]{width:100%}.app-login[_ngcontent-%COMP%]{background:#fff;padding:32px;margin:50px;border-radius:12px}"]});let t=e;return t})();var ge=[{path:"",component:de}];M(ue);var ze=R,Ce=Object.keys(ze).map(t=>ze[t]),ot=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=C({type:e}),e.\u0275inj=b({providers:[k(ge),{provide:Z,useValue:W},{provide:L,useValue:Ce}],imports:[D,te,T,V,ie,fe]});let t=e;return t})();export{ot as a};
