import{b as Y,d as We}from"./chunk-O3FVDKUL.js";import{a as ze}from"./chunk-JD43ETEY.js";import{a as S}from"./chunk-ILRJTMHX.js";import{A as _,Ab as ge,B as f,Ba as M,Bc as Ie,Db as B,Dc as j,E as P,Fb as xe,Fc as Fe,Gc as G,Ha as I,Ia as le,Ib as Ve,Ic as R,Jb as ve,Jc as q,Kc as Z,Lb as we,Lc as J,Mb as ye,N as K,Na as de,Nb as H,O as d,Ob as Se,P as b,Pb as De,Qc as ke,Rc as Ae,U as u,V as p,_ as se,a as E,b as oe,ca as a,da as s,db as ee,e as w,ea as C,eb as me,ec as be,f as re,fa as Q,fc as Te,ga as X,gc as Ee,ha as z,hb as F,hc as Ne,ia as h,ja as l,jb as pe,jc as Oe,kb as ce,lb as _e,lc as Pe,mb as k,mc as Me,na as T,nb as A,oa as c,ob as W,pa as y,pb as fe,qa as $,qb as ue,sa as g,ta as x,ua as V,ub as he,v as ae,vb as Ce,w as N,x as O,xb as U,yb as D,zb as L}from"./chunk-T7SK3QLE.js";function Xe(o,r){if(o&1){let i=z();a(0,"span")(1,"input",7),V("ngModelChange",function(e){_(i);let n=l(2);return x(n.newProduct,e)||(n.newProduct=e),f(e)}),s(),a(2,"button",8),h("click",function(){_(i);let e=l(2);return f(e.handleAddProduct())}),c(3,"Add Product"),s()()}if(o&2){let i=l(2);d(),g("ngModel",i.newProduct)}}function $e(o,r){if(o&1&&(a(0,"tr")(1,"td"),c(2),s()()),o&2){let i=r.$implicit;d(2),y(i.name)}}function et(o,r){if(o&1&&(a(0,"div",2),u(1,Xe,4,1,"span",3),a(2,"nz-table",4)(3,"thead")(4,"tr")(5,"th",5),c(6,"Product Name"),s()()(),a(7,"tbody"),u(8,$e,3,1,"tr",6),s()()()),o&2){let i=l();d(),p("appHasPermission",i.appPermissions.UpdateVendors),d(),p("nzPageSize",1e3)("nzData",i.products),d(6),p("ngForOf",i.products)}}var Ue=(()=>{let r=class r{constructor(t){this.appService=t,this.visible=!1,this.closeDrawer=new ae,this.placement="right",this.products=[],this.newProduct="",this.appPermissions=S}ngOnInit(){this.getAndSetItems()}getAndSetItems(){return w(this,null,function*(){this.products=yield this.appService.getVendorItems(this.vendor.id)})}addNewItem(){return w(this,null,function*(){this.newProduct&&this.newProduct.trim()&&(yield this.appService.addVendorItem(this.vendor.id,this.newProduct.trim()))})}showDrawer(){this.visible=!0}onClose(){this.visible=!1,this.closeDrawer.emit(!0)}handleAddProduct(){return w(this,null,function*(){this.newProduct.trim()!==""&&(this.products.push({name:this.newProduct.trim()}),yield this.addNewItem(),this.newProduct="",this.getAndSetItems())})}};r.\u0275fac=function(e){return new(e||r)(b(F))},r.\u0275cmp=N({type:r,selectors:[["app-vendor-details"]],inputs:{vendor:"vendor",visible:"visible"},outputs:{closeDrawer:"closeDrawer"},decls:2,vars:4,consts:[[3,"nzClosable","nzVisible","nzPlacement","nzTitle","nzOnClose"],["class","vendor-details",4,"nzDrawerContent"],[1,"vendor-details"],[4,"appHasPermission"],["nzShowPagination","false","nzBordered","",3,"nzPageSize","nzData"],["nzWidth","50%"],[4,"ngFor","ngForOf"],["nz-input","","placeholder","Enter product name",2,"margin-bottom","12px",3,"ngModel","ngModelChange"],["nz-button","","nzType","primary",2,"margin-bottom","12px",3,"click"]],template:function(e,n){e&1&&(a(0,"nz-drawer",0),h("nzOnClose",function(){return n.onClose()}),u(1,et,9,4,"div",1),s()),e&2&&p("nzClosable",!1)("nzVisible",n.visible)("nzPlacement",n.placement)("nzTitle",n.vendor.name)},dependencies:[I,W,k,A,Te,be,H,q,j,G,J,R,Z,U,L,B,Y]});let o=r;return o})();function it(o,r){if(o&1){let i=z();a(0,"span",17),h("click",function(){_(i);let e=l(3);return e.searchValue="",f(e.search())}),s()}}function nt(o,r){o&1&&C(0,"span",18)}function ot(o,r){if(o&1&&u(0,it,1,0,"span",16)(1,nt,1,0),o&2){let i=l(2);se(0,i.searchValue?0:1)}}function rt(o,r){o&1&&C(0,"span",18)}function at(o,r){if(o&1){let i=z();a(0,"div",8)(1,"span",9)(2,"h3",10),c(3," Vendors "),s(),a(4,"nz-input-group",11)(5,"input",12),V("ngModelChange",function(e){_(i);let n=l();return x(n.searchValue,e)||(n.searchValue=e),f(e)}),h("keyup",function(){_(i);let e=l();return f(e.search())}),s()(),u(6,ot,2,1,"ng-template",null,13,M)(8,rt,1,0,"ng-template",null,14,M),s(),a(10,"button",15),h("click",function(){_(i);let e=l();return f(e.showModal())}),c(11,"Add Vendor"),s()()}if(o&2){let i=T(7),t=T(9),e=l();d(4),p("nzSuffix",t)("nzSuffix",i),d(),g("ngModel",e.searchValue)}}function st(o,r){if(o&1){let i=z();a(0,"app-vendor-details",19),h("closeDrawer",function(){_(i);let e=l();return f(e.drawerVisible=!1)}),s()}if(o&2){let i=l();p("vendor",i.selectedVendor)("visible",i.drawerVisible)}}function lt(o,r){if(o&1&&(Q(0),C(1,"span",33),a(2,"div",34),c(3,"Upload"),s(),X()),o&2){let i=l(2);d(),p("nzType",i.loading?"loading":"plus")}}function dt(o,r){if(o&1&&C(0,"img",35),o&2){let i=l(2);p("src",i.avatarUrl,K)}}function mt(o,r){if(o&1){let i=z();a(0,"nz-form",20)(1,"nz-form-item")(2,"nz-form-label",21),c(3,"Vendor Name"),s(),a(4,"nz-form-control",22),C(5,"input",23),s()(),a(6,"nz-form-item")(7,"nz-form-label",21),c(8,"Contact No"),s(),a(9,"nz-form-control",24),C(10,"input",25),s()(),a(11,"nz-form-item")(12,"nz-form-label",21),c(13,"Email"),s(),a(14,"nz-form-control",26),C(15,"input",27),s()(),a(16,"nz-form-item")(17,"nz-form-label",21),c(18,"Address"),s(),a(19,"nz-form-control",28),C(20,"input",29),s()(),a(21,"nz-form-item")(22,"nz-form-label",21),c(23,"Vendor Image"),s(),a(24,"nz-form-control",22)(25,"nz-upload",30),h("nzChange",function(e){_(i);let n=l();return f(n.handleChange(e))}),u(26,lt,4,1,"ng-container",31)(27,dt,1,1,"img",32),s()()()()}if(o&2){let i=l();p("formGroup",i.addVendorForm),d(25),p("nzShowUploadList",!1)("nzBeforeUpload",i.beforeUpload),d(),p("ngIf",!i.avatarUrl),d(),p("ngIf",i.avatarUrl)}}function pt(o,r){if(o&1&&(a(0,"th",36),c(1),s()),o&2){let i=r.$implicit;p("nzSortFn",i.compare)("nzSortPriority",i.priority),d(),$(" ",i.title," ")}}function ct(o,r){if(o&1){let i=z();a(0,"a",42),h("click",function(){_(i);let e=l(2).$implicit,n=l();return f(n.startEdit(e.id))}),c(1,"Edit"),s()}}function _t(o,r){if(o&1){let i=z();Q(0),a(1,"td")(2,"div")(3,"span",39),h("click",function(){_(i);let e=l().$implicit,n=l();return f(n.viewDetails(e))}),s(),C(4,"img",40),a(5,"span"),c(6),s()()(),a(7,"td"),c(8),s(),a(9,"td"),c(10),s(),a(11,"td"),c(12),s(),a(13,"td"),u(14,ct,2,0,"a",41),s(),X()}if(o&2){let i=l().$implicit,t=l();d(4),p("src",t.apiUrl+"/images/"+i.filename,K),d(2),$(" ",i.name,""),d(2),y(i.contact_no),d(2),y(i.address),d(2),y(i.email),d(2),p("appHasPermission",t.appPermissions.UpdateVendors)}}function ft(o,r){if(o&1){let i=z();a(0,"td")(1,"input",43),V("ngModelChange",function(e){_(i);let n=l().$implicit,m=l();return x(m.editCache[n.id].data.name,e)||(m.editCache[n.id].data.name=e),f(e)}),s()(),a(2,"td")(3,"input",43),V("ngModelChange",function(e){_(i);let n=l().$implicit,m=l();return x(m.editCache[n.id].data.contact_no,e)||(m.editCache[n.id].data.contact_no=e),f(e)}),s()(),a(4,"td")(5,"input",43),V("ngModelChange",function(e){_(i);let n=l().$implicit,m=l();return x(m.editCache[n.id].data.address,e)||(m.editCache[n.id].data.address=e),f(e)}),s()(),a(6,"td")(7,"input",43),V("ngModelChange",function(e){_(i);let n=l().$implicit,m=l();return x(m.editCache[n.id].data.email,e)||(m.editCache[n.id].data.email=e),f(e)}),s()(),a(8,"td")(9,"a",44),h("click",function(){_(i);let e=l().$implicit,n=l();return f(n.saveEdit(e.id))}),c(10,"Save"),s(),c(11," \xA0 "),a(12,"a",45),h("nzOnConfirm",function(){_(i);let e=l().$implicit,n=l();return f(n.cancelEdit(e.id))}),c(13,"Cancel"),s()()}if(o&2){let i=l().$implicit,t=l();d(),g("ngModel",t.editCache[i.id].data.name),d(2),g("ngModel",t.editCache[i.id].data.contact_no),d(2),g("ngModel",t.editCache[i.id].data.address),d(2),g("ngModel",t.editCache[i.id].data.email)}}function ut(o,r){if(o&1&&(a(0,"tr"),u(1,_t,15,6,"ng-container",37)(2,ft,14,4,"ng-template",null,38,M),s()),o&2){let i=r.$implicit,t=T(3),e=l();d(),p("ngIf",!(e.editCache[i.id]!=null&&e.editCache[i.id].edit))("ngIfElse",t)}}var Le=(()=>{let r=class r{constructor(t,e){this.appService=t,this.fb=e,this.apiUrl=me.apiUrl,this.isModalVisible=!1,this.drawerVisible=!1,this.selectedVendor={},this.appPermissions=S,this.listOfColumn=[{title:"Name",compare:(n,m)=>n.name.localeCompare(m.name),priority:!1},{title:"Contact No",compare:(n,m)=>n.contact_no.localeCompare(m.contact_no),priority:!1},{title:"Address",compare:(n,m)=>n.address.localeCompare(m.address),priority:!1},{title:"Email",compare:(n,m)=>n.email.localeCompare(m.email),priority:!1},{title:"Action",compare:(n,m)=>n.role_id-m.role_id,priority:!1}],this.listOfData=[],this.visible=!1,this.listOfDisplayData=[],this.editCache={},this.beforeUpload=(n,m)=>new re(v=>{let ie=n.type==="image/jpeg"||n.type==="image/png";if(!ie){this.msg.error("You can only upload JPG file!"),v.complete();return}let ne=n.size/1024/1024<2;if(!ne){this.msg.error("Image must smaller than 2MB!"),v.complete();return}this.addVendorForm.patchValue({file:n}),v.next(ie&&ne),v.complete()}),this.addVendorForm=this.fb.group({name:["",[D.required]],contact_no:["",[D.required]],email:["",[D.required]],address:["",[D.required]],file:["",[D.required]]})}showModal(){this.isModalVisible=!0}handleOk(){return w(this,null,function*(){yield this.appService.createVendor(this.addVendorForm.value.name,this.addVendorForm.value.file),this.isModalVisible=!1,this.populateVendorData()})}handleCancel(){this.isModalVisible=!1}ngOnInit(){this.currentSubOrganizationSubscription=this.appService.currentSubOrganization.subscribe(t=>{t&&t.id>0&&this.populateVendorData()})}ngOnDestroy(){this.currentSubOrganizationSubscription&&this.currentSubOrganizationSubscription.unsubscribe()}open(){this.visible=!0}close(t=!1){this.visible=!1,t&&this.populateVendorData()}populateVendorData(){return w(this,null,function*(){this.listOfData=yield this.appService.getVendors(),this.listOfDisplayData=this.listOfData,this.updateEditCache()})}startEdit(t){this.editCache[t].edit=!0}cancelEdit(t){let e=this.listOfDisplayData.findIndex(n=>n.id===t);this.editCache[t]={data:E({},this.listOfDisplayData[e]),edit:!1}}saveEdit(t){return w(this,null,function*(){let e=this.listOfDisplayData.findIndex(n=>n.id===t);yield this.appService.updateVendor(oe(E({id:t},this.editCache[t].data),{organization_id:this.editCache[t].data.organization_id,role_id:this.editCache[t].data.role_id,reports_to:this.editCache[t].data.reports_to,name:this.editCache[t].data.name})),this.editCache[t].edit=!1,Object.assign(this.listOfDisplayData[e],this.editCache[t].data),this.populateVendorData()})}updateEditCache(){this.listOfDisplayData.forEach(t=>{this.editCache[t.id]={edit:!1,data:E({},t)}})}viewDetails(t){this.selectedVendor=t,this.drawerVisible=!0}getBase64(t,e){let n=new FileReader;n.addEventListener("load",()=>e(n.result.toString())),n.readAsDataURL(t)}handleChange(t){this.getBase64(t.file.originFileObj,e=>{this.loading=!1,this.avatarUrl=e})}search(){this.searchVisible=!1,this.searchValue?(this.listOfDisplayData=this.listOfData.filter(t=>t.name&&t.name.toLowerCase().indexOf(this.searchValue.toLowerCase())>-1),console.log(this.listOfDisplayData)):this.listOfDisplayData=this.listOfData}};r.\u0275fac=function(e){return new(e||r)(b(F),b(ve))},r.\u0275cmp=N({type:r,selectors:[["app-vendor"]],decls:12,vars:7,consts:[["class","flex space-between","style","margin-bottom:5px",4,"appHasPermission"],[3,"vendor","visible","closeDrawer",4,"ngIf"],["nzTitle","Add Vendor",3,"nzVisible","nzVisibleChange","nzOnCancel","nzOnOk"],[3,"formGroup",4,"nzModalContent"],["nzShowPagination","false","nzTableLayout","fixed",3,"nzPageSize","nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"flex","space-between",2,"margin-bottom","5px"],[2,"display","-webkit-box","width","100%"],[2,"margin-right","5px"],[3,"nzSuffix"],["type","text","placeholder","Search here","nz-input","",3,"ngModel","ngModelChange","keyup"],["inputClearTpl",""],["suffixIconSearch",""],["nz-button","","nzType","primary","nzSize","small",3,"click"],["nz-icon","","class","ant-input-clear-icon","nzTheme","fill","nzType","close-circle"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],["nz-icon","","nzType","search"],[3,"vendor","visible","closeDrawer"],[3,"formGroup"],["nzRequired",""],["nzHasFeedback","","nzErrorTip","Please input Vendor name"],["nz-input","","formControlName","name"],["nzHasFeedback","","nzErrorTip","Please input Vendor contact no"],["nz-input","","formControlName","contact_no"],["nzHasFeedback","","nzErrorTip","Please input Vendor email"],["nz-input","","formControlName","email"],["nzHasFeedback","","nzErrorTip","Please input vendor address"],["nz-input","","formControlName","address"],["nzAction","null","nzName","avatar","nzListType","picture-card",1,"avatar-uploader",3,"nzShowUploadList","nzBeforeUpload","nzChange"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"],[3,"nzSortFn","nzSortPriority"],[4,"ngIf","ngIfElse"],["editTemplate",""],["nz-button","","nz-icon","","nzType","profile","nzTheme","outline",2,"font-size","24px",3,"click"],["alt","",1,"smallIcon",3,"src"],[3,"click",4,"appHasPermission"],[3,"click"],["type","text","nz-input","",3,"ngModel","ngModelChange"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"]],template:function(e,n){if(e&1&&(u(0,at,12,3,"div",0)(1,st,1,2,"app-vendor-details",1),a(2,"nz-modal",2),V("nzVisibleChange",function(v){return x(n.isModalVisible,v)||(n.isModalVisible=v),v}),h("nzOnCancel",function(){return n.handleCancel()})("nzOnOk",function(){return n.handleOk()}),u(3,mt,28,5,"nz-form",3),s(),a(4,"nz-table",4,5)(7,"thead")(8,"tr"),u(9,pt,2,3,"th",6),s()(),a(10,"tbody"),u(11,ut,4,2,"tr",7),s()()),e&2){let m=T(6);p("appHasPermission",n.appPermissions.UpdateVendors),d(),p("ngIf",n.drawerVisible),d(),g("nzVisible",n.isModalVisible),d(2),p("nzPageSize",1e3)("nzData",n.listOfDisplayData),d(5),p("ngForOf",n.listOfColumn),d(2),p("ngForOf",m.data)}},dependencies:[I,le,W,k,A,_e,Ne,Ee,Oe,Me,Pe,H,De,Se,Ce,he,Ie,q,Fe,j,G,J,R,Z,ke,U,L,ge,xe,Ve,B,Y,Ue],styles:["[_nghost-%COMP%]     .avatar-uploader>.ant-upload{width:128px;height:128px}"]});let o=r;return o})();var ht=[{path:"",component:Le,children:[],data:{name:"",permission:S.ViewVendors},canActivate:[ze]}],Be=(()=>{let r=class r{};r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=O({type:r}),r.\u0275inj=P({imports:[ee.forChild(ht),ee]});let o=r;return o})();var He=pe,Ct=Object.keys(He).map(o=>He[o]),ii=(()=>{let r=class r{};r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=O({type:r}),r.\u0275inj=P({providers:[{provide:ue,useValue:fe},{provide:ce,useValue:Ct}],imports:[de,Be,Ae,ye,we,We]});let o=r;return o})();export{ii as VendorModule};
