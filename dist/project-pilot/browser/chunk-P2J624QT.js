import{b as J,f as Fe}from"./chunk-HUCT2AA2.js";import{a as he}from"./chunk-WES5WHKE.js";import{a as y}from"./chunk-UQBFF3T4.js";import"./chunk-US7SBZSK.js";import{$ as D,Ad as G,Bd as q,Cd as Z,Da as b,Ea as _,Fa as N,Fb as ee,G as S,Ga as X,Gb as le,Gd as Me,Hd as Oe,Ja as x,K as T,Ka as P,L as V,La as w,Qb as M,R as m,S as d,Sb as ce,Sc as ye,Tb as pe,Tc as De,U as oe,Ub as me,Uc as be,Va as I,Vb as O,Vc as Se,Wb as F,Xb as k,Xc as Te,Yb as de,Z as Y,Zb as _e,Zc as Ve,_ as l,_c as Ne,a as $,bc as fe,cc as ue,eb as E,f as g,fa as f,fb as ae,fc as A,h as ne,hc as v,ia as c,ic as U,jc as Ce,mb as se,mc as W,na as re,oc as ge,ra as a,rc as ze,rd as Ie,sa as s,sc as xe,ta as z,ua as K,uc as Pe,ud as B,va as Q,vc as we,wc as L,wd as Ee,xa as C,xc as ve,xd as R,ya as u,yc as je,za as o,zd as H}from"./chunk-RYV5VKQF.js";function Ye(i,p){if(i&1){let e=C();a(0,"span")(1,"input",7),w("ngModelChange",function(t){m(e);let r=o(2);return P(r.newProduct,t)||(r.newProduct=t),d(t)}),s(),a(2,"button",8),u("click",function(){m(e);let t=o(2);return d(t.handleAddProduct())}),_(3,"Add Product"),s()()}if(i&2){let e=o(2);l(),x("ngModel",e.newProduct)}}function Ke(i,p){if(i&1&&(a(0,"tr")(1,"td"),_(2),s()()),i&2){let e=p.$implicit;l(2),N(e.name)}}function Qe(i,p){if(i&1&&(a(0,"div",2),f(1,Ye,4,1,"span",3),a(2,"nz-table",4)(3,"thead")(4,"tr")(5,"th",5),_(6,"Product Name"),s()()(),a(7,"tbody"),f(8,Ke,3,1,"tr",6),s()()()),i&2){let e=o();l(),c("appHasPermission",e.appPermissions.AddTask),l(),c("nzPageSize",1e3)("nzData",e.products),l(6),c("ngForOf",e.products)}}var ke=(()=>{class i{constructor(e){this.appService=e,this.visible=!1,this.closeDrawer=new oe,this.placement="right",this.products=[],this.newProduct="",this.appPermissions=y}ngOnInit(){this.getAndSetItems()}getAndSetItems(){return g(this,null,function*(){this.products=yield this.appService.getProjectItems(this.project.id)})}addNewItem(){return g(this,null,function*(){this.newProduct&&this.newProduct.trim()&&(yield this.appService.addProjectItem(this.project.id,this.newProduct.trim()))})}showDrawer(){this.visible=!0}onClose(){this.visible=!1,this.closeDrawer.emit(!0)}handleAddProduct(){return g(this,null,function*(){this.newProduct.trim()!==""&&(this.products.push({name:this.newProduct.trim()}),yield this.addNewItem(),this.newProduct="",this.getAndSetItems())})}static{this.\u0275fac=function(n){return new(n||i)(D(M))}}static{this.\u0275cmp=T({type:i,selectors:[["app-project-details"]],inputs:{project:"project",visible:"visible"},outputs:{closeDrawer:"closeDrawer"},decls:2,vars:4,consts:[[3,"nzOnClose","nzClosable","nzVisible","nzPlacement","nzTitle"],["class","project-details",4,"nzDrawerContent"],[1,"project-details"],[4,"appHasPermission"],["nzShowPagination","false","nzBordered","",3,"nzPageSize","nzData"],["nzWidth","50%"],[4,"ngFor","ngForOf"],["nz-input","","placeholder","Enter product name",2,"margin-bottom","12px",3,"ngModelChange","ngModel"],["nz-button","","nzType","primary",2,"margin-bottom","12px",3,"click"]],template:function(n,t){n&1&&(a(0,"nz-drawer",0),u("nzOnClose",function(){return t.onClose()}),f(1,Qe,9,4,"div",1),s()),n&2&&c("nzClosable",!1)("nzVisible",t.visible)("nzPlacement",t.placement)("nzTitle",t.project.name)},dependencies:[E,k,O,F,De,ye,L,G,B,R,Z,H,q,A,U,W,J]})}}return i})();function et(i,p){if(i&1){let e=C();a(0,"span",19),u("click",function(){m(e);let t=o(3);return t.searchValue="",d(t.search())}),s()}}function tt(i,p){i&1&&z(0,"span",18)}function it(i,p){if(i&1&&f(0,et,1,0,"span",17)(1,tt,1,0,"span",18),i&2){let e=o(2);re(e.searchValue?0:1)}}function nt(i,p){i&1&&z(0,"span",18)}function ot(i,p){if(i&1){let e=C();a(0,"div",11)(1,"span",12)(2,"h3",13),_(3," Projects "),s(),a(4,"nz-input-group",14)(5,"input",15),w("ngModelChange",function(t){m(e);let r=o();return P(r.searchValue,t)||(r.searchValue=t),d(t)}),u("keyup",function(){m(e);let t=o();return d(t.search())}),s()(),f(6,it,2,1,"ng-template",null,1,I)(8,nt,1,0,"ng-template",null,2,I),s(),a(10,"button",16),u("click",function(){m(e);let t=o();return d(t.showModal())}),_(11,"Add Project"),s()()}if(i&2){let e=b(7),n=b(9),t=o();l(4),c("nzSuffix",n)("nzSuffix",e),l(),x("ngModel",t.searchValue)}}function rt(i,p){if(i&1){let e=C();a(0,"app-project-details",20),u("closeDrawer",function(){m(e);let t=o();return d(t.drawerVisible=!1)}),s()}if(i&2){let e=o();c("project",e.selectedProject)("visible",e.drawerVisible)}}function at(i,p){if(i&1&&(K(0),z(1,"span",30),a(2,"div",31),_(3,"Upload"),s(),Q()),i&2){let e=o(2);l(),c("nzType",e.loading?"loading":"plus")}}function st(i,p){if(i&1&&z(0,"img",32),i&2){let e=o(2);c("src",e.avatarUrl,Y)}}function lt(i,p){if(i&1){let e=C();a(0,"nz-form",21)(1,"nz-form-item")(2,"nz-form-label",22),_(3,"Project Name"),s(),a(4,"nz-form-control",23),z(5,"input",24),s()(),a(6,"nz-form-item")(7,"nz-form-label",22),_(8,"Description"),s(),a(9,"nz-form-control",25),z(10,"textarea",26),s()(),a(11,"nz-form-item")(12,"nz-form-label",22),_(13,"Project Image"),s(),a(14,"nz-form-control",23)(15,"nz-upload",27),u("nzChange",function(t){m(e);let r=o();return d(r.handleChange(t))}),f(16,at,4,1,"ng-container",28)(17,st,1,1,"img",29),s()()()()}if(i&2){let e=o();c("formGroup",e.addProjectForm),l(15),c("nzShowUploadList",!1)("nzBeforeUpload",e.beforeUpload),l(),c("ngIf",!e.avatarUrl),l(),c("ngIf",e.avatarUrl)}}function ct(i,p){if(i&1&&(a(0,"th",33),_(1),s()),i&2){let e=p.$implicit;c("nzSortFn",e.compare)("nzSortPriority",e.priority),l(),X(" ",e.title," ")}}function pt(i,p){if(i&1&&z(0,"img",38),i&2){let e=o(2).$implicit,n=o();c("src",n.apiUrl+"/images/"+e.filename,Y)}}function mt(i,p){if(i&1){let e=C();a(0,"a",39),u("click",function(){m(e);let t=o(2).$implicit,r=o();return r.startEdit(t.id),d(r.showModal(!1))}),_(1,"Edit"),s()}}function dt(i,p){if(i&1){let e=C();K(0),a(1,"td")(2,"div")(3,"span",35),u("click",function(){m(e);let t=o().$implicit,r=o();return d(r.viewDetails(t))}),s(),f(4,pt,1,1,"img",36),a(5,"span"),_(6),s()()(),a(7,"td"),_(8),s(),a(9,"td"),f(10,mt,2,0,"a",37),s(),Q()}if(i&2){let e=o().$implicit,n=o();l(4),c("ngIf",e.filename),l(2),X(" ",e.name,""),l(2),N(e.description),l(2),c("appHasPermission",n.appPermissions.AddTask)}}function _t(i,p){if(i&1){let e=C();a(0,"td")(1,"input",40),w("ngModelChange",function(t){m(e);let r=o().$implicit,h=o();return P(h.editCache[r.id].data.name,t)||(h.editCache[r.id].data.name=t),d(t)}),s()(),a(2,"td")(3,"input",40),w("ngModelChange",function(t){m(e);let r=o().$implicit,h=o();return P(h.editCache[r.id].data.description,t)||(h.editCache[r.id].data.description=t),d(t)}),s()(),a(4,"td")(5,"a",41),u("click",function(){m(e);let t=o().$implicit,r=o();return d(r.saveEdit(t.id))}),_(6,"Save"),s(),_(7," \xA0 "),a(8,"a",42),u("nzOnConfirm",function(){m(e);let t=o().$implicit,r=o();return d(r.cancelEdit(t.id))}),_(9,"Cancel"),s()()}if(i&2){let e=o().$implicit,n=o();l(),x("ngModel",n.editCache[e.id].data.name),l(2),x("ngModel",n.editCache[e.id].data.description)}}function ft(i,p){if(i&1&&(a(0,"tr"),f(1,dt,11,4,"ng-container",34)(2,_t,10,2,"ng-template",null,3,I),s()),i&2){let e=p.$implicit,n=b(3),t=o();l(),c("ngIf",!(t.editCache[e.id]!=null&&t.editCache[e.id].edit))("ngIfElse",n)}}var Ae=(()=>{class i{constructor(e,n){this.appService=e,this.fb=n,this.apiUrl=le.apiUrl,this.isModalVisible=!1,this.drawerVisible=!1,this.selectedProject={},this.appPermissions=y,this.listOfColumn=[{title:"Name",compare:(t,r)=>t.name.localeCompare(r.name),priority:!1},{title:"Description",compare:(t,r)=>t.description.localeCompare(r.description),priority:!1},{title:"Action",compare:(t,r)=>t.role_id-r.role_id,priority:!1}],this.listOfData=[],this.visible=!1,this.listOfDisplayData=[],this.editCache={},this.beforeUpload=(t,r)=>new ne(h=>{let j=t.type==="image/jpeg"||t.type==="image/png";if(!j){this.msg.error("You can only upload JPG file!"),h.complete();return}let ie=t.size/1024/1024<2;if(!ie){this.msg.error("Image must smaller than 2MB!"),h.complete();return}this.addProjectForm.patchValue({file:t}),h.next(j&&ie),h.complete()}),this.addProjectForm=this.fb.group({name:["",[v.required]],id:[0],description:["",[v.required]],file:["",[v.required]]})}showModal(e=!0){this.newItem=e,this.newItem&&(this.addProjectForm.reset(),this.avatarUrl=""),this.isModalVisible=!0}handleOk(){return g(this,null,function*(){this.isModalVisible=!1,this.newItem?yield this.appService.createProject(this.addProjectForm.value,this.addProjectForm.value.file):yield this.appService.updateProject(this.addProjectForm.value,this.addProjectForm.value.file),this.isModalVisible=!1,this.populateProjectData()})}handleCancel(){this.isModalVisible=!1}ngOnInit(){this.currentClientSubscription=this.appService.currentClient.subscribe(e=>{e&&e.id>0&&this.populateProjectData()})}ngOnDestroy(){this.currentClientSubscription&&this.currentClientSubscription.unsubscribe()}open(){this.visible=!0}close(e=!1){this.visible=!1,e&&this.populateProjectData()}populateProjectData(){return g(this,null,function*(){this.listOfData=yield this.appService.getProjects(),this.listOfDisplayData=this.listOfData,this.updateEditCache()})}startEdit(e){this.editableItem=this.editCache[e].data,this.addProjectForm=this.fb.group({name:[this.editableItem.name,[v.required]],description:[this.editableItem.description,[v.required]],file:[null,[v.required]],id:[this.editableItem.id]}),this.avatarUrl="api/images/"+this.editableItem.filename}cancelEdit(e){let n=this.listOfDisplayData.findIndex(t=>t.id===e);this.editCache[e]={data:$({},this.listOfDisplayData[n]),edit:!1}}saveEdit(e){return g(this,null,function*(){let n=this.listOfDisplayData.findIndex(t=>t.id===e);this.editCache[e].edit=!1,Object.assign(this.listOfDisplayData[n],this.editCache[e].data),this.populateProjectData()})}updateEditCache(){this.listOfDisplayData.forEach(e=>{this.editCache[e.id]={edit:!1,data:$({},e)}})}viewDetails(e){this.selectedProject=e,this.drawerVisible=!0}getBase64(e,n){let t=new FileReader;t.addEventListener("load",()=>n(t.result.toString())),t.readAsDataURL(e)}handleChange(e){this.getBase64(e.file.originFileObj,n=>{this.loading=!1,this.avatarUrl=n})}search(){this.searchVisible=!1,this.searchValue?(this.listOfDisplayData=this.listOfData.filter(e=>e.name&&e.name.toLowerCase().indexOf(this.searchValue.toLowerCase())>-1),console.log(this.listOfDisplayData)):this.listOfDisplayData=this.listOfData}static{this.\u0275fac=function(n){return new(n||i)(D(M),D(xe))}}static{this.\u0275cmp=T({type:i,selectors:[["app-project"]],decls:12,vars:8,consts:[["editRowTable","","sortTable",""],["inputClearTpl",""],["suffixIconSearch",""],["editTemplate",""],["class","flex space-between","style","margin-bottom:5px",4,"appHasPermission"],[3,"project","visible","closeDrawer",4,"ngIf"],[3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzTitle"],[3,"formGroup",4,"nzModalContent"],["nzShowPagination","false",3,"nzPageSize","nzData"],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"flex","space-between",2,"margin-bottom","5px"],[2,"display","-webkit-box","width","100%"],[2,"margin-right","5px"],[3,"nzSuffix"],["type","text","placeholder","Search here","nz-input","",3,"ngModelChange","keyup","ngModel"],["nz-button","","nzType","primary","nzSize","small",3,"click"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon"],["nz-icon","","nzType","search"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],[3,"closeDrawer","project","visible"],[3,"formGroup"],["nzRequired",""],["nzHasFeedback","","nzErrorTip","Please input Project name"],["nz-input","","formControlName","name"],["nzHasFeedback","","nzErrorTip","Please input project description"],["nz-input","","rows","2","formControlName","description"],["nzAction","null","nzName","avatar","nzListType","picture-card",1,"avatar-uploader",3,"nzChange","nzShowUploadList","nzBeforeUpload"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"],[3,"nzSortFn","nzSortPriority"],[4,"ngIf","ngIfElse"],["nz-button","","nz-icon","","nzType","profile","nzTheme","outline",2,"font-size","24px",3,"click"],["class","smallIcon","alt","",3,"src",4,"ngIf"],[3,"click",4,"appHasPermission"],["alt","",1,"smallIcon",3,"src"],[3,"click"],["type","text","nz-input","",3,"ngModelChange","ngModel"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"]],template:function(n,t){if(n&1){let r=C();f(0,ot,12,3,"div",4)(1,rt,1,2,"app-project-details",5),a(2,"nz-modal",6),w("nzVisibleChange",function(j){return m(r),P(t.isModalVisible,j)||(t.isModalVisible=j),d(j)}),u("nzOnCancel",function(){return m(r),d(t.handleCancel())})("nzOnOk",function(){return m(r),d(t.handleOk())}),f(3,lt,18,5,"nz-form",7),s(),a(4,"nz-table",8,0)(7,"thead")(8,"tr"),f(9,ct,2,3,"th",9),s()(),a(10,"tbody"),f(11,ft,4,2,"tr",10),s()()}if(n&2){let r=b(6);c("appHasPermission",t.appPermissions.AddTask),l(),c("ngIf",t.drawerVisible),l(),x("nzVisible",t.isModalVisible),c("nzTitle",t.newItem?"Add Project":"Edit Project"),l(2),c("nzPageSize",1e3)("nzData",t.listOfDisplayData),l(5),c("ngForOf",t.listOfColumn),l(2),c("ngForOf",r.data)}},dependencies:[E,ae,k,O,F,me,Se,be,Te,Ne,Ve,L,je,ve,ue,fe,Ie,G,Ee,B,R,Z,H,q,Me,A,U,Ce,ge,ze,W,J,ke],styles:["[_nghost-%COMP%]     .avatar-uploader>.ant-upload{width:128px;height:128px}"]})}}return i})();var ut=[{path:"",component:Ae,children:[],data:{name:"",permission:y.ViewTasks},canActivate:[he]}],Ue=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=V({type:i})}static{this.\u0275inj=S({imports:[ee.forChild(ut),ee]})}}return i})();var We=ce,ht=Object.keys(We).map(i=>We[i]),ti=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=V({type:i})}static{this.\u0275inj=S({providers:[{provide:_e,useValue:de},{provide:pe,useValue:ht}],imports:[se,Ue,Oe,we,Pe,Fe]})}}return i})();export{ti as ProjectModule};
