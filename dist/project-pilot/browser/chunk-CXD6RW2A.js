import{a as u}from"./chunk-62EMLTDR.js";import{Cb as p,Lb as h,M as n,P as c,R as r,Xb as d,jb as l,mb as f,xb as m}from"./chunk-ALEK3DEW.js";var v=(()=>{let e=class e{constructor(i,t,s){this.http=i,this.platformId=t,this.appService=s}isLoggedIn(){if(l(this.platformId)){let i=localStorage.getItem("token");if(i){let t=this.getTokenExpirationDate(i);return t===void 0||t<=new Date?(this.logout(),!1):(this.setUserClient(),!0)}}return!1}getTokenExpirationDate(i){try{let t=JSON.parse(atob(i.split(".")[1]));return t&&t.exp?new Date(t.exp*1e3):void 0}catch{return}}logout(){localStorage.removeItem("token")}setUserClient(){this.appService.getAndSetUserDefaultClient()}};e.\u0275fac=function(t){return new(t||e)(r(f),r(c),r(h))},e.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var U=(()=>{let e=class e{constructor(i,t,s,a){this.authService=i,this.userService=t,this.router=s,this.modal=a}canActivate(i,t){if(this.authService.isLoggedIn()){if(this.userService.loggedInUser.is_admin)return!0;let s=i.data.permission;return s&&!this.userService.hasPermission(s)?(s==u.MainDashboardView?this.router.navigate(["/employee"]):this.modal.create({nzTitle:"Insufficient Permission!",nzContent:"You do not have permission to view this content. Please contact with admin for queries.",nzFooter:null}).afterClose.subscribe(()=>{localStorage.removeItem("redirectUrl"),this.router.navigate([this.router.lastSuccessfulNavigation?.previousNavigation])}),!1):!0}else return this.router.navigate(["/login"]),!1}};e.\u0275fac=function(t){return new(t||e)(r(v),r(p),r(m),r(d))},e.\u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();export{U as a};
