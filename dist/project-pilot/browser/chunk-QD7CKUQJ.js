import{a as rt}from"./chunk-34L3VTGA.js";import{a as st}from"./chunk-COVKA2NU.js";import{a as Y,b as $}from"./chunk-2EKTRE4X.js";import{a as R}from"./chunk-CXD6RW2A.js";import{a as P,m as A,n as N,t as F}from"./chunk-62EMLTDR.js";import{Ab as T,Da as f,F as w,Fa as y,Fc as Z,G as S,Lb as W,Mc as q,N as v,Nb as B,Nc as J,Ob as L,Qa as X,Sa as I,Tb as G,Ub as K,Z as a,_ as D,db as E,e as _,f as z,ga as O,hb as j,ia as s,ib as H,pc as V,qc as U,ra as c,sa as p,ta as b,ya as x,yd as Q}from"./chunk-ALEK3DEW.js";var M=_(st());var et=_(rt());function ct(n,i){if(n&1&&(c(0,"nz-card",11),b(1,"highcharts-chart",12),p()),n&2){let d=x();a(),s("Highcharts",d.Highcharts)("options",d.siteChartOptions)("constructorType",d.chartConstructor)}}function lt(n,i){if(n&1&&(c(0,"nz-card",11),b(1,"highcharts-chart",12),p()),n&2){let d=x();a(),s("Highcharts",d.Highcharts)("options",d.chartOptions)("constructorType",d.chartConstructor)}}function pt(n,i){if(n&1&&(c(0,"nz-card"),b(1,"highcharts-chart",13),p()),n&2){let d=x();a(),s("Highcharts",d.Highcharts)("options",d.piechartOptions)("constructorType",d.chartConstructor)}}function dt(n,i){if(n&1&&b(0,"highcharts-chart",12),n&2){let d=x();s("Highcharts",d.Highcharts)("options",d.lineChartOptions)("constructorType",d.chartConstructor)}}(0,et.default)(M);var it=(()=>{let i=class i{constructor(r){this.appService=r,this.isHighcharts=typeof M=="object",this.title="UnivHighCharts",this.Highcharts=M,this.chartConstructor="chart",this.sitesGraphKeys=A,this.chartOptions={},this.siteChartOptions={},this.stateNames=N,this.piechartOptions={},this.lineChartOptions={},this.showTopTen=!1,this.currentOrganizationId=0,this.selectedItem="",this.showMonthly=!1,this.projectStats={},this.chartOptions={chart:{type:"gauge",plotBackgroundColor:"",plotBorderWidth:0,plotShadow:!1,height:"80%"},title:{text:"Progress %",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},pane:{startAngle:-90,endAngle:90,background:[],center:["50%","70%"],size:"100%"},credits:{enabled:!1},yAxis:{min:0,max:100,lineWidth:0,tickPositions:[0,50,100],tickLength:0,labels:{enabled:!1},plotBands:[{from:0,to:50,color:"#6A55FF",thickness:"50%"},{from:50,to:100,color:"#E0E0E0",thickness:"50%"}]},series:[{type:"gauge",name:"Progress",data:[52],dataLabels:{format:"{y} %",borderWidth:0,style:{fontSize:"18px",fontWeight:"bold"},y:20},dial:{radius:"100%",backgroundColor:"#4D4D4D",baseWidth:10,rearLength:"0%"},pivot:{backgroundColor:"#4D4D4D",radius:6}}]},this.siteChartOptions={chart:{type:"bar"},title:{text:"Task Breakdown by Status",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},credits:{enabled:!1},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},xAxis:{categories:[]},yAxis:{min:0,title:{text:"Tasks Count",align:"high"},labels:{overflow:"justify"}},series:[{type:"bar",name:"Tasks",data:[]}],plotOptions:{bar:{dataLabels:{enabled:!0}}}},this.piechartOptions={chart:{type:"pie"},title:{text:"Tasks By Severity",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},tooltip:{valueSuffix:"",style:{fontSize:"11px"}},credits:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.2f} %",distance:-30}}},series:[]},this.lineChartOptions={chart:{type:"column",backgroundColor:"transparent",height:218},credits:{enabled:!1},title:{text:"",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},plotOptions:{series:{label:{connectorAllowed:!1},pointStart:0}},xAxis:{categories:[]},series:[],responsive:{rules:[{condition:{maxWidth:500},chartOptions:{}}]},legend:{enabled:!0}}}ngAfterViewInit(){}ngOnDestroy(){}ngOnInit(){this.clientSubscription=this.appService.currentClient.subscribe(r=>{r&&r.id>0&&this.currentOrganizationId!=r.id&&(this.currentOrganizationId=r.id,this.currentClient=r,this.loadData())})}loadData(){return z(this,null,function*(){yield this.getProjectStats(this.currentOrganizationId),this.setProjectProgress(this.currentOrganizationId),this.loadStatistics(this.currentOrganizationId)})}loadStatistics(r){return z(this,null,function*(){this.showChart=!1;let o=this.projectStats.tasks,e=o.map(l=>l.siteName),m=[];o.forEach((l,h)=>{Object.entries(l).forEach(([t,g])=>{if(t!=="siteId"&&t!=="siteName")if(h===0)m.push({name:this.sitesGraphKeys[t],data:[g]});else{let C=m.find(k=>k.name===this.sitesGraphKeys[t]);C&&C.data.push(g)}})});let u={};this.projectStats.tasks.forEach(l=>{let h=this.stateNames[l.state];u[h]||(u[h]=0),u[h]++}),this.siteChartOptions.xAxis&&this.siteChartOptions.xAxis&&(this.siteChartOptions.xAxis.categories=Object.values(this.stateNames)),this.siteChartOptions.series&&this.siteChartOptions.series[0]&&(this.siteChartOptions.series[0].data=Object.keys(this.stateNames).map(l=>{let h=this.stateNames[l];return u[h]||0})),setTimeout(()=>{this.showChart=!0},100)})}getProjectStats(r=0){return z(this,null,function*(){this.projectStats=yield this.appService.getProjectStatsByClient(r),this.totalApprovedHours=this.projectStats.worklogs.reduce((o,e)=>o+(e.approved_hours||e.no_of_hours||0),0),this.paidApprovedHours=this.projectStats.worklogs.filter(o=>o.paid).reduce((o,e)=>o+(e.approved_hours||e.no_of_hours||0),0),this.totalEstimatedHours=this.calculateTotalEstimatedHours(this.projectStats.tasks)})}calculateTotalEstimatedHours(r){return r.reduce((o,e)=>{let m=new Date(e.start_date),u=new Date(e.due_date),h=Math.floor((u.getTime()-m.getTime())/(1e3*60*60*24))*8;return o+h},0)}setProjectProgress(r=0){return z(this,null,function*(){this.showTopTen=!1;let o=this.projectStats.tasks.length,e=this.projectStats.tasks.filter(t=>t.state===4).length,m=Math.round(e/o*100),u=[];u[0]={type:"gauge",name:"Progress",data:[m],dataLabels:{format:"{y} %",borderWidth:0,style:{fontSize:"18px",fontWeight:"bold"},y:20},dial:{radius:"100%",backgroundColor:"#4D4D4D",baseWidth:10,rearLength:"0%"},pivot:{backgroundColor:"#4D4D4D",radius:6}},this.chartOptions.series=u,this.chartOptions.yAxis={min:0,max:100,lineWidth:0,tickPositions:[0,50,100],tickLength:0,labels:{enabled:!1},plotBands:[{from:0,to:m,color:"#6A55FF",thickness:"50%"},{from:m,to:100,color:"#E0E0E0",thickness:"50%"}]};let l={Medium:0,Low:0,Critical:0,High:0};this.projectStats.tasks.forEach(t=>{let g=F[t.severity];g&&l[g]++});let h=[{name:"Tasks",colorByPoint:!0,data:[{name:"Low",y:l.Low,color:"#00FF00"},{name:"Medium",y:l.Medium,color:"#0000FF"},{name:"High",y:l.High,color:"#FF8000"},{name:"Critical",y:l.Critical,color:"#FF0000"}]}];this.piechartOptions.series=h,setTimeout(()=>{this.showTopTen=!0},100),this.setItemBasedTrend()})}setItemBasedTrend(){return z(this,null,function*(){this.showMonthly=!1;let r=this.projectStats.worklogs,o=this.projectStats.tasks,e={},m={},u=[],l=[];o.forEach(t=>{let g=new Date(t.start_date||t.due_date||new Date),C=new Date(t.due_date||t.start_date||new Date),ot=Math.floor((C.getTime()-g.getTime())/(1e3*60*60*24))*8;e[t.id]=ot,m[t.id]=0,u.push(t.id),l.push(t.task_no)}),r.forEach(t=>{let g=t.id;m[g]+=t.approved_hours||t.no_of_hours||0});let h=[{name:"Estimated Time",data:u.map(t=>e[t]||0),type:"column",color:"blue"},{name:"Consumed Time",data:u.map(t=>m[t]||0),type:"line",color:"red",marker:{enabled:!0}}];h[0].data=h[0].data.map((t,g)=>m[o[g].id]>t?{y:t,color:"red"}:t),this.lineChartOptions.xAxis&&(this.lineChartOptions.xAxis.categories=l,this.lineChartOptions.series=h),setTimeout(()=>{this.showMonthly=!0},100)})}};i.\u0275fac=function(o){return new(o||i)(D(W))},i.\u0275cmp=w({type:i,selectors:[["app-dashboard"]],decls:43,vars:56,consts:[[1,"dashboard"],["nzGutter","16",2,"margin-bottom","12px"],[1,"num_details",3,"nzSm","nzXs","nzMd","nzXl","nzXXl"],["nzGutter","8"],[3,"nzSm","nzXs","nzMd","nzXl","nzXXl"],[2,"margin-top","12px",";margin-bottom","12px",3,"title"],[2,"margin-top","12px","margin-bottom","12px",3,"title"],[2,"margin-top","12px","margin-bottom","12px"],["style","margin-bottom: 12px;",4,"ngIf"],[4,"ngIf"],["style","width: 100%;display: block;",3,"Highcharts","options","constructorType",4,"ngIf"],[2,"margin-bottom","12px"],[2,"width","100%","display","block",3,"Highcharts","options","constructorType"],[2,"width","100%","display","block","min-height","200px",3,"Highcharts","options","constructorType"]],template:function(o,e){o&1&&(c(0,"div",0)(1,"nz-row",1)(2,"nz-col",2)(3,"nz-row",3)(4,"nz-col",4)(5,"nz-card",5)(6,"h3"),f(7),p(),c(8,"h5"),f(9,"Budget: "),c(10,"b"),f(11),X(12,"currency"),p()(),c(13,"h5"),f(14,"Duration: "),c(15,"b"),f(16),p()()()(),c(17,"nz-col",4)(18,"nz-card",6)(19,"h3"),f(20," Estimated Hours"),p(),c(21,"h5"),f(22),p()()(),c(23,"nz-col",4)(24,"nz-card",6)(25,"h3"),f(26," Utilized Hours"),p(),c(27,"h5"),f(28),p()()(),c(29,"nz-col",4)(30,"nz-card",7)(31,"h3"),f(32," Paid hours"),p(),c(33,"h5"),f(34),p()()()()(),c(35,"nz-col",4),O(36,ct,2,3,"nz-card",8),p(),c(37,"nz-col",4),O(38,lt,2,3,"nz-card",8)(39,pt,2,3,"nz-card",9),p(),c(40,"nz-col",4)(41,"nz-card"),O(42,dt,1,3,"highcharts-chart",10),p()()()()),o&2&&(a(2),s("nzSm",24)("nzXs",24)("nzMd",24)("nzXl",24)("nzXXl",24),a(2),s("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),a(),s("title","Current Stock"),a(2),y(" ",e.currentClient==null?null:e.currentClient.name,""),a(4),y(" ",I(12,53,e.currentClient==null?null:e.currentClient.projectBudget,"PKR "),""),a(5),y(" ",e.currentClient==null?null:e.currentClient.projectDuration," hours"),a(),s("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),a(),s("title","Max Tasks"),a(4),y(" ",e.totalEstimatedHours,""),a(),s("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),a(),s("title","Max Tasks"),a(4),y(" ",e.totalApprovedHours,""),a(),s("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),a(5),y(" ",e.paidApprovedHours,""),a(),s("nzSm",24)("nzXs",24)("nzMd",17)("nzXl",17)("nzXXl",17),a(),s("ngIf",e.showChart),a(),s("nzSm",24)("nzXs",24)("nzMd",7)("nzXl",7)("nzXXl",7),a(),s("ngIf",e.showTopTen),a(),s("ngIf",e.showTopTen),a(),s("nzSm",24)("nzXs",24)("nzMd",24)("nzXl",24)("nzXXl",24),a(2),s("ngIf",e.showMonthly))},dependencies:[E,Z,J,q,Y,j],styles:[".green-button[_ngcontent-%COMP%]{background-color:#72e272}.green-button[_ngcontent-%COMP%], .default[_ngcontent-%COMP%]{font-size:11px;text-wrap:nowrap;border:none}[_nghost-%COMP%]{display:block;height:100%}.card-container[_ngcontent-%COMP%]     p{margin:0}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-content{margin-top:-16px;margin-bottom:16px}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-content>.ant-tabs-tabpane{background:#ffffffb6;padding:16px}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card>.ant-tabs-nav:before{display:none}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-tab{border-color:transparent;background:transparent}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-tab-active{background:#ffffffb6}.num_details[_ngcontent-%COMP%]    >.ant-card-body{padding:4px}"]});let n=i;return n})();var ht=[{path:"",component:it,data:{name:"Task Requests",permission:P.MainDashboard},canActivate:[R]}],nt=(()=>{let i=class i{};i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=S({type:i}),i.\u0275inj=v({imports:[T.forChild(ht),T]});let n=i;return n})();var at=B,mt=Object.keys(at).map(n=>at[n]),Pt=(()=>{let i=class i{};i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=S({type:i}),i.\u0275inj=v({providers:[{provide:K,useValue:G},{provide:L,useValue:mt}],imports:[H,nt,Q,U,$,V]});let n=i;return n})();export{Pt as DashboardModule};
