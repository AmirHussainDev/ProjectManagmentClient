import{a as ue}from"./chunk-NGE6N3H6.js";import{$ as p,Cb as O,Da as x,Ea as f,Eb as k,G as N,Gb as L,Hd as fe,K as S,L as I,Oc as me,Qb as j,R as u,S as d,Sb as A,Tb as R,Ub as G,Uc as ae,Va as b,Vb as B,Vc as se,Wb as U,X as w,Xb as J,Xc as pe,Yb as W,Yc as le,Zb as Z,Zc as ce,_ as s,cb as F,dc as q,f as y,fa as g,fb as M,fc as H,hc as C,ia as n,ic as $,jc as K,mb as V,nb as _,nc as Q,oc as X,qb as D,ra as m,rc as Y,sa as a,sb as E,ta as c,tb as P,tc as ee,ub as T,uc as te,vc as ie,wc as oe,xa as h,xc as re,ya as z,yc as ne,za as v}from"./chunk-RYV5VKQF.js";function _e(e,ze){if(e&1){let t=h();m(0,"span",15),z("click",function(){u(t);let o=v();return d(o.passwordVisible=!o.passwordVisible)}),a()}if(e&2){let t=v();n("nzType",t.passwordVisible?"eye-invisible":"eye")}}function Ce(e,ze){e&1&&(m(0,"nz-form-item")(1,"nz-form-control",16),c(2,"nz-alert",17),a()()),e&2&&(s(),n("nzSpan",24))}var de=(()=>{class e{constructor(t,i,o,r,l){this.fb=t,this.http=i,this.platformId=o,this.router=r,this.appService=l,this.appurl=L.apiUrl,this.organization_id=0,this.showErrorMessage=!1,this.passwordVisible=!1,this.validateForm=this.fb.group({username:["",[C.required]],password:["",[C.required]],remember:[!0]}),_(this.platformId)&&(this.organization_id=parseInt(localStorage.getItem("organization_id")||""))}submitForm(){return y(this,null,function*(){this.showErrorMessage=!1;try{if(this.validateForm.valid){console.log("submit",this.validateForm.value);let t=20,i=this.validateForm.value.password||"",o=this.validateForm.value.username||"",r=yield this.http.post(`${this.appurl}/auth/login`,{organization_id:this.organization_id,username:o,password:i}).toPromise();if(_(this.platformId)&&r.access_token){localStorage.setItem("token",r.access_token),localStorage.setItem("user",JSON.stringify(r.user)),localStorage.setItem("permissions",JSON.stringify(r.user.role_permissions)),localStorage.setItem("client_id",JSON.stringify(r.user.client_id));let l=localStorage.getItem("redirectUrl");this.router.navigateByUrl(l||"/")}}else Object.values(this.validateForm.controls).forEach(t=>{t.invalid&&(t.markAsDirty(),t.updateValueAndValidity({onlySelf:!0}),this.showErrorMessage=!0)})}catch{this.showErrorMessage=!0}})}static{this.\u0275fac=function(i){return new(i||e)(p(ee),p(D),p(w),p(O),p(j))}}static{this.\u0275cmp=S({type:e,selectors:[["app-login"]],decls:22,vars:6,consts:[["suffixTemplate",""],[1,"app-login"],[1,"text-center","p4"],["nz-form","",1,"login-form",3,"ngSubmit","formGroup"],["nzErrorTip","Please input your username!"],["nzPrefixIcon","user"],["type","text","nz-input","","formControlName","username","placeholder","username"],["nzErrorTip","Please input your Password!"],["nzPrefixIcon","lock",3,"nzSuffix"],["nz-input","","formControlName","password","placeholder","Password",3,"type"],[4,"ngIf"],["nz-row","",1,"login-form-margin"],["nz-col","",3,"nzSpan"],["nz-checkbox","","formControlName","remember"],["nz-button","",1,"login-form-button","login-form-margin",3,"nzType"],["nz-icon","",3,"click","nzType"],[3,"nzSpan"],["nzType","error","nzMessage","Incorrect credentials !"]],template:function(i,o){if(i&1){let r=h();m(0,"div",1)(1,"h2",2),f(2," Welcome Back!"),a(),m(3,"form",3),z("ngSubmit",function(){return u(r),d(o.submitForm())}),m(4,"nz-form-item")(5,"nz-form-control",4)(6,"nz-input-group",5),c(7,"input",6),a()()(),m(8,"nz-form-item")(9,"nz-form-control",7)(10,"nz-input-group",8),c(11,"input",9),a(),g(12,_e,1,1,"ng-template",null,0,b),a()(),g(14,Ce,3,1,"nz-form-item",10),m(15,"div",11)(16,"div",12)(17,"label",13)(18,"span"),f(19,"Remember me"),a()()()(),m(20,"button",14),f(21,"Log in"),a()()()}if(i&2){let r=x(13);s(3),n("formGroup",o.validateForm),s(7),n("nzSuffix",r),s(),n("type",o.passwordVisible?"text":"password"),s(3),n("ngIf",o.showErrorMessage),s(2),n("nzSpan",12),s(4),n("nzType","primary")}},dependencies:[M,Q,H,$,K,X,Y,q,J,B,U,me,G,se,ae,le,pe,ce,oe,ne,re],styles:[".login-form[_ngcontent-%COMP%]{max-width:300px}.login-form-margin[_ngcontent-%COMP%]{margin-bottom:16px}.login-form-forgot[_ngcontent-%COMP%]{float:right}.login-form-button[_ngcontent-%COMP%]{width:100%}.app-login[_ngcontent-%COMP%]{background:#fff;padding:32px;margin:50px;border-radius:12px}"]})}}return e})();var ge=[{path:"",component:de}];F(ue);var he=A,ye=Object.keys(he).map(e=>he[e]),ot=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=I({type:e})}static{this.\u0275inj=N({providers:[k(ge),{provide:Z,useValue:W},{provide:R,useValue:ye},E(P(),T())],imports:[V,te,ie,fe]})}}return e})();export{ot as a};
