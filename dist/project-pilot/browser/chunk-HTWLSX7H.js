import{a as we}from"./chunk-L26K7SAR.js";import{b as re,e as vt,f as zt}from"./chunk-HUCT2AA2.js";import{a as Ve}from"./chunk-WES5WHKE.js";import{a as k}from"./chunk-UQBFF3T4.js";import"./chunk-US7SBZSK.js";import{$ as b,Ab as Ze,Ad as J,Bd as Q,Cb as Je,Cd as ee,Da as T,Ea as l,Ed as gt,F as He,Fa as u,Fb as Ae,Fd as ft,G as me,Ga as E,Gc as pt,Hb as Qe,Hc as ct,Hd as Ct,Ic as dt,Ja as N,Jc as ut,K as D,Ka as M,Kc as yt,L as pe,La as O,N as Ue,Nc as Ce,Oa as Ge,Pa as $e,Qb as I,R as g,Ra as qe,S as f,Sa as y,Sb as et,Sc as ve,Ta as Re,Tb as tt,Tc as ze,U as Ke,Ua as h,Ub as ce,Uc as q,Va as R,Vb as V,Vc as X,Wb as B,Xb as F,Xc as xe,Yb as it,Yc as _t,Zb as nt,Zc as Se,_ as a,_c as be,a as ie,bc as de,cc as ue,eb as P,f as C,fa as d,fb as A,fc as L,hc as w,ia as s,ib as ne,ic as G,jc as ye,kc as _e,lb as oe,lc as W,mb as Xe,mc as he,na as Le,nc as ot,oc as ge,ra as r,rc as fe,rd as Ee,sa as o,sc as rt,ta as z,ua as H,uc as at,ud as j,va as U,vc as lt,wc as $,wd as ht,xa as x,xc as st,xd as Y,ya as v,yb as Ye,yc as mt,za as p,zd as Z}from"./chunk-RYV5VKQF.js";var Mt=()=>({overflow:"auto"});function Ot(i,c){if(i&1&&z(0,"nz-option",15),i&2){let e=c.$implicit;s("nzValue",e==null?null:e.id)("nzLabel",e==null?null:e.name)}}function Rt(i,c){if(i&1&&(r(0,"nz-select",13),d(1,Ot,1,2,"nz-option",14),o()),i&2){let e=p(2);a(),s("ngForOf",e.users)}}function At(i,c){if(i&1&&(r(0,"nz-form",3)(1,"div",4)(2,"div",5)(3,"nz-form-item")(4,"nz-form-label"),l(5,"Job Title"),o(),r(6,"nz-form-control"),z(7,"input",6),o()()()(),r(8,"div",4)(9,"div",7)(10,"nz-form-item")(11,"nz-form-label"),l(12,"Employee"),o(),r(13,"nz-form-control"),d(14,Rt,2,1,"nz-select",8),o()()()(),r(15,"div",4)(16,"div",5)(17,"nz-form-item")(18,"nz-form-label"),l(19,"Salary Nature"),o(),r(20,"nz-form-control")(21,"nz-radio-group",9)(22,"label",10),l(23,"Hourly"),o(),r(24,"label",10),l(25,"Fixed"),o()()()()()(),r(26,"div",4)(27,"div",5)(28,"nz-form-item")(29,"nz-form-label"),l(30,"HourlyRate"),o(),r(31,"nz-form-control"),z(32,"input",11),o()()()(),r(33,"div",4)(34,"div",5)(35,"nz-form-item")(36,"nz-form-label"),l(37,"Employement Details"),o(),r(38,"nz-form-control"),z(39,"textarea",12),o()()()()()),i&2){let e=p();s("formGroup",e.employeeForm),a(),s("nzGutter",8),a(7),s("nzGutter",8),a(6),s("ngIf",e.users.length),a(),s("nzGutter",8),a(7),s("nzValue",!0),a(2),s("nzValue",!1),a(2),s("nzGutter",8),a(7),s("nzGutter",8),a(6),s("rows",3)}}function Vt(i,c){if(i&1){let e=x();r(0,"div",16)(1,"button",17),v("click",function(){g(e);let n=p();return f(n.close())}),l(2,"Cancel"),o(),r(3,"button",18),v("click",function(){g(e);let n=p();return f(n.addUser())}),l(4,"Submit"),o()()}if(i&2){let e=p();a(3),s("disabled",!e.employeeForm.valid)}}var Te=(()=>{class i{constructor(e,t){this.appService=e,this.fb=t,this.visible=!1,this.users=[],this.userRoles=[],this.clients=[],this.editableItem={},this.isNew=!0,this.closeDrawer=new Ke,this.employeeForm=this.fb.group({id:[0,[]],employee:[0,[w.required]],position:["",[w.required]],isHourlyRateHourly:[!1],salary:[0,[w.required]],organization:[parseInt(localStorage.getItem("organization_id")||"0")],client:[this.appService.currentSubOrgId],details:["",[w.required]]})}ngOnInit(){this.isNew&&this.employeeForm.reset(),this.employeeForm=this.fb.group({id:[this.editableItem.id],employee:[this.editableItem.employee,[w.required]],position:[this.editableItem.position,[w.required]],isHourlyRateHourly:[this.editableItem.isHourlyRateHourly],salary:[this.editableItem.salary,[w.required]],organization:[parseInt(localStorage.getItem("organization_id")||"0")],client:[this.editableItem.client],details:[this.editableItem.details,[w.required]]})}close(){this.closeDrawer.emit(!1)}addUser(){return C(this,null,function*(){console.log(this.employeeForm),this.isNew?yield this.appService.createEmployee({position:this.employeeForm.value.position,employee:this.employeeForm.value.employee,salary:this.employeeForm.value.salary,isHourlyRateHourly:this.employeeForm.value.isHourlyRateHourly,details:this.employeeForm.value.details}):yield this.appService.updateEmployee({id:this.editableItem.id,position:this.employeeForm.value.position,employee:this.employeeForm.value.employee,salary:this.employeeForm.value.salary,isHourlyRateHourly:this.employeeForm.value.isHourlyRateHourly,details:this.employeeForm.value.details}),this.closeDrawer.emit(!0)})}objectKeys(e){return Object.keys(e).map(t=>({key:t,value:e[t]}))}static{this.\u0275fac=function(t){return new(t||i)(b(I),b(rt))}}static{this.\u0275cmp=D({type:i,selectors:[["app-employee-contract"]],inputs:{visible:"visible",users:"users",userRoles:"userRoles",clients:"clients",editableItem:"editableItem",isNew:"isNew"},outputs:{closeDrawer:"closeDrawer"},decls:4,vars:7,consts:[["footerTpl",""],[3,"nzOnClose","nzBodyStyle","nzMaskClosable","nzWidth","nzVisible","nzTitle","nzFooter"],[3,"formGroup",4,"nzDrawerContent"],[3,"formGroup"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","12"],["formControlName","position","nz-input","","placeholder","please enter user position"],["nz-col","","nz-col","","nzSpan","12"],["id","employee","formControlName","employee","placeholder","Select user",4,"ngIf"],["formControlName","isHourlyRateHourly"],["nz-radio","",3,"nzValue"],["formControlName","salary","nz-input","","placeholder","please enter user salary"],["nz-input","","formControlName","details",3,"rows"],["id","employee","formControlName","employee","placeholder","Select user"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],[2,"float","right"],["nz-button","",2,"margin-right","8px",3,"click"],["nz-button","","nzType","primary",3,"click","disabled"]],template:function(t,n){if(t&1){let m=x();r(0,"nz-drawer",1),v("nzOnClose",function(){return g(m),f(n.close())}),d(1,At,40,10,"nz-form",2)(2,Vt,5,1,"ng-template",null,0,R),o()}if(t&2){let m=T(3);s("nzBodyStyle",Ge(6,Mt))("nzMaskClosable",!1)("nzWidth",720)("nzVisible",n.visible)("nzTitle",n.isNew?"Create Employee":"Update Employee")("nzFooter",m)}},dependencies:[P,A,F,V,B,ze,ve,X,q,xe,be,Se,$,ct,pt,dt,ut,L,G,ye,ge,fe]})}}return i})();var jt=i=>[i],Ht=(i,c,e)=>({user:i,permissionName:0,isAdmin:c,isContractor:!1,userIds:e});function Ut(i,c){if(i&1){let e=x();r(0,"span",16),v("click",function(){g(e);let n=p(2);return n.searchValue="",f(n.search())}),o()}}function Kt(i,c){i&1&&z(0,"span",15)}function Lt(i,c){if(i&1&&d(0,Ut,1,0,"span",14)(1,Kt,1,0,"span",15),i&2){let e=p();Le(e.searchValue?0:1)}}function Gt(i,c){i&1&&z(0,"span",15)}function $t(i,c){if(i&1){let e=x();r(0,"button",17),v("click",function(){g(e);let n=p();return f(n.open())}),l(1,"Add"),o()}}function qt(i,c){if(i&1){let e=x();r(0,"app-employee-contract",18),v("closeDrawer",function(n){g(e);let m=p();return f(m.close(n))}),o()}if(i&2){let e=p();s("clients",e.clients)("visible",e.visible)("users",e.users)("editableItem",e.editableItem)("isNew",e.isNew)}}function Xt(i,c){if(i&1&&(r(0,"th",19),l(1),o()),i&2){let e=c.$implicit;s("nzSortFn",e.compare)("nzSortPriority",e.priority),a(),E(" ",e.title," ")}}function Yt(i,c){if(i&1&&(r(0,"td"),l(1),o()),i&2){let e=p(3).$implicit;a(),u(e.isHourlyRateHourly?"Hourly":"Fixed")}}function Zt(i,c){if(i&1&&(r(0,"td"),l(1),o()),i&2){let e=p(3).$implicit;a(),u(e.salary)}}function Jt(i,c){if(i&1){let e=x();r(0,"a",24),v("click",function(){g(e);let n=p(3).$implicit,m=p();return m.startEdit(n.id),f(m.open(!1))}),l(1,"Edit"),o()}}function Qt(i,c){if(i&1&&(H(0),r(1,"td"),l(2),y(3,"username"),o(),r(4,"td"),l(5),o(),d(6,Yt,2,1,"td",22)(7,Zt,2,1,"td",22),r(8,"td"),d(9,Jt,2,0,"a",23),o(),U()),i&2){let e=p(2).$implicit,t=p();a(2),u(Re(3,5,e.employee)),a(3),u(e.position),a(),s("appHasPermission",t.appPermissions.UpdateClientEmployee),a(),s("appHasPermission",t.appPermissions.UpdateClientEmployee),a(2),s("appHasPermission",t.appPermissions.UpdateClientEmployee)}}function ei(i,c){if(i&1){let e=x();r(0,"td"),l(1),y(2,"username"),o(),r(3,"td")(4,"input",25),O("ngModelChange",function(n){g(e);let m=p(2).$implicit,_=p();return M(_.editCache[m.id].data.position,n)||(_.editCache[m.id].data.position=n),f(n)}),o()(),r(5,"td")(6,"input",25),O("ngModelChange",function(n){g(e);let m=p(2).$implicit,_=p();return M(_.editCache[m.id].data.salary,n)||(_.editCache[m.id].data.salary=n),f(n)}),o()(),r(7,"td")(8,"a",26),v("click",function(){g(e);let n=p(2).$implicit,m=p();return f(m.saveEdit(n.id))}),l(9,"Save"),o(),l(10," \xA0 "),r(11,"a",27),v("nzOnConfirm",function(){g(e);let n=p(2).$implicit,m=p();return f(m.cancelEdit(n.id))}),l(12,"Cancel"),o()()}if(i&2){let e=p(2).$implicit,t=p();a(),u(Re(2,3,e.employee)),a(3),N("ngModel",t.editCache[e.id].data.position),a(2),N("ngModel",t.editCache[e.id].data.salary)}}function ti(i,c){if(i&1&&(r(0,"tr"),d(1,Qt,10,7,"ng-container",21)(2,ei,13,5,"ng-template",null,3,R),o()),i&2){let e=T(3),t=p().$implicit,n=p();a(),s("ngIf",!(n.editCache[t.id]!=null&&n.editCache[t.id].edit))("ngIfElse",e)}}function ii(i,c){if(i&1&&(H(0),d(1,ti,4,2,"tr",20),U()),i&2){let e=c.$implicit,t=p();a(),s("filterUser",qe(3,Ht,t.loggedInUser,t.loggedInUser.is_admin,$e(1,jt,e.employee)))}}var St=(()=>{class i{constructor(e,t){this.appService=e,this.userService=t,this.listOfColumn=[{title:"Employee",compare:(n,m)=>n.employeeName.localeCompare(m.employeeName),priority:1},{title:"Position",compare:(n,m)=>n.position.localeCompare(m.position),priority:2},{title:"Action",compare:(n,m)=>(n.id||0)-(m.id||0),priority:5}],this.listOfData=[],this.users=[],this.visible=!1,this.appPermissions=k,this.listOfDisplayData=[],this.editCache={}}ngOnInit(){this.loggedInUser=this.userService.loggedInUser,this.getUsers(),this.loggedInUser.is_admin&&(this.listOfColumn.push({title:"Hourly/Fixed",compare:(e,t)=>e.isHourlyRateHourly>t.isHourlyRateHourly,priority:3}),this.listOfColumn.push({title:"Amount",compare:(e,t)=>e.salary-t.salary,priority:4}),this.listOfColumn=this.listOfColumn.sort((e,t)=>e.priority-t.priority))}getUsers(){return C(this,null,function*(){this.users=yield this.userService.getOrganizationUsers(),this.clientSubscription=this.appService.currentClient.subscribe(e=>{e&&e.id>0&&this.currentOrganizationId!=e.id&&(this.populateEmployeeData(),this.currentOrganizationId=e.id)})})}ngOnDestroy(){this.clientSubscription&&this.clientSubscription.unsubscribe()}open(e=!0){this.visible=!0,this.isNew=e}close(e=!1){this.visible=!1,e&&this.populateEmployeeData()}populateEmployeeData(){return C(this,null,function*(){this.listOfData=yield this.appService.getOrganizationEmployees(),this.listOfDisplayData=this.listOfData,this.updateEditCache()})}startEdit(e){this.editableItem=this.editCache[e].data}cancelEdit(e){let t=this.listOfData.findIndex(n=>n.id===e);this.editCache[e]={data:ie({},this.listOfData[t]),edit:!1}}saveEdit(e){return C(this,null,function*(){let t=this.listOfData.findIndex(n=>n.id===e);yield this.appService.updateEmployee({id:this.editCache[e].data.id,position:this.editCache[e].data.position,employee:this.editCache[e].data.employee,salary:this.editCache[e].data.salary,details:this.editCache[e].data.details}),this.editCache[e].edit=!1,Object.assign(this.listOfData[t],this.editCache[e].data),this.populateEmployeeData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:ie({},e)}})}search(){this.searchVisible=!1,this.searchValue?(this.listOfDisplayData=this.listOfData.filter(e=>e.employeeName&&e.employeeName.toLowerCase().indexOf(this.searchValue.toLowerCase())>-1||e.supervisorName&&e.supervisorName.toLowerCase().indexOf(this.searchValue.toLowerCase())>-1),console.log(this.listOfDisplayData)):this.listOfDisplayData=this.listOfData}static{this.\u0275fac=function(t){return new(t||i)(b(I),b(Qe))}}static{this.\u0275cmp=D({type:i,selectors:[["app-employee-management"]],decls:20,vars:9,consts:[["inputClearTpl",""],["suffixIconSearch",""],["editRowTable","","sortTable",""],["editTemplate",""],[1,"flex","space-between"],[2,"display","-webkit-box","width","100%"],[2,"margin-right","5px"],[3,"nzSuffix"],["type","text","placeholder","Search here","nz-input","",3,"ngModelChange","keyup","ngModel"],["nz-button","","nzType","primary",3,"click",4,"appHasPermission"],[3,"clients","visible","users","editableItem","isNew","closeDrawer",4,"ngIf"],["nzShowPagination","false",3,"nzPageSize","nzData"],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon"],["nz-icon","","nzType","search"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],["nz-button","","nzType","primary",3,"click"],[3,"closeDrawer","clients","visible","users","editableItem","isNew"],[3,"nzSortFn","nzSortPriority"],[4,"filterUser"],[4,"ngIf","ngIfElse"],[4,"appHasPermission"],[3,"click",4,"appHasPermission"],[3,"click"],["type","text","nz-input","",3,"ngModelChange","ngModel"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"]],template:function(t,n){if(t&1){let m=x();r(0,"div",4)(1,"span",5)(2,"h3",6),l(3," Employees "),o(),r(4,"nz-input-group",7)(5,"input",8),O("ngModelChange",function(S){return g(m),M(n.searchValue,S)||(n.searchValue=S),f(S)}),v("keyup",function(){return g(m),f(n.search())}),o()(),d(6,Lt,2,1,"ng-template",null,0,R)(8,Gt,1,0,"ng-template",null,1,R),o(),d(10,$t,2,0,"button",9),o(),d(11,qt,1,5,"app-employee-contract",10),r(12,"nz-table",11,2)(15,"thead")(16,"tr"),d(17,Xt,2,3,"th",12),o()(),r(18,"tbody"),d(19,ii,2,7,"ng-container",13),o()()}if(t&2){let m=T(7),_=T(9),S=T(14);a(4),s("nzSuffix",_)("nzSuffix",m),a(),N("ngModel",n.searchValue),a(5),s("appHasPermission",n.appPermissions.UpdateClientEmployee),a(),s("ngIf",n.visible),a(),s("nzPageSize",1e3)("nzData",n.listOfDisplayData),a(5),s("ngForOf",n.listOfColumn),a(2),s("ngForOf",S.data)}},dependencies:[P,A,F,V,B,ce,$,mt,st,Ee,J,ht,j,Y,ee,Z,Q,L,G,he,re,vt,Te,we]})}}return i})();var te=(()=>{class i{constructor(){}calculateHourlyRate(e,t,n,m=!0){if(m)return e;{let _=t.getFullYear(),S=t.getMonth(),se=new Date(_,S+1,0).getDate(),je=0;for(let Oe=1;Oe<=se;Oe++)new Date(_,S,Oe).getDay()!==0&&je++;return e/(je*n)}}isDateInLastOrCurrentMonth(e){let t=new Date,n=t.getMonth(),m=t.getFullYear(),_=e.getMonth(),S=e.getFullYear();return m===S&&n===_||m===S&&n-1===_||m-1===S&&n===0&&_===11}getDifferenceInHours(e,t){let n=new Date(e).getHours()*3600+new Date(e).getMinutes()*60+new Date(e).getSeconds(),m=new Date(t).getHours()*3600+new Date(t).getMinutes()*60+new Date(t).getSeconds(),S=Math.abs(m-n)/3600;return isNaN(S)?0:S}calculateWorkingHours(e,t){return 8}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=He({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function oi(i,c){i&1&&(r(0,"th"),l(1," Action "),o())}function ri(i,c){if(i&1&&(r(0,"span"),l(1),o()),i&2){let e=p().$implicit;a(),E(" ",e.approved_hours," ")}}function ai(i,c){if(i&1){let e=x();r(0,"input",13),v("ngModelChange",function(){g(e);let n=p().$implicit,m=p();return f(m.claculateAndSetAmount(n.id))}),O("ngModelChange",function(n){g(e);let m=p().$implicit,_=p();return M(_.editCache[m.id]==null?null:_.editCache[m.id].data.approved_hours,n)||((_.editCache[m.id]==null?null:_.editCache[m.id].data).approved_hours=n),f(n)}),o()}if(i&2){let e=p().$implicit,t=p();N("ngModel",t.editCache[e.id]==null?null:t.editCache[e.id].data.approved_hours)}}function li(i,c){if(i&1&&(r(0,"span"),l(1),o()),i&2){let e=p().$implicit,t=p();a(),E(" ",(e.approved_hours||e.no_of_hours||0)*t.employee.salary," ")}}function si(i,c){if(i&1&&(r(0,"span"),l(1),o()),i&2){let e=p().$implicit,t=p();a(),E(" ",(t.editCache[e.id].data.approved_hours||t.editCache[e.id].data.no_of_hours||0)*t.employee.salary,"")}}function mi(i,c){if(i&1){let e=x();r(0,"a",17),v("click",function(){g(e);let n=p(2).$implicit,m=p();return f(m.startEdit(n.id))}),l(1,"Edit"),o()}}function pi(i,c){if(i&1){let e=x();r(0,"a",18),v("click",function(){g(e);let n=p(2).$implicit,m=p();return f(m.saveEdit(n.id))}),l(1,"Save"),o()}}function ci(i,c){if(i&1){let e=x();r(0,"a",19),v("nzOnConfirm",function(){g(e);let n=p(2).$implicit,m=p();return f(m.cancelEdit(n.id))}),l(1,"Cancel"),o()}}function di(i,c){if(i&1&&(r(0,"td"),d(1,mi,2,0,"a",14)(2,pi,2,0,"a",15),l(3," \xA0 "),d(4,ci,2,0,"a",16),o()),i&2){let e=p().$implicit,t=p();a(),s("ngIf",!(t.editCache[e.id]!=null&&t.editCache[e.id].edit)&&!e.paid),a(),s("ngIf",t.editCache[e.id]==null?null:t.editCache[e.id].edit),a(2),s("ngIf",t.editCache[e.id]==null?null:t.editCache[e.id].edit)}}function ui(i,c){if(i&1&&(r(0,"tr")(1,"td"),l(2),y(3,"date"),o(),r(4,"td"),l(5),o(),r(6,"td"),l(7),o(),r(8,"td"),d(9,ri,2,1,"span",11)(10,ai,1,1,"input",12),o(),r(11,"td"),d(12,li,2,1,"span",11)(13,si,2,1,"span",11),o(),d(14,di,5,3,"td",3),o()),i&2){let e=c.$implicit,t=p();a(2),E("",h(3,8,e.date_created," dd MMM yyyy")," "),a(3),E("Task-",e.task.id,""),a(2),u(e.no_of_hours),a(2),s("ngIf",!(t.editCache[e.id]!=null&&t.editCache[e.id].edit)),a(),s("ngIf",t.editCache[e.id]==null?null:t.editCache[e.id].edit),a(2),s("ngIf",!(t.editCache[e.id]!=null&&t.editCache[e.id].edit)),a(),s("ngIf",t.editCache[e.id]==null?null:t.editCache[e.id].edit),a(),s("appHasPermission",t.appPermissions.AddUpdatePayments)}}function yi(i,c){if(i&1&&(r(0,"span",20),z(1,"span"),r(2,"span")(3,"b"),l(4),y(5,"currency"),o()()()),i&2){let e=p();a(4),E(" Total: ",h(5,1,e.totalAmount,"PKR "),"")}}function _i(i,c){if(i&1){let e=x();r(0,"button",21),v("click",function(){g(e);let n=p();return f(n.completeEmployeePayment())}),l(1," Pay"),o()}}var Me=(()=>{class i{constructor(e,t){this.appService=e,this.employeeManagementService=t,this.appPermissions=k,this.WorklogData=[],this.totalAmount=0,this.balanceAmount=0,this.editCache={}}ngOnInit(){this.getCurrentUserWorklog(),console.log(this.worklog)}sunscribeToGeoLocation(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{this.latitude=e.coords.latitude,this.longitude=e.coords.longitude})}getCurrentUserWorklog(){return C(this,null,function*(){this.initializeWorklogTableData(this.worklog),this.updateEditCache()})}initializeWorklogTableData(e){this.WorklogData=e,this.totalAmount=this.WorklogData.reduce((t,n)=>t+(Number(n.approved_hours||n.no_of_hours)||0)*this.employee.salary,0),this.balanceAmount==this.WorklogData.filter(t=>!t.paid).reduce((t,n)=>t+(Number(n.approved_hours||n.no_of_hours)||0)*this.employee.salary,0)}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let t=this.WorklogData.findIndex(n=>n.id===e);this.editCache[e]={data:ie({},this.WorklogData[t]),edit:!1}}claculateAndSetAmount(e){setTimeout(()=>{this.totalAmount=this.WorklogData.reduce((t,n,m)=>t+(Number((n.id==e?this.editCache[e].data.approved_hours:n.approved_hours)||n.no_of_hours)||0)*this.employee.salary,0),this.balanceAmount==this.WorklogData.filter(t=>!t.paid).reduce((t,n,m)=>t+(Number((n.id==e?this.editCache[e].data.approved_hours:n.approved_hours)||n.no_of_hours)||0)*this.employee.salary,0)},100)}signIn(e){this.editCache[e].data.sign_in_corrd=this.latitude+","+this.longitude}signOut(e){this.editCache[e].data.sign_out_corrd=this.latitude+","+this.longitude,this.editCache[e].data.hours_worked=Math.round(this.employeeManagementService.getDifferenceInHours(this.editCache[e].data.sign_in,this.editCache[e].data.sign_out));let t=this.employeeManagementService.calculateHourlyRate(this.employee.salary,this.editCache[e].data.date,8,!0);this.editCache[e].data.amount=t*this.employeeManagementService.calculateWorkingHours(this.employee,this.editCache[e].data.approved_hours||this.editCache[e].data.hours_worked)}saveEdit(e){return C(this,null,function*(){let t=this.WorklogData.findIndex(n=>n.id===e);this.editCache[e].data.id&&(yield this.appService.updateWorklog({id:e,approved_hours:this.editCache[e].data.approved_hours})),this.editCache[e].edit=!1,Object.assign(this.WorklogData[t],this.editCache[e].data),this.getCurrentUserWorklog()})}completeEmployeePayment(){return C(this,null,function*(){yield this.appService.payAddTaskWorklogs(this.employee.employee.id),this.getCurrentUserWorklog()})}updateEditCache(){this.WorklogData.forEach(e=>{this.editCache[e.id]={edit:!1,data:ie({},e)}})}static{this.\u0275fac=function(t){return new(t||i)(b(I),b(te))}}static{this.\u0275cmp=D({type:i,selectors:[["app-worklog-details"]],inputs:{employee:"employee",worklog:"worklog"},decls:32,vars:14,consts:[["basicTable",""],["footerDetails",""],["nzShowPagination","false",3,"nzPageSize","nzFooter","nzData","nzBordered"],[4,"appHasPermission"],[4,"ngFor","ngForOf"],["nzGutter","4",2,"margin-top","12px"],[3,"nzMd","nzSm","nzXs"],[2,"width","100%","margin-top","12px"],[2,"width","100%","display","inline-block"],[1,"flex","space-between",2,"margin-bottom","10px"],["nz-button","","nzType","primary","style","margin-top: 12px;float: right;",3,"click",4,"appHasPermission"],[4,"ngIf"],["nz-input","",3,"ngModel","ngModelChange",4,"ngIf"],["nz-input","",3,"ngModelChange","ngModel"],[3,"click",4,"ngIf"],["class","save",3,"click",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm",4,"ngIf"],[3,"click"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],[1,"flex","space-between","center"],["nz-button","","nzType","primary",2,"margin-top","12px","float","right",3,"click"]],template:function(t,n){if(t&1&&(r(0,"nz-table",2,0)(2,"thead")(3,"tr")(4,"th"),l(5,"Date"),o(),r(6,"th"),l(7,"Task"),o(),r(8,"th"),l(9,"Hours Worked"),o(),r(10,"th"),l(11,"Approved Hours"),o(),r(12,"th"),l(13,"Amount"),o(),d(14,oi,2,0,"th",3),o()(),r(15,"tbody"),d(16,ui,15,11,"tr",4),o()(),d(17,yi,6,4,"ng-template",null,1,R),r(19,"nz-row",5)(20,"nz-col",6)(21,"nz-card",7)(22,"div",8)(23,"div")(24,"div",9)(25,"span")(26,"b"),l(27,"Balance:"),o()(),r(28,"span"),l(29),y(30,"currency"),o()(),d(31,_i,2,0,"button",10),o()()()()()),t&2){let m=T(18);s("nzPageSize",1e3)("nzFooter",m)("nzData",n.WorklogData)("nzBordered",!0),a(14),s("appHasPermission",n.appPermissions.AddUpdatePayments),a(2),s("ngForOf",n.WorklogData),a(4),s("nzMd",24)("nzSm",24)("nzXs",24),a(9),E(" ",h(30,11,n.balanceAmount||0,"PKR "),""),a(2),s("appHasPermission",n.appPermissions.AddUpdatePayments)}},dependencies:[P,A,F,V,B,Ce,X,q,$,Ee,J,j,Y,ee,Z,Q,L,G,he,re,oe,ne]})}}return i})();function gi(i,c){if(i&1&&(r(0,"div"),l(1),y(2,"date"),o()),i&2){let e=p(2);a(),E(" ",h(2,1,e.signInTime,"hh:mm a"),"")}}function fi(i,c){if(i&1){let e=x();r(0,"button",8),v("click",function(){g(e);let n=p(2);return f(n.signIn())}),l(1,"Sign In"),o()}}function Ci(i,c){if(i&1&&(r(0,"div"),l(1),y(2,"date"),o()),i&2){let e=p(2);a(),E(" ",h(2,1,e.signOutTime,"hh:mm a"),"")}}function vi(i,c){if(i&1){let e=x();r(0,"button",8),v("click",function(){g(e);let n=p(2);return f(n.signOut())}),l(1,"Sign Out"),o()}}function zi(i,c){if(i&1&&(r(0,"div",5)(1,"strong"),l(2),y(3,"date"),o(),d(4,gi,3,4,"div",6)(5,fi,2,0,"button",7)(6,Ci,3,4,"div",6)(7,vi,2,0,"button",7),o()),i&2){let e=p();a(2),u(h(3,5,e.currentDate,"longDate")),a(2),s("ngIf",e.signInTime),a(),s("ngIf",!e.signInTime),a(),s("ngIf",e.signOutTime),a(),s("ngIf",e.signInTime&&!e.signOutTime)}}function xi(i,c){if(i&1&&(r(0,"td"),l(1),o()),i&2){let e=p().$implicit;a(),u(e.employee==null?null:e.employee.employee.name)}}function Si(i,c){if(i&1&&z(0,"app-worklog-details",11),i&2){let e=p().$implicit;s("employee",e.employee)}}function bi(i,c){if(i&1&&(r(0,"nz-tab",9),d(1,xi,2,1,"ng-template",null,0,R)(3,Si,1,1,"app-worklog-details",10),o()),i&2){let e=c.$implicit,t=T(2);s("nzTitle",t),a(3),s("ngIf",e.employee)}}function Ei(i,c){i&1&&(H(0),r(1,"div",12)(2,"p"),l(3,"We need your location to provide the best experience. Please follow these steps to enable location access:"),o(),r(4,"ul")(5,"li")(6,"strong"),l(7,"Chrome:"),o(),l(8," Go to Settings > Privacy and Security > Site Settings > Location, and allow location access for this site."),o(),r(9,"li")(10,"strong"),l(11,"Firefox:"),o(),l(12," Go to Preferences > Privacy & Security > Permissions > Location, and allow location access for this site."),o(),r(13,"li")(14,"strong"),l(15,"Safari:"),o(),l(16," Go to Preferences > Websites > Location, and allow location access for this site. "),o()()(),U())}var Et=(()=>{class i{constructor(e,t,n,m){this.route=e,this.router=t,this.appService=n,this.employeeManagementService=m,this.currentDate=new Date,this.supervisorUsers=[],this.currentDateWorklogIndex=0,this.isVisible=!1}ngOnInit(){this.clientSubscription=this.appService.currentClient.subscribe(e=>{e&&e.id>0&&this.currentOrganizationId!=e.id&&(this.currentOrganizationId=e.id,this.route.paramMap.subscribe(t=>{e&&e.id>0&&t.get("userId")&&(this.currentUserId=parseInt(t.get("userId")||"0"),this.setCurrentUserDetails(e.id))}))}),this.sunscribeToGeoLocation()}handleOk(){this.isVisible=!1}sunscribeToGeoLocation(){setTimeout(()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{this.longitude=e.coords.longitude,this.latitude=e.coords.latitude},e=>{switch(console.error(`Error occurred: ${e.message}`),this.isVisible=!0,e.code){case e.PERMISSION_DENIED:alert("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:alert("Location information is unavailable.");break;case e.TIMEOUT:alert("The request to get user location timed out.");break}this.router.navigate(["employee"])}):(alert("Geolocation is not supported by this browser."),this.router.navigate(["employee"]))},2e3)}setCurrentUserDetails(e){return C(this,null,function*(){this.employee=yield this.appService.getEmployeeDetail(this.currentUserId,e),this.employee&&this.employee.id&&this.getCurrentDayWorklog(this.employee.id),this.fetchSupervisorUsers()})}getCurrentDayWorklog(e){return C(this,null,function*(){let t=yield this.appService.getCurrentDateWorklog(e);this.processCurentDayWorklog(t)})}processCurentDayWorklog(e){e?(this.currentDateWorklogIndex=e.id,e.sign_in&&(this.signInTime=new Date(e.sign_in)),e.sign_out&&(this.signOutTime=new Date(e.sign_out))):this.currentDateWorklogIndex=0}signIn(){return C(this,null,function*(){let e=yield this.appService.createWorklog({employee:this.employee.id,sign_in:new Date,sign_in_corrd:this.latitude+","+this.longitude});this.processCurentDayWorklog(e)})}signOut(){return C(this,null,function*(){let e=Math.round(this.employeeManagementService.getDifferenceInHours(this.signInTime,new Date)),n=this.employeeManagementService.calculateHourlyRate(this.employee.salary,new Date,8,!0)*this.employeeManagementService.calculateWorkingHours(this.employee,e),m=yield this.appService.updateWorklog({id:this.currentDateWorklogIndex,sign_out:new Date,sign_out_corrd:this.latitude+","+this.longitude,hours_worked:e,amount:n});this.processCurentDayWorklog(m)})}fetchSupervisorUsers(){return C(this,null,function*(){this.supervisorUsers=[],this.employee&&this.employee.id&&this.supervisorUsers.push({employee:this.employee,isSupervisor:!1});let e=yield this.appService.getCurrentEmployeeSubordinates(this.currentUserId);e&&e.length&&(this.supervisorUsers=[...this.supervisorUsers,...e.map(t=>({employee:t,isSupervisor:!0}))])})}generateUserData(){let e=new Date("2024-01-01"),t=new Date("2024-01-31"),n=[],m=new Date(e);for(;m<=t;)n.push({date:m}),m=new Date(m.setDate(m.getDate()+1));return n}ngOnDestroy(){this.clientSubscription&&this.clientSubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||i)(b(Ze),b(Je),b(I),b(te))}}static{this.\u0275cmp=D({type:i,selectors:[["app-worklog"]],decls:7,vars:4,consts:[["titleTemplate",""],["class","flex center space-between",4,"ngIf"],[3,"nzTitle",4,"ngFor","ngForOf"],["nzTitle","Enable Location",3,"nzVisibleChange","nzOnOk","nzVisible","nzCancelDisabled"],[4,"nzModalContent"],[1,"flex","center","space-between"],[4,"ngIf"],["nz-button","","nzType","primary","mat-button","",3,"click",4,"ngIf"],["nz-button","","nzType","primary","mat-button","",3,"click"],[3,"nzTitle"],[3,"employee",4,"ngIf"],[3,"employee"],["id","geolocation-error-message"]],template:function(t,n){t&1&&(r(0,"h3"),l(1,"Worklog"),o(),d(2,zi,8,8,"div",1),r(3,"nz-tabset"),d(4,bi,4,2,"nz-tab",2),o(),r(5,"nz-modal",3),O("nzVisibleChange",function(_){return M(n.isVisible,_)||(n.isVisible=_),_}),v("nzOnOk",function(){return n.handleOk()}),d(6,Ei,17,0,"ng-container",4),o()),t&2&&(a(2),s("ngIf",n.employee&&n.employee.id),a(2),s("ngForOf",n.supervisorUsers),a(),N("nzVisible",n.isVisible),s("nzCancelDisabled",!0))},dependencies:[P,A,F,V,B,ue,de,j,ft,gt,Me,ne]})}}return i})();function wi(i,c){if(i&1&&(r(0,"tr"),z(1,"td",9),r(2,"td",9),l(3),y(4,"currency"),o(),r(5,"td",10),l(6),y(7,"date"),o(),z(8,"td",9)(9,"td",11),o()),i&2){let e=c.$implicit,t=p(2);a(3),u(h(4,2,e.recieved,t.currentClinet==null?null:t.currentClinet.currency)),a(3),u(h(7,5,e.recieving_date,"dd MMM yyyy"))}}function Di(i,c){if(i&1&&(H(0),d(1,wi,10,8,"tr",22),U()),i&2){let e=p();a(),s("ngForOf",e.projectBudgetDetail.details)}}function Pi(i,c){if(i&1){let e=x();r(0,"a",24),v("click",function(){g(e);let n=p().$implicit,m=p(2);return f(n.employee!=null&&n.employee.isHourlyRateHourly?m.open(n):m.addAmmountRecievedModal(!1,n))}),l(1," Pay"),o()}}function Ii(i,c){if(i&1&&(r(0,"tr")(1,"td"),l(2),o(),r(3,"td")(4,"b"),l(5),o(),l(6),y(7,"currency"),o(),r(8,"td"),l(9),y(10,"currency"),o(),r(11,"td"),l(12),y(13,"currency"),o(),r(14,"td"),l(15),y(16,"date"),o(),r(17,"td"),l(18),y(19,"currency"),o(),r(20,"td"),d(21,Pi,2,0,"a",23),o()()),i&2){let e=c.$implicit,t=p(2);a(2),E("",e.employee==null||e.employee.employee==null?null:e.employee.employee.name," "),a(3),u(e.employee!=null&&e.employee.isHourlyRateHourly?"Hourly":"Fixed"),a(),E(" ",h(7,8,e.employee==null?null:e.employee.salary,"PKR")," "),a(3),u(h(10,11,(e.paymentObject==null?null:e.paymentObject.totalAmount)||0,"PKR")),a(3),E("",h(13,14,(e.paymentObject==null?null:e.paymentObject.totalPaid)||0,"PKR")," "),a(3),u(h(16,17,"1-1-2024","dd MMM yyyy")),a(3),u(h(19,20,(e.paymentObject==null?null:e.paymentObject.balance)||0,"PKR")),a(3),s("appHasPermission",t.appPermissions.AddUpdatePayments)}}function Ti(i,c){if(i&1&&(H(0),d(1,Ii,22,23,"tr",22),U()),i&2){let e=p();a(),s("ngForOf",e.paymentData)}}function ki(i,c){i&1&&(r(0,"nz-row",27)(1,"nz-col",28)(2,"nz-form-item")(3,"nz-form-label",36),l(4,"Recieving Date "),o(),r(5,"nz-form-control",30),z(6,"nz-date-picker",37),o()()()()),i&2&&(a(),s("nzMd",10)("nzSm",16)("nzXs",16),a(2),s("nzMd",8)("nzSm",24)("nzXs",12),a(2),s("nzSm",14)("nzXs",24))}function Ni(i,c){if(i&1){let e=x();r(0,"nz-card",25)(1,"form",26),v("ngSubmit",function(){g(e);let n=p();return f(n.handleRecieveAmountOk())}),r(2,"nz-row",27)(3,"nz-col",28)(4,"nz-form-item")(5,"nz-form-label",29),l(6,"Amount "),o(),r(7,"nz-form-control",30),z(8,"input",31),o()()()(),d(9,ki,7,8,"nz-row",32),r(10,"nz-row",27)(11,"nz-col",28)(12,"nz-form-item")(13,"nz-form-label",33),l(14,"Payment Description"),o(),r(15,"nz-form-control",34),z(16,"textarea",35),o()()()()()()}if(i&2){let e=p();a(),s("formGroup",e.addAmmountRecievedForm),a(2),s("nzMd",10)("nzSm",16)("nzXs",16),a(2),s("nzMd",8)("nzSm",24)("nzXs",12),a(2),s("nzSm",14)("nzXs",24),a(2),s("ngIf",e.addingAmountRecieved),a(2),s("nzMd",24)("nzSm",24)("nzXs",24),a(2),s("nzMd",8)("nzSm",24)("nzXs",24),a(2),s("nzSm",14)("nzXs",24)}}function Mi(i,c){if(i&1&&z(0,"app-worklog-details",39),i&2){let e=p(2);s("worklog",e.selectedEmployee.worklog)("employee",e.selectedEmployee.employee)}}function Oi(i,c){if(i&1&&(H(0),r(1,"h3")(2,"strong"),l(3,"Worklog and Payments "),o()(),d(4,Mi,1,2,"app-worklog-details",38),U()),i&2){let e=p();a(4),s("ngIf",e.selectedEmployee)}}var wt=(()=>{class i{constructor(e,t){this.appService=e,this.employeeManagementService=t,this.isMobile=this.appService.isMobile,this.appPermissions=k,this.today=new Date,this.amountPayment=0,this.advanceAmount=0,this.paymentDescription="",this.advancePayment=!0,this.disablePayment=!1,this.payments=[],this.budegetExpanded=!1,this.employeeExpanded=!1,this.showAddAmountRecieved=!1,this.projectBudgetSummary={budget:1e3,budgetPKR:1e3,expense:7e3,profit:3e3},this.projectBudgetDetail={summary:{budget:"10000",recieved:"7000",recieving_date:new Date,balance:"3000"},details:[{recieved:"2000",recieving_date:new Date},{recieved:"3000",recieving_date:new Date},{recieved:"2000",recieving_date:new Date}]},this.visible=!1}addAmmountRecievedModal(e=!0,t){this.showAddAmountRecieved=!0,this.addAmmountRecievedForm.touched&&this.addAmmountRecievedForm.pristine&&this.addAmmountRecievedForm.reset(),this.addingAmountRecieved=e,!e&&t&&(this.selectedEmployee=t)}closeModal(){this.showAddAmountRecieved=!1,this.isOkLoading=!1,this.addingAmountRecieved=!1}handleRecieveAmountOk(){return C(this,null,function*(){try{this.isOkLoading=!0,this.addingAmountRecieved?yield this.addAmmountRecieved():(this.amountPayment=this.addAmmountRecievedForm.value.amount,this.paymentDescription=this.addAmmountRecievedForm.value.note,yield this.createPayment()),this.showAddAmountRecieved=!1,this.addAmmountRecievedForm.reset()}catch{}finally{this.showAddAmountRecieved=!1,this.isOkLoading=!1}})}addAmmountRecieved(){return C(this,null,function*(){yield this.appService.createClientPayment(this.addAmmountRecievedForm.value)})}getAmmountRecievedDetails(){return C(this,null,function*(){let e=yield this.appService.getClientBudgetRecievingDetails();e&&(e.summary.budget=this.currentClinet.projectBudget,e.summary.balance=this.currentClinet.projectBudget-e.summary.recieved,this.projectBudgetDetail=e)})}getExpenseSummary(){return C(this,null,function*(){let e=yield this.appService.getClientExpenseSummary();if(e){let t=this.appService.convertCurrency(this.currentClinet.projectBudget||0,this.currentClinet.currency||"PKR","PKR");this.projectBudgetSummary.expense=e.expense||0,this.projectBudgetSummary.budgetPKR=t,this.projectBudgetSummary.budget=this.currentClinet.projectBudget||0,this.projectBudgetSummary.profit=t||0-e.expense||0}})}ngOnInit(){this.clientSubscription=this.appService.currentClient.subscribe(e=>{e&&e.id>0&&this.currentClientId!=e.id&&(this.setEmployeePayments(e.id),this.currentClientId=e.id,this.currentClinet=e,this.getAmmountRecievedDetails(),this.getExpenseSummary())}),this.addAmmountRecievedForm=new _e({id:new W(0),amount:new W(0,[w.required]),recieving_date:new W(new Date,[w.required]),note:new W})}ngOnDestroy(){this.clientSubscription&&this.clientSubscription.unsubscribe}setEmployeePayments(e){return C(this,null,function*(){this.paymentData=yield this.appService.getEmployeePaymentsDetail(e),this.calculateTotals()})}calculateTotals(){this.totalAmount=0,this.totalPaid=0,this.totalBalance=0;let e=0;this.paymentData.forEach(t=>{let n=Number(t.paymentObject?.totalAmount||0),m=Number(t.paymentObject?.totalPaid||0),_=Number(t.paymentObject?.balance||0),S=t.paymentObject?.date?new Date(t.paymentObject.date):null;if(this.totalAmount+=Number(n||0),this.totalPaid+=Number(m),this.totalBalance+=Number(_),S){let se=S.getTime();se>e&&(e=se)}}),this.latestDate=e?new Date(e).toISOString():null}open(e){this.selectedEmployee=e,this.visible=!0,this.activeHourlyRateHistory=!1,this.activeAdvanceHistory=!1,this.amountPayment=0,this.advanceAmount=0,this.disablePayment=!1}close(){this.visible=!1}createPayment(){return C(this,null,function*(){let e={payment_type:"salary",employee:this.selectedEmployee.employee.id,payment_description:this.paymentDescription,amount:this.amountPayment,balance:this.selectedEmployee.paymentObject.balance+this.selectedEmployee.paymentObject.totalAmount-this.amountPayment};yield this.appService.createPayment(e),this.visible=!1,this.paymentData=yield this.appService.getEmployeePaymentsDetail()})}getEmployeePayments(e){return C(this,null,function*(){e&&(this.payments=[],this.payments=yield this.appService.getPayments(this.selectedEmployee.employee.id))})}static{this.\u0275fac=function(t){return new(t||i)(b(I),b(te))}}static{this.\u0275cmp=D({type:i,selectors:[["app-pay-processing"]],decls:117,vars:79,consts:[["summaryTable",""],["basicTable",""],[2,"margin","10px"],["nzSpan","12"],["nzShowPagination","false",2,"width","auto",3,"nzPageSize","nzBordered"],["nzSpan","12",2,"text-align","right"],["nz-button","","nzType","primary",3,"click","nzSize"],["nz-icon","",3,"nzType"],["nzShowPagination","false",3,"nzPageSize","nzBordered"],["width","24%"],["width","26%"],["width","2%"],[2,"background","#d5d5d5"],["nz-button","","nzType","primary","nzShape","circle",3,"click","nzSize"],[4,"ngIf"],["nzShowPagination","false",3,"nzPageSize","nzData","nzBordered"],[3,"width"],[2,"text-align","center"],[3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzTitle","nzOkDisabled","nzOkLoading"],["style","width:100%",4,"nzModalContent"],["nzPlacement","right",3,"nzOnClose","nzClosable","nzVisible","nzTitle","nzWidth"],[4,"nzDrawerContent"],[4,"ngFor","ngForOf"],["nzType","primary",3,"click",4,"appHasPermission"],["nzType","primary",3,"click"],[2,"width","100%"],["nz-form","",3,"ngSubmit","formGroup"],["nzGutter","2",2,"margin-bottom","12px"],[3,"nzMd","nzSm","nzXs"],["nzRequired","","nzFor","amount",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",3,"nzSm","nzXs"],["nz-input","","formControlName","amount"],["nzGutter","2","style","margin-bottom: 12px;",4,"ngIf"],["nzRequired","","nzFor","name",3,"nzMd","nzSm","nzXs"],["nzErrorTip","The input is not valid date!",1,"flex","space-between","center",3,"nzSm","nzXs"],["nz-input","","formControlName","note",1,"inputField"],["nzRequired","","nzFor","recieving_date",3,"nzMd","nzSm","nzXs"],["nzFormat","MM-dd-yyyy","formControlName","recieving_date",1,"inputField"],[3,"worklog","employee",4,"ngIf"],[3,"worklog","employee"]],template:function(t,n){if(t&1){let m=x();r(0,"nz-row",2)(1,"nz-col",3)(2,"h3"),l(3),o()(),r(4,"nz-col",3)(5,"nz-table",4,0)(7,"thead")(8,"tr")(9,"th"),l(10,"Budget"),o(),r(11,"th"),l(12,"Budget(PKR)"),o(),r(13,"th"),l(14,"Expense"),o(),r(15,"th"),l(16,"Profit"),o()()(),r(17,"tbody")(18,"tr")(19,"td"),l(20),y(21,"currency"),o(),r(22,"td"),l(23),y(24,"currency"),o(),r(25,"td"),l(26),y(27,"currency"),o(),r(28,"td"),l(29),y(30,"currency"),o()()()()()(),r(31,"nz-row",2)(32,"nz-col",3)(33,"h3"),l(34,"Project Budget"),o()(),r(35,"nz-col",5)(36,"button",6),v("click",function(){return g(m),f(n.addAmmountRecievedModal())}),l(37," Amount Recieved "),z(38,"span",7),o()()(),r(39,"nz-table",8,1)(41,"thead")(42,"tr")(43,"th",9),l(44,"Budget"),o(),r(45,"th",9),l(46,"Recieved"),o(),r(47,"th",10),l(48,"Recieving Date"),o(),r(49,"th",9),l(50,"Balance"),o(),z(51,"th",11),o()(),r(52,"tbody")(53,"tr",12)(54,"td"),l(55),y(56,"currency"),o(),r(57,"td"),l(58),y(59,"currency"),o(),r(60,"td"),l(61),y(62,"date"),o(),r(63,"td"),l(64),y(65,"currency"),o(),r(66,"td")(67,"button",13),v("click",function(){return g(m),f(n.budegetExpanded=!n.budegetExpanded)}),z(68,"span",7),o()()(),d(69,Di,2,1,"ng-container",14),o()(),r(70,"nz-row",2)(71,"nz-col")(72,"h3"),l(73,"Employee Payments"),o()()(),r(74,"nz-table",15,1)(76,"thead")(77,"tr")(78,"th",16),l(79,"Employee"),o(),r(80,"th",16),l(81,"Rate"),o(),r(82,"th",16),l(83,"Total Amount"),o(),r(84,"th",16),l(85,"Paid"),o(),r(86,"th",16),l(87,"Date Paid"),o(),r(88,"th",16),l(89,"Balance"),o(),z(90,"th",16),o()(),r(91,"tbody")(92,"tr",12)(93,"td",17),l(94,"---"),o(),r(95,"td",17),l(96,"---"),o(),r(97,"td"),l(98),y(99,"currency"),o(),r(100,"td"),l(101),y(102,"currency"),o(),r(103,"td"),l(104),y(105,"date"),o(),r(106,"td"),l(107),y(108,"currency"),o(),r(109,"td")(110,"button",13),v("click",function(){return g(m),f(n.employeeExpanded=!n.employeeExpanded)}),z(111,"span",7),o()()(),d(112,Ti,2,1,"ng-container",14),o()(),r(113,"nz-modal",18),O("nzVisibleChange",function(S){return g(m),M(n.showAddAmountRecieved,S)||(n.showAddAmountRecieved=S),f(S)}),v("nzOnCancel",function(){return g(m),f(n.closeModal())})("nzOnOk",function(){return g(m),f(n.handleRecieveAmountOk())}),d(114,Ni,17,18,"nz-card",19),o(),r(115,"nz-drawer",20),v("nzOnClose",function(){return g(m),f(n.close())}),d(116,Oi,5,1,"ng-container",21),o()}t&2&&(a(3),u(n.currentClinet==null?null:n.currentClinet.name),a(2),s("nzPageSize",1e3)("nzBordered",!0),a(15),u(h(21,43,n.projectBudgetSummary==null?null:n.projectBudgetSummary.budget,n.currentClinet==null?null:n.currentClinet.currency)),a(3),u(h(24,46,n.projectBudgetSummary==null?null:n.projectBudgetSummary.budgetPKR,"PKR")),a(3),u(h(27,49,n.projectBudgetSummary==null?null:n.projectBudgetSummary.expense,"PKR")),a(3),u(h(30,52,n.projectBudgetSummary==null?null:n.projectBudgetSummary.profit,"PKR")),a(7),s("nzSize","small"),a(2),s("nzType","plus"),a(),s("nzPageSize",1e3)("nzBordered",!0),a(16),u(h(56,55,n.projectBudgetDetail.summary.budget,n.currentClinet==null?null:n.currentClinet.currency)),a(3),u(h(59,58,n.projectBudgetDetail.summary.recieved,n.currentClinet==null?null:n.currentClinet.currency)),a(3),u(h(62,61,n.projectBudgetDetail.summary.recieving_date,"dd MMM yyyy")),a(3),u(h(65,64,n.projectBudgetDetail.summary.balance,n.currentClinet==null?null:n.currentClinet.currency)),a(3),s("nzSize","small"),a(),s("nzType",n.budegetExpanded?"up":"down"),a(),s("ngIf",n.budegetExpanded),a(5),s("nzPageSize",1e3)("nzData",n.paymentData)("nzBordered",!0),a(4),s("width","13%"),a(2),s("width","13%"),a(2),s("width","13%"),a(2),s("width","13%"),a(2),s("width","13%"),a(2),s("width","13%"),a(2),s("width","1.8%"),a(8),u(h(99,67,n.totalAmount||0,"PKR")),a(3),u(h(102,70,n.totalPaid||0,"PKR")),a(3),u(n.latestDate?h(105,73,n.latestDate,"dd MMM yyyy"):"---"),a(3),u(h(108,76,n.totalBalance||0,"PKR")),a(3),s("nzSize","small"),a(),s("nzType",n.employeeExpanded?"up":"down"),a(),s("ngIf",n.employeeExpanded),a(),N("nzVisible",n.showAddAmountRecieved),s("nzTitle",n.addingAmountRecieved?"Add Recieved Amount":"Pay Amount to "+(n.selectedEmployee==null||n.selectedEmployee.employee==null?null:n.selectedEmployee.employee.employee.name))("nzOkDisabled",n.addAmmountRecievedForm.invalid)("nzOkLoading",n.isOkLoading),a(2),s("nzClosable",!1)("nzVisible",n.visible)("nzTitle","Employee: "+(n.selectedEmployee==null||n.selectedEmployee.employee==null?null:n.selectedEmployee.employee.employee.name))("nzWidth",n.isMobile()?"100%":"50%"))},dependencies:[P,A,F,V,B,Ce,ce,yt,ze,ve,X,q,_t,xe,be,Se,$,ue,de,J,j,Y,ee,Z,Q,ot,L,G,ye,ge,fe,re,Me,oe,ne]})}}return i})();function Ri(i,c){if(i&1&&(r(0,"tr")(1,"td"),l(2),o(),r(3,"td"),l(4),y(5,"currency"),o(),r(6,"td"),l(7),y(8,"currency"),o(),r(9,"td"),l(10),y(11,"currency"),o(),r(12,"td"),l(13),y(14,"currency"),o()()),i&2){let e=c.$implicit;a(2),u(e.client),a(2),u(h(5,5,e.budget,e.currency)),a(3),u(h(8,8,e.budgetPKR,"PKR")),a(3),u(h(11,11,e.expense,"PKR")),a(3),u(h(14,14,e.profit,"PKR"))}}var Dt=(()=>{class i{constructor(e,t){this.appService=e,this.employeeManagementService=t,this.isMobile=this.appService.isMobile,this.appPermissions=k,this.today=new Date,this.amountPayment=0,this.advanceAmount=0,this.paymentDescription="",this.advancePayment=!0,this.disablePayment=!1,this.payments=[],this.budegetExpanded=!1,this.employeeExpanded=!1,this.showAddAmountRecieved=!1,this.projectBudgetSummary=[{client:"Client",currency:"PKR",budgetPKR:0,budget:1e3,expense:7e3,profit:3e3}],this.projectBudgetDetail={summary:{budget:"10000",recieved:"7000",recieving_date:new Date,balance:"3000"},details:[{recieved:"2000",recieving_date:new Date},{recieved:"3000",recieving_date:new Date},{recieved:"2000",recieving_date:new Date}]},this.visible=!1}addAmmountRecievedModal(){this.showAddAmountRecieved=!0,this.addAmmountRecievedForm.touched&&this.addAmmountRecievedForm.pristine&&this.addAmmountRecievedForm.reset()}handleRecieveAmountOk(){return C(this,null,function*(){try{this.isOkLoading=!0,yield this.addAmmountRecieved(),this.showAddAmountRecieved=!1,this.addAmmountRecievedForm.reset()}catch{}finally{this.showAddAmountRecieved=!1,this.isOkLoading=!1}})}addAmmountRecieved(){return C(this,null,function*(){yield this.appService.createClientPayment(this.addAmmountRecievedForm.value)})}getAmmountRecievedDetails(){return C(this,null,function*(){let e=yield this.appService.getClientBudgetRecievingDetails();e&&(e.summary.budget=this.currentClinet.projectBudget,e.summary.balance=this.currentClinet.projectBudget-e.summary.recieved,this.projectBudgetDetail=e)})}getExpenseSummary(){return C(this,null,function*(){this.projectBudgetSummary=[];let e=yield this.appService.getClientsExpenseSummary();e&&e.forEach(t=>this.projectBudgetSummary.push({client:t.name,expense:t.expense||0,currency:t.currency||"PKR",budget:t.budget||0,budgetPKR:this.appService.convertCurrency(t.budget||0,t.currency,"PKR"),profit:this.currentClinet.projectBudget||0-t.expense||0})),this.calculateTotals()})}calculateTotals(){this.totalBudgetPKR=this.projectBudgetSummary.reduce((e,t)=>e+Number(t.budgetPKR||0),0),this.totalExpense=this.projectBudgetSummary.reduce((e,t)=>e+Number(t.expense||0),0),this.totalProfit=this.projectBudgetSummary.reduce((e,t)=>e+Number(t.profit||0),0)}ngOnInit(){this.clientSubscription=this.appService.currentClient.subscribe(e=>{e&&e.id>0&&this.currentClientId!=e.id&&(this.setEmployeePayments(e.id),this.currentClientId=e.id,this.currentClinet=e)}),this.getExpenseSummary(),this.addAmmountRecievedForm=new _e({id:new W(0),amount:new W(0,[w.required]),recieving_date:new W(new Date,[w.required]),note:new W})}ngOnDestroy(){this.clientSubscription&&this.clientSubscription.unsubscribe}setEmployeePayments(e){return C(this,null,function*(){this.paymentData=yield this.appService.getEmployeePaymentsDetail(e)})}open(e){this.selectedEmployee=e,this.visible=!0,this.activeHourlyRateHistory=!1,this.activeAdvanceHistory=!1,this.amountPayment=0,this.advanceAmount=0,this.disablePayment=!1}close(){this.visible=!1}createPayment(){return C(this,null,function*(){let e={payment_type:"salary",employee:this.selectedEmployee.employee.id,payment_description:this.paymentDescription,amount:this.amountPayment,balance:this.selectedEmployee.paymentObject.balance+this.selectedEmployee.paymentObject.totalAmount-this.amountPayment};yield this.appService.createPayment(e),this.visible=!1,this.paymentData=yield this.appService.getEmployeePaymentsDetail()})}getEmployeePayments(e){return C(this,null,function*(){e&&(this.payments=[],this.payments=yield this.appService.getPayments(this.selectedEmployee.employee.id))})}static{this.\u0275fac=function(t){return new(t||i)(b(I),b(te))}}static{this.\u0275cmp=D({type:i,selectors:[["app-payment-summary"]],decls:39,vars:15,consts:[["summaryTable",""],[2,"margin","10px"],["nzSpan","24"],["nzShowPagination","false",2,"width","auto",3,"nzPageSize","nzBordered"],[4,"ngFor","ngForOf"]],template:function(t,n){t&1&&(r(0,"nz-row",1)(1,"nz-col",2)(2,"h3"),l(3,"Payment Summary"),o()(),r(4,"nz-col",2)(5,"nz-table",3,0)(7,"thead")(8,"tr")(9,"th"),l(10,"Client"),o(),r(11,"th"),l(12,"Budget"),o(),r(13,"th"),l(14,"Budget(PKR)"),o(),r(15,"th"),l(16,"Expense"),o(),r(17,"th"),l(18,"Profit"),o()()(),r(19,"tbody"),d(20,Ri,15,17,"tr",4),o(),r(21,"tfoot")(22,"tr")(23,"td")(24,"b"),l(25,"Total:"),o()(),z(26,"td"),r(27,"td")(28,"b"),l(29),y(30,"currency"),o()(),r(31,"td")(32,"b"),l(33),y(34,"currency"),o()(),r(35,"td")(36,"b"),l(37),y(38,"currency"),o()()()()()()()),t&2&&(a(5),s("nzPageSize",1e3)("nzBordered",!0),a(15),s("ngForOf",n.projectBudgetSummary),a(9),u(h(30,6,n.totalBudgetPKR,"PKR")),a(4),u(h(34,9,n.totalExpense,"PKR")),a(4),u(h(38,12,n.totalProfit,"PKR")))},dependencies:[P,X,q,J,j,Y,ee,Z,Q,oe]})}}return i})();var Ai=[{path:"",component:St,data:{name:"All Employee"}},{path:"pay-processing",component:wt,data:{name:"Payment",permission:k.AddUpdatePayments},canActivate:[Ve]},{path:"client-processing",component:Dt,data:{name:"Budget Payment",permission:k.AddUpdatePayments},canActivate:[Ve]},{path:":employeeId",component:Te,data:{name:"Employee"}},{path:":userId/worklog",component:Et,data:{name:"Worklog"}}],Pt=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=pe({type:i})}static{this.\u0275inj=me({imports:[Ae.forChild(Ai),Ae]})}}return i})();var It=(()=>{class i{constructor(e){this.sanitizer=e}transform(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)}static{this.\u0275fac=function(t){return new(t||i)(b(Ye,16))}}static{this.\u0275pipe=Ue({name:"safe",type:i,pure:!0,standalone:!0})}}return i})();var Tt=et,Vi=Object.keys(Tt).map(i=>Tt[i]),Xn=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=pe({type:i})}static{this.\u0275inj=me({providers:[{provide:nt,useValue:it},{provide:tt,useValue:Vi},we,It],imports:[Pt,Xe,Ct,lt,at,zt]})}}return i})();export{Xn as EmployeeManagementModule};
