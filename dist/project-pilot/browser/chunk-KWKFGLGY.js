import{a as st}from"./chunk-C2GOQEZE.js";import{a as ot}from"./chunk-E7PBODKY.js";import{a as Q,b as Y}from"./chunk-MXRUSZEU.js";import{a as R}from"./chunk-WES5WHKE.js";import{a as H,m as P,n as A,t as N}from"./chunk-UQBFF3T4.js";import{$ as k,Ea as m,Fb as O,G as C,Ga as f,Hd as J,K as M,L as x,Nc as V,Qb as F,Sa as w,Sb as W,Tb as B,Ua as X,Uc as Z,Vc as q,Yb as L,Zb as G,_ as a,e as D,f as g,fa as S,fb as I,ia as s,lb as E,mb as j,ra as r,sa as l,ta as b,uc as K,vc as U,za as y}from"./chunk-RYV5VKQF.js";var T=D(ot());var tt=D(st());function rt(n,v){if(n&1&&(r(0,"nz-card",11),b(1,"highcharts-chart",12),l()),n&2){let t=y();a(),s("Highcharts",t.Highcharts)("options",t.siteChartOptions)("constructorType",t.chartConstructor)}}function ct(n,v){if(n&1&&(r(0,"nz-card",11),b(1,"highcharts-chart",12),l()),n&2){let t=y();a(),s("Highcharts",t.Highcharts)("options",t.chartOptions)("constructorType",t.chartConstructor)}}function lt(n,v){if(n&1&&(r(0,"nz-card"),b(1,"highcharts-chart",13),l()),n&2){let t=y();a(),s("Highcharts",t.Highcharts)("options",t.piechartOptions)("constructorType",t.chartConstructor)}}function pt(n,v){if(n&1&&b(0,"highcharts-chart",12),n&2){let t=y();s("Highcharts",t.Highcharts)("options",t.lineChartOptions)("constructorType",t.chartConstructor)}}(0,tt.default)(T);var et=(()=>{class n{constructor(t){this.appService=t,this.isHighcharts=typeof T=="object",this.title="UnivHighCharts",this.Highcharts=T,this.chartConstructor="chart",this.sitesGraphKeys=P,this.chartOptions={},this.siteChartOptions={},this.stateNames=A,this.piechartOptions={},this.lineChartOptions={},this.showTopTen=!1,this.currentOrganizationId=0,this.selectedItem="",this.showMonthly=!1,this.projectStats={},this.chartOptions={chart:{type:"gauge",plotBackgroundColor:"",plotBorderWidth:0,plotShadow:!1,height:"80%"},title:{text:"Progress %",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},pane:{startAngle:-90,endAngle:90,background:[],center:["50%","70%"],size:"100%"},credits:{enabled:!1},yAxis:{min:0,max:100,lineWidth:0,tickPositions:[0,50,100],tickLength:0,labels:{enabled:!1},plotBands:[{from:0,to:50,color:"#6A55FF",thickness:"50%"},{from:50,to:100,color:"#E0E0E0",thickness:"50%"}]},series:[{type:"gauge",name:"Progress",data:[52],dataLabels:{format:"{y} %",borderWidth:0,style:{fontSize:"18px",fontWeight:"bold"},y:20},dial:{radius:"100%",backgroundColor:"#4D4D4D",baseWidth:10,rearLength:"0%"},pivot:{backgroundColor:"#4D4D4D",radius:6}}]},this.siteChartOptions={chart:{type:"bar"},title:{text:"Task Breakdown by Status",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},credits:{enabled:!1},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},xAxis:{categories:[]},yAxis:{min:0,title:{text:"Tasks Count",align:"high"},labels:{overflow:"justify"}},series:[{type:"bar",name:"Tasks",data:[]}],plotOptions:{bar:{dataLabels:{enabled:!0}}}},this.piechartOptions={chart:{type:"pie"},title:{text:"Tasks By Severity",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},tooltip:{valueSuffix:"",style:{fontSize:"11px"}},credits:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.2f} %",distance:-30}}},series:[]},this.lineChartOptions={chart:{type:"column",backgroundColor:"transparent",height:218},credits:{enabled:!1},title:{text:"",align:"left",style:{fontSize:"12px",fontWeight:"bold"}},subtitle:{text:"",align:"left",style:{fontSize:"12px"}},plotOptions:{series:{label:{connectorAllowed:!1},pointStart:0}},xAxis:{categories:[]},series:[],responsive:{rules:[{condition:{maxWidth:500},chartOptions:{}}]},legend:{enabled:!0}}}ngAfterViewInit(){}ngOnDestroy(){}ngOnInit(){this.clientSubscription=this.appService.currentClient.subscribe(t=>{t&&t.id>0&&this.currentOrganizationId!=t.id&&(this.currentOrganizationId=t.id,this.currentClient=t,this.loadData())})}loadData(){return g(this,null,function*(){yield this.getProjectStats(this.currentOrganizationId),this.setProjectProgress(this.currentOrganizationId),this.loadStatistics(this.currentOrganizationId)})}loadStatistics(t){return g(this,null,function*(){this.showChart=!1;let o=this.projectStats.tasks,e=o.map(c=>c.siteName),d=[];o.forEach((c,p)=>{Object.entries(c).forEach(([i,u])=>{if(i!=="siteId"&&i!=="siteName")if(p===0)d.push({name:this.sitesGraphKeys[i],data:[u]});else{let z=d.find(_=>_.name===this.sitesGraphKeys[i]);z&&z.data.push(u)}})});let h={};this.projectStats.tasks.forEach(c=>{let p=this.stateNames[c.state];h[p]||(h[p]=0),h[p]++}),this.siteChartOptions.xAxis&&this.siteChartOptions.xAxis&&(this.siteChartOptions.xAxis.categories=Object.values(this.stateNames)),this.siteChartOptions.series&&this.siteChartOptions.series[0]&&(this.siteChartOptions.series[0].data=Object.keys(this.stateNames).map(c=>{let p=this.stateNames[c];return h[p]||0})),setTimeout(()=>{this.showChart=!0},100)})}getProjectStats(t=0){return g(this,null,function*(){this.projectStats=yield this.appService.getProjectStatsByClient(t),this.totalApprovedHours=this.projectStats.worklogs.reduce((o,e)=>o+(e.approved_hours||e.no_of_hours||0),0),this.paidApprovedHours=this.projectStats.worklogs.filter(o=>o.paid).reduce((o,e)=>o+(e.approved_hours||e.no_of_hours||0),0),this.totalEstimatedHours=this.calculateTotalEstimatedHours(this.projectStats.tasks)})}calculateTotalEstimatedHours(t){return t.reduce((o,e)=>{let d=new Date(e.start_date),h=new Date(e.due_date),p=Math.floor((h.getTime()-d.getTime())/(1e3*60*60*24))*8;return o+p},0)}setProjectProgress(t=0){return g(this,null,function*(){this.showTopTen=!1;let o=this.projectStats.tasks.length,e=this.projectStats.tasks.filter(i=>i.state===4).length,d=Math.round(e/o*100),h=[];h[0]={type:"gauge",name:"Progress",data:[d],dataLabels:{format:"{y} %",borderWidth:0,style:{fontSize:"18px",fontWeight:"bold"},y:20},dial:{radius:"100%",backgroundColor:"#4D4D4D",baseWidth:10,rearLength:"0%"},pivot:{backgroundColor:"#4D4D4D",radius:6}},this.chartOptions.series=h,this.chartOptions.yAxis={min:0,max:100,lineWidth:0,tickPositions:[0,50,100],tickLength:0,labels:{enabled:!1},plotBands:[{from:0,to:d,color:"#6A55FF",thickness:"50%"},{from:d,to:100,color:"#E0E0E0",thickness:"50%"}]};let c={Medium:0,Low:0,Critical:0,High:0};this.projectStats.tasks.forEach(i=>{let u=N[i.severity];u&&c[u]++});let p=[{name:"Tasks",colorByPoint:!0,data:[{name:"Low",y:c.Low,color:"#00FF00"},{name:"Medium",y:c.Medium,color:"#0000FF"},{name:"High",y:c.High,color:"#FF8000"},{name:"Critical",y:c.Critical,color:"#FF0000"}]}];this.piechartOptions.series=p,setTimeout(()=>{this.showTopTen=!0},100),this.setItemBasedTrend()})}setItemBasedTrend(){return g(this,null,function*(){this.showMonthly=!1;let t=this.projectStats.worklogs,o=this.projectStats.tasks,e={},d={},h=[],c=[];o.forEach(i=>{let u=new Date(i.start_date||i.due_date||new Date),z=new Date(i.due_date||i.start_date||new Date),at=Math.floor((z.getTime()-u.getTime())/(1e3*60*60*24))*8;e[i.id]=at,d[i.id]=0,h.push(i.id),c.push(i.task_no)}),t.forEach(i=>{let u=i.id;d[u]+=i.approved_hours||i.no_of_hours||0});let p=[{name:"Estimated Time",data:h.map(i=>e[i]||0),type:"column",color:"blue"},{name:"Consumed Time",data:h.map(i=>d[i]||0),type:"line",color:"red",marker:{enabled:!0}}];p[0].data=p[0].data.map((i,u)=>d[o[u].id]>i?{y:i,color:"red"}:i),this.lineChartOptions.xAxis&&(this.lineChartOptions.xAxis.categories=c,this.lineChartOptions.series=p),setTimeout(()=>{this.showMonthly=!0},100)})}static{this.\u0275fac=function(o){return new(o||n)(k(F))}}static{this.\u0275cmp=M({type:n,selectors:[["app-dashboard"]],decls:43,vars:56,consts:[[1,"dashboard"],["nzGutter","16",2,"margin-bottom","12px"],[1,"num_details",3,"nzSm","nzXs","nzMd","nzXl","nzXXl"],["nzGutter","8"],[3,"nzSm","nzXs","nzMd","nzXl","nzXXl"],[2,"margin-top","12px",";margin-bottom","12px",3,"title"],[2,"margin-top","12px","margin-bottom","12px",3,"title"],[2,"margin-top","12px","margin-bottom","12px"],["style","margin-bottom: 12px;",4,"ngIf"],[4,"ngIf"],["style","width: 100%;display: block;",3,"Highcharts","options","constructorType",4,"ngIf"],[2,"margin-bottom","12px"],[2,"width","100%","display","block",3,"Highcharts","options","constructorType"],[2,"width","100%","display","block","min-height","200px",3,"Highcharts","options","constructorType"]],template:function(o,e){o&1&&(r(0,"div",0)(1,"nz-row",1)(2,"nz-col",2)(3,"nz-row",3)(4,"nz-col",4)(5,"nz-card",5)(6,"h3"),m(7),l(),r(8,"h5"),m(9,"Budget: "),r(10,"b"),m(11),w(12,"currency"),l()(),r(13,"h5"),m(14,"Duration: "),r(15,"b"),m(16),l()()()(),r(17,"nz-col",4)(18,"nz-card",6)(19,"h3"),m(20," Estimated Hours"),l(),r(21,"h5"),m(22),l()()(),r(23,"nz-col",4)(24,"nz-card",6)(25,"h3"),m(26," Utilized Hours"),l(),r(27,"h5"),m(28),l()()(),r(29,"nz-col",4)(30,"nz-card",7)(31,"h3"),m(32," Paid hours"),l(),r(33,"h5"),m(34),l()()()()(),r(35,"nz-col",4),S(36,rt,2,3,"nz-card",8),l(),r(37,"nz-col",4),S(38,ct,2,3,"nz-card",8)(39,lt,2,3,"nz-card",9),l(),r(40,"nz-col",4)(41,"nz-card"),S(42,pt,1,3,"highcharts-chart",10),l()()()()),o&2&&(a(2),s("nzSm",24)("nzXs",24)("nzMd",24)("nzXl",24)("nzXXl",24),a(2),s("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),a(),s("title","Current Stock"),a(2),f(" ",e.currentClient==null?null:e.currentClient.name,""),a(4),f(" ",X(12,53,e.currentClient==null?null:e.currentClient.projectBudget,e.currentClient.currency),""),a(5),f(" ",e.currentClient==null?null:e.currentClient.projectDuration," hours"),a(),s("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),a(),s("title","Max Tasks"),a(4),f(" ",e.totalEstimatedHours,""),a(),s("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),a(),s("title","Max Tasks"),a(4),f(" ",e.totalApprovedHours,""),a(),s("nzSm",12)("nzXs",12)("nzMd",6)("nzXl",6)("nzXXl",6),a(5),f(" ",e.paidApprovedHours,""),a(),s("nzSm",24)("nzXs",24)("nzMd",17)("nzXl",17)("nzXXl",17),a(),s("ngIf",e.showChart),a(),s("nzSm",24)("nzXs",24)("nzMd",7)("nzXl",7)("nzXXl",7),a(),s("ngIf",e.showTopTen),a(),s("ngIf",e.showTopTen),a(),s("nzSm",24)("nzXs",24)("nzMd",24)("nzXl",24)("nzXXl",24),a(2),s("ngIf",e.showMonthly))},dependencies:[I,V,q,Z,Q,E],styles:[".green-button[_ngcontent-%COMP%]{background-color:#72e272}.green-button[_ngcontent-%COMP%], .default[_ngcontent-%COMP%]{font-size:11px;text-wrap:nowrap;border:none}[_nghost-%COMP%]{display:block;height:100%}.card-container[_ngcontent-%COMP%]     p{margin:0}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-content{margin-top:-16px;margin-bottom:16px}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-content>.ant-tabs-tabpane{background:#ffffffb6;padding:16px}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card>.ant-tabs-nav:before{display:none}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-tab{border-color:transparent;background:transparent}.card-container[_ngcontent-%COMP%]    >.ant-tabs-card .ant-tabs-tab-active{background:#ffffffb6}.num_details[_ngcontent-%COMP%]    >.ant-card-body{padding:4px}"]})}}return n})();var dt=[{path:"",component:et,data:{name:"Task Requests",permission:H.MainDashboard},canActivate:[R]}],it=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=x({type:n})}static{this.\u0275inj=C({imports:[O.forChild(dt),O]})}}return n})();var nt=W,ht=Object.keys(nt).map(n=>nt[n]),Ht=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=x({type:n})}static{this.\u0275inj=C({providers:[{provide:G,useValue:L},{provide:B,useValue:ht}],imports:[j,it,J,U,Y,K]})}}return n})();export{Ht as DashboardModule};
