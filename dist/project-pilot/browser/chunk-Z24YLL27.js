import{a as de}from"./chunk-BWS6N757.js";import{b as ee,e as mt,f as ct}from"./chunk-TFSPKEVB.js";import{a as Ge}from"./chunk-CXD6RW2A.js";import{a as F}from"./chunk-62EMLTDR.js";import"./chunk-MXNMPF3F.js";import{Ab as Ce,Bc as et,Ca as D,Cb as Fe,Cc as tt,D as Ee,Da as p,Ea as b,F as I,Fa as v,Fc as it,G as ie,Ha as O,I as De,Ia as W,J as f,Ja as V,K as h,Kc as se,Lb as N,Lc as le,M as Ie,Ma as Te,Mc as pe,N as ne,Na as Pe,Nb as Ae,Nc as me,Ob as He,Pa as Ne,Pb as Ue,Pc as nt,Qa as z,Qb as A,Ra as ge,Rb as H,Rc as ot,Sa as w,Sb as U,Sc as rt,Ta as k,Tb as je,Ub as Be,Yb as Re,Z as l,Zb as Le,_ as g,a as G,ac as $,cb as T,cc as M,db as P,dc as q,ec as $e,f as y,fb as oe,ga as u,hb as re,hc as ae,ia as c,ib as Me,jc as qe,jd as ce,ld as j,mc as Ye,na as ke,nc as Ke,nd as at,od as K,pc as Ze,qc as Xe,qd as Z,ra as s,rc as Y,rd as X,sa as a,sc as Je,sd as J,ta as S,tb as Oe,tc as Qe,td as Q,ua as R,va as L,vb as We,vd as st,wa as C,wd as lt,xa as _,xb as Ve,ya as m,yd as pt}from"./chunk-ALEK3DEW.js";function wt(t,o){if(t&1&&S(0,"nz-option",13),t&2){let n=o.$implicit;c("nzValue",n==null?null:n.id)("nzLabel",n==null?null:n.name)}}function Et(t,o){if(t&1&&(s(0,"nz-select",11),u(1,wt,1,2,"nz-option",12),a()),t&2){let n=m(2);l(),c("ngForOf",n.users)}}function Dt(t,o){if(t&1&&(s(0,"nz-form",3)(1,"div",4)(2,"div",5)(3,"nz-form-item")(4,"nz-form-label"),p(5,"JobSubject"),a(),s(6,"nz-form-control"),S(7,"input",6),a()()()(),s(8,"div",4)(9,"div",7)(10,"nz-form-item")(11,"nz-form-label"),p(12,"Employee"),a(),s(13,"nz-form-control"),u(14,Et,2,1,"nz-select",8),a()()()(),s(15,"div",4)(16,"div",5)(17,"nz-form-item")(18,"nz-form-label"),p(19,"HourlyRate"),a(),s(20,"nz-form-control"),S(21,"input",9),a()()()(),s(22,"div",4)(23,"div",5)(24,"nz-form-item")(25,"nz-form-label"),p(26,"Employement Details"),a(),s(27,"nz-form-control"),S(28,"textarea",10),a()()()()()),t&2){let n=m();c("formGroup",n.employeeForm),l(),c("nzGutter",8),l(7),c("nzGutter",8),l(6),c("ngIf",n.users.length),l(),c("nzGutter",8),l(7),c("nzGutter",8),l(6),c("rows",3)}}function It(t,o){if(t&1){let n=C();s(0,"div",14)(1,"button",15),_("click",function(){f(n);let i=m();return h(i.close())}),p(2,"Cancel"),a(),s(3,"button",16),_("click",function(){f(n);let i=m();return h(i.addUser())}),p(4,"Submit"),a()()}if(t&2){let n=m();l(3),c("disabled",!n.employeeForm.valid)}}var kt=()=>({overflow:"auto"}),fe=(()=>{let o=class o{constructor(e,i){this.appService=e,this.fb=i,this.visible=!1,this.users=[],this.userRoles=[],this.clients=[],this.editableItem={},this.isNew=!0,this.closeDrawer=new Ee,this.employeeForm=this.fb.group({id:[0,[]],employee:[0,[M.required]],position:["",[M.required]],salary:[0,[M.required]],organization:[parseInt(localStorage.getItem("organization_id")||"0")],client:[this.appService.currentSubOrgId],details:["",[M.required]]})}ngOnInit(){this.isNew&&this.employeeForm.reset(),this.employeeForm=this.fb.group({id:[this.editableItem.id],employee:[this.editableItem.employee,[M.required]],position:[this.editableItem.position,[M.required]],salary:[this.editableItem.salary,[M.required]],organization:[parseInt(localStorage.getItem("organization_id")||"0")],client:[this.editableItem.client],details:[this.editableItem.details,[M.required]]})}close(){this.closeDrawer.emit(!1)}addUser(){return y(this,null,function*(){console.log(this.employeeForm),this.isNew?yield this.appService.createEmployee({position:this.employeeForm.value.position,employee:this.employeeForm.value.employee,salary:this.employeeForm.value.salary,details:this.employeeForm.value.details}):yield this.appService.updateEmployee({id:this.editableItem.id,position:this.employeeForm.value.position,employee:this.employeeForm.value.employee,salary:this.employeeForm.value.salary,details:this.employeeForm.value.details}),this.closeDrawer.emit(!0)})}objectKeys(e){return Object.keys(e).map(i=>({key:i,value:e[i]}))}};o.\u0275fac=function(i){return new(i||o)(g(N),g(Ke))},o.\u0275cmp=I({type:o,selectors:[["app-employee-contract"]],inputs:{visible:"visible",users:"users",userRoles:"userRoles",clients:"clients",editableItem:"editableItem",isNew:"isNew"},outputs:{closeDrawer:"closeDrawer"},decls:4,vars:7,consts:[[3,"nzBodyStyle","nzMaskClosable","nzWidth","nzVisible","nzTitle","nzFooter","nzOnClose"],[3,"formGroup",4,"nzDrawerContent"],["footerTpl",""],[3,"formGroup"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","12"],["formControlName","position","nz-input","","placeholder","please enter user position"],["nz-col","","nz-col","","nzSpan","12"],["id","employee","formControlName","employee","placeholder","Select user",4,"ngIf"],["formControlName","salary","nz-input","","placeholder","please enter user salary"],["nz-input","","formControlName","details",3,"rows"],["id","employee","formControlName","employee","placeholder","Select user"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],[2,"float","right"],["nz-button","",2,"margin-right","8px",3,"click"],["nz-button","","nzType","primary",3,"disabled","click"]],template:function(i,r){if(i&1&&(s(0,"nz-drawer",0),_("nzOnClose",function(){return r.close()}),u(1,Dt,29,7,"nz-form",1)(2,It,5,1,"ng-template",null,2,k),a()),i&2){let d=D(3);c("nzBodyStyle",Te(6,kt))("nzMaskClosable",!1)("nzWidth",720)("nzVisible",r.visible)("nzTitle",r.isNew?"Create Employee":"Update Employee")("nzFooter",d)}},dependencies:[T,P,U,A,H,le,se,me,pe,nt,rt,ot,Y,et,tt,$,q,$e,qe,Ye]});let t=o;return t})();function Nt(t,o){if(t&1){let n=C();s(0,"span",14),_("click",function(){f(n);let i=m(2);return i.searchValue="",h(i.search())}),a()}}function Mt(t,o){t&1&&S(0,"span",15)}function Ot(t,o){if(t&1&&u(0,Nt,1,0,"span",13)(1,Mt,1,0),t&2){let n=m();ke(0,n.searchValue?0:1)}}function Wt(t,o){t&1&&S(0,"span",15)}function Vt(t,o){if(t&1){let n=C();s(0,"button",16),_("click",function(){f(n);let i=m();return h(i.open())}),p(1,"Add"),a()}}function Ft(t,o){if(t&1){let n=C();s(0,"app-employee-contract",17),_("closeDrawer",function(i){f(n);let r=m();return h(r.close(i))}),a()}if(t&2){let n=m();c("clients",n.clients)("visible",n.visible)("users",n.users)("editableItem",n.editableItem)("isNew",n.isNew)}}function At(t,o){if(t&1&&(s(0,"th",18),p(1),a()),t&2){let n=o.$implicit;c("nzSortFn",n.compare)("nzSortPriority",n.priority),l(),v(" ",n.title," ")}}function Ht(t,o){if(t&1){let n=C();s(0,"a",23),_("click",function(){f(n);let i=m(3).$implicit,r=m();return r.startEdit(i.id),h(r.open(!1))}),p(1,"Edit"),a()}}function Ut(t,o){if(t&1&&(R(0),s(1,"td"),p(2),z(3,"username"),a(),s(4,"td"),p(5),a(),s(6,"td"),p(7),a(),s(8,"td"),u(9,Ht,2,0,"a",22),a(),L()),t&2){let n=m(2).$implicit,e=m();l(2),b(ge(3,4,n.employee)),l(3),b(n.position),l(2),b(n.salary),l(2),c("appHasPermission",e.appPermissions.UpdateClientEmployee)}}function jt(t,o){if(t&1){let n=C();s(0,"td"),p(1),z(2,"username"),a(),s(3,"td")(4,"input",24),V("ngModelChange",function(i){f(n);let r=m(2).$implicit,d=m();return W(d.editCache[r.id].data.position,i)||(d.editCache[r.id].data.position=i),h(i)}),a()(),s(5,"td")(6,"input",24),V("ngModelChange",function(i){f(n);let r=m(2).$implicit,d=m();return W(d.editCache[r.id].data.salary,i)||(d.editCache[r.id].data.salary=i),h(i)}),a()(),s(7,"td")(8,"a",25),_("click",function(){f(n);let i=m(2).$implicit,r=m();return h(r.saveEdit(i.id))}),p(9,"Save"),a(),p(10," \xA0 "),s(11,"a",26),_("nzOnConfirm",function(){f(n);let i=m(2).$implicit,r=m();return h(r.cancelEdit(i.id))}),p(12,"Cancel"),a()()}if(t&2){let n=m(2).$implicit,e=m();l(),b(ge(2,3,n.employee)),l(3),O("ngModel",e.editCache[n.id].data.position),l(2),O("ngModel",e.editCache[n.id].data.salary)}}function Bt(t,o){if(t&1&&(s(0,"tr"),u(1,Ut,10,6,"ng-container",20)(2,jt,13,5,"ng-template",null,21,k),a()),t&2){let n=D(3),e=m().$implicit,i=m();l(),c("ngIf",!(i.editCache[e.id]!=null&&i.editCache[e.id].edit))("ngIfElse",n)}}var Rt=t=>[t],Lt=(t,o,n)=>({user:t,permissionName:0,isAdmin:o,isContractor:!1,userIds:n});function Gt(t,o){if(t&1&&(R(0),u(1,Bt,4,2,"tr",19),L()),t&2){let n=o.$implicit,e=m();l(),c("filterUser",Ne(3,Lt,e.loggedInUser,e.loggedInUser.is_admin,Pe(1,Rt,n.employee)))}}var ft=(()=>{let o=class o{constructor(e,i){this.appService=e,this.userService=i,this.listOfColumn=[{title:"Employee",compare:(r,d)=>r.employeeName.localeCompare(d.employeeName),priority:1},{title:"Position",compare:(r,d)=>r.position.localeCompare(d.position),priority:2},{title:"Action",compare:(r,d)=>(r.id||0)-(d.id||0),priority:5}],this.listOfData=[],this.users=[],this.visible=!1,this.appPermissions=F,this.listOfDisplayData=[],this.editCache={}}ngOnInit(){this.loggedInUser=this.userService.loggedInUser,this.getUsers(),this.loggedInUser.is_admin&&(this.listOfColumn.push({title:"HourlyRate",compare:(e,i)=>e.salary-i.salary,priority:3}),this.listOfColumn=this.listOfColumn.sort((e,i)=>e.priority-i.priority))}getUsers(){return y(this,null,function*(){this.users=yield this.userService.getOrganizationUsers(),this.clientSubscription=this.appService.currentClient.subscribe(e=>{e&&e.id>0&&this.currentOrganizationId!=e.id&&(this.populateEmployeeData(),this.currentOrganizationId=e.id)})})}ngOnDestroy(){this.clientSubscription&&this.clientSubscription.unsubscribe()}open(e=!0){this.visible=!0,this.isNew=e}close(e=!1){this.visible=!1,e&&this.populateEmployeeData()}populateEmployeeData(){return y(this,null,function*(){this.listOfData=yield this.appService.getOrganizationEmployees(),this.listOfDisplayData=this.listOfData,this.updateEditCache()})}startEdit(e){this.editableItem=this.editCache[e].data}cancelEdit(e){let i=this.listOfData.findIndex(r=>r.id===e);this.editCache[e]={data:G({},this.listOfData[i]),edit:!1}}saveEdit(e){return y(this,null,function*(){let i=this.listOfData.findIndex(r=>r.id===e);yield this.appService.updateEmployee({id:this.editCache[e].data.id,position:this.editCache[e].data.position,employee:this.editCache[e].data.employee,salary:this.editCache[e].data.salary,details:this.editCache[e].data.details}),this.editCache[e].edit=!1,Object.assign(this.listOfData[i],this.editCache[e].data),this.populateEmployeeData()})}updateEditCache(){this.listOfData.forEach(e=>{this.editCache[e.id]={edit:!1,data:G({},e)}})}search(){this.searchVisible=!1,this.searchValue?(this.listOfDisplayData=this.listOfData.filter(e=>e.employeeName&&e.employeeName.toLowerCase().indexOf(this.searchValue.toLowerCase())>-1||e.supervisorName&&e.supervisorName.toLowerCase().indexOf(this.searchValue.toLowerCase())>-1),console.log(this.listOfDisplayData)):this.listOfDisplayData=this.listOfData}};o.\u0275fac=function(i){return new(i||o)(g(N),g(Fe))},o.\u0275cmp=I({type:o,selectors:[["app-employee-management"]],decls:20,vars:9,consts:[[1,"flex","space-between"],[2,"display","-webkit-box","width","100%"],[2,"margin-right","5px"],[3,"nzSuffix"],["type","text","placeholder","Search here","nz-input","",3,"ngModel","ngModelChange","keyup"],["inputClearTpl",""],["suffixIconSearch",""],["nz-button","","nzType","primary",3,"click",4,"appHasPermission"],[3,"clients","visible","users","editableItem","isNew","closeDrawer",4,"ngIf"],["nzShowPagination","false",3,"nzPageSize","nzData"],["editRowTable","","sortTable",""],[3,"nzSortFn","nzSortPriority",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["nz-icon","","class","ant-input-clear-icon","nzTheme","fill","nzType","close-circle"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],["nz-icon","","nzType","search"],["nz-button","","nzType","primary",3,"click"],[3,"clients","visible","users","editableItem","isNew","closeDrawer"],[3,"nzSortFn","nzSortPriority"],[4,"filterUser"],[4,"ngIf","ngIfElse"],["editTemplate",""],[3,"click",4,"appHasPermission"],[3,"click"],["type","text","nz-input","",3,"ngModel","ngModelChange"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"]],template:function(i,r){if(i&1&&(s(0,"div",0)(1,"span",1)(2,"h3",2),p(3," Employees "),a(),s(4,"nz-input-group",3)(5,"input",4),V("ngModelChange",function(x){return W(r.searchValue,x)||(r.searchValue=x),x}),_("keyup",function(){return r.search()}),a()(),u(6,Ot,2,1,"ng-template",null,5,k)(8,Wt,1,0,"ng-template",null,6,k),a(),u(10,Vt,2,0,"button",7),a(),u(11,Ft,1,5,"app-employee-contract",8),s(12,"nz-table",9,10)(15,"thead")(16,"tr"),u(17,At,2,3,"th",11),a()(),s(18,"tbody"),u(19,Gt,2,7,"ng-container",12),a()()),i&2){let d=D(7),x=D(9),E=D(14);l(4),c("nzSuffix",x)("nzSuffix",d),l(),O("ngModel",r.searchValue),l(5),c("appHasPermission",r.appPermissions.UpdateClientEmployee),l(),c("ngIf",r.visible),l(),c("nzPageSize",1e3)("nzData",r.listOfDisplayData),l(5),c("ngForOf",r.listOfColumn),l(2),c("ngForOf",E.data)}},dependencies:[T,P,U,A,H,Ue,Y,Qe,Je,ce,X,at,j,K,Q,Z,J,$,q,ae,ee,mt,fe,de]});let t=o;return t})();var te=(()=>{let o=class o{constructor(){}calculateHourlyRate(e,i,r,d=!0){if(d)return e;{let x=i.getFullYear(),E=i.getMonth(),zt=new Date(x,E+1,0).getDate(),we=0;for(let ye=1;ye<=zt;ye++)new Date(x,E,ye).getDay()!==0&&we++;return e/(we*r)}}isDateInLastOrCurrentMonth(e){let i=new Date,r=i.getMonth(),d=i.getFullYear(),x=e.getMonth(),E=e.getFullYear();return d===E&&r===x||d===E&&r-1===x||d-1===E&&r===0&&x===11}getDifferenceInHours(e,i){let r=new Date(e).getHours()*3600+new Date(e).getMinutes()*60+new Date(e).getSeconds(),d=new Date(i).getHours()*3600+new Date(i).getMinutes()*60+new Date(i).getSeconds(),E=Math.abs(d-r)/3600;return isNaN(E)?0:E}calculateWorkingHours(e,i){return 8}};o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=Ie({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})();function $t(t,o){t&1&&(s(0,"th"),p(1," Action "),a())}function qt(t,o){if(t&1&&(s(0,"span"),p(1),a()),t&2){let n=m().$implicit;l(),v(" ",n.approved_hours," ")}}function Yt(t,o){if(t&1){let n=C();s(0,"input",13),_("ngModelChange",function(){f(n);let i=m().$implicit,r=m();return h(r.claculateAndSetAmount(i.id))}),V("ngModelChange",function(i){f(n);let r=m().$implicit,d=m();return d.editCache[r.id]==null||W(d.editCache[r.id].data.approved_hours,i)||(d.editCache[r.id].data.approved_hours=i),h(i)}),a()}if(t&2){let n=m().$implicit,e=m();O("ngModel",e.editCache[n.id]==null?null:e.editCache[n.id].data.approved_hours)}}function Kt(t,o){if(t&1&&(s(0,"span"),p(1),a()),t&2){let n=m().$implicit,e=m();l(),v(" ",(n.approved_hours||n.no_of_hours||0)*e.employee.salary," ")}}function Zt(t,o){if(t&1&&(s(0,"span"),p(1),a()),t&2){let n=m().$implicit,e=m();l(),v(" ",(e.editCache[n.id].data.approved_hours||e.editCache[n.id].data.no_of_hours||0)*e.employee.salary,"")}}function Xt(t,o){if(t&1){let n=C();s(0,"a",17),_("click",function(){f(n);let i=m(2).$implicit,r=m();return h(r.startEdit(i.id))}),p(1,"Edit"),a()}}function Jt(t,o){if(t&1){let n=C();s(0,"a",18),_("click",function(){f(n);let i=m(2).$implicit,r=m();return h(r.saveEdit(i.id))}),p(1,"Save"),a()}}function Qt(t,o){if(t&1){let n=C();s(0,"a",19),_("nzOnConfirm",function(){f(n);let i=m(2).$implicit,r=m();return h(r.cancelEdit(i.id))}),p(1,"Cancel"),a()}}function ei(t,o){if(t&1&&(s(0,"td"),u(1,Xt,2,0,"a",14)(2,Jt,2,0,"a",15),p(3," \xA0 "),u(4,Qt,2,0,"a",16),a()),t&2){let n=m().$implicit,e=m();l(),c("ngIf",!(e.editCache[n.id]!=null&&e.editCache[n.id].edit)&&!n.paid),l(),c("ngIf",e.editCache[n.id]==null?null:e.editCache[n.id].edit),l(2),c("ngIf",e.editCache[n.id]==null?null:e.editCache[n.id].edit)}}function ti(t,o){if(t&1&&(s(0,"tr")(1,"td"),p(2),z(3,"date"),a(),s(4,"td"),p(5),a(),s(6,"td"),p(7),a(),s(8,"td"),u(9,qt,2,1,"span",11)(10,Yt,1,1,"input",12),a(),s(11,"td"),u(12,Kt,2,1,"span",11)(13,Zt,2,1,"span",11),a(),u(14,ei,5,3,"td",2),a()),t&2){let n=o.$implicit,e=m();l(2),v("",w(3,8,n.date_created," dd MMM yyyy")," "),l(3),v("Task-",n.task.id,""),l(2),b(n.no_of_hours),l(2),c("ngIf",!(e.editCache[n.id]!=null&&e.editCache[n.id].edit)),l(),c("ngIf",e.editCache[n.id]==null?null:e.editCache[n.id].edit),l(2),c("ngIf",!(e.editCache[n.id]!=null&&e.editCache[n.id].edit)),l(),c("ngIf",e.editCache[n.id]==null?null:e.editCache[n.id].edit),l(),c("appHasPermission",e.appPermissions.AddUpdatePayments)}}function ii(t,o){if(t&1&&(s(0,"span",20),S(1,"span"),s(2,"span")(3,"b"),p(4),z(5,"currency"),a()()()),t&2){let n=m();l(4),v(" Total: ",w(5,1,n.totalAmount,"PKR "),"")}}function ni(t,o){if(t&1){let n=C();s(0,"button",21),_("click",function(){f(n);let i=m();return h(i.completeEmployeePayment())}),p(1," Pay"),a()}}var he=(()=>{let o=class o{constructor(e,i){this.appService=e,this.employeeManagementService=i,this.appPermissions=F,this.WorklogData=[],this.totalAmount=0,this.balanceAmount=0,this.editCache={}}ngOnInit(){this.getCurrentUserWorklog(),console.log(this.worklog)}sunscribeToGeoLocation(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{this.latitude=e.coords.latitude,this.longitude=e.coords.longitude})}getCurrentUserWorklog(){return y(this,null,function*(){let e=yield this.appService.getCurrentAddUpdateTaskWorklog(this.employee.employee.id);e&&this.initializeWorklogTableData(e),this.updateEditCache()})}initializeWorklogTableData(e){this.WorklogData=e,this.totalAmount=this.WorklogData.reduce((i,r)=>i+(Number(r.approved_hours||r.no_of_hours)||0)*this.employee.salary,0),this.balanceAmount==this.WorklogData.filter(i=>!i.paid).reduce((i,r)=>i+(Number(r.approved_hours||r.no_of_hours)||0)*this.employee.salary,0)}startEdit(e){this.editCache[e].edit=!0}cancelEdit(e){let i=this.WorklogData.findIndex(r=>r.id===e);this.editCache[e]={data:G({},this.WorklogData[i]),edit:!1}}claculateAndSetAmount(e){setTimeout(()=>{this.totalAmount=this.WorklogData.reduce((i,r,d)=>i+(Number((r.id==e?this.editCache[e].data.approved_hours:r.approved_hours)||r.no_of_hours)||0)*this.employee.salary,0),this.balanceAmount==this.WorklogData.filter(i=>!i.paid).reduce((i,r,d)=>i+(Number((r.id==e?this.editCache[e].data.approved_hours:r.approved_hours)||r.no_of_hours)||0)*this.employee.salary,0)},100)}signIn(e){this.editCache[e].data.sign_in_corrd=this.latitude+","+this.longitude}signOut(e){this.editCache[e].data.sign_out_corrd=this.latitude+","+this.longitude,this.editCache[e].data.hours_worked=Math.round(this.employeeManagementService.getDifferenceInHours(this.editCache[e].data.sign_in,this.editCache[e].data.sign_out));let i=this.employeeManagementService.calculateHourlyRate(this.employee.salary,this.editCache[e].data.date,8,!0);this.editCache[e].data.amount=i*this.employeeManagementService.calculateWorkingHours(this.employee,this.editCache[e].data.approved_hours||this.editCache[e].data.hours_worked)}saveEdit(e){return y(this,null,function*(){let i=this.WorklogData.findIndex(r=>r.id===e);this.editCache[e].data.id&&(yield this.appService.updateWorklog({id:e,approved_hours:this.editCache[e].data.approved_hours})),this.editCache[e].edit=!1,Object.assign(this.WorklogData[i],this.editCache[e].data),this.getCurrentUserWorklog()})}completeEmployeePayment(){return y(this,null,function*(){yield this.appService.payAddUpdateTaskWorklogs(this.employee.employee.id),this.getCurrentUserWorklog()})}updateEditCache(){this.WorklogData.forEach(e=>{this.editCache[e.id]={edit:!1,data:G({},e)}})}};o.\u0275fac=function(i){return new(i||o)(g(N),g(te))},o.\u0275cmp=I({type:o,selectors:[["app-worklog-details"]],inputs:{employee:"employee",worklog:"worklog"},decls:32,vars:14,consts:[["nzShowPagination","false",3,"nzPageSize","nzFooter","nzData","nzBordered"],["basicTable",""],[4,"appHasPermission"],[4,"ngFor","ngForOf"],["footerDetails",""],["nzGutter","4",2,"margin-top","12px"],[3,"nzMd","nzSm","nzXs"],[2,"width","100%","margin-top","12px"],[2,"width","100%","display","inline-block"],[1,"flex","space-between",2,"margin-bottom","10px"],["nz-button","","nzType","primary","style","margin-top: 12px;float: right;",3,"click",4,"appHasPermission"],[4,"ngIf"],["nz-input","",3,"ngModel","ngModelChange",4,"ngIf"],["nz-input","",3,"ngModel","ngModelChange"],[3,"click",4,"ngIf"],["class","save",3,"click",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm",4,"ngIf"],[3,"click"],[1,"save",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Sure to cancel?",3,"nzOnConfirm"],[1,"flex","space-between","center"],["nz-button","","nzType","primary",2,"margin-top","12px","float","right",3,"click"]],template:function(i,r){if(i&1&&(s(0,"nz-table",0,1)(2,"thead")(3,"tr")(4,"th"),p(5,"Date"),a(),s(6,"th"),p(7,"Task"),a(),s(8,"th"),p(9,"Hours Worked"),a(),s(10,"th"),p(11,"Approved Hours"),a(),s(12,"th"),p(13,"Amount"),a(),u(14,$t,2,0,"th",2),a()(),s(15,"tbody"),u(16,ti,15,11,"tr",3),a()(),u(17,ii,6,4,"ng-template",null,4,k),s(19,"nz-row",5)(20,"nz-col",6)(21,"nz-card",7)(22,"div",8)(23,"div")(24,"div",9)(25,"span")(26,"b"),p(27,"Balance:"),a()(),s(28,"span"),p(29),z(30,"currency"),a()(),u(31,ni,2,0,"button",10),a()()()()()),i&2){let d=D(18);c("nzPageSize",1e3)("nzFooter",d)("nzData",r.WorklogData)("nzBordered",!0),l(14),c("appHasPermission",r.appPermissions.AddUpdatePayments),l(2),c("ngForOf",r.WorklogData),l(4),c("nzMd",24)("nzSm",24)("nzXs",24),l(9),v(" ",w(30,11,r.balanceAmount||0,"PKR "),""),l(2),c("appHasPermission",r.appPermissions.AddUpdatePayments)}},dependencies:[T,P,U,A,H,it,me,pe,Y,ce,X,j,K,Q,Z,J,$,q,ae,ee,re,oe]});let t=o;return t})();function oi(t,o){if(t&1&&(s(0,"div"),p(1),z(2,"date"),a()),t&2){let n=m(2);l(),v(" ",w(2,1,n.signInTime,"hh:mm a"),"")}}function ri(t,o){if(t&1){let n=C();s(0,"button",7),_("click",function(){f(n);let i=m(2);return h(i.signIn())}),p(1,"Sign In"),a()}}function ai(t,o){if(t&1&&(s(0,"div"),p(1),z(2,"date"),a()),t&2){let n=m(2);l(),v(" ",w(2,1,n.signOutTime,"hh:mm a"),"")}}function si(t,o){if(t&1){let n=C();s(0,"button",7),_("click",function(){f(n);let i=m(2);return h(i.signOut())}),p(1,"Sign Out"),a()}}function li(t,o){if(t&1&&(s(0,"div",4)(1,"strong"),p(2),z(3,"date"),a(),u(4,oi,3,4,"div",5)(5,ri,2,0,"button",6)(6,ai,3,4,"div",5)(7,si,2,0,"button",6),a()),t&2){let n=m();l(2),b(w(3,5,n.currentDate,"longDate")),l(2),c("ngIf",n.signInTime),l(),c("ngIf",!n.signInTime),l(),c("ngIf",n.signOutTime),l(),c("ngIf",n.signInTime&&!n.signOutTime)}}function pi(t,o){if(t&1&&(s(0,"td"),p(1),a()),t&2){let n=m().$implicit;l(),b(n.employee==null?null:n.employee.employee.name)}}function mi(t,o){if(t&1&&S(0,"app-worklog-details",11),t&2){let n=m().$implicit;c("employee",n.employee)}}function ci(t,o){if(t&1&&(s(0,"nz-tab",8),u(1,pi,2,1,"ng-template",null,9,k)(3,mi,1,1,"app-worklog-details",10),a()),t&2){let n=o.$implicit,e=D(2);c("nzTitle",e),l(3),c("ngIf",n.employee)}}function di(t,o){t&1&&(R(0),s(1,"div",12)(2,"p"),p(3,"We need your location to provide the best experience. Please follow these steps to enable location access:"),a(),s(4,"ul")(5,"li")(6,"strong"),p(7,"Chrome:"),a(),p(8," Go to Settings > Privacy and Security > Site Settings > Location, and allow location access for this site."),a(),s(9,"li")(10,"strong"),p(11,"Firefox:"),a(),p(12," Go to Preferences > Privacy & Security > Permissions > Location, and allow location access for this site."),a(),s(13,"li")(14,"strong"),p(15,"Safari:"),a(),p(16," Go to Preferences > Websites > Location, and allow location access for this site. "),a()()(),L())}var yt=(()=>{let o=class o{constructor(e,i,r,d){this.route=e,this.router=i,this.appService=r,this.employeeManagementService=d,this.currentDate=new Date,this.supervisorUsers=[],this.currentDateWorklogIndex=0,this.isVisible=!1}ngOnInit(){this.clientSubscription=this.appService.currentClient.subscribe(e=>{e&&e.id>0&&this.currentOrganizationId!=e.id&&(this.currentOrganizationId=e.id,this.route.paramMap.subscribe(i=>{e&&e.id>0&&i.get("userId")&&(this.currentUserId=parseInt(i.get("userId")||"0"),this.setCurrentUserDetails(e.id))}))}),this.sunscribeToGeoLocation()}handleOk(){this.isVisible=!1}sunscribeToGeoLocation(){setTimeout(()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{this.longitude=e.coords.longitude,this.latitude=e.coords.latitude},e=>{switch(console.error(`Error occurred: ${e.message}`),this.isVisible=!0,e.code){case e.PERMISSION_DENIED:alert("User denied the request for Geolocation.");break;case e.TASKSITION_UNAVAILABLE:alert("Location information is unavailable.");break;case e.TIMEOUT:alert("The request to get user location timed out.");break}this.router.navigate(["employee"])}):(alert("Geolocation is not supported by this browser."),this.router.navigate(["employee"]))},2e3)}setCurrentUserDetails(e){return y(this,null,function*(){this.employee=yield this.appService.getEmployeeDetail(this.currentUserId,e),this.employee&&this.employee.id&&this.getCurrentDayWorklog(this.employee.id),this.fetchSupervisorUsers()})}getCurrentDayWorklog(e){return y(this,null,function*(){let i=yield this.appService.getCurrentDateWorklog(e);this.processCurentDayWorklog(i)})}processCurentDayWorklog(e){e?(this.currentDateWorklogIndex=e.id,e.sign_in&&(this.signInTime=new Date(e.sign_in)),e.sign_out&&(this.signOutTime=new Date(e.sign_out))):this.currentDateWorklogIndex=0}signIn(){return y(this,null,function*(){let e=yield this.appService.createWorklog({employee:this.employee.id,sign_in:new Date,sign_in_corrd:this.latitude+","+this.longitude});this.processCurentDayWorklog(e)})}signOut(){return y(this,null,function*(){let e=Math.round(this.employeeManagementService.getDifferenceInHours(this.signInTime,new Date)),r=this.employeeManagementService.calculateHourlyRate(this.employee.salary,new Date,8,!0)*this.employeeManagementService.calculateWorkingHours(this.employee,e),d=yield this.appService.updateWorklog({id:this.currentDateWorklogIndex,sign_out:new Date,sign_out_corrd:this.latitude+","+this.longitude,hours_worked:e,amount:r});this.processCurentDayWorklog(d)})}fetchSupervisorUsers(){return y(this,null,function*(){this.supervisorUsers=[],this.employee&&this.employee.id&&this.supervisorUsers.push({employee:this.employee,isSupervisor:!1});let e=yield this.appService.getCurrentEmployeeSubordinates(this.currentUserId);e&&e.length&&(this.supervisorUsers=[...this.supervisorUsers,...e.map(i=>({employee:i,isSupervisor:!0}))])})}generateUserData(){let e=new Date("2024-01-01"),i=new Date("2024-01-31"),r=[],d=new Date(e);for(;d<=i;)r.push({date:d}),d=new Date(d.setDate(d.getDate()+1));return r}ngOnDestroy(){this.clientSubscription&&this.clientSubscription.unsubscribe()}};o.\u0275fac=function(i){return new(i||o)(g(We),g(Ve),g(N),g(te))},o.\u0275cmp=I({type:o,selectors:[["app-worklog"]],decls:7,vars:4,consts:[["class","flex center space-between",4,"ngIf"],[3,"nzTitle",4,"ngFor","ngForOf"],["nzTitle","Enable Location",3,"nzVisible","nzCancelDisabled","nzVisibleChange","nzOnOk"],[4,"nzModalContent"],[1,"flex","center","space-between"],[4,"ngIf"],["nz-button","","nzType","primary","mat-button","",3,"click",4,"ngIf"],["nz-button","","nzType","primary","mat-button","",3,"click"],[3,"nzTitle"],["titleTemplate",""],[3,"employee",4,"ngIf"],[3,"employee"],["id","geolocation-error-message"]],template:function(i,r){i&1&&(s(0,"h3"),p(1,"Worklog"),a(),u(2,li,8,8,"div",0),s(3,"nz-tabset"),u(4,ci,4,2,"nz-tab",1),a(),s(5,"nz-modal",2),V("nzVisibleChange",function(x){return W(r.isVisible,x)||(r.isVisible=x),x}),_("nzOnOk",function(){return r.handleOk()}),u(6,di,17,0,"ng-container",3),a()),i&2&&(l(2),c("ngIf",r.employee&&r.employee.id),l(2),c("ngForOf",r.supervisorUsers),l(),O("nzVisible",r.isVisible),c("nzCancelDisabled",!0))},dependencies:[T,P,U,A,H,Le,Re,j,lt,st,he,oe]});let t=o;return t})();function ui(t,o){if(t&1){let n=C();s(0,"a",6),_("click",function(){f(n);let i=m().$implicit,r=m();return h(r.open(i))}),p(1,"Pay"),a()}}function _i(t,o){if(t&1&&(s(0,"tr")(1,"td"),p(2),a(),s(3,"td"),p(4),z(5,"currency"),a(),s(6,"td"),p(7),z(8,"currency"),a(),s(9,"td"),p(10),z(11,"currency"),a(),s(12,"td"),u(13,ui,2,0,"a",5),a()()),t&2){let n=o.$implicit,e=m();l(2),v("",n.employee==null||n.employee.employee==null?null:n.employee.employee.name," "),l(2),v("",w(5,5,n.employee==null?null:n.employee.salary," ")," "),l(3),b(w(8,8,(n.paymentObject==null?null:n.paymentObject.totalAmount)||0," ")),l(3),v("",w(11,11,(n.paymentObject==null?null:n.paymentObject.balance)||0," ")," "),l(3),c("appHasPermission",e.appPermissions.EmployeeHourlyRateManagment)}}function fi(t,o){if(t&1&&S(0,"app-worklog-details",8),t&2){let n=m(2);c("worklog",n.selectedEmployee.worklog)("employee",n.selectedEmployee.employee)}}function hi(t,o){if(t&1&&(R(0),s(1,"h3")(2,"strong"),p(3,"Worklog and Payments "),a()(),u(4,fi,1,2,"app-worklog-details",7),L()),t&2){let n=m();l(4),c("ngIf",n.selectedEmployee)}}var gt=(()=>{let o=class o{constructor(e,i){this.appService=e,this.employeeManagementService=i,this.isMobile=this.appService.isMobile,this.appPermissions=F,this.today=new Date,this.amountPayment=0,this.advanceAmount=0,this.paymentDescription="",this.advancePayment=!0,this.disablePayment=!1,this.payments=[],this.visible=!1}ngOnInit(){this.clientSubscription=this.appService.currentClient.subscribe(e=>{e&&e.id>0&&this.currentOrganizationId!=e.id&&(this.setEmployeePayments(e.id),this.currentOrganizationId=e.id)})}ngOnDestroy(){this.clientSubscription&&this.clientSubscription.unsubscribe}setEmployeePayments(e){return y(this,null,function*(){this.paymentData=yield this.appService.getEmployeePaymentsDetail(e)})}open(e){this.selectedEmployee=e,this.visible=!0,this.activeHourlyRateHistory=!1,this.activeAdvanceHistory=!1,this.amountPayment=0,this.advanceAmount=0,this.disablePayment=!1}close(){this.visible=!1}createPayment(){return y(this,null,function*(){let e={payment_type:"salary",employee:this.selectedEmployee.employee.id,payment_description:this.paymentDescription,amount:this.amountPayment,balance:this.selectedEmployee.paymentObject.balance+this.selectedEmployee.paymentObject.totalAmount-this.amountPayment};yield this.appService.createPayment(e),this.visible=!1,this.paymentData=yield this.appService.getEmployeePaymentsDetail()})}getEmployeePayments(e){return y(this,null,function*(){e&&(this.payments=[],this.payments=yield this.appService.getPayments(this.selectedEmployee.employee.id))})}};o.\u0275fac=function(i){return new(i||o)(g(N),g(te))},o.\u0275cmp=I({type:o,selectors:[["app-pay-processing"]],decls:20,vars:8,consts:[["nzShowPagination","false",3,"nzPageSize","nzData","nzBordered"],["basicTable",""],[4,"ngFor","ngForOf"],["nzPlacement","right",3,"nzClosable","nzVisible","nzTitle","nzWidth","nzOnClose"],[4,"nzDrawerContent"],["nzType","primary",3,"click",4,"appHasPermission"],["nzType","primary",3,"click"],[3,"worklog","employee",4,"ngIf"],[3,"worklog","employee"]],template:function(i,r){i&1&&(s(0,"h3"),p(1,"Employee Payments"),a(),s(2,"nz-table",0,1)(4,"thead")(5,"tr")(6,"th"),p(7,"Employee"),a(),s(8,"th"),p(9,"Hourly Rate"),a(),s(10,"th"),p(11,"Amount"),a(),s(12,"th"),p(13,"Balance"),a(),s(14,"th"),p(15," Proceed For Payment "),a()()(),s(16,"tbody"),u(17,_i,14,14,"tr",2),a()(),s(18,"nz-drawer",3),_("nzOnClose",function(){return r.close()}),u(19,hi,5,1,"ng-container",4),a()),i&2&&(l(2),c("nzPageSize",1e3)("nzData",r.paymentData)("nzBordered",!0),l(15),c("ngForOf",r.paymentData),l(),c("nzClosable",!1)("nzVisible",r.visible)("nzTitle","Employee: "+(r.selectedEmployee==null||r.selectedEmployee.employee==null?null:r.selectedEmployee.employee.employee.name))("nzWidth",r.isMobile()?"100%":"50%"))},dependencies:[T,P,le,se,X,j,K,Q,Z,J,ee,he,re]});let t=o;return t})();var yi=[{path:"",component:ft,data:{name:"All Employee"}},{path:"pay-processing",component:gt,data:{name:"Payment",permission:F.EmployeeHourlyRateManagment},canActivate:[Ge]},{path:":employeeId",component:fe,data:{name:"Employee"}},{path:":userId/worklog",component:yt,data:{name:"Worklog"}}],Ct=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=ie({type:o}),o.\u0275inj=ne({imports:[Ce.forChild(yi),Ce]});let t=o;return t})();var xt=(()=>{let o=class o{constructor(e){this.sanitizer=e}transform(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)}};o.\u0275fac=function(i){return new(i||o)(g(Oe,16))},o.\u0275pipe=De({name:"safe",type:o,pure:!0,standalone:!0});let t=o;return t})();var vt=Ae,gi=Object.keys(vt).map(t=>vt[t]),bn=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=ie({type:o}),o.\u0275inj=ne({providers:[{provide:Be,useValue:je},{provide:He,useValue:gi},de,xt],imports:[Ct,Me,pt,Xe,Ze,ct]});let t=o;return t})();export{bn as EmployeeManagementModule};
